var U9=Object.defineProperty;var $9=(n,e,t)=>e in n?U9(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var O=(n,e,t)=>$9(n,typeof e!="symbol"?e+"":e,t);function H9(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function za(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mv={exports:{}},Ld={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZP;function K9(){if(ZP)return Ld;ZP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var a=null;if(s!==void 0&&(a=""+s),i.key!==void 0&&(a=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:a,ref:i!==void 0?i:null,props:s}}return Ld.Fragment=e,Ld.jsx=t,Ld.jsxs=t,Ld}var QP;function q9(){return QP||(QP=1,Mv.exports=K9()),Mv.exports}var p=q9(),Av={exports:{}},Xe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JP;function G9(){if(JP)return Xe;JP=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.iterator;function m(B){return B===null||typeof B!="object"?null:(B=g&&B[g]||B["@@iterator"],typeof B=="function"?B:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,x={};function w(B,re,me){this.props=B,this.context=re,this.refs=x,this.updater=me||S}w.prototype.isReactComponent={},w.prototype.setState=function(B,re){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,re,"setState")},w.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function _(){}_.prototype=w.prototype;function E(B,re,me){this.props=B,this.context=re,this.refs=x,this.updater=me||S}var M=E.prototype=new _;M.constructor=E,b(M,w.prototype),M.isPureReactComponent=!0;var I=Array.isArray,A={H:null,A:null,T:null,S:null},j=Object.prototype.hasOwnProperty;function D(B,re,me,de,ye,ge){return me=ge.ref,{$$typeof:n,type:B,key:re,ref:me!==void 0?me:null,props:ge}}function R(B,re){return D(B.type,re,void 0,void 0,void 0,B.props)}function q(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function L(B){var re={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(me){return re[me]})}var K=/\/+/g;function G(B,re){return typeof B=="object"&&B!==null&&B.key!=null?L(""+B.key):re.toString(36)}function z(){}function U(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(z,z):(B.status="pending",B.then(function(re){B.status==="pending"&&(B.status="fulfilled",B.value=re)},function(re){B.status==="pending"&&(B.status="rejected",B.reason=re)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Y(B,re,me,de,ye){var ge=typeof B;(ge==="undefined"||ge==="boolean")&&(B=null);var Ie=!1;if(B===null)Ie=!0;else switch(ge){case"bigint":case"string":case"number":Ie=!0;break;case"object":switch(B.$$typeof){case n:case e:Ie=!0;break;case f:return Ie=B._init,Y(Ie(B._payload),re,me,de,ye)}}if(Ie)return ye=ye(B),Ie=de===""?"."+G(B,0):de,I(ye)?(me="",Ie!=null&&(me=Ie.replace(K,"$&/")+"/"),Y(ye,re,me,"",function(Te){return Te})):ye!=null&&(q(ye)&&(ye=R(ye,me+(ye.key==null||B&&B.key===ye.key?"":(""+ye.key).replace(K,"$&/")+"/")+Ie)),re.push(ye)),1;Ie=0;var Ne=de===""?".":de+":";if(I(B))for(var we=0;we<B.length;we++)de=B[we],ge=Ne+G(de,we),Ie+=Y(de,re,me,ge,ye);else if(we=m(B),typeof we=="function")for(B=we.call(B),we=0;!(de=B.next()).done;)de=de.value,ge=Ne+G(de,we++),Ie+=Y(de,re,me,ge,ye);else if(ge==="object"){if(typeof B.then=="function")return Y(U(B),re,me,de,ye);throw re=String(B),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.")}return Ie}function H(B,re,me){if(B==null)return B;var de=[],ye=0;return Y(B,de,"","",function(ge){return re.call(me,ge,ye++)}),de}function X(B){if(B._status===-1){var re=B._result;re=re(),re.then(function(me){(B._status===0||B._status===-1)&&(B._status=1,B._result=me)},function(me){(B._status===0||B._status===-1)&&(B._status=2,B._result=me)}),B._status===-1&&(B._status=0,B._result=re)}if(B._status===1)return B._result.default;throw B._result}var V=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var re=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(re))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function ie(){}return Xe.Children={map:H,forEach:function(B,re,me){H(B,function(){re.apply(this,arguments)},me)},count:function(B){var re=0;return H(B,function(){re++}),re},toArray:function(B){return H(B,function(re){return re})||[]},only:function(B){if(!q(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},Xe.Component=w,Xe.Fragment=t,Xe.Profiler=i,Xe.PureComponent=E,Xe.StrictMode=r,Xe.Suspense=u,Xe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,Xe.act=function(){throw Error("act(...) is not supported in production builds of React.")},Xe.cache=function(B){return function(){return B.apply(null,arguments)}},Xe.cloneElement=function(B,re,me){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var de=b({},B.props),ye=B.key,ge=void 0;if(re!=null)for(Ie in re.ref!==void 0&&(ge=void 0),re.key!==void 0&&(ye=""+re.key),re)!j.call(re,Ie)||Ie==="key"||Ie==="__self"||Ie==="__source"||Ie==="ref"&&re.ref===void 0||(de[Ie]=re[Ie]);var Ie=arguments.length-2;if(Ie===1)de.children=me;else if(1<Ie){for(var Ne=Array(Ie),we=0;we<Ie;we++)Ne[we]=arguments[we+2];de.children=Ne}return D(B.type,ye,void 0,void 0,ge,de)},Xe.createContext=function(B){return B={$$typeof:a,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:s,_context:B},B},Xe.createElement=function(B,re,me){var de,ye={},ge=null;if(re!=null)for(de in re.key!==void 0&&(ge=""+re.key),re)j.call(re,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(ye[de]=re[de]);var Ie=arguments.length-2;if(Ie===1)ye.children=me;else if(1<Ie){for(var Ne=Array(Ie),we=0;we<Ie;we++)Ne[we]=arguments[we+2];ye.children=Ne}if(B&&B.defaultProps)for(de in Ie=B.defaultProps,Ie)ye[de]===void 0&&(ye[de]=Ie[de]);return D(B,ge,void 0,void 0,null,ye)},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(B){return{$$typeof:l,render:B}},Xe.isValidElement=q,Xe.lazy=function(B){return{$$typeof:f,_payload:{_status:-1,_result:B},_init:X}},Xe.memo=function(B,re){return{$$typeof:d,type:B,compare:re===void 0?null:re}},Xe.startTransition=function(B){var re=A.T,me={};A.T=me;try{var de=B(),ye=A.S;ye!==null&&ye(me,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(ie,V)}catch(ge){V(ge)}finally{A.T=re}},Xe.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},Xe.use=function(B){return A.H.use(B)},Xe.useActionState=function(B,re,me){return A.H.useActionState(B,re,me)},Xe.useCallback=function(B,re){return A.H.useCallback(B,re)},Xe.useContext=function(B){return A.H.useContext(B)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(B,re){return A.H.useDeferredValue(B,re)},Xe.useEffect=function(B,re){return A.H.useEffect(B,re)},Xe.useId=function(){return A.H.useId()},Xe.useImperativeHandle=function(B,re,me){return A.H.useImperativeHandle(B,re,me)},Xe.useInsertionEffect=function(B,re){return A.H.useInsertionEffect(B,re)},Xe.useLayoutEffect=function(B,re){return A.H.useLayoutEffect(B,re)},Xe.useMemo=function(B,re){return A.H.useMemo(B,re)},Xe.useOptimistic=function(B,re){return A.H.useOptimistic(B,re)},Xe.useReducer=function(B,re,me){return A.H.useReducer(B,re,me)},Xe.useRef=function(B){return A.H.useRef(B)},Xe.useState=function(B){return A.H.useState(B)},Xe.useSyncExternalStore=function(B,re,me){return A.H.useSyncExternalStore(B,re,me)},Xe.useTransition=function(){return A.H.useTransition()},Xe.version="19.0.0",Xe}var eT;function p1(){return eT||(eT=1,Av.exports=G9()),Av.exports}var T=p1();const ct=za(T),Y9=H9({__proto__:null,default:ct},[T]);var kv={exports:{}},Nd={},jv={exports:{}},Ov={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tT;function V9(){return tT||(tT=1,function(n){function e(H,X){var V=H.length;H.push(X);e:for(;0<V;){var ie=V-1>>>1,B=H[ie];if(0<i(B,X))H[ie]=X,H[V]=B,V=ie;else break e}}function t(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var X=H[0],V=H.pop();if(V!==X){H[0]=V;e:for(var ie=0,B=H.length,re=B>>>1;ie<re;){var me=2*(ie+1)-1,de=H[me],ye=me+1,ge=H[ye];if(0>i(de,V))ye<B&&0>i(ge,de)?(H[ie]=ge,H[ye]=V,ie=ye):(H[ie]=de,H[me]=V,ie=me);else if(ye<B&&0>i(ge,V))H[ie]=ge,H[ye]=V,ie=ye;else break e}}return X}function i(H,X){var V=H.sortIndex-X.sortIndex;return V!==0?V:H.id-X.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();n.unstable_now=function(){return a.now()-l}}var u=[],d=[],f=1,g=null,m=3,S=!1,b=!1,x=!1,w=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function M(H){for(var X=t(d);X!==null;){if(X.callback===null)r(d);else if(X.startTime<=H)r(d),X.sortIndex=X.expirationTime,e(u,X);else break;X=t(d)}}function I(H){if(x=!1,M(H),!b)if(t(u)!==null)b=!0,U();else{var X=t(d);X!==null&&Y(I,X.startTime-H)}}var A=!1,j=-1,D=5,R=-1;function q(){return!(n.unstable_now()-R<D)}function L(){if(A){var H=n.unstable_now();R=H;var X=!0;try{e:{b=!1,x&&(x=!1,_(j),j=-1),S=!0;var V=m;try{t:{for(M(H),g=t(u);g!==null&&!(g.expirationTime>H&&q());){var ie=g.callback;if(typeof ie=="function"){g.callback=null,m=g.priorityLevel;var B=ie(g.expirationTime<=H);if(H=n.unstable_now(),typeof B=="function"){g.callback=B,M(H),X=!0;break t}g===t(u)&&r(u),M(H)}else r(u);g=t(u)}if(g!==null)X=!0;else{var re=t(d);re!==null&&Y(I,re.startTime-H),X=!1}}break e}finally{g=null,m=V,S=!1}X=void 0}}finally{X?K():A=!1}}}var K;if(typeof E=="function")K=function(){E(L)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,z=G.port2;G.port1.onmessage=L,K=function(){z.postMessage(null)}}else K=function(){w(L,0)};function U(){A||(A=!0,K())}function Y(H,X){j=w(function(){H(n.unstable_now())},X)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){b||S||(b=!0,U())},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(H){switch(m){case 1:case 2:case 3:var X=3;break;default:X=m}var V=m;m=X;try{return H()}finally{m=V}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,X){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var V=m;m=H;try{return X()}finally{m=V}},n.unstable_scheduleCallback=function(H,X,V){var ie=n.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?ie+V:ie):V=ie,H){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=V+B,H={id:f++,callback:X,priorityLevel:H,startTime:V,expirationTime:B,sortIndex:-1},V>ie?(H.sortIndex=V,e(d,H),t(u)===null&&H===t(d)&&(x?(_(j),j=-1):x=!0,Y(I,V-ie))):(H.sortIndex=B,e(u,H),b||S||(b=!0,U())),H},n.unstable_shouldYield=q,n.unstable_wrapCallback=function(H){var X=m;return function(){var V=m;m=X;try{return H.apply(this,arguments)}finally{m=V}}}}(Ov)),Ov}var nT;function X9(){return nT||(nT=1,jv.exports=V9()),jv.exports}var Dv={exports:{}},Vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rT;function W9(){if(rT)return Vn;rT=1;var n=p1();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:d,implementation:f}}var a=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Vn.createPortal=function(u,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,f)},Vn.flushSync=function(u){var d=a.T,f=r.p;try{if(a.T=null,r.p=2,u)return u()}finally{a.T=d,r.p=f,r.d.f()}},Vn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},Vn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Vn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var f=d.as,g=l(f,d.crossOrigin),m=typeof d.integrity=="string"?d.integrity:void 0,S=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:m,fetchPriority:S}):f==="script"&&r.d.X(u,{crossOrigin:g,integrity:m,fetchPriority:S,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Vn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},Vn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,g=l(f,d.crossOrigin);r.d.L(u,f,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Vn.preloadModule=function(u,d){if(typeof u=="string")if(d){var f=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},Vn.requestFormReset=function(u){r.d.r(u)},Vn.unstable_batchedUpdates=function(u,d){return u(d)},Vn.useFormState=function(u,d,f){return a.H.useFormState(u,d,f)},Vn.useFormStatus=function(){return a.H.useHostTransitionStatus()},Vn.version="19.0.0",Vn}var iT;function mj(){if(iT)return Dv.exports;iT=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Dv.exports=W9(),Dv.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sT;function Z9(){if(sT)return Nd;sT=1;var n=X9(),e=p1(),t=mj();function r(o){var c="https://react.dev/errors/"+o;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)c+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}var s=Symbol.for("react.element"),a=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),S=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),I=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function j(o){return o===null||typeof o!="object"?null:(o=A&&o[A]||o["@@iterator"],typeof o=="function"?o:null)}var D=Symbol.for("react.client.reference");function R(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===D?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case u:return"Fragment";case l:return"Portal";case f:return"Profiler";case d:return"StrictMode";case x:return"Suspense";case w:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case S:return(o.displayName||"Context")+".Provider";case m:return(o._context.displayName||"Context")+".Consumer";case b:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case _:return c=o.displayName||null,c!==null?c:R(o.type)||"Memo";case E:c=o._payload,o=o._init;try{return R(o(c))}catch{}}return null}var q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=Object.assign,K,G;function z(o){if(K===void 0)try{throw Error()}catch(h){var c=h.stack.trim().match(/\n( *(at )?)/);K=c&&c[1]||"",G=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+K+o+G}var U=!1;function Y(o,c){if(!o||U)return"";U=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(c){var Se=function(){throw Error()};if(Object.defineProperty(Se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Se,[])}catch(le){var se=le}Reflect.construct(o,[],Se)}else{try{Se.call()}catch(le){se=le}o.call(Se.prototype)}}else{try{throw Error()}catch(le){se=le}(Se=o())&&typeof Se.catch=="function"&&Se.catch(function(){})}}catch(le){if(le&&se&&typeof le.stack=="string")return[le.stack,se.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=y.DetermineComponentFrameRoot(),k=C[0],N=C[1];if(k&&N){var $=k.split(`
`),Q=N.split(`
`);for(v=y=0;y<$.length&&!$[y].includes("DetermineComponentFrameRoot");)y++;for(;v<Q.length&&!Q[v].includes("DetermineComponentFrameRoot");)v++;if(y===$.length||v===Q.length)for(y=$.length-1,v=Q.length-1;1<=y&&0<=v&&$[y]!==Q[v];)v--;for(;1<=y&&0<=v;y--,v--)if($[y]!==Q[v]){if(y!==1||v!==1)do if(y--,v--,0>v||$[y]!==Q[v]){var ce=`
`+$[y].replace(" at new "," at ");return o.displayName&&ce.includes("<anonymous>")&&(ce=ce.replace("<anonymous>",o.displayName)),ce}while(1<=y&&0<=v);break}}}finally{U=!1,Error.prepareStackTrace=h}return(h=o?o.displayName||o.name:"")?z(h):""}function H(o){switch(o.tag){case 26:case 27:case 5:return z(o.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 15:return o=Y(o.type,!1),o;case 11:return o=Y(o.type.render,!1),o;case 1:return o=Y(o.type,!0),o;default:return""}}function X(o){try{var c="";do c+=H(o),o=o.return;while(o);return c}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function V(o){var c=o,h=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,c.flags&4098&&(h=c.return),o=c.return;while(o)}return c.tag===3?h:null}function ie(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function B(o){if(V(o)!==o)throw Error(r(188))}function re(o){var c=o.alternate;if(!c){if(c=V(o),c===null)throw Error(r(188));return c!==o?null:o}for(var h=o,y=c;;){var v=h.return;if(v===null)break;var C=v.alternate;if(C===null){if(y=v.return,y!==null){h=y;continue}break}if(v.child===C.child){for(C=v.child;C;){if(C===h)return B(v),o;if(C===y)return B(v),c;C=C.sibling}throw Error(r(188))}if(h.return!==y.return)h=v,y=C;else{for(var k=!1,N=v.child;N;){if(N===h){k=!0,h=v,y=C;break}if(N===y){k=!0,y=v,h=C;break}N=N.sibling}if(!k){for(N=C.child;N;){if(N===h){k=!0,h=C,y=v;break}if(N===y){k=!0,y=C,h=v;break}N=N.sibling}if(!k)throw Error(r(189))}}if(h.alternate!==y)throw Error(r(190))}if(h.tag!==3)throw Error(r(188));return h.stateNode.current===h?o:c}function me(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o;for(o=o.child;o!==null;){if(c=me(o),c!==null)return c;o=o.sibling}return null}var de=Array.isArray,ye=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ge={pending:!1,data:null,method:null,action:null},Ie=[],Ne=-1;function we(o){return{current:o}}function Te(o){0>Ne||(o.current=Ie[Ne],Ie[Ne]=null,Ne--)}function je(o,c){Ne++,Ie[Ne]=o.current,o.current=c}var He=we(null),Ft=we(null),at=we(null),Bt=we(null);function _t(o,c){switch(je(at,c),je(Ft,o),je(He,null),o=c.nodeType,o){case 9:case 11:c=(c=c.documentElement)&&(c=c.namespaceURI)?PP(c):0;break;default:if(o=o===8?c.parentNode:c,c=o.tagName,o=o.namespaceURI)o=PP(o),c=TP(o,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}Te(He),je(He,c)}function gt(){Te(He),Te(Ft),Te(at)}function Sr(o){o.memoizedState!==null&&je(Bt,o);var c=He.current,h=TP(c,o.type);c!==h&&(je(Ft,o),je(He,h))}function Hn(o){Ft.current===o&&(Te(He),Te(Ft)),Bt.current===o&&(Te(Bt),kd._currentValue=ge)}var vr=Object.prototype.hasOwnProperty,ci=n.unstable_scheduleCallback,Vs=n.unstable_cancelCallback,Ou=n.unstable_shouldYield,Du=n.unstable_requestPaint,br=n.unstable_now,Ru=n.unstable_getCurrentPriorityLevel,Wl=n.unstable_ImmediatePriority,Xs=n.unstable_UserBlockingPriority,Ni=n.unstable_NormalPriority,Zl=n.unstable_LowPriority,ae=n.unstable_IdlePriority,xe=n.log,Ue=n.unstable_setDisableYieldValue,bt=null,Gt=null;function xr(o){if(Gt&&typeof Gt.onCommitFiberRoot=="function")try{Gt.onCommitFiberRoot(bt,o,void 0,(o.current.flags&128)===128)}catch{}}function wr(o){if(typeof xe=="function"&&Ue(o),Gt&&typeof Gt.setStrictMode=="function")try{Gt.setStrictMode(bt,o)}catch{}}var Yt=Math.clz32?Math.clz32:Fi,zi=Math.log,ui=Math.LN2;function Fi(o){return o>>>=0,o===0?32:31-(zi(o)/ui|0)|0}var di=128,Ws=4194304;function Bi(o){var c=o&42;if(c!==0)return c;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function fs(o,c){var h=o.pendingLanes;if(h===0)return 0;var y=0,v=o.suspendedLanes,C=o.pingedLanes,k=o.warmLanes;o=o.finishedLanes!==0;var N=h&134217727;return N!==0?(h=N&~v,h!==0?y=Bi(h):(C&=N,C!==0?y=Bi(C):o||(k=N&~k,k!==0&&(y=Bi(k))))):(N=h&~v,N!==0?y=Bi(N):C!==0?y=Bi(C):o||(k=h&~k,k!==0&&(y=Bi(k)))),y===0?0:c!==0&&c!==y&&!(c&v)&&(v=y&-y,k=c&-c,v>=k||v===32&&(k&4194176)!==0)?c:y}function Zs(o,c){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&c)===0}function Lu(o,c){switch(o){case 1:case 2:case 4:case 8:return c+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ql(){var o=di;return di<<=1,!(di&4194176)&&(di=128),o}function Ko(){var o=Ws;return Ws<<=1,!(Ws&62914560)&&(Ws=4194304),o}function Nu(o){for(var c=[],h=0;31>h;h++)c.push(o);return c}function Wa(o,c){o.pendingLanes|=c,c!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function ky(o,c,h,y,v,C){var k=o.pendingLanes;o.pendingLanes=h,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=h,o.entangledLanes&=h,o.errorRecoveryDisabledLanes&=h,o.shellSuspendCounter=0;var N=o.entanglements,$=o.expirationTimes,Q=o.hiddenUpdates;for(h=k&~h;0<h;){var ce=31-Yt(h),Se=1<<ce;N[ce]=0,$[ce]=-1;var se=Q[ce];if(se!==null)for(Q[ce]=null,ce=0;ce<se.length;ce++){var le=se[ce];le!==null&&(le.lane&=-536870913)}h&=~Se}y!==0&&ff(o,y,0),C!==0&&v===0&&o.tag!==0&&(o.suspendedLanes|=C&~(k&~c))}function ff(o,c,h){o.pendingLanes|=c,o.suspendedLanes&=~c;var y=31-Yt(c);o.entangledLanes|=c,o.entanglements[y]=o.entanglements[y]|1073741824|h&4194218}function pf(o,c){var h=o.entangledLanes|=c;for(o=o.entanglements;h;){var y=31-Yt(h),v=1<<y;v&c|o[y]&c&&(o[y]|=c),h&=~v}}function zu(o){return o&=-o,2<o?8<o?o&134217727?32:268435456:8:2}function Jl(){var o=ye.p;return o!==0?o:(o=window.event,o===void 0?32:qP(o.type))}function Qs(o,c){var h=ye.p;try{return ye.p=o,c()}finally{ye.p=h}}var ps=Math.random().toString(36).slice(2),xn="__reactFiber$"+ps,Kn="__reactProps$"+ps,qo="__reactContainer$"+ps,Fu="__reactEvents$"+ps,Ui="__reactListeners$"+ps,jy="__reactHandles$"+ps,gf="__reactResources$"+ps,Za="__reactMarker$"+ps;function Bu(o){delete o[xn],delete o[Kn],delete o[Fu],delete o[Ui],delete o[jy]}function Js(o){var c=o[xn];if(c)return c;for(var h=o.parentNode;h;){if(c=h[qo]||h[xn]){if(h=c.alternate,c.child!==null||h!==null&&h.child!==null)for(o=AP(o);o!==null;){if(h=o[xn])return h;o=AP(o)}return c}o=h,h=o.parentNode}return null}function _r(o){if(o=o[xn]||o[qo]){var c=o.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return o}return null}function Qa(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o.stateNode;throw Error(r(33))}function Go(o){var c=o[gf];return c||(c=o[gf]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function hn(o){o[Za]=!0}var mf=new Set,yf={};function hi(o,c){Yo(o,c),Yo(o+"Capture",c)}function Yo(o,c){for(yf[o]=c,o=0;o<c.length;o++)mf.add(c[o])}var $i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gs=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sf={},vf={};function Oy(o){return vr.call(vf,o)?!0:vr.call(Sf,o)?!1:gs.test(o)?vf[o]=!0:(Sf[o]=!0,!1)}function ec(o,c,h){if(Oy(c))if(h===null)o.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":o.removeAttribute(c);return;case"boolean":var y=c.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){o.removeAttribute(c);return}}o.setAttribute(c,""+h)}}function tc(o,c,h){if(h===null)o.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(c);return}o.setAttribute(c,""+h)}}function Hi(o,c,h,y){if(y===null)o.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(h);return}o.setAttributeNS(c,h,""+y)}}function Mn(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function bf(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ja(o){var c=bf(o)?"checked":"value",h=Object.getOwnPropertyDescriptor(o.constructor.prototype,c),y=""+o[c];if(!o.hasOwnProperty(c)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var v=h.get,C=h.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return v.call(this)},set:function(k){y=""+k,C.call(this,k)}}),Object.defineProperty(o,c,{enumerable:h.enumerable}),{getValue:function(){return y},setValue:function(k){y=""+k},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function el(o){o._valueTracker||(o._valueTracker=Ja(o))}function Uu(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var h=c.getValue(),y="";return o&&(y=bf(o)?o.checked?"true":"false":o.value),o=y,o!==h?(c.setValue(o),!0):!1}function nc(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var Dy=/[\n"\\]/g;function Cr(o){return o.replace(Dy,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function $u(o,c,h,y,v,C,k,N){o.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?o.type=k:o.removeAttribute("type"),c!=null?k==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+Mn(c)):o.value!==""+Mn(c)&&(o.value=""+Mn(c)):k!=="submit"&&k!=="reset"||o.removeAttribute("value"),c!=null?Ku(o,k,Mn(c)):h!=null?Ku(o,k,Mn(h)):y!=null&&o.removeAttribute("value"),v==null&&C!=null&&(o.defaultChecked=!!C),v!=null&&(o.checked=v&&typeof v!="function"&&typeof v!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?o.name=""+Mn(N):o.removeAttribute("name")}function Hu(o,c,h,y,v,C,k,N){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(o.type=C),c!=null||h!=null){if(!(C!=="submit"&&C!=="reset"||c!=null))return;h=h!=null?""+Mn(h):"",c=c!=null?""+Mn(c):h,N||c===o.value||(o.value=c),o.defaultValue=c}y=y??v,y=typeof y!="function"&&typeof y!="symbol"&&!!y,o.checked=N?o.checked:!!y,o.defaultChecked=!!y,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(o.name=k)}function Ku(o,c,h){c==="number"&&nc(o.ownerDocument)===o||o.defaultValue===""+h||(o.defaultValue=""+h)}function Vo(o,c,h,y){if(o=o.options,c){c={};for(var v=0;v<h.length;v++)c["$"+h[v]]=!0;for(h=0;h<o.length;h++)v=c.hasOwnProperty("$"+o[h].value),o[h].selected!==v&&(o[h].selected=v),v&&y&&(o[h].defaultSelected=!0)}else{for(h=""+Mn(h),c=null,v=0;v<o.length;v++){if(o[v].value===h){o[v].selected=!0,y&&(o[v].defaultSelected=!0);return}c!==null||o[v].disabled||(c=o[v])}c!==null&&(c.selected=!0)}}function qu(o,c,h){if(c!=null&&(c=""+Mn(c),c!==o.value&&(o.value=c),h==null)){o.defaultValue!==c&&(o.defaultValue=c);return}o.defaultValue=h!=null?""+Mn(h):""}function tl(o,c,h,y){if(c==null){if(y!=null){if(h!=null)throw Error(r(92));if(de(y)){if(1<y.length)throw Error(r(93));y=y[0]}h=y}h==null&&(h=""),c=h}h=Mn(c),o.defaultValue=h,y=o.textContent,y===h&&y!==""&&y!==null&&(o.value=y)}function $r(o,c){if(c){var h=o.firstChild;if(h&&h===o.lastChild&&h.nodeType===3){h.nodeValue=c;return}}o.textContent=c}var Ry=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function xf(o,c,h){var y=c.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?y?o.setProperty(c,""):c==="float"?o.cssFloat="":o[c]="":y?o.setProperty(c,h):typeof h!="number"||h===0||Ry.has(c)?c==="float"?o.cssFloat=h:o[c]=(""+h).trim():o[c]=h+"px"}function Ki(o,c,h){if(c!=null&&typeof c!="object")throw Error(r(62));if(o=o.style,h!=null){for(var y in h)!h.hasOwnProperty(y)||c!=null&&c.hasOwnProperty(y)||(y.indexOf("--")===0?o.setProperty(y,""):y==="float"?o.cssFloat="":o[y]="");for(var v in c)y=c[v],c.hasOwnProperty(v)&&h[v]!==y&&xf(o,v,y)}else for(var C in c)c.hasOwnProperty(C)&&xf(o,C,c[C])}function Gu(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ly=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ny=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rc(o){return Ny.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var Yu=null;function qi(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var eo=null,Xo=null;function nl(o){var c=_r(o);if(c&&(o=c.stateNode)){var h=o[Kn]||null;e:switch(o=c.stateNode,c.type){case"input":if($u(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),c=h.name,h.type==="radio"&&c!=null){for(h=o;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Cr(""+c)+'"][type="radio"]'),c=0;c<h.length;c++){var y=h[c];if(y!==o&&y.form===o.form){var v=y[Kn]||null;if(!v)throw Error(r(90));$u(y,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<h.length;c++)y=h[c],y.form===o.form&&Uu(y)}break e;case"textarea":qu(o,h.value,h.defaultValue);break e;case"select":c=h.value,c!=null&&Vo(o,!!h.multiple,c,!1)}}}var Vu=!1;function ic(o,c,h){if(Vu)return o(c,h);Vu=!0;try{var y=o(c);return y}finally{if(Vu=!1,(eo!==null||Xo!==null)&&(tp(),eo&&(c=eo,o=Xo,Xo=eo=null,nl(c),o)))for(c=0;c<o.length;c++)nl(o[c])}}function rl(o,c){var h=o.stateNode;if(h===null)return null;var y=h[Kn]||null;if(y===null)return null;h=y[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(o=o.type,y=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!y;break e;default:o=!1}if(o)return null;if(h&&typeof h!="function")throw Error(r(231,c,typeof h));return h}var sc=!1;if($i)try{var Wo={};Object.defineProperty(Wo,"passive",{get:function(){sc=!0}}),window.addEventListener("test",Wo,Wo),window.removeEventListener("test",Wo,Wo)}catch{sc=!1}var Gi=null,to=null,il=null;function wf(){if(il)return il;var o,c=to,h=c.length,y,v="value"in Gi?Gi.value:Gi.textContent,C=v.length;for(o=0;o<h&&c[o]===v[o];o++);var k=h-o;for(y=1;y<=k&&c[h-y]===v[C-y];y++);return il=v.slice(o,1<y?1-y:void 0)}function oc(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function ac(){return!0}function F(){return!1}function W(o){function c(h,y,v,C,k){this._reactName=h,this._targetInst=v,this.type=y,this.nativeEvent=C,this.target=k,this.currentTarget=null;for(var N in o)o.hasOwnProperty(N)&&(h=o[N],this[N]=h?h(C):C[N]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?ac:F,this.isPropagationStopped=F,this}return L(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ac)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ac)},persist:function(){},isPersistent:ac}),c}var fe={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pe=W(fe),xt=L({},fe,{view:0,detail:0}),Ve=W(xt),Ot,en,Vt,Et=L({},xt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zy,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Vt&&(Vt&&o.type==="mousemove"?(Ot=o.screenX-Vt.screenX,en=o.screenY-Vt.screenY):en=Ot=0,Vt=o),Ot)},movementY:function(o){return"movementY"in o?o.movementY:en}}),qn=W(Et),Hr=L({},Et,{dataTransfer:0}),wn=W(Hr),Er=L({},xt,{relatedTarget:0}),Gn=W(Er),ms=L({},fe,{animationName:0,elapsedTime:0,pseudoElement:0}),Yi=W(ms),no=L({},fe,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),_f=W(no),lc=L({},fe,{data:0}),sl=W(lc),W8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Z8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Q8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function J8(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=Q8[o])?!!c[o]:!1}function zy(){return J8}var e7=L({},xt,{key:function(o){if(o.key){var c=W8[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=oc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Z8[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zy,charCode:function(o){return o.type==="keypress"?oc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?oc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),t7=W(e7),n7=L({},Et,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$C=W(n7),r7=L({},xt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zy}),i7=W(r7),s7=L({},fe,{propertyName:0,elapsedTime:0,pseudoElement:0}),o7=W(s7),a7=L({},Et,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),l7=W(a7),c7=L({},fe,{newState:0,oldState:0}),u7=W(c7),d7=[9,13,27,32],Fy=$i&&"CompositionEvent"in window,Xu=null;$i&&"documentMode"in document&&(Xu=document.documentMode);var h7=$i&&"TextEvent"in window&&!Xu,HC=$i&&(!Fy||Xu&&8<Xu&&11>=Xu),KC=" ",qC=!1;function GC(o,c){switch(o){case"keyup":return d7.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YC(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var cc=!1;function f7(o,c){switch(o){case"compositionend":return YC(c);case"keypress":return c.which!==32?null:(qC=!0,KC);case"textInput":return o=c.data,o===KC&&qC?null:o;default:return null}}function p7(o,c){if(cc)return o==="compositionend"||!Fy&&GC(o,c)?(o=wf(),il=to=Gi=null,cc=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return HC&&c.locale!=="ko"?null:c.data;default:return null}}var g7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function VC(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!g7[o.type]:c==="textarea"}function XC(o,c,h,y){eo?Xo?Xo.push(y):Xo=[y]:eo=y,c=op(c,"onChange"),0<c.length&&(h=new Pe("onChange","change",null,h,y),o.push({event:h,listeners:c}))}var Wu=null,Zu=null;function m7(o){xP(o,0)}function Cf(o){var c=Qa(o);if(Uu(c))return o}function WC(o,c){if(o==="change")return c}var ZC=!1;if($i){var By;if($i){var Uy="oninput"in document;if(!Uy){var QC=document.createElement("div");QC.setAttribute("oninput","return;"),Uy=typeof QC.oninput=="function"}By=Uy}else By=!1;ZC=By&&(!document.documentMode||9<document.documentMode)}function JC(){Wu&&(Wu.detachEvent("onpropertychange",eE),Zu=Wu=null)}function eE(o){if(o.propertyName==="value"&&Cf(Zu)){var c=[];XC(c,Zu,o,qi(o)),ic(m7,c)}}function y7(o,c,h){o==="focusin"?(JC(),Wu=c,Zu=h,Wu.attachEvent("onpropertychange",eE)):o==="focusout"&&JC()}function S7(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Cf(Zu)}function v7(o,c){if(o==="click")return Cf(c)}function b7(o,c){if(o==="input"||o==="change")return Cf(c)}function x7(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var Kr=typeof Object.is=="function"?Object.is:x7;function Qu(o,c){if(Kr(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var h=Object.keys(o),y=Object.keys(c);if(h.length!==y.length)return!1;for(y=0;y<h.length;y++){var v=h[y];if(!vr.call(c,v)||!Kr(o[v],c[v]))return!1}return!0}function tE(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function nE(o,c){var h=tE(o);o=0;for(var y;h;){if(h.nodeType===3){if(y=o+h.textContent.length,o<=c&&y>=c)return{node:h,offset:c-o};o=y}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=tE(h)}}function rE(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?rE(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function iE(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var c=nc(o.document);c instanceof o.HTMLIFrameElement;){try{var h=typeof c.contentWindow.location.href=="string"}catch{h=!1}if(h)o=c.contentWindow;else break;c=nc(o.document)}return c}function $y(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}function w7(o,c){var h=iE(c);c=o.focusedElem;var y=o.selectionRange;if(h!==c&&c&&c.ownerDocument&&rE(c.ownerDocument.documentElement,c)){if(y!==null&&$y(c)){if(o=y.start,h=y.end,h===void 0&&(h=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(h,c.value.length);else if(h=(o=c.ownerDocument||document)&&o.defaultView||window,h.getSelection){h=h.getSelection();var v=c.textContent.length,C=Math.min(y.start,v);y=y.end===void 0?C:Math.min(y.end,v),!h.extend&&C>y&&(v=y,y=C,C=v),v=nE(c,C);var k=nE(c,y);v&&k&&(h.rangeCount!==1||h.anchorNode!==v.node||h.anchorOffset!==v.offset||h.focusNode!==k.node||h.focusOffset!==k.offset)&&(o=o.createRange(),o.setStart(v.node,v.offset),h.removeAllRanges(),C>y?(h.addRange(o),h.extend(k.node,k.offset)):(o.setEnd(k.node,k.offset),h.addRange(o)))}}for(o=[],h=c;h=h.parentNode;)h.nodeType===1&&o.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)h=o[c],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var _7=$i&&"documentMode"in document&&11>=document.documentMode,uc=null,Hy=null,Ju=null,Ky=!1;function sE(o,c,h){var y=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Ky||uc==null||uc!==nc(y)||(y=uc,"selectionStart"in y&&$y(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Ju&&Qu(Ju,y)||(Ju=y,y=op(Hy,"onSelect"),0<y.length&&(c=new Pe("onSelect","select",null,c,h),o.push({event:c,listeners:y}),c.target=uc)))}function ol(o,c){var h={};return h[o.toLowerCase()]=c.toLowerCase(),h["Webkit"+o]="webkit"+c,h["Moz"+o]="moz"+c,h}var dc={animationend:ol("Animation","AnimationEnd"),animationiteration:ol("Animation","AnimationIteration"),animationstart:ol("Animation","AnimationStart"),transitionrun:ol("Transition","TransitionRun"),transitionstart:ol("Transition","TransitionStart"),transitioncancel:ol("Transition","TransitionCancel"),transitionend:ol("Transition","TransitionEnd")},qy={},oE={};$i&&(oE=document.createElement("div").style,"AnimationEvent"in window||(delete dc.animationend.animation,delete dc.animationiteration.animation,delete dc.animationstart.animation),"TransitionEvent"in window||delete dc.transitionend.transition);function al(o){if(qy[o])return qy[o];if(!dc[o])return o;var c=dc[o],h;for(h in c)if(c.hasOwnProperty(h)&&h in oE)return qy[o]=c[h];return o}var aE=al("animationend"),lE=al("animationiteration"),cE=al("animationstart"),C7=al("transitionrun"),E7=al("transitionstart"),P7=al("transitioncancel"),uE=al("transitionend"),dE=new Map,hE="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Vi(o,c){dE.set(o,c),hi(c,[o])}var fi=[],hc=0,Gy=0;function Ef(){for(var o=hc,c=Gy=hc=0;c<o;){var h=fi[c];fi[c++]=null;var y=fi[c];fi[c++]=null;var v=fi[c];fi[c++]=null;var C=fi[c];if(fi[c++]=null,y!==null&&v!==null){var k=y.pending;k===null?v.next=v:(v.next=k.next,k.next=v),y.pending=v}C!==0&&fE(h,v,C)}}function Pf(o,c,h,y){fi[hc++]=o,fi[hc++]=c,fi[hc++]=h,fi[hc++]=y,Gy|=y,o.lanes|=y,o=o.alternate,o!==null&&(o.lanes|=y)}function Yy(o,c,h,y){return Pf(o,c,h,y),Tf(o)}function Zo(o,c){return Pf(o,null,null,c),Tf(o)}function fE(o,c,h){o.lanes|=h;var y=o.alternate;y!==null&&(y.lanes|=h);for(var v=!1,C=o.return;C!==null;)C.childLanes|=h,y=C.alternate,y!==null&&(y.childLanes|=h),C.tag===22&&(o=C.stateNode,o===null||o._visibility&1||(v=!0)),o=C,C=C.return;v&&c!==null&&o.tag===3&&(C=o.stateNode,v=31-Yt(h),C=C.hiddenUpdates,o=C[v],o===null?C[v]=[c]:o.push(c),c.lane=h|536870912)}function Tf(o){if(50<Cd)throw Cd=0,JS=null,Error(r(185));for(var c=o.return;c!==null;)o=c,c=o.return;return o.tag===3?o.stateNode:null}var fc={},pE=new WeakMap;function pi(o,c){if(typeof o=="object"&&o!==null){var h=pE.get(o);return h!==void 0?h:(c={value:o,source:c,stack:X(c)},pE.set(o,c),c)}return{value:o,source:c,stack:X(c)}}var pc=[],gc=0,If=null,Mf=0,gi=[],mi=0,ll=null,ro=1,io="";function cl(o,c){pc[gc++]=Mf,pc[gc++]=If,If=o,Mf=c}function gE(o,c,h){gi[mi++]=ro,gi[mi++]=io,gi[mi++]=ll,ll=o;var y=ro;o=io;var v=32-Yt(y)-1;y&=~(1<<v),h+=1;var C=32-Yt(c)+v;if(30<C){var k=v-v%5;C=(y&(1<<k)-1).toString(32),y>>=k,v-=k,ro=1<<32-Yt(c)+v|h<<v|y,io=C+o}else ro=1<<C|h<<v|y,io=o}function Vy(o){o.return!==null&&(cl(o,1),gE(o,1,0))}function Xy(o){for(;o===If;)If=pc[--gc],pc[gc]=null,Mf=pc[--gc],pc[gc]=null;for(;o===ll;)ll=gi[--mi],gi[mi]=null,io=gi[--mi],gi[mi]=null,ro=gi[--mi],gi[mi]=null}var ar=null,An=null,mt=!1,Xi=null,ys=!1,Wy=Error(r(519));function ul(o){var c=Error(r(418,""));throw nd(pi(c,o)),Wy}function mE(o){var c=o.stateNode,h=o.type,y=o.memoizedProps;switch(c[xn]=o,c[Kn]=y,h){case"dialog":lt("cancel",c),lt("close",c);break;case"iframe":case"object":case"embed":lt("load",c);break;case"video":case"audio":for(h=0;h<Pd.length;h++)lt(Pd[h],c);break;case"source":lt("error",c);break;case"img":case"image":case"link":lt("error",c),lt("load",c);break;case"details":lt("toggle",c);break;case"input":lt("invalid",c),Hu(c,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0),el(c);break;case"select":lt("invalid",c);break;case"textarea":lt("invalid",c),tl(c,y.value,y.defaultValue,y.children),el(c)}h=y.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||c.textContent===""+h||y.suppressHydrationWarning===!0||EP(c.textContent,h)?(y.popover!=null&&(lt("beforetoggle",c),lt("toggle",c)),y.onScroll!=null&&lt("scroll",c),y.onScrollEnd!=null&&lt("scrollend",c),y.onClick!=null&&(c.onclick=ap),c=!0):c=!1,c||ul(o)}function yE(o){for(ar=o.return;ar;)switch(ar.tag){case 3:case 27:ys=!0;return;case 5:case 13:ys=!1;return;default:ar=ar.return}}function ed(o){if(o!==ar)return!1;if(!mt)return yE(o),mt=!0,!1;var c=!1,h;if((h=o.tag!==3&&o.tag!==27)&&((h=o.tag===5)&&(h=o.type,h=!(h!=="form"&&h!=="button")||mv(o.type,o.memoizedProps)),h=!h),h&&(c=!0),c&&An&&ul(o),yE(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(r(317));e:{for(o=o.nextSibling,c=0;o;){if(o.nodeType===8)if(h=o.data,h==="/$"){if(c===0){An=Zi(o.nextSibling);break e}c--}else h!=="$"&&h!=="$!"&&h!=="$?"||c++;o=o.nextSibling}An=null}}else An=ar?Zi(o.stateNode.nextSibling):null;return!0}function td(){An=ar=null,mt=!1}function nd(o){Xi===null?Xi=[o]:Xi.push(o)}var rd=Error(r(460)),SE=Error(r(474)),Zy={then:function(){}};function vE(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Af(){}function bE(o,c,h){switch(h=o[h],h===void 0?o.push(c):h!==c&&(c.then(Af,Af),c=h),c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,o===rd?Error(r(483)):o;default:if(typeof c.status=="string")c.then(Af,Af);else{if(o=Dt,o!==null&&100<o.shellSuspendCounter)throw Error(r(482));o=c,o.status="pending",o.then(function(y){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=y}},function(y){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=y}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,o===rd?Error(r(483)):o}throw id=c,rd}}var id=null;function xE(){if(id===null)throw Error(r(459));var o=id;return id=null,o}var mc=null,sd=0;function kf(o){var c=sd;return sd+=1,mc===null&&(mc=[]),bE(mc,o,c)}function od(o,c){c=c.props.ref,o.ref=c!==void 0?c:null}function jf(o,c){throw c.$$typeof===s?Error(r(525)):(o=Object.prototype.toString.call(c),Error(r(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o)))}function wE(o){var c=o._init;return c(o._payload)}function _E(o){function c(J,Z){if(o){var ne=J.deletions;ne===null?(J.deletions=[Z],J.flags|=16):ne.push(Z)}}function h(J,Z){if(!o)return null;for(;Z!==null;)c(J,Z),Z=Z.sibling;return null}function y(J){for(var Z=new Map;J!==null;)J.key!==null?Z.set(J.key,J):Z.set(J.index,J),J=J.sibling;return Z}function v(J,Z){return J=ca(J,Z),J.index=0,J.sibling=null,J}function C(J,Z,ne){return J.index=ne,o?(ne=J.alternate,ne!==null?(ne=ne.index,ne<Z?(J.flags|=33554434,Z):ne):(J.flags|=33554434,Z)):(J.flags|=1048576,Z)}function k(J){return o&&J.alternate===null&&(J.flags|=33554434),J}function N(J,Z,ne,pe){return Z===null||Z.tag!==6?(Z=qS(ne,J.mode,pe),Z.return=J,Z):(Z=v(Z,ne),Z.return=J,Z)}function $(J,Z,ne,pe){var ke=ne.type;return ke===u?ce(J,Z,ne.props.children,pe,ne.key):Z!==null&&(Z.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===E&&wE(ke)===Z.type)?(Z=v(Z,ne.props),od(Z,ne),Z.return=J,Z):(Z=Wf(ne.type,ne.key,ne.props,null,J.mode,pe),od(Z,ne),Z.return=J,Z)}function Q(J,Z,ne,pe){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==ne.containerInfo||Z.stateNode.implementation!==ne.implementation?(Z=GS(ne,J.mode,pe),Z.return=J,Z):(Z=v(Z,ne.children||[]),Z.return=J,Z)}function ce(J,Z,ne,pe,ke){return Z===null||Z.tag!==7?(Z=bl(ne,J.mode,pe,ke),Z.return=J,Z):(Z=v(Z,ne),Z.return=J,Z)}function Se(J,Z,ne){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Z=qS(""+Z,J.mode,ne),Z.return=J,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case a:return ne=Wf(Z.type,Z.key,Z.props,null,J.mode,ne),od(ne,Z),ne.return=J,ne;case l:return Z=GS(Z,J.mode,ne),Z.return=J,Z;case E:var pe=Z._init;return Z=pe(Z._payload),Se(J,Z,ne)}if(de(Z)||j(Z))return Z=bl(Z,J.mode,ne,null),Z.return=J,Z;if(typeof Z.then=="function")return Se(J,kf(Z),ne);if(Z.$$typeof===S)return Se(J,Yf(J,Z),ne);jf(J,Z)}return null}function se(J,Z,ne,pe){var ke=Z!==null?Z.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return ke!==null?null:N(J,Z,""+ne,pe);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case a:return ne.key===ke?$(J,Z,ne,pe):null;case l:return ne.key===ke?Q(J,Z,ne,pe):null;case E:return ke=ne._init,ne=ke(ne._payload),se(J,Z,ne,pe)}if(de(ne)||j(ne))return ke!==null?null:ce(J,Z,ne,pe,null);if(typeof ne.then=="function")return se(J,Z,kf(ne),pe);if(ne.$$typeof===S)return se(J,Z,Yf(J,ne),pe);jf(J,ne)}return null}function le(J,Z,ne,pe,ke){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return J=J.get(ne)||null,N(Z,J,""+pe,ke);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case a:return J=J.get(pe.key===null?ne:pe.key)||null,$(Z,J,pe,ke);case l:return J=J.get(pe.key===null?ne:pe.key)||null,Q(Z,J,pe,ke);case E:var Je=pe._init;return pe=Je(pe._payload),le(J,Z,ne,pe,ke)}if(de(pe)||j(pe))return J=J.get(ne)||null,ce(Z,J,pe,ke,null);if(typeof pe.then=="function")return le(J,Z,ne,kf(pe),ke);if(pe.$$typeof===S)return le(J,Z,ne,Yf(Z,pe),ke);jf(Z,pe)}return null}function De(J,Z,ne,pe){for(var ke=null,Je=null,Re=Z,$e=Z=0,En=null;Re!==null&&$e<ne.length;$e++){Re.index>$e?(En=Re,Re=null):En=Re.sibling;var yt=se(J,Re,ne[$e],pe);if(yt===null){Re===null&&(Re=En);break}o&&Re&&yt.alternate===null&&c(J,Re),Z=C(yt,Z,$e),Je===null?ke=yt:Je.sibling=yt,Je=yt,Re=En}if($e===ne.length)return h(J,Re),mt&&cl(J,$e),ke;if(Re===null){for(;$e<ne.length;$e++)Re=Se(J,ne[$e],pe),Re!==null&&(Z=C(Re,Z,$e),Je===null?ke=Re:Je.sibling=Re,Je=Re);return mt&&cl(J,$e),ke}for(Re=y(Re);$e<ne.length;$e++)En=le(Re,J,$e,ne[$e],pe),En!==null&&(o&&En.alternate!==null&&Re.delete(En.key===null?$e:En.key),Z=C(En,Z,$e),Je===null?ke=En:Je.sibling=En,Je=En);return o&&Re.forEach(function(ma){return c(J,ma)}),mt&&cl(J,$e),ke}function Ge(J,Z,ne,pe){if(ne==null)throw Error(r(151));for(var ke=null,Je=null,Re=Z,$e=Z=0,En=null,yt=ne.next();Re!==null&&!yt.done;$e++,yt=ne.next()){Re.index>$e?(En=Re,Re=null):En=Re.sibling;var ma=se(J,Re,yt.value,pe);if(ma===null){Re===null&&(Re=En);break}o&&Re&&ma.alternate===null&&c(J,Re),Z=C(ma,Z,$e),Je===null?ke=ma:Je.sibling=ma,Je=ma,Re=En}if(yt.done)return h(J,Re),mt&&cl(J,$e),ke;if(Re===null){for(;!yt.done;$e++,yt=ne.next())yt=Se(J,yt.value,pe),yt!==null&&(Z=C(yt,Z,$e),Je===null?ke=yt:Je.sibling=yt,Je=yt);return mt&&cl(J,$e),ke}for(Re=y(Re);!yt.done;$e++,yt=ne.next())yt=le(Re,J,$e,yt.value,pe),yt!==null&&(o&&yt.alternate!==null&&Re.delete(yt.key===null?$e:yt.key),Z=C(yt,Z,$e),Je===null?ke=yt:Je.sibling=yt,Je=yt);return o&&Re.forEach(function(B9){return c(J,B9)}),mt&&cl(J,$e),ke}function rn(J,Z,ne,pe){if(typeof ne=="object"&&ne!==null&&ne.type===u&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case a:e:{for(var ke=ne.key;Z!==null;){if(Z.key===ke){if(ke=ne.type,ke===u){if(Z.tag===7){h(J,Z.sibling),pe=v(Z,ne.props.children),pe.return=J,J=pe;break e}}else if(Z.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===E&&wE(ke)===Z.type){h(J,Z.sibling),pe=v(Z,ne.props),od(pe,ne),pe.return=J,J=pe;break e}h(J,Z);break}else c(J,Z);Z=Z.sibling}ne.type===u?(pe=bl(ne.props.children,J.mode,pe,ne.key),pe.return=J,J=pe):(pe=Wf(ne.type,ne.key,ne.props,null,J.mode,pe),od(pe,ne),pe.return=J,J=pe)}return k(J);case l:e:{for(ke=ne.key;Z!==null;){if(Z.key===ke)if(Z.tag===4&&Z.stateNode.containerInfo===ne.containerInfo&&Z.stateNode.implementation===ne.implementation){h(J,Z.sibling),pe=v(Z,ne.children||[]),pe.return=J,J=pe;break e}else{h(J,Z);break}else c(J,Z);Z=Z.sibling}pe=GS(ne,J.mode,pe),pe.return=J,J=pe}return k(J);case E:return ke=ne._init,ne=ke(ne._payload),rn(J,Z,ne,pe)}if(de(ne))return De(J,Z,ne,pe);if(j(ne)){if(ke=j(ne),typeof ke!="function")throw Error(r(150));return ne=ke.call(ne),Ge(J,Z,ne,pe)}if(typeof ne.then=="function")return rn(J,Z,kf(ne),pe);if(ne.$$typeof===S)return rn(J,Z,Yf(J,ne),pe);jf(J,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint"?(ne=""+ne,Z!==null&&Z.tag===6?(h(J,Z.sibling),pe=v(Z,ne),pe.return=J,J=pe):(h(J,Z),pe=qS(ne,J.mode,pe),pe.return=J,J=pe),k(J)):h(J,Z)}return function(J,Z,ne,pe){try{sd=0;var ke=rn(J,Z,ne,pe);return mc=null,ke}catch(Re){if(Re===rd)throw Re;var Je=bi(29,Re,null,J.mode);return Je.lanes=pe,Je.return=J,Je}finally{}}}var dl=_E(!0),CE=_E(!1),yc=we(null),Of=we(0);function EE(o,c){o=mo,je(Of,o),je(yc,c),mo=o|c.baseLanes}function Qy(){je(Of,mo),je(yc,yc.current)}function Jy(){mo=Of.current,Te(yc),Te(Of)}var yi=we(null),Ss=null;function Qo(o){var c=o.alternate;je(Sn,Sn.current&1),je(yi,o),Ss===null&&(c===null||yc.current!==null||c.memoizedState!==null)&&(Ss=o)}function PE(o){if(o.tag===22){if(je(Sn,Sn.current),je(yi,o),Ss===null){var c=o.alternate;c!==null&&c.memoizedState!==null&&(Ss=o)}}else Jo()}function Jo(){je(Sn,Sn.current),je(yi,yi.current)}function so(o){Te(yi),Ss===o&&(Ss=null),Te(Sn)}var Sn=we(0);function Df(o){for(var c=o;c!==null;){if(c.tag===13){var h=c.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if(c.flags&128)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var T7=typeof AbortController<"u"?AbortController:function(){var o=[],c=this.signal={aborted:!1,addEventListener:function(h,y){o.push(y)}};this.abort=function(){c.aborted=!0,o.forEach(function(h){return h()})}},I7=n.unstable_scheduleCallback,M7=n.unstable_NormalPriority,vn={$$typeof:S,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function eS(){return{controller:new T7,data:new Map,refCount:0}}function ad(o){o.refCount--,o.refCount===0&&I7(M7,function(){o.controller.abort()})}var ld=null,tS=0,Sc=0,vc=null;function A7(o,c){if(ld===null){var h=ld=[];tS=0,Sc=av(),vc={status:"pending",value:void 0,then:function(y){h.push(y)}}}return tS++,c.then(TE,TE),c}function TE(){if(--tS===0&&ld!==null){vc!==null&&(vc.status="fulfilled");var o=ld;ld=null,Sc=0,vc=null;for(var c=0;c<o.length;c++)(0,o[c])()}}function k7(o,c){var h=[],y={status:"pending",value:null,reason:null,then:function(v){h.push(v)}};return o.then(function(){y.status="fulfilled",y.value=c;for(var v=0;v<h.length;v++)(0,h[v])(c)},function(v){for(y.status="rejected",y.reason=v,v=0;v<h.length;v++)(0,h[v])(void 0)}),y}var IE=q.S;q.S=function(o,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&A7(o,c),IE!==null&&IE(o,c)};var hl=we(null);function nS(){var o=hl.current;return o!==null?o:Dt.pooledCache}function Rf(o,c){c===null?je(hl,hl.current):je(hl,c.pool)}function ME(){var o=nS();return o===null?null:{parent:vn._currentValue,pool:o}}var ea=0,Qe=null,Pt=null,fn=null,Lf=!1,bc=!1,fl=!1,Nf=0,cd=0,xc=null,j7=0;function on(){throw Error(r(321))}function rS(o,c){if(c===null)return!1;for(var h=0;h<c.length&&h<o.length;h++)if(!Kr(o[h],c[h]))return!1;return!0}function iS(o,c,h,y,v,C){return ea=C,Qe=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,q.H=o===null||o.memoizedState===null?pl:ta,fl=!1,C=h(y,v),fl=!1,bc&&(C=kE(c,h,y,v)),AE(o),C}function AE(o){q.H=vs;var c=Pt!==null&&Pt.next!==null;if(ea=0,fn=Pt=Qe=null,Lf=!1,cd=0,xc=null,c)throw Error(r(300));o===null||_n||(o=o.dependencies,o!==null&&Gf(o)&&(_n=!0))}function kE(o,c,h,y){Qe=o;var v=0;do{if(bc&&(xc=null),cd=0,bc=!1,25<=v)throw Error(r(301));if(v+=1,fn=Pt=null,o.updateQueue!=null){var C=o.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}q.H=gl,C=c(h,y)}while(bc);return C}function O7(){var o=q.H,c=o.useState()[0];return c=typeof c.then=="function"?ud(c):c,o=o.useState()[0],(Pt!==null?Pt.memoizedState:null)!==o&&(Qe.flags|=1024),c}function sS(){var o=Nf!==0;return Nf=0,o}function oS(o,c,h){c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~h}function aS(o){if(Lf){for(o=o.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}Lf=!1}ea=0,fn=Pt=Qe=null,bc=!1,cd=Nf=0,xc=null}function Pr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?Qe.memoizedState=fn=o:fn=fn.next=o,fn}function pn(){if(Pt===null){var o=Qe.alternate;o=o!==null?o.memoizedState:null}else o=Pt.next;var c=fn===null?Qe.memoizedState:fn.next;if(c!==null)fn=c,Pt=o;else{if(o===null)throw Qe.alternate===null?Error(r(467)):Error(r(310));Pt=o,o={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},fn===null?Qe.memoizedState=fn=o:fn=fn.next=o}return fn}var zf;zf=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function ud(o){var c=cd;return cd+=1,xc===null&&(xc=[]),o=bE(xc,o,c),c=Qe,(fn===null?c.memoizedState:fn.next)===null&&(c=c.alternate,q.H=c===null||c.memoizedState===null?pl:ta),o}function Ff(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return ud(o);if(o.$$typeof===S)return Yn(o)}throw Error(r(438,String(o)))}function lS(o){var c=null,h=Qe.updateQueue;if(h!==null&&(c=h.memoCache),c==null){var y=Qe.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(c={data:y.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),h===null&&(h=zf(),Qe.updateQueue=h),h.memoCache=c,h=c.data[c.index],h===void 0)for(h=c.data[c.index]=Array(o),y=0;y<o;y++)h[y]=I;return c.index++,h}function oo(o,c){return typeof c=="function"?c(o):c}function Bf(o){var c=pn();return cS(c,Pt,o)}function cS(o,c,h){var y=o.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=h;var v=o.baseQueue,C=y.pending;if(C!==null){if(v!==null){var k=v.next;v.next=C.next,C.next=k}c.baseQueue=v=C,y.pending=null}if(C=o.baseState,v===null)o.memoizedState=C;else{c=v.next;var N=k=null,$=null,Q=c,ce=!1;do{var Se=Q.lane&-536870913;if(Se!==Q.lane?(dt&Se)===Se:(ea&Se)===Se){var se=Q.revertLane;if(se===0)$!==null&&($=$.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),Se===Sc&&(ce=!0);else if((ea&se)===se){Q=Q.next,se===Sc&&(ce=!0);continue}else Se={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},$===null?(N=$=Se,k=C):$=$.next=Se,Qe.lanes|=se,ua|=se;Se=Q.action,fl&&h(C,Se),C=Q.hasEagerState?Q.eagerState:h(C,Se)}else se={lane:Se,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},$===null?(N=$=se,k=C):$=$.next=se,Qe.lanes|=Se,ua|=Se;Q=Q.next}while(Q!==null&&Q!==c);if($===null?k=C:$.next=N,!Kr(C,o.memoizedState)&&(_n=!0,ce&&(h=vc,h!==null)))throw h;o.memoizedState=C,o.baseState=k,o.baseQueue=$,y.lastRenderedState=C}return v===null&&(y.lanes=0),[o.memoizedState,y.dispatch]}function uS(o){var c=pn(),h=c.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=o;var y=h.dispatch,v=h.pending,C=c.memoizedState;if(v!==null){h.pending=null;var k=v=v.next;do C=o(C,k.action),k=k.next;while(k!==v);Kr(C,c.memoizedState)||(_n=!0),c.memoizedState=C,c.baseQueue===null&&(c.baseState=C),h.lastRenderedState=C}return[C,y]}function jE(o,c,h){var y=Qe,v=pn(),C=mt;if(C){if(h===void 0)throw Error(r(407));h=h()}else h=c();var k=!Kr((Pt||v).memoizedState,h);if(k&&(v.memoizedState=h,_n=!0),v=v.queue,fS(RE.bind(null,y,v,o),[o]),v.getSnapshot!==c||k||fn!==null&&fn.memoizedState.tag&1){if(y.flags|=2048,wc(9,DE.bind(null,y,v,h,c),{destroy:void 0},null),Dt===null)throw Error(r(349));C||ea&60||OE(y,c,h)}return h}function OE(o,c,h){o.flags|=16384,o={getSnapshot:c,value:h},c=Qe.updateQueue,c===null?(c=zf(),Qe.updateQueue=c,c.stores=[o]):(h=c.stores,h===null?c.stores=[o]:h.push(o))}function DE(o,c,h,y){c.value=h,c.getSnapshot=y,LE(c)&&NE(o)}function RE(o,c,h){return h(function(){LE(c)&&NE(o)})}function LE(o){var c=o.getSnapshot;o=o.value;try{var h=c();return!Kr(o,h)}catch{return!0}}function NE(o){var c=Zo(o,2);c!==null&&lr(c,o,2)}function dS(o){var c=Pr();if(typeof o=="function"){var h=o;if(o=h(),fl){wr(!0);try{h()}finally{wr(!1)}}}return c.memoizedState=c.baseState=o,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:o},c}function zE(o,c,h,y){return o.baseState=h,cS(o,Pt,typeof y=="function"?y:oo)}function D7(o,c,h,y,v){if(Hf(o))throw Error(r(485));if(o=c.action,o!==null){var C={payload:v,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){C.listeners.push(k)}};q.T!==null?h(!0):C.isTransition=!1,y(C),h=c.pending,h===null?(C.next=c.pending=C,FE(c,C)):(C.next=h.next,c.pending=h.next=C)}}function FE(o,c){var h=c.action,y=c.payload,v=o.state;if(c.isTransition){var C=q.T,k={};q.T=k;try{var N=h(v,y),$=q.S;$!==null&&$(k,N),BE(o,c,N)}catch(Q){hS(o,c,Q)}finally{q.T=C}}else try{C=h(v,y),BE(o,c,C)}catch(Q){hS(o,c,Q)}}function BE(o,c,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(y){UE(o,c,y)},function(y){return hS(o,c,y)}):UE(o,c,h)}function UE(o,c,h){c.status="fulfilled",c.value=h,$E(c),o.state=h,c=o.pending,c!==null&&(h=c.next,h===c?o.pending=null:(h=h.next,c.next=h,FE(o,h)))}function hS(o,c,h){var y=o.pending;if(o.pending=null,y!==null){y=y.next;do c.status="rejected",c.reason=h,$E(c),c=c.next;while(c!==y)}o.action=null}function $E(o){o=o.listeners;for(var c=0;c<o.length;c++)(0,o[c])()}function HE(o,c){return c}function KE(o,c){if(mt){var h=Dt.formState;if(h!==null){e:{var y=Qe;if(mt){if(An){t:{for(var v=An,C=ys;v.nodeType!==8;){if(!C){v=null;break t}if(v=Zi(v.nextSibling),v===null){v=null;break t}}C=v.data,v=C==="F!"||C==="F"?v:null}if(v){An=Zi(v.nextSibling),y=v.data==="F!";break e}}ul(y)}y=!1}y&&(c=h[0])}}return h=Pr(),h.memoizedState=h.baseState=c,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:HE,lastRenderedState:c},h.queue=y,h=l2.bind(null,Qe,y),y.dispatch=h,y=dS(!1),C=SS.bind(null,Qe,!1,y.queue),y=Pr(),v={state:c,dispatch:null,action:o,pending:null},y.queue=v,h=D7.bind(null,Qe,v,C,h),v.dispatch=h,y.memoizedState=o,[c,h,!1]}function qE(o){var c=pn();return GE(c,Pt,o)}function GE(o,c,h){c=cS(o,c,HE)[0],o=Bf(oo)[0],c=typeof c=="object"&&c!==null&&typeof c.then=="function"?ud(c):c;var y=pn(),v=y.queue,C=v.dispatch;return h!==y.memoizedState&&(Qe.flags|=2048,wc(9,R7.bind(null,v,h),{destroy:void 0},null)),[c,C,o]}function R7(o,c){o.action=c}function YE(o){var c=pn(),h=Pt;if(h!==null)return GE(c,h,o);pn(),c=c.memoizedState,h=pn();var y=h.queue.dispatch;return h.memoizedState=o,[c,y,!1]}function wc(o,c,h,y){return o={tag:o,create:c,inst:h,deps:y,next:null},c=Qe.updateQueue,c===null&&(c=zf(),Qe.updateQueue=c),h=c.lastEffect,h===null?c.lastEffect=o.next=o:(y=h.next,h.next=o,o.next=y,c.lastEffect=o),o}function VE(){return pn().memoizedState}function Uf(o,c,h,y){var v=Pr();Qe.flags|=o,v.memoizedState=wc(1|c,h,{destroy:void 0},y===void 0?null:y)}function $f(o,c,h,y){var v=pn();y=y===void 0?null:y;var C=v.memoizedState.inst;Pt!==null&&y!==null&&rS(y,Pt.memoizedState.deps)?v.memoizedState=wc(c,h,C,y):(Qe.flags|=o,v.memoizedState=wc(1|c,h,C,y))}function XE(o,c){Uf(8390656,8,o,c)}function fS(o,c){$f(2048,8,o,c)}function WE(o,c){return $f(4,2,o,c)}function ZE(o,c){return $f(4,4,o,c)}function QE(o,c){if(typeof c=="function"){o=o();var h=c(o);return function(){typeof h=="function"?h():c(null)}}if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function JE(o,c,h){h=h!=null?h.concat([o]):null,$f(4,4,QE.bind(null,c,o),h)}function pS(){}function e2(o,c){var h=pn();c=c===void 0?null:c;var y=h.memoizedState;return c!==null&&rS(c,y[1])?y[0]:(h.memoizedState=[o,c],o)}function t2(o,c){var h=pn();c=c===void 0?null:c;var y=h.memoizedState;if(c!==null&&rS(c,y[1]))return y[0];if(y=o(),fl){wr(!0);try{o()}finally{wr(!1)}}return h.memoizedState=[y,c],y}function gS(o,c,h){return h===void 0||ea&1073741824?o.memoizedState=c:(o.memoizedState=h,o=rP(),Qe.lanes|=o,ua|=o,h)}function n2(o,c,h,y){return Kr(h,c)?h:yc.current!==null?(o=gS(o,h,y),Kr(o,c)||(_n=!0),o):ea&42?(o=rP(),Qe.lanes|=o,ua|=o,c):(_n=!0,o.memoizedState=h)}function r2(o,c,h,y,v){var C=ye.p;ye.p=C!==0&&8>C?C:8;var k=q.T,N={};q.T=N,SS(o,!1,c,h);try{var $=v(),Q=q.S;if(Q!==null&&Q(N,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var ce=k7($,y);dd(o,c,ce,Vr(o))}else dd(o,c,y,Vr(o))}catch(Se){dd(o,c,{then:function(){},status:"rejected",reason:Se},Vr())}finally{ye.p=C,q.T=k}}function L7(){}function mS(o,c,h,y){if(o.tag!==5)throw Error(r(476));var v=i2(o).queue;r2(o,v,c,ge,h===null?L7:function(){return s2(o),h(y)})}function i2(o){var c=o.memoizedState;if(c!==null)return c;c={memoizedState:ge,baseState:ge,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:ge},next:null};var h={};return c.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:h},next:null},o.memoizedState=c,o=o.alternate,o!==null&&(o.memoizedState=c),c}function s2(o){var c=i2(o).next.queue;dd(o,c,{},Vr())}function yS(){return Yn(kd)}function o2(){return pn().memoizedState}function a2(){return pn().memoizedState}function N7(o){for(var c=o.return;c!==null;){switch(c.tag){case 24:case 3:var h=Vr();o=ia(h);var y=sa(c,o,h);y!==null&&(lr(y,c,h),pd(y,c,h)),c={cache:eS()},o.payload=c;return}c=c.return}}function z7(o,c,h){var y=Vr();h={lane:y,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null},Hf(o)?c2(c,h):(h=Yy(o,c,h,y),h!==null&&(lr(h,o,y),u2(h,c,y)))}function l2(o,c,h){var y=Vr();dd(o,c,h,y)}function dd(o,c,h,y){var v={lane:y,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null};if(Hf(o))c2(c,v);else{var C=o.alternate;if(o.lanes===0&&(C===null||C.lanes===0)&&(C=c.lastRenderedReducer,C!==null))try{var k=c.lastRenderedState,N=C(k,h);if(v.hasEagerState=!0,v.eagerState=N,Kr(N,k))return Pf(o,c,v,0),Dt===null&&Ef(),!1}catch{}finally{}if(h=Yy(o,c,v,y),h!==null)return lr(h,o,y),u2(h,c,y),!0}return!1}function SS(o,c,h,y){if(y={lane:2,revertLane:av(),action:y,hasEagerState:!1,eagerState:null,next:null},Hf(o)){if(c)throw Error(r(479))}else c=Yy(o,h,y,2),c!==null&&lr(c,o,2)}function Hf(o){var c=o.alternate;return o===Qe||c!==null&&c===Qe}function c2(o,c){bc=Lf=!0;var h=o.pending;h===null?c.next=c:(c.next=h.next,h.next=c),o.pending=c}function u2(o,c,h){if(h&4194176){var y=c.lanes;y&=o.pendingLanes,h|=y,c.lanes=h,pf(o,h)}}var vs={readContext:Yn,use:Ff,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useLayoutEffect:on,useInsertionEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useSyncExternalStore:on,useId:on};vs.useCacheRefresh=on,vs.useMemoCache=on,vs.useHostTransitionStatus=on,vs.useFormState=on,vs.useActionState=on,vs.useOptimistic=on;var pl={readContext:Yn,use:Ff,useCallback:function(o,c){return Pr().memoizedState=[o,c===void 0?null:c],o},useContext:Yn,useEffect:XE,useImperativeHandle:function(o,c,h){h=h!=null?h.concat([o]):null,Uf(4194308,4,QE.bind(null,c,o),h)},useLayoutEffect:function(o,c){return Uf(4194308,4,o,c)},useInsertionEffect:function(o,c){Uf(4,2,o,c)},useMemo:function(o,c){var h=Pr();c=c===void 0?null:c;var y=o();if(fl){wr(!0);try{o()}finally{wr(!1)}}return h.memoizedState=[y,c],y},useReducer:function(o,c,h){var y=Pr();if(h!==void 0){var v=h(c);if(fl){wr(!0);try{h(c)}finally{wr(!1)}}}else v=c;return y.memoizedState=y.baseState=v,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:v},y.queue=o,o=o.dispatch=z7.bind(null,Qe,o),[y.memoizedState,o]},useRef:function(o){var c=Pr();return o={current:o},c.memoizedState=o},useState:function(o){o=dS(o);var c=o.queue,h=l2.bind(null,Qe,c);return c.dispatch=h,[o.memoizedState,h]},useDebugValue:pS,useDeferredValue:function(o,c){var h=Pr();return gS(h,o,c)},useTransition:function(){var o=dS(!1);return o=r2.bind(null,Qe,o.queue,!0,!1),Pr().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,c,h){var y=Qe,v=Pr();if(mt){if(h===void 0)throw Error(r(407));h=h()}else{if(h=c(),Dt===null)throw Error(r(349));dt&60||OE(y,c,h)}v.memoizedState=h;var C={value:h,getSnapshot:c};return v.queue=C,XE(RE.bind(null,y,C,o),[o]),y.flags|=2048,wc(9,DE.bind(null,y,C,h,c),{destroy:void 0},null),h},useId:function(){var o=Pr(),c=Dt.identifierPrefix;if(mt){var h=io,y=ro;h=(y&~(1<<32-Yt(y)-1)).toString(32)+h,c=":"+c+"R"+h,h=Nf++,0<h&&(c+="H"+h.toString(32)),c+=":"}else h=j7++,c=":"+c+"r"+h.toString(32)+":";return o.memoizedState=c},useCacheRefresh:function(){return Pr().memoizedState=N7.bind(null,Qe)}};pl.useMemoCache=lS,pl.useHostTransitionStatus=yS,pl.useFormState=KE,pl.useActionState=KE,pl.useOptimistic=function(o){var c=Pr();c.memoizedState=c.baseState=o;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=h,c=SS.bind(null,Qe,!0,h),h.dispatch=c,[o,c]};var ta={readContext:Yn,use:Ff,useCallback:e2,useContext:Yn,useEffect:fS,useImperativeHandle:JE,useInsertionEffect:WE,useLayoutEffect:ZE,useMemo:t2,useReducer:Bf,useRef:VE,useState:function(){return Bf(oo)},useDebugValue:pS,useDeferredValue:function(o,c){var h=pn();return n2(h,Pt.memoizedState,o,c)},useTransition:function(){var o=Bf(oo)[0],c=pn().memoizedState;return[typeof o=="boolean"?o:ud(o),c]},useSyncExternalStore:jE,useId:o2};ta.useCacheRefresh=a2,ta.useMemoCache=lS,ta.useHostTransitionStatus=yS,ta.useFormState=qE,ta.useActionState=qE,ta.useOptimistic=function(o,c){var h=pn();return zE(h,Pt,o,c)};var gl={readContext:Yn,use:Ff,useCallback:e2,useContext:Yn,useEffect:fS,useImperativeHandle:JE,useInsertionEffect:WE,useLayoutEffect:ZE,useMemo:t2,useReducer:uS,useRef:VE,useState:function(){return uS(oo)},useDebugValue:pS,useDeferredValue:function(o,c){var h=pn();return Pt===null?gS(h,o,c):n2(h,Pt.memoizedState,o,c)},useTransition:function(){var o=uS(oo)[0],c=pn().memoizedState;return[typeof o=="boolean"?o:ud(o),c]},useSyncExternalStore:jE,useId:o2};gl.useCacheRefresh=a2,gl.useMemoCache=lS,gl.useHostTransitionStatus=yS,gl.useFormState=YE,gl.useActionState=YE,gl.useOptimistic=function(o,c){var h=pn();return Pt!==null?zE(h,Pt,o,c):(h.baseState=o,[o,h.queue.dispatch])};function vS(o,c,h,y){c=o.memoizedState,h=h(y,c),h=h==null?c:L({},c,h),o.memoizedState=h,o.lanes===0&&(o.updateQueue.baseState=h)}var bS={isMounted:function(o){return(o=o._reactInternals)?V(o)===o:!1},enqueueSetState:function(o,c,h){o=o._reactInternals;var y=Vr(),v=ia(y);v.payload=c,h!=null&&(v.callback=h),c=sa(o,v,y),c!==null&&(lr(c,o,y),pd(c,o,y))},enqueueReplaceState:function(o,c,h){o=o._reactInternals;var y=Vr(),v=ia(y);v.tag=1,v.payload=c,h!=null&&(v.callback=h),c=sa(o,v,y),c!==null&&(lr(c,o,y),pd(c,o,y))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var h=Vr(),y=ia(h);y.tag=2,c!=null&&(y.callback=c),c=sa(o,y,h),c!==null&&(lr(c,o,h),pd(c,o,h))}};function d2(o,c,h,y,v,C,k){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(y,C,k):c.prototype&&c.prototype.isPureReactComponent?!Qu(h,y)||!Qu(v,C):!0}function h2(o,c,h,y){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(h,y),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(h,y),c.state!==o&&bS.enqueueReplaceState(c,c.state,null)}function ml(o,c){var h=c;if("ref"in c){h={};for(var y in c)y!=="ref"&&(h[y]=c[y])}if(o=o.defaultProps){h===c&&(h=L({},h));for(var v in o)h[v]===void 0&&(h[v]=o[v])}return h}var Kf=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function f2(o){Kf(o)}function p2(o){console.error(o)}function g2(o){Kf(o)}function qf(o,c){try{var h=o.onUncaughtError;h(c.value,{componentStack:c.stack})}catch(y){setTimeout(function(){throw y})}}function m2(o,c,h){try{var y=o.onCaughtError;y(h.value,{componentStack:h.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function xS(o,c,h){return h=ia(h),h.tag=3,h.payload={element:null},h.callback=function(){qf(o,c)},h}function y2(o){return o=ia(o),o.tag=3,o}function S2(o,c,h,y){var v=h.type.getDerivedStateFromError;if(typeof v=="function"){var C=y.value;o.payload=function(){return v(C)},o.callback=function(){m2(c,h,y)}}var k=h.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(o.callback=function(){m2(c,h,y),typeof v!="function"&&(da===null?da=new Set([this]):da.add(this));var N=y.stack;this.componentDidCatch(y.value,{componentStack:N!==null?N:""})})}function F7(o,c,h,y,v){if(h.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(c=h.alternate,c!==null&&fd(c,h,v,!0),h=yi.current,h!==null){switch(h.tag){case 13:return Ss===null?nv():h.alternate===null&&nn===0&&(nn=3),h.flags&=-257,h.flags|=65536,h.lanes=v,y===Zy?h.flags|=16384:(c=h.updateQueue,c===null?h.updateQueue=new Set([y]):c.add(y),iv(o,y,v)),!1;case 22:return h.flags|=65536,y===Zy?h.flags|=16384:(c=h.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([y])},h.updateQueue=c):(h=c.retryQueue,h===null?c.retryQueue=new Set([y]):h.add(y)),iv(o,y,v)),!1}throw Error(r(435,h.tag))}return iv(o,y,v),nv(),!1}if(mt)return c=yi.current,c!==null?(!(c.flags&65536)&&(c.flags|=256),c.flags|=65536,c.lanes=v,y!==Wy&&(o=Error(r(422),{cause:y}),nd(pi(o,h)))):(y!==Wy&&(c=Error(r(423),{cause:y}),nd(pi(c,h))),o=o.current.alternate,o.flags|=65536,v&=-v,o.lanes|=v,y=pi(y,h),v=xS(o.stateNode,y,v),LS(o,v),nn!==4&&(nn=2)),!1;var C=Error(r(520),{cause:y});if(C=pi(C,h),wd===null?wd=[C]:wd.push(C),nn!==4&&(nn=2),c===null)return!0;y=pi(y,h),h=c;do{switch(h.tag){case 3:return h.flags|=65536,o=v&-v,h.lanes|=o,o=xS(h.stateNode,y,o),LS(h,o),!1;case 1:if(c=h.type,C=h.stateNode,(h.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(da===null||!da.has(C))))return h.flags|=65536,v&=-v,h.lanes|=v,v=y2(v),S2(v,o,h,y),LS(h,v),!1}h=h.return}while(h!==null);return!1}var v2=Error(r(461)),_n=!1;function kn(o,c,h,y){c.child=o===null?CE(c,null,h,y):dl(c,o.child,h,y)}function b2(o,c,h,y,v){h=h.render;var C=c.ref;if("ref"in y){var k={};for(var N in y)N!=="ref"&&(k[N]=y[N])}else k=y;return Sl(c),y=iS(o,c,h,k,C,v),N=sS(),o!==null&&!_n?(oS(o,c,v),ao(o,c,v)):(mt&&N&&Vy(c),c.flags|=1,kn(o,c,y,v),c.child)}function x2(o,c,h,y,v){if(o===null){var C=h.type;return typeof C=="function"&&!KS(C)&&C.defaultProps===void 0&&h.compare===null?(c.tag=15,c.type=C,w2(o,c,C,y,v)):(o=Wf(h.type,null,y,c,c.mode,v),o.ref=c.ref,o.return=c,c.child=o)}if(C=o.child,!AS(o,v)){var k=C.memoizedProps;if(h=h.compare,h=h!==null?h:Qu,h(k,y)&&o.ref===c.ref)return ao(o,c,v)}return c.flags|=1,o=ca(C,y),o.ref=c.ref,o.return=c,c.child=o}function w2(o,c,h,y,v){if(o!==null){var C=o.memoizedProps;if(Qu(C,y)&&o.ref===c.ref)if(_n=!1,c.pendingProps=y=C,AS(o,v))o.flags&131072&&(_n=!0);else return c.lanes=o.lanes,ao(o,c,v)}return wS(o,c,h,y,v)}function _2(o,c,h){var y=c.pendingProps,v=y.children,C=(c.stateNode._pendingVisibility&2)!==0,k=o!==null?o.memoizedState:null;if(hd(o,c),y.mode==="hidden"||C){if(c.flags&128){if(y=k!==null?k.baseLanes|h:h,o!==null){for(v=c.child=o.child,C=0;v!==null;)C=C|v.lanes|v.childLanes,v=v.sibling;c.childLanes=C&~y}else c.childLanes=0,c.child=null;return C2(o,c,y,h)}if(h&536870912)c.memoizedState={baseLanes:0,cachePool:null},o!==null&&Rf(c,k!==null?k.cachePool:null),k!==null?EE(c,k):Qy(),PE(c);else return c.lanes=c.childLanes=536870912,C2(o,c,k!==null?k.baseLanes|h:h,h)}else k!==null?(Rf(c,k.cachePool),EE(c,k),Jo(),c.memoizedState=null):(o!==null&&Rf(c,null),Qy(),Jo());return kn(o,c,v,h),c.child}function C2(o,c,h,y){var v=nS();return v=v===null?null:{parent:vn._currentValue,pool:v},c.memoizedState={baseLanes:h,cachePool:v},o!==null&&Rf(c,null),Qy(),PE(c),o!==null&&fd(o,c,y,!0),null}function hd(o,c){var h=c.ref;if(h===null)o!==null&&o.ref!==null&&(c.flags|=2097664);else{if(typeof h!="function"&&typeof h!="object")throw Error(r(284));(o===null||o.ref!==h)&&(c.flags|=2097664)}}function wS(o,c,h,y,v){return Sl(c),h=iS(o,c,h,y,void 0,v),y=sS(),o!==null&&!_n?(oS(o,c,v),ao(o,c,v)):(mt&&y&&Vy(c),c.flags|=1,kn(o,c,h,v),c.child)}function E2(o,c,h,y,v,C){return Sl(c),c.updateQueue=null,h=kE(c,y,h,v),AE(o),y=sS(),o!==null&&!_n?(oS(o,c,C),ao(o,c,C)):(mt&&y&&Vy(c),c.flags|=1,kn(o,c,h,C),c.child)}function P2(o,c,h,y,v){if(Sl(c),c.stateNode===null){var C=fc,k=h.contextType;typeof k=="object"&&k!==null&&(C=Yn(k)),C=new h(y,C),c.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=bS,c.stateNode=C,C._reactInternals=c,C=c.stateNode,C.props=y,C.state=c.memoizedState,C.refs={},DS(c),k=h.contextType,C.context=typeof k=="object"&&k!==null?Yn(k):fc,C.state=c.memoizedState,k=h.getDerivedStateFromProps,typeof k=="function"&&(vS(c,h,k,y),C.state=c.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(k=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),k!==C.state&&bS.enqueueReplaceState(C,C.state,null),md(c,y,C,v),gd(),C.state=c.memoizedState),typeof C.componentDidMount=="function"&&(c.flags|=4194308),y=!0}else if(o===null){C=c.stateNode;var N=c.memoizedProps,$=ml(h,N);C.props=$;var Q=C.context,ce=h.contextType;k=fc,typeof ce=="object"&&ce!==null&&(k=Yn(ce));var Se=h.getDerivedStateFromProps;ce=typeof Se=="function"||typeof C.getSnapshotBeforeUpdate=="function",N=c.pendingProps!==N,ce||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(N||Q!==k)&&h2(c,C,y,k),ra=!1;var se=c.memoizedState;C.state=se,md(c,y,C,v),gd(),Q=c.memoizedState,N||se!==Q||ra?(typeof Se=="function"&&(vS(c,h,Se,y),Q=c.memoizedState),($=ra||d2(c,h,$,y,se,Q,k))?(ce||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(c.flags|=4194308)):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=y,c.memoizedState=Q),C.props=y,C.state=Q,C.context=k,y=$):(typeof C.componentDidMount=="function"&&(c.flags|=4194308),y=!1)}else{C=c.stateNode,RS(o,c),k=c.memoizedProps,ce=ml(h,k),C.props=ce,Se=c.pendingProps,se=C.context,Q=h.contextType,$=fc,typeof Q=="object"&&Q!==null&&($=Yn(Q)),N=h.getDerivedStateFromProps,(Q=typeof N=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(k!==Se||se!==$)&&h2(c,C,y,$),ra=!1,se=c.memoizedState,C.state=se,md(c,y,C,v),gd();var le=c.memoizedState;k!==Se||se!==le||ra||o!==null&&o.dependencies!==null&&Gf(o.dependencies)?(typeof N=="function"&&(vS(c,h,N,y),le=c.memoizedState),(ce=ra||d2(c,h,ce,y,se,le,$)||o!==null&&o.dependencies!==null&&Gf(o.dependencies))?(Q||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(y,le,$),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(y,le,$)),typeof C.componentDidUpdate=="function"&&(c.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof C.componentDidUpdate!="function"||k===o.memoizedProps&&se===o.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===o.memoizedProps&&se===o.memoizedState||(c.flags|=1024),c.memoizedProps=y,c.memoizedState=le),C.props=y,C.state=le,C.context=$,y=ce):(typeof C.componentDidUpdate!="function"||k===o.memoizedProps&&se===o.memoizedState||(c.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===o.memoizedProps&&se===o.memoizedState||(c.flags|=1024),y=!1)}return C=y,hd(o,c),y=(c.flags&128)!==0,C||y?(C=c.stateNode,h=y&&typeof h.getDerivedStateFromError!="function"?null:C.render(),c.flags|=1,o!==null&&y?(c.child=dl(c,o.child,null,v),c.child=dl(c,null,h,v)):kn(o,c,h,v),c.memoizedState=C.state,o=c.child):o=ao(o,c,v),o}function T2(o,c,h,y){return td(),c.flags|=256,kn(o,c,h,y),c.child}var _S={dehydrated:null,treeContext:null,retryLane:0};function CS(o){return{baseLanes:o,cachePool:ME()}}function ES(o,c,h){return o=o!==null?o.childLanes&~h:0,c&&(o|=xi),o}function I2(o,c,h){var y=c.pendingProps,v=!1,C=(c.flags&128)!==0,k;if((k=C)||(k=o!==null&&o.memoizedState===null?!1:(Sn.current&2)!==0),k&&(v=!0,c.flags&=-129),k=(c.flags&32)!==0,c.flags&=-33,o===null){if(mt){if(v?Qo(c):Jo(),mt){var N=An,$;if($=N){e:{for($=N,N=ys;$.nodeType!==8;){if(!N){N=null;break e}if($=Zi($.nextSibling),$===null){N=null;break e}}N=$}N!==null?(c.memoizedState={dehydrated:N,treeContext:ll!==null?{id:ro,overflow:io}:null,retryLane:536870912},$=bi(18,null,null,0),$.stateNode=N,$.return=c,c.child=$,ar=c,An=null,$=!0):$=!1}$||ul(c)}if(N=c.memoizedState,N!==null&&(N=N.dehydrated,N!==null))return N.data==="$!"?c.lanes=16:c.lanes=536870912,null;so(c)}return N=y.children,y=y.fallback,v?(Jo(),v=c.mode,N=TS({mode:"hidden",children:N},v),y=bl(y,v,h,null),N.return=c,y.return=c,N.sibling=y,c.child=N,v=c.child,v.memoizedState=CS(h),v.childLanes=ES(o,k,h),c.memoizedState=_S,y):(Qo(c),PS(c,N))}if($=o.memoizedState,$!==null&&(N=$.dehydrated,N!==null)){if(C)c.flags&256?(Qo(c),c.flags&=-257,c=IS(o,c,h)):c.memoizedState!==null?(Jo(),c.child=o.child,c.flags|=128,c=null):(Jo(),v=y.fallback,N=c.mode,y=TS({mode:"visible",children:y.children},N),v=bl(v,N,h,null),v.flags|=2,y.return=c,v.return=c,y.sibling=v,c.child=y,dl(c,o.child,null,h),y=c.child,y.memoizedState=CS(h),y.childLanes=ES(o,k,h),c.memoizedState=_S,c=v);else if(Qo(c),N.data==="$!"){if(k=N.nextSibling&&N.nextSibling.dataset,k)var Q=k.dgst;k=Q,y=Error(r(419)),y.stack="",y.digest=k,nd({value:y,source:null,stack:null}),c=IS(o,c,h)}else if(_n||fd(o,c,h,!1),k=(h&o.childLanes)!==0,_n||k){if(k=Dt,k!==null){if(y=h&-h,y&42)y=1;else switch(y){case 2:y=1;break;case 8:y=4;break;case 32:y=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:y=64;break;case 268435456:y=134217728;break;default:y=0}if(y=y&(k.suspendedLanes|h)?0:y,y!==0&&y!==$.retryLane)throw $.retryLane=y,Zo(o,y),lr(k,o,y),v2}N.data==="$?"||nv(),c=IS(o,c,h)}else N.data==="$?"?(c.flags|=128,c.child=o.child,c=e9.bind(null,o),N._reactRetry=c,c=null):(o=$.treeContext,An=Zi(N.nextSibling),ar=c,mt=!0,Xi=null,ys=!1,o!==null&&(gi[mi++]=ro,gi[mi++]=io,gi[mi++]=ll,ro=o.id,io=o.overflow,ll=c),c=PS(c,y.children),c.flags|=4096);return c}return v?(Jo(),v=y.fallback,N=c.mode,$=o.child,Q=$.sibling,y=ca($,{mode:"hidden",children:y.children}),y.subtreeFlags=$.subtreeFlags&31457280,Q!==null?v=ca(Q,v):(v=bl(v,N,h,null),v.flags|=2),v.return=c,y.return=c,y.sibling=v,c.child=y,y=v,v=c.child,N=o.child.memoizedState,N===null?N=CS(h):($=N.cachePool,$!==null?(Q=vn._currentValue,$=$.parent!==Q?{parent:Q,pool:Q}:$):$=ME(),N={baseLanes:N.baseLanes|h,cachePool:$}),v.memoizedState=N,v.childLanes=ES(o,k,h),c.memoizedState=_S,y):(Qo(c),h=o.child,o=h.sibling,h=ca(h,{mode:"visible",children:y.children}),h.return=c,h.sibling=null,o!==null&&(k=c.deletions,k===null?(c.deletions=[o],c.flags|=16):k.push(o)),c.child=h,c.memoizedState=null,h)}function PS(o,c){return c=TS({mode:"visible",children:c},o.mode),c.return=o,o.child=c}function TS(o,c){return eP(o,c,0,null)}function IS(o,c,h){return dl(c,o.child,null,h),o=PS(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function M2(o,c,h){o.lanes|=c;var y=o.alternate;y!==null&&(y.lanes|=c),jS(o.return,c,h)}function MS(o,c,h,y,v){var C=o.memoizedState;C===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:y,tail:h,tailMode:v}:(C.isBackwards=c,C.rendering=null,C.renderingStartTime=0,C.last=y,C.tail=h,C.tailMode=v)}function A2(o,c,h){var y=c.pendingProps,v=y.revealOrder,C=y.tail;if(kn(o,c,y.children,h),y=Sn.current,y&2)y=y&1|2,c.flags|=128;else{if(o!==null&&o.flags&128)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&M2(o,h,c);else if(o.tag===19)M2(o,h,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}y&=1}switch(je(Sn,y),v){case"forwards":for(h=c.child,v=null;h!==null;)o=h.alternate,o!==null&&Df(o)===null&&(v=h),h=h.sibling;h=v,h===null?(v=c.child,c.child=null):(v=h.sibling,h.sibling=null),MS(c,!1,v,h,C);break;case"backwards":for(h=null,v=c.child,c.child=null;v!==null;){if(o=v.alternate,o!==null&&Df(o)===null){c.child=v;break}o=v.sibling,v.sibling=h,h=v,v=o}MS(c,!0,h,null,C);break;case"together":MS(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ao(o,c,h){if(o!==null&&(c.dependencies=o.dependencies),ua|=c.lanes,!(h&c.childLanes))if(o!==null){if(fd(o,c,h,!1),(h&c.childLanes)===0)return null}else return null;if(o!==null&&c.child!==o.child)throw Error(r(153));if(c.child!==null){for(o=c.child,h=ca(o,o.pendingProps),c.child=h,h.return=c;o.sibling!==null;)o=o.sibling,h=h.sibling=ca(o,o.pendingProps),h.return=c;h.sibling=null}return c.child}function AS(o,c){return o.lanes&c?!0:(o=o.dependencies,!!(o!==null&&Gf(o)))}function B7(o,c,h){switch(c.tag){case 3:_t(c,c.stateNode.containerInfo),na(c,vn,o.memoizedState.cache),td();break;case 27:case 5:Sr(c);break;case 4:_t(c,c.stateNode.containerInfo);break;case 10:na(c,c.type,c.memoizedProps.value);break;case 13:var y=c.memoizedState;if(y!==null)return y.dehydrated!==null?(Qo(c),c.flags|=128,null):h&c.child.childLanes?I2(o,c,h):(Qo(c),o=ao(o,c,h),o!==null?o.sibling:null);Qo(c);break;case 19:var v=(o.flags&128)!==0;if(y=(h&c.childLanes)!==0,y||(fd(o,c,h,!1),y=(h&c.childLanes)!==0),v){if(y)return A2(o,c,h);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),je(Sn,Sn.current),y)break;return null;case 22:case 23:return c.lanes=0,_2(o,c,h);case 24:na(c,vn,o.memoizedState.cache)}return ao(o,c,h)}function k2(o,c,h){if(o!==null)if(o.memoizedProps!==c.pendingProps)_n=!0;else{if(!AS(o,h)&&!(c.flags&128))return _n=!1,B7(o,c,h);_n=!!(o.flags&131072)}else _n=!1,mt&&c.flags&1048576&&gE(c,Mf,c.index);switch(c.lanes=0,c.tag){case 16:e:{o=c.pendingProps;var y=c.elementType,v=y._init;if(y=v(y._payload),c.type=y,typeof y=="function")KS(y)?(o=ml(y,o),c.tag=1,c=P2(null,c,y,o,h)):(c.tag=0,c=wS(null,c,y,o,h));else{if(y!=null){if(v=y.$$typeof,v===b){c.tag=11,c=b2(null,c,y,o,h);break e}else if(v===_){c.tag=14,c=x2(null,c,y,o,h);break e}}throw c=R(y)||y,Error(r(306,c,""))}}return c;case 0:return wS(o,c,c.type,c.pendingProps,h);case 1:return y=c.type,v=ml(y,c.pendingProps),P2(o,c,y,v,h);case 3:e:{if(_t(c,c.stateNode.containerInfo),o===null)throw Error(r(387));var C=c.pendingProps;v=c.memoizedState,y=v.element,RS(o,c),md(c,C,null,h);var k=c.memoizedState;if(C=k.cache,na(c,vn,C),C!==v.cache&&OS(c,[vn],h,!0),gd(),C=k.element,v.isDehydrated)if(v={element:C,isDehydrated:!1,cache:k.cache},c.updateQueue.baseState=v,c.memoizedState=v,c.flags&256){c=T2(o,c,C,h);break e}else if(C!==y){y=pi(Error(r(424)),c),nd(y),c=T2(o,c,C,h);break e}else for(An=Zi(c.stateNode.containerInfo.firstChild),ar=c,mt=!0,Xi=null,ys=!0,h=CE(c,null,C,h),c.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(td(),C===y){c=ao(o,c,h);break e}kn(o,c,C,h)}c=c.child}return c;case 26:return hd(o,c),o===null?(h=DP(c.type,null,c.pendingProps,null))?c.memoizedState=h:mt||(h=c.type,o=c.pendingProps,y=lp(at.current).createElement(h),y[xn]=c,y[Kn]=o,jn(y,h,o),hn(y),c.stateNode=y):c.memoizedState=DP(c.type,o.memoizedProps,c.pendingProps,o.memoizedState),null;case 27:return Sr(c),o===null&&mt&&(y=c.stateNode=kP(c.type,c.pendingProps,at.current),ar=c,ys=!0,An=Zi(y.firstChild)),y=c.pendingProps.children,o!==null||mt?kn(o,c,y,h):c.child=dl(c,null,y,h),hd(o,c),c.child;case 5:return o===null&&mt&&((v=y=An)&&(y=m9(y,c.type,c.pendingProps,ys),y!==null?(c.stateNode=y,ar=c,An=Zi(y.firstChild),ys=!1,v=!0):v=!1),v||ul(c)),Sr(c),v=c.type,C=c.pendingProps,k=o!==null?o.memoizedProps:null,y=C.children,mv(v,C)?y=null:k!==null&&mv(v,k)&&(c.flags|=32),c.memoizedState!==null&&(v=iS(o,c,O7,null,null,h),kd._currentValue=v),hd(o,c),kn(o,c,y,h),c.child;case 6:return o===null&&mt&&((o=h=An)&&(h=y9(h,c.pendingProps,ys),h!==null?(c.stateNode=h,ar=c,An=null,o=!0):o=!1),o||ul(c)),null;case 13:return I2(o,c,h);case 4:return _t(c,c.stateNode.containerInfo),y=c.pendingProps,o===null?c.child=dl(c,null,y,h):kn(o,c,y,h),c.child;case 11:return b2(o,c,c.type,c.pendingProps,h);case 7:return kn(o,c,c.pendingProps,h),c.child;case 8:return kn(o,c,c.pendingProps.children,h),c.child;case 12:return kn(o,c,c.pendingProps.children,h),c.child;case 10:return y=c.pendingProps,na(c,c.type,y.value),kn(o,c,y.children,h),c.child;case 9:return v=c.type._context,y=c.pendingProps.children,Sl(c),v=Yn(v),y=y(v),c.flags|=1,kn(o,c,y,h),c.child;case 14:return x2(o,c,c.type,c.pendingProps,h);case 15:return w2(o,c,c.type,c.pendingProps,h);case 19:return A2(o,c,h);case 22:return _2(o,c,h);case 24:return Sl(c),y=Yn(vn),o===null?(v=nS(),v===null&&(v=Dt,C=eS(),v.pooledCache=C,C.refCount++,C!==null&&(v.pooledCacheLanes|=h),v=C),c.memoizedState={parent:y,cache:v},DS(c),na(c,vn,v)):(o.lanes&h&&(RS(o,c),md(c,null,null,h),gd()),v=o.memoizedState,C=c.memoizedState,v.parent!==y?(v={parent:y,cache:y},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),na(c,vn,y)):(y=C.cache,na(c,vn,y),y!==v.cache&&OS(c,[vn],h,!0))),kn(o,c,c.pendingProps.children,h),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}var kS=we(null),yl=null,lo=null;function na(o,c,h){je(kS,c._currentValue),c._currentValue=h}function co(o){o._currentValue=kS.current,Te(kS)}function jS(o,c,h){for(;o!==null;){var y=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,y!==null&&(y.childLanes|=c)):y!==null&&(y.childLanes&c)!==c&&(y.childLanes|=c),o===h)break;o=o.return}}function OS(o,c,h,y){var v=o.child;for(v!==null&&(v.return=o);v!==null;){var C=v.dependencies;if(C!==null){var k=v.child;C=C.firstContext;e:for(;C!==null;){var N=C;C=v;for(var $=0;$<c.length;$++)if(N.context===c[$]){C.lanes|=h,N=C.alternate,N!==null&&(N.lanes|=h),jS(C.return,h,o),y||(k=null);break e}C=N.next}}else if(v.tag===18){if(k=v.return,k===null)throw Error(r(341));k.lanes|=h,C=k.alternate,C!==null&&(C.lanes|=h),jS(k,h,o),k=null}else k=v.child;if(k!==null)k.return=v;else for(k=v;k!==null;){if(k===o){k=null;break}if(v=k.sibling,v!==null){v.return=k.return,k=v;break}k=k.return}v=k}}function fd(o,c,h,y){o=null;for(var v=c,C=!1;v!==null;){if(!C){if(v.flags&524288)C=!0;else if(v.flags&262144)break}if(v.tag===10){var k=v.alternate;if(k===null)throw Error(r(387));if(k=k.memoizedProps,k!==null){var N=v.type;Kr(v.pendingProps.value,k.value)||(o!==null?o.push(N):o=[N])}}else if(v===Bt.current){if(k=v.alternate,k===null)throw Error(r(387));k.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(o!==null?o.push(kd):o=[kd])}v=v.return}o!==null&&OS(c,o,h,y),c.flags|=262144}function Gf(o){for(o=o.firstContext;o!==null;){if(!Kr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Sl(o){yl=o,lo=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Yn(o){return j2(yl,o)}function Yf(o,c){return yl===null&&Sl(o),j2(o,c)}function j2(o,c){var h=c._currentValue;if(c={context:c,memoizedValue:h,next:null},lo===null){if(o===null)throw Error(r(308));lo=c,o.dependencies={lanes:0,firstContext:c},o.flags|=524288}else lo=lo.next=c;return h}var ra=!1;function DS(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function RS(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function ia(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function sa(o,c,h){var y=o.updateQueue;if(y===null)return null;if(y=y.shared,Wt&2){var v=y.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),y.pending=c,c=Tf(o),fE(o,null,h),c}return Pf(o,y,c,h),Tf(o)}function pd(o,c,h){if(c=c.updateQueue,c!==null&&(c=c.shared,(h&4194176)!==0)){var y=c.lanes;y&=o.pendingLanes,h|=y,c.lanes=h,pf(o,h)}}function LS(o,c){var h=o.updateQueue,y=o.alternate;if(y!==null&&(y=y.updateQueue,h===y)){var v=null,C=null;if(h=h.firstBaseUpdate,h!==null){do{var k={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};C===null?v=C=k:C=C.next=k,h=h.next}while(h!==null);C===null?v=C=c:C=C.next=c}else v=C=c;h={baseState:y.baseState,firstBaseUpdate:v,lastBaseUpdate:C,shared:y.shared,callbacks:y.callbacks},o.updateQueue=h;return}o=h.lastBaseUpdate,o===null?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=c}var NS=!1;function gd(){if(NS){var o=vc;if(o!==null)throw o}}function md(o,c,h,y){NS=!1;var v=o.updateQueue;ra=!1;var C=v.firstBaseUpdate,k=v.lastBaseUpdate,N=v.shared.pending;if(N!==null){v.shared.pending=null;var $=N,Q=$.next;$.next=null,k===null?C=Q:k.next=Q,k=$;var ce=o.alternate;ce!==null&&(ce=ce.updateQueue,N=ce.lastBaseUpdate,N!==k&&(N===null?ce.firstBaseUpdate=Q:N.next=Q,ce.lastBaseUpdate=$))}if(C!==null){var Se=v.baseState;k=0,ce=Q=$=null,N=C;do{var se=N.lane&-536870913,le=se!==N.lane;if(le?(dt&se)===se:(y&se)===se){se!==0&&se===Sc&&(NS=!0),ce!==null&&(ce=ce.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var De=o,Ge=N;se=c;var rn=h;switch(Ge.tag){case 1:if(De=Ge.payload,typeof De=="function"){Se=De.call(rn,Se,se);break e}Se=De;break e;case 3:De.flags=De.flags&-65537|128;case 0:if(De=Ge.payload,se=typeof De=="function"?De.call(rn,Se,se):De,se==null)break e;Se=L({},Se,se);break e;case 2:ra=!0}}se=N.callback,se!==null&&(o.flags|=64,le&&(o.flags|=8192),le=v.callbacks,le===null?v.callbacks=[se]:le.push(se))}else le={lane:se,tag:N.tag,payload:N.payload,callback:N.callback,next:null},ce===null?(Q=ce=le,$=Se):ce=ce.next=le,k|=se;if(N=N.next,N===null){if(N=v.shared.pending,N===null)break;le=N,N=le.next,le.next=null,v.lastBaseUpdate=le,v.shared.pending=null}}while(!0);ce===null&&($=Se),v.baseState=$,v.firstBaseUpdate=Q,v.lastBaseUpdate=ce,C===null&&(v.shared.lanes=0),ua|=k,o.lanes=k,o.memoizedState=Se}}function O2(o,c){if(typeof o!="function")throw Error(r(191,o));o.call(c)}function D2(o,c){var h=o.callbacks;if(h!==null)for(o.callbacks=null,o=0;o<h.length;o++)O2(h[o],c)}function yd(o,c){try{var h=c.updateQueue,y=h!==null?h.lastEffect:null;if(y!==null){var v=y.next;h=v;do{if((h.tag&o)===o){y=void 0;var C=h.create,k=h.inst;y=C(),k.destroy=y}h=h.next}while(h!==v)}}catch(N){At(c,c.return,N)}}function oa(o,c,h){try{var y=c.updateQueue,v=y!==null?y.lastEffect:null;if(v!==null){var C=v.next;y=C;do{if((y.tag&o)===o){var k=y.inst,N=k.destroy;if(N!==void 0){k.destroy=void 0,v=c;var $=h;try{N()}catch(Q){At(v,$,Q)}}}y=y.next}while(y!==C)}}catch(Q){At(c,c.return,Q)}}function R2(o){var c=o.updateQueue;if(c!==null){var h=o.stateNode;try{D2(c,h)}catch(y){At(o,o.return,y)}}}function L2(o,c,h){h.props=ml(o.type,o.memoizedProps),h.state=o.memoizedState;try{h.componentWillUnmount()}catch(y){At(o,c,y)}}function vl(o,c){try{var h=o.ref;if(h!==null){var y=o.stateNode;switch(o.tag){case 26:case 27:case 5:var v=y;break;default:v=y}typeof h=="function"?o.refCleanup=h(v):h.current=v}}catch(C){At(o,c,C)}}function qr(o,c){var h=o.ref,y=o.refCleanup;if(h!==null)if(typeof y=="function")try{y()}catch(v){At(o,c,v)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(v){At(o,c,v)}else h.current=null}function N2(o){var c=o.type,h=o.memoizedProps,y=o.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":h.autoFocus&&y.focus();break e;case"img":h.src?y.src=h.src:h.srcSet&&(y.srcset=h.srcSet)}}catch(v){At(o,o.return,v)}}function z2(o,c,h){try{var y=o.stateNode;d9(y,o.type,h,c),y[Kn]=c}catch(v){At(o,o.return,v)}}function F2(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27||o.tag===4}function zS(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||F2(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==27&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function FS(o,c,h){var y=o.tag;if(y===5||y===6)o=o.stateNode,c?h.nodeType===8?h.parentNode.insertBefore(o,c):h.insertBefore(o,c):(h.nodeType===8?(c=h.parentNode,c.insertBefore(o,h)):(c=h,c.appendChild(o)),h=h._reactRootContainer,h!=null||c.onclick!==null||(c.onclick=ap));else if(y!==4&&y!==27&&(o=o.child,o!==null))for(FS(o,c,h),o=o.sibling;o!==null;)FS(o,c,h),o=o.sibling}function Vf(o,c,h){var y=o.tag;if(y===5||y===6)o=o.stateNode,c?h.insertBefore(o,c):h.appendChild(o);else if(y!==4&&y!==27&&(o=o.child,o!==null))for(Vf(o,c,h),o=o.sibling;o!==null;)Vf(o,c,h),o=o.sibling}var uo=!1,tn=!1,BS=!1,B2=typeof WeakSet=="function"?WeakSet:Set,Cn=null,U2=!1;function U7(o,c){if(o=o.containerInfo,pv=pp,o=iE(o),$y(o)){if("selectionStart"in o)var h={start:o.selectionStart,end:o.selectionEnd};else e:{h=(h=o.ownerDocument)&&h.defaultView||window;var y=h.getSelection&&h.getSelection();if(y&&y.rangeCount!==0){h=y.anchorNode;var v=y.anchorOffset,C=y.focusNode;y=y.focusOffset;try{h.nodeType,C.nodeType}catch{h=null;break e}var k=0,N=-1,$=-1,Q=0,ce=0,Se=o,se=null;t:for(;;){for(var le;Se!==h||v!==0&&Se.nodeType!==3||(N=k+v),Se!==C||y!==0&&Se.nodeType!==3||($=k+y),Se.nodeType===3&&(k+=Se.nodeValue.length),(le=Se.firstChild)!==null;)se=Se,Se=le;for(;;){if(Se===o)break t;if(se===h&&++Q===v&&(N=k),se===C&&++ce===y&&($=k),(le=Se.nextSibling)!==null)break;Se=se,se=Se.parentNode}Se=le}h=N===-1||$===-1?null:{start:N,end:$}}else h=null}h=h||{start:0,end:0}}else h=null;for(gv={focusedElem:o,selectionRange:h},pp=!1,Cn=c;Cn!==null;)if(c=Cn,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,Cn=o;else for(;Cn!==null;){switch(c=Cn,C=c.alternate,o=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if(o&1024&&C!==null){o=void 0,h=c,v=C.memoizedProps,C=C.memoizedState,y=h.stateNode;try{var De=ml(h.type,v,h.elementType===h.type);o=y.getSnapshotBeforeUpdate(De,C),y.__reactInternalSnapshotBeforeUpdate=o}catch(Ge){At(h,h.return,Ge)}}break;case 3:if(o&1024){if(o=c.stateNode.containerInfo,h=o.nodeType,h===9)vv(o);else if(h===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":vv(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(o&1024)throw Error(r(163))}if(o=c.sibling,o!==null){o.return=c.return,Cn=o;break}Cn=c.return}return De=U2,U2=!1,De}function $2(o,c,h){var y=h.flags;switch(h.tag){case 0:case 11:case 15:fo(o,h),y&4&&yd(5,h);break;case 1:if(fo(o,h),y&4)if(o=h.stateNode,c===null)try{o.componentDidMount()}catch(N){At(h,h.return,N)}else{var v=ml(h.type,c.memoizedProps);c=c.memoizedState;try{o.componentDidUpdate(v,c,o.__reactInternalSnapshotBeforeUpdate)}catch(N){At(h,h.return,N)}}y&64&&R2(h),y&512&&vl(h,h.return);break;case 3:if(fo(o,h),y&64&&(y=h.updateQueue,y!==null)){if(o=null,h.child!==null)switch(h.child.tag){case 27:case 5:o=h.child.stateNode;break;case 1:o=h.child.stateNode}try{D2(y,o)}catch(N){At(h,h.return,N)}}break;case 26:fo(o,h),y&512&&vl(h,h.return);break;case 27:case 5:fo(o,h),c===null&&y&4&&N2(h),y&512&&vl(h,h.return);break;case 12:fo(o,h);break;case 13:fo(o,h),y&4&&q2(o,h);break;case 22:if(v=h.memoizedState!==null||uo,!v){c=c!==null&&c.memoizedState!==null||tn;var C=uo,k=tn;uo=v,(tn=c)&&!k?aa(o,h,(h.subtreeFlags&8772)!==0):fo(o,h),uo=C,tn=k}y&512&&(h.memoizedProps.mode==="manual"?vl(h,h.return):qr(h,h.return));break;default:fo(o,h)}}function H2(o){var c=o.alternate;c!==null&&(o.alternate=null,H2(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&Bu(c)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var gn=null,Gr=!1;function ho(o,c,h){for(h=h.child;h!==null;)K2(o,c,h),h=h.sibling}function K2(o,c,h){if(Gt&&typeof Gt.onCommitFiberUnmount=="function")try{Gt.onCommitFiberUnmount(bt,h)}catch{}switch(h.tag){case 26:tn||qr(h,c),ho(o,c,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:tn||qr(h,c);var y=gn,v=Gr;for(gn=h.stateNode,ho(o,c,h),h=h.stateNode,c=h.attributes;c.length;)h.removeAttributeNode(c[0]);Bu(h),gn=y,Gr=v;break;case 5:tn||qr(h,c);case 6:v=gn;var C=Gr;if(gn=null,ho(o,c,h),gn=v,Gr=C,gn!==null)if(Gr)try{o=gn,y=h.stateNode,o.nodeType===8?o.parentNode.removeChild(y):o.removeChild(y)}catch(k){At(h,c,k)}else try{gn.removeChild(h.stateNode)}catch(k){At(h,c,k)}break;case 18:gn!==null&&(Gr?(c=gn,h=h.stateNode,c.nodeType===8?Sv(c.parentNode,h):c.nodeType===1&&Sv(c,h),Rd(c)):Sv(gn,h.stateNode));break;case 4:y=gn,v=Gr,gn=h.stateNode.containerInfo,Gr=!0,ho(o,c,h),gn=y,Gr=v;break;case 0:case 11:case 14:case 15:tn||oa(2,h,c),tn||oa(4,h,c),ho(o,c,h);break;case 1:tn||(qr(h,c),y=h.stateNode,typeof y.componentWillUnmount=="function"&&L2(h,c,y)),ho(o,c,h);break;case 21:ho(o,c,h);break;case 22:tn||qr(h,c),tn=(y=tn)||h.memoizedState!==null,ho(o,c,h),tn=y;break;default:ho(o,c,h)}}function q2(o,c){if(c.memoizedState===null&&(o=c.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Rd(o)}catch(h){At(c,c.return,h)}}function $7(o){switch(o.tag){case 13:case 19:var c=o.stateNode;return c===null&&(c=o.stateNode=new B2),c;case 22:return o=o.stateNode,c=o._retryCache,c===null&&(c=o._retryCache=new B2),c;default:throw Error(r(435,o.tag))}}function US(o,c){var h=$7(o);c.forEach(function(y){var v=t9.bind(null,o,y);h.has(y)||(h.add(y),y.then(v,v))})}function Si(o,c){var h=c.deletions;if(h!==null)for(var y=0;y<h.length;y++){var v=h[y],C=o,k=c,N=k;e:for(;N!==null;){switch(N.tag){case 27:case 5:gn=N.stateNode,Gr=!1;break e;case 3:gn=N.stateNode.containerInfo,Gr=!0;break e;case 4:gn=N.stateNode.containerInfo,Gr=!0;break e}N=N.return}if(gn===null)throw Error(r(160));K2(C,k,v),gn=null,Gr=!1,C=v.alternate,C!==null&&(C.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)G2(c,o),c=c.sibling}var Wi=null;function G2(o,c){var h=o.alternate,y=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Si(c,o),vi(o),y&4&&(oa(3,o,o.return),yd(3,o),oa(5,o,o.return));break;case 1:Si(c,o),vi(o),y&512&&(tn||h===null||qr(h,h.return)),y&64&&uo&&(o=o.updateQueue,o!==null&&(y=o.callbacks,y!==null&&(h=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=h===null?y:h.concat(y))));break;case 26:var v=Wi;if(Si(c,o),vi(o),y&512&&(tn||h===null||qr(h,h.return)),y&4){var C=h!==null?h.memoizedState:null;if(y=o.memoizedState,h===null)if(y===null)if(o.stateNode===null){e:{y=o.type,h=o.memoizedProps,v=v.ownerDocument||v;t:switch(y){case"title":C=v.getElementsByTagName("title")[0],(!C||C[Za]||C[xn]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=v.createElement(y),v.head.insertBefore(C,v.querySelector("head > title"))),jn(C,y,h),C[xn]=o,hn(C),y=C;break e;case"link":var k=NP("link","href",v).get(y+(h.href||""));if(k){for(var N=0;N<k.length;N++)if(C=k[N],C.getAttribute("href")===(h.href==null?null:h.href)&&C.getAttribute("rel")===(h.rel==null?null:h.rel)&&C.getAttribute("title")===(h.title==null?null:h.title)&&C.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){k.splice(N,1);break t}}C=v.createElement(y),jn(C,y,h),v.head.appendChild(C);break;case"meta":if(k=NP("meta","content",v).get(y+(h.content||""))){for(N=0;N<k.length;N++)if(C=k[N],C.getAttribute("content")===(h.content==null?null:""+h.content)&&C.getAttribute("name")===(h.name==null?null:h.name)&&C.getAttribute("property")===(h.property==null?null:h.property)&&C.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&C.getAttribute("charset")===(h.charSet==null?null:h.charSet)){k.splice(N,1);break t}}C=v.createElement(y),jn(C,y,h),v.head.appendChild(C);break;default:throw Error(r(468,y))}C[xn]=o,hn(C),y=C}o.stateNode=y}else zP(v,o.type,o.stateNode);else o.stateNode=LP(v,y,o.memoizedProps);else C!==y?(C===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):C.count--,y===null?zP(v,o.type,o.stateNode):LP(v,y,o.memoizedProps)):y===null&&o.stateNode!==null&&z2(o,o.memoizedProps,h.memoizedProps)}break;case 27:if(y&4&&o.alternate===null){v=o.stateNode,C=o.memoizedProps;try{for(var $=v.firstChild;$;){var Q=$.nextSibling,ce=$.nodeName;$[Za]||ce==="HEAD"||ce==="BODY"||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&$.rel.toLowerCase()==="stylesheet"||v.removeChild($),$=Q}for(var Se=o.type,se=v.attributes;se.length;)v.removeAttributeNode(se[0]);jn(v,Se,C),v[xn]=o,v[Kn]=C}catch(De){At(o,o.return,De)}}case 5:if(Si(c,o),vi(o),y&512&&(tn||h===null||qr(h,h.return)),o.flags&32){v=o.stateNode;try{$r(v,"")}catch(De){At(o,o.return,De)}}y&4&&o.stateNode!=null&&(v=o.memoizedProps,z2(o,v,h!==null?h.memoizedProps:v)),y&1024&&(BS=!0);break;case 6:if(Si(c,o),vi(o),y&4){if(o.stateNode===null)throw Error(r(162));y=o.memoizedProps,h=o.stateNode;try{h.nodeValue=y}catch(De){At(o,o.return,De)}}break;case 3:if(dp=null,v=Wi,Wi=cp(c.containerInfo),Si(c,o),Wi=v,vi(o),y&4&&h!==null&&h.memoizedState.isDehydrated)try{Rd(c.containerInfo)}catch(De){At(o,o.return,De)}BS&&(BS=!1,Y2(o));break;case 4:y=Wi,Wi=cp(o.stateNode.containerInfo),Si(c,o),vi(o),Wi=y;break;case 12:Si(c,o),vi(o);break;case 13:Si(c,o),vi(o),o.child.flags&8192&&o.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(WS=br()),y&4&&(y=o.updateQueue,y!==null&&(o.updateQueue=null,US(o,y)));break;case 22:if(y&512&&(tn||h===null||qr(h,h.return)),$=o.memoizedState!==null,Q=h!==null&&h.memoizedState!==null,ce=uo,Se=tn,uo=ce||$,tn=Se||Q,Si(c,o),tn=Se,uo=ce,vi(o),c=o.stateNode,c._current=o,c._visibility&=-3,c._visibility|=c._pendingVisibility&2,y&8192&&(c._visibility=$?c._visibility&-2:c._visibility|1,$&&(c=uo||tn,h===null||Q||c||_c(o)),o.memoizedProps===null||o.memoizedProps.mode!=="manual"))e:for(h=null,c=o;;){if(c.tag===5||c.tag===26||c.tag===27){if(h===null){Q=h=c;try{if(v=Q.stateNode,$)C=v.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{k=Q.stateNode,N=Q.memoizedProps.style;var le=N!=null&&N.hasOwnProperty("display")?N.display:null;k.style.display=le==null||typeof le=="boolean"?"":(""+le).trim()}}catch(De){At(Q,Q.return,De)}}}else if(c.tag===6){if(h===null){Q=c;try{Q.stateNode.nodeValue=$?"":Q.memoizedProps}catch(De){At(Q,Q.return,De)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===o)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break e;for(;c.sibling===null;){if(c.return===null||c.return===o)break e;h===c&&(h=null),c=c.return}h===c&&(h=null),c.sibling.return=c.return,c=c.sibling}y&4&&(y=o.updateQueue,y!==null&&(h=y.retryQueue,h!==null&&(y.retryQueue=null,US(o,h))));break;case 19:Si(c,o),vi(o),y&4&&(y=o.updateQueue,y!==null&&(o.updateQueue=null,US(o,y)));break;case 21:break;default:Si(c,o),vi(o)}}function vi(o){var c=o.flags;if(c&2){try{if(o.tag!==27){e:{for(var h=o.return;h!==null;){if(F2(h)){var y=h;break e}h=h.return}throw Error(r(160))}switch(y.tag){case 27:var v=y.stateNode,C=zS(o);Vf(o,C,v);break;case 5:var k=y.stateNode;y.flags&32&&($r(k,""),y.flags&=-33);var N=zS(o);Vf(o,N,k);break;case 3:case 4:var $=y.stateNode.containerInfo,Q=zS(o);FS(o,Q,$);break;default:throw Error(r(161))}}}catch(ce){At(o,o.return,ce)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function Y2(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var c=o;Y2(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),o=o.sibling}}function fo(o,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)$2(o,c.alternate,c),c=c.sibling}function _c(o){for(o=o.child;o!==null;){var c=o;switch(c.tag){case 0:case 11:case 14:case 15:oa(4,c,c.return),_c(c);break;case 1:qr(c,c.return);var h=c.stateNode;typeof h.componentWillUnmount=="function"&&L2(c,c.return,h),_c(c);break;case 26:case 27:case 5:qr(c,c.return),_c(c);break;case 22:qr(c,c.return),c.memoizedState===null&&_c(c);break;default:_c(c)}o=o.sibling}}function aa(o,c,h){for(h=h&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var y=c.alternate,v=o,C=c,k=C.flags;switch(C.tag){case 0:case 11:case 15:aa(v,C,h),yd(4,C);break;case 1:if(aa(v,C,h),y=C,v=y.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(Q){At(y,y.return,Q)}if(y=C,v=y.updateQueue,v!==null){var N=y.stateNode;try{var $=v.shared.hiddenCallbacks;if($!==null)for(v.shared.hiddenCallbacks=null,v=0;v<$.length;v++)O2($[v],N)}catch(Q){At(y,y.return,Q)}}h&&k&64&&R2(C),vl(C,C.return);break;case 26:case 27:case 5:aa(v,C,h),h&&y===null&&k&4&&N2(C),vl(C,C.return);break;case 12:aa(v,C,h);break;case 13:aa(v,C,h),h&&k&4&&q2(v,C);break;case 22:C.memoizedState===null&&aa(v,C,h),vl(C,C.return);break;default:aa(v,C,h)}c=c.sibling}}function $S(o,c){var h=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),o=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(o=c.memoizedState.cachePool.pool),o!==h&&(o!=null&&o.refCount++,h!=null&&ad(h))}function HS(o,c){o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&ad(o))}function la(o,c,h,y){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)V2(o,c,h,y),c=c.sibling}function V2(o,c,h,y){var v=c.flags;switch(c.tag){case 0:case 11:case 15:la(o,c,h,y),v&2048&&yd(9,c);break;case 3:la(o,c,h,y),v&2048&&(o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&ad(o)));break;case 12:if(v&2048){la(o,c,h,y),o=c.stateNode;try{var C=c.memoizedProps,k=C.id,N=C.onPostCommit;typeof N=="function"&&N(k,c.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch($){At(c,c.return,$)}}else la(o,c,h,y);break;case 23:break;case 22:C=c.stateNode,c.memoizedState!==null?C._visibility&4?la(o,c,h,y):Sd(o,c):C._visibility&4?la(o,c,h,y):(C._visibility|=4,Cc(o,c,h,y,(c.subtreeFlags&10256)!==0)),v&2048&&$S(c.alternate,c);break;case 24:la(o,c,h,y),v&2048&&HS(c.alternate,c);break;default:la(o,c,h,y)}}function Cc(o,c,h,y,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var C=o,k=c,N=h,$=y,Q=k.flags;switch(k.tag){case 0:case 11:case 15:Cc(C,k,N,$,v),yd(8,k);break;case 23:break;case 22:var ce=k.stateNode;k.memoizedState!==null?ce._visibility&4?Cc(C,k,N,$,v):Sd(C,k):(ce._visibility|=4,Cc(C,k,N,$,v)),v&&Q&2048&&$S(k.alternate,k);break;case 24:Cc(C,k,N,$,v),v&&Q&2048&&HS(k.alternate,k);break;default:Cc(C,k,N,$,v)}c=c.sibling}}function Sd(o,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var h=o,y=c,v=y.flags;switch(y.tag){case 22:Sd(h,y),v&2048&&$S(y.alternate,y);break;case 24:Sd(h,y),v&2048&&HS(y.alternate,y);break;default:Sd(h,y)}c=c.sibling}}var vd=8192;function Ec(o){if(o.subtreeFlags&vd)for(o=o.child;o!==null;)X2(o),o=o.sibling}function X2(o){switch(o.tag){case 26:Ec(o),o.flags&vd&&o.memoizedState!==null&&A9(Wi,o.memoizedState,o.memoizedProps);break;case 5:Ec(o);break;case 3:case 4:var c=Wi;Wi=cp(o.stateNode.containerInfo),Ec(o),Wi=c;break;case 22:o.memoizedState===null&&(c=o.alternate,c!==null&&c.memoizedState!==null?(c=vd,vd=16777216,Ec(o),vd=c):Ec(o));break;default:Ec(o)}}function W2(o){var c=o.alternate;if(c!==null&&(o=c.child,o!==null)){c.child=null;do c=o.sibling,o.sibling=null,o=c;while(o!==null)}}function bd(o){var c=o.deletions;if(o.flags&16){if(c!==null)for(var h=0;h<c.length;h++){var y=c[h];Cn=y,Q2(y,o)}W2(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Z2(o),o=o.sibling}function Z2(o){switch(o.tag){case 0:case 11:case 15:bd(o),o.flags&2048&&oa(9,o,o.return);break;case 3:bd(o);break;case 12:bd(o);break;case 22:var c=o.stateNode;o.memoizedState!==null&&c._visibility&4&&(o.return===null||o.return.tag!==13)?(c._visibility&=-5,Xf(o)):bd(o);break;default:bd(o)}}function Xf(o){var c=o.deletions;if(o.flags&16){if(c!==null)for(var h=0;h<c.length;h++){var y=c[h];Cn=y,Q2(y,o)}W2(o)}for(o=o.child;o!==null;){switch(c=o,c.tag){case 0:case 11:case 15:oa(8,c,c.return),Xf(c);break;case 22:h=c.stateNode,h._visibility&4&&(h._visibility&=-5,Xf(c));break;default:Xf(c)}o=o.sibling}}function Q2(o,c){for(;Cn!==null;){var h=Cn;switch(h.tag){case 0:case 11:case 15:oa(8,h,c);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var y=h.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:ad(h.memoizedState.cache)}if(y=h.child,y!==null)y.return=h,Cn=y;else e:for(h=o;Cn!==null;){y=Cn;var v=y.sibling,C=y.return;if(H2(y),y===h){Cn=null;break e}if(v!==null){v.return=C,Cn=v;break e}Cn=C}}}function H7(o,c,h,y){this.tag=o,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bi(o,c,h,y){return new H7(o,c,h,y)}function KS(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ca(o,c){var h=o.alternate;return h===null?(h=bi(o.tag,c,o.key,o.mode),h.elementType=o.elementType,h.type=o.type,h.stateNode=o.stateNode,h.alternate=o,o.alternate=h):(h.pendingProps=c,h.type=o.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=o.flags&31457280,h.childLanes=o.childLanes,h.lanes=o.lanes,h.child=o.child,h.memoizedProps=o.memoizedProps,h.memoizedState=o.memoizedState,h.updateQueue=o.updateQueue,c=o.dependencies,h.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},h.sibling=o.sibling,h.index=o.index,h.ref=o.ref,h.refCleanup=o.refCleanup,h}function J2(o,c){o.flags&=31457282;var h=o.alternate;return h===null?(o.childLanes=0,o.lanes=c,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=h.childLanes,o.lanes=h.lanes,o.child=h.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=h.memoizedProps,o.memoizedState=h.memoizedState,o.updateQueue=h.updateQueue,o.type=h.type,c=h.dependencies,o.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),o}function Wf(o,c,h,y,v,C){var k=0;if(y=o,typeof o=="function")KS(o)&&(k=1);else if(typeof o=="string")k=I9(o,h,He.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case u:return bl(h.children,v,C,c);case d:k=8,v|=24;break;case f:return o=bi(12,h,c,v|2),o.elementType=f,o.lanes=C,o;case x:return o=bi(13,h,c,v),o.elementType=x,o.lanes=C,o;case w:return o=bi(19,h,c,v),o.elementType=w,o.lanes=C,o;case M:return eP(h,v,C,c);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case g:case S:k=10;break e;case m:k=9;break e;case b:k=11;break e;case _:k=14;break e;case E:k=16,y=null;break e}k=29,h=Error(r(130,o===null?"null":typeof o,"")),y=null}return c=bi(k,h,c,v),c.elementType=o,c.type=y,c.lanes=C,c}function bl(o,c,h,y){return o=bi(7,o,y,c),o.lanes=h,o}function eP(o,c,h,y){o=bi(22,o,y,c),o.elementType=M,o.lanes=h;var v={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var C=v._current;if(C===null)throw Error(r(456));if(!(v._pendingVisibility&2)){var k=Zo(C,2);k!==null&&(v._pendingVisibility|=2,lr(k,C,2))}},attach:function(){var C=v._current;if(C===null)throw Error(r(456));if(v._pendingVisibility&2){var k=Zo(C,2);k!==null&&(v._pendingVisibility&=-3,lr(k,C,2))}}};return o.stateNode=v,o}function qS(o,c,h){return o=bi(6,o,null,c),o.lanes=h,o}function GS(o,c,h){return c=bi(4,o.children!==null?o.children:[],o.key,c),c.lanes=h,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}function po(o){o.flags|=4}function tP(o,c){if(c.type!=="stylesheet"||c.state.loading&4)o.flags&=-16777217;else if(o.flags|=16777216,!FP(c)){if(c=yi.current,c!==null&&((dt&4194176)===dt?Ss!==null:(dt&62914560)!==dt&&!(dt&536870912)||c!==Ss))throw id=Zy,SE;o.flags|=8192}}function Zf(o,c){c!==null&&(o.flags|=4),o.flags&16384&&(c=o.tag!==22?Ko():536870912,o.lanes|=c,Tc|=c)}function xd(o,c){if(!mt)switch(o.tailMode){case"hidden":c=o.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?o.tail=null:h.sibling=null;break;case"collapsed":h=o.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:y.sibling=null}}function Xt(o){var c=o.alternate!==null&&o.alternate.child===o.child,h=0,y=0;if(c)for(var v=o.child;v!==null;)h|=v.lanes|v.childLanes,y|=v.subtreeFlags&31457280,y|=v.flags&31457280,v.return=o,v=v.sibling;else for(v=o.child;v!==null;)h|=v.lanes|v.childLanes,y|=v.subtreeFlags,y|=v.flags,v.return=o,v=v.sibling;return o.subtreeFlags|=y,o.childLanes=h,c}function K7(o,c,h){var y=c.pendingProps;switch(Xy(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xt(c),null;case 1:return Xt(c),null;case 3:return h=c.stateNode,y=null,o!==null&&(y=o.memoizedState.cache),c.memoizedState.cache!==y&&(c.flags|=2048),co(vn),gt(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(ed(c)?po(c):o===null||o.memoizedState.isDehydrated&&!(c.flags&256)||(c.flags|=1024,Xi!==null&&(ev(Xi),Xi=null))),Xt(c),null;case 26:return h=c.memoizedState,o===null?(po(c),h!==null?(Xt(c),tP(c,h)):(Xt(c),c.flags&=-16777217)):h?h!==o.memoizedState?(po(c),Xt(c),tP(c,h)):(Xt(c),c.flags&=-16777217):(o.memoizedProps!==y&&po(c),Xt(c),c.flags&=-16777217),null;case 27:Hn(c),h=at.current;var v=c.type;if(o!==null&&c.stateNode!=null)o.memoizedProps!==y&&po(c);else{if(!y){if(c.stateNode===null)throw Error(r(166));return Xt(c),null}o=He.current,ed(c)?mE(c):(o=kP(v,y,h),c.stateNode=o,po(c))}return Xt(c),null;case 5:if(Hn(c),h=c.type,o!==null&&c.stateNode!=null)o.memoizedProps!==y&&po(c);else{if(!y){if(c.stateNode===null)throw Error(r(166));return Xt(c),null}if(o=He.current,ed(c))mE(c);else{switch(v=lp(at.current),o){case 1:o=v.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:o=v.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":o=v.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":o=v.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":o=v.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof y.is=="string"?v.createElement("select",{is:y.is}):v.createElement("select"),y.multiple?o.multiple=!0:y.size&&(o.size=y.size);break;default:o=typeof y.is=="string"?v.createElement(h,{is:y.is}):v.createElement(h)}}o[xn]=c,o[Kn]=y;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)o.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=o;e:switch(jn(o,h,y),h){case"button":case"input":case"select":case"textarea":o=!!y.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&po(c)}}return Xt(c),c.flags&=-16777217,null;case 6:if(o&&c.stateNode!=null)o.memoizedProps!==y&&po(c);else{if(typeof y!="string"&&c.stateNode===null)throw Error(r(166));if(o=at.current,ed(c)){if(o=c.stateNode,h=c.memoizedProps,y=null,v=ar,v!==null)switch(v.tag){case 27:case 5:y=v.memoizedProps}o[xn]=c,o=!!(o.nodeValue===h||y!==null&&y.suppressHydrationWarning===!0||EP(o.nodeValue,h)),o||ul(c)}else o=lp(o).createTextNode(y),o[xn]=c,c.stateNode=o}return Xt(c),null;case 13:if(y=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(v=ed(c),y!==null&&y.dehydrated!==null){if(o===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[xn]=c}else td(),!(c.flags&128)&&(c.memoizedState=null),c.flags|=4;Xt(c),v=!1}else Xi!==null&&(ev(Xi),Xi=null),v=!0;if(!v)return c.flags&256?(so(c),c):(so(c),null)}if(so(c),c.flags&128)return c.lanes=h,c;if(h=y!==null,o=o!==null&&o.memoizedState!==null,h){y=c.child,v=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(v=y.alternate.memoizedState.cachePool.pool);var C=null;y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(C=y.memoizedState.cachePool.pool),C!==v&&(y.flags|=2048)}return h!==o&&h&&(c.child.flags|=8192),Zf(c,c.updateQueue),Xt(c),null;case 4:return gt(),o===null&&dv(c.stateNode.containerInfo),Xt(c),null;case 10:return co(c.type),Xt(c),null;case 19:if(Te(Sn),v=c.memoizedState,v===null)return Xt(c),null;if(y=(c.flags&128)!==0,C=v.rendering,C===null)if(y)xd(v,!1);else{if(nn!==0||o!==null&&o.flags&128)for(o=c.child;o!==null;){if(C=Df(o),C!==null){for(c.flags|=128,xd(v,!1),o=C.updateQueue,c.updateQueue=o,Zf(c,o),c.subtreeFlags=0,o=h,h=c.child;h!==null;)J2(h,o),h=h.sibling;return je(Sn,Sn.current&1|2),c.child}o=o.sibling}v.tail!==null&&br()>Qf&&(c.flags|=128,y=!0,xd(v,!1),c.lanes=4194304)}else{if(!y)if(o=Df(C),o!==null){if(c.flags|=128,y=!0,o=o.updateQueue,c.updateQueue=o,Zf(c,o),xd(v,!0),v.tail===null&&v.tailMode==="hidden"&&!C.alternate&&!mt)return Xt(c),null}else 2*br()-v.renderingStartTime>Qf&&h!==536870912&&(c.flags|=128,y=!0,xd(v,!1),c.lanes=4194304);v.isBackwards?(C.sibling=c.child,c.child=C):(o=v.last,o!==null?o.sibling=C:c.child=C,v.last=C)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=br(),c.sibling=null,o=Sn.current,je(Sn,y?o&1|2:o&1),c):(Xt(c),null);case 22:case 23:return so(c),Jy(),y=c.memoizedState!==null,o!==null?o.memoizedState!==null!==y&&(c.flags|=8192):y&&(c.flags|=8192),y?h&536870912&&!(c.flags&128)&&(Xt(c),c.subtreeFlags&6&&(c.flags|=8192)):Xt(c),h=c.updateQueue,h!==null&&Zf(c,h.retryQueue),h=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),y=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),y!==h&&(c.flags|=2048),o!==null&&Te(hl),null;case 24:return h=null,o!==null&&(h=o.memoizedState.cache),c.memoizedState.cache!==h&&(c.flags|=2048),co(vn),Xt(c),null;case 25:return null}throw Error(r(156,c.tag))}function q7(o,c){switch(Xy(c),c.tag){case 1:return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return co(vn),gt(),o=c.flags,o&65536&&!(o&128)?(c.flags=o&-65537|128,c):null;case 26:case 27:case 5:return Hn(c),null;case 13:if(so(c),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(r(340));td()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return Te(Sn),null;case 4:return gt(),null;case 10:return co(c.type),null;case 22:case 23:return so(c),Jy(),o!==null&&Te(hl),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 24:return co(vn),null;case 25:return null;default:return null}}function nP(o,c){switch(Xy(c),c.tag){case 3:co(vn),gt();break;case 26:case 27:case 5:Hn(c);break;case 4:gt();break;case 13:so(c);break;case 19:Te(Sn);break;case 10:co(c.type);break;case 22:case 23:so(c),Jy(),o!==null&&Te(hl);break;case 24:co(vn)}}var G7={getCacheForType:function(o){var c=Yn(vn),h=c.data.get(o);return h===void 0&&(h=o(),c.data.set(o,h)),h}},Y7=typeof WeakMap=="function"?WeakMap:Map,Wt=0,Dt=null,rt=null,dt=0,Rt=0,Yr=null,go=!1,Pc=!1,YS=!1,mo=0,nn=0,ua=0,xl=0,VS=0,xi=0,Tc=0,wd=null,bs=null,XS=!1,WS=0,Qf=1/0,Jf=null,da=null,ep=!1,wl=null,_d=0,ZS=0,QS=null,Cd=0,JS=null;function Vr(){if(Wt&2&&dt!==0)return dt&-dt;if(q.T!==null){var o=Sc;return o!==0?o:av()}return Jl()}function rP(){xi===0&&(xi=!(dt&536870912)||mt?Ql():536870912);var o=yi.current;return o!==null&&(o.flags|=32),xi}function lr(o,c,h){(o===Dt&&Rt===2||o.cancelPendingCommit!==null)&&(Ic(o,0),yo(o,dt,xi,!1)),Wa(o,h),(!(Wt&2)||o!==Dt)&&(o===Dt&&(!(Wt&2)&&(xl|=h),nn===4&&yo(o,dt,xi,!1)),xs(o))}function iP(o,c,h){if(Wt&6)throw Error(r(327));var y=!h&&(c&60)===0&&(c&o.expiredLanes)===0||Zs(o,c),v=y?W7(o,c):rv(o,c,!0),C=y;do{if(v===0){Pc&&!y&&yo(o,c,0,!1);break}else if(v===6)yo(o,c,0,!go);else{if(h=o.current.alternate,C&&!V7(h)){v=rv(o,c,!1),C=!1;continue}if(v===2){if(C=c,o.errorRecoveryDisabledLanes&C)var k=0;else k=o.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){c=k;e:{var N=o;v=wd;var $=N.current.memoizedState.isDehydrated;if($&&(Ic(N,k).flags|=256),k=rv(N,k,!1),k!==2){if(YS&&!$){N.errorRecoveryDisabledLanes|=C,xl|=C,v=4;break e}C=bs,bs=v,C!==null&&ev(C)}v=k}if(C=!1,v!==2)continue}}if(v===1){Ic(o,0),yo(o,c,0,!0);break}e:{switch(y=o,v){case 0:case 1:throw Error(r(345));case 4:if((c&4194176)===c){yo(y,c,xi,!go);break e}break;case 2:bs=null;break;case 3:case 5:break;default:throw Error(r(329))}if(y.finishedWork=h,y.finishedLanes=c,(c&62914560)===c&&(C=WS+300-br(),10<C)){if(yo(y,c,xi,!go),fs(y,0)!==0)break e;y.timeoutHandle=IP(sP.bind(null,y,h,bs,Jf,XS,c,xi,xl,Tc,go,2,-0,0),C);break e}sP(y,h,bs,Jf,XS,c,xi,xl,Tc,go,0,-0,0)}}break}while(!0);xs(o)}function ev(o){bs===null?bs=o:bs.push.apply(bs,o)}function sP(o,c,h,y,v,C,k,N,$,Q,ce,Se,se){var le=c.subtreeFlags;if((le&8192||(le&16785408)===16785408)&&(Ad={stylesheets:null,count:0,unsuspend:M9},X2(c),c=k9(),c!==null)){o.cancelPendingCommit=c(hP.bind(null,o,h,y,v,k,N,$,1,Se,se)),yo(o,C,k,!Q);return}hP(o,h,y,v,k,N,$,ce,Se,se)}function V7(o){for(var c=o;;){var h=c.tag;if((h===0||h===11||h===15)&&c.flags&16384&&(h=c.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var y=0;y<h.length;y++){var v=h[y],C=v.getSnapshot;v=v.value;try{if(!Kr(C(),v))return!1}catch{return!1}}if(h=c.child,c.subtreeFlags&16384&&h!==null)h.return=c,c=h;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function yo(o,c,h,y){c&=~VS,c&=~xl,o.suspendedLanes|=c,o.pingedLanes&=~c,y&&(o.warmLanes|=c),y=o.expirationTimes;for(var v=c;0<v;){var C=31-Yt(v),k=1<<C;y[C]=-1,v&=~k}h!==0&&ff(o,h,c)}function tp(){return Wt&6?!0:(Ed(0),!1)}function tv(){if(rt!==null){if(Rt===0)var o=rt.return;else o=rt,lo=yl=null,aS(o),mc=null,sd=0,o=rt;for(;o!==null;)nP(o.alternate,o),o=o.return;rt=null}}function Ic(o,c){o.finishedWork=null,o.finishedLanes=0;var h=o.timeoutHandle;h!==-1&&(o.timeoutHandle=-1,f9(h)),h=o.cancelPendingCommit,h!==null&&(o.cancelPendingCommit=null,h()),tv(),Dt=o,rt=h=ca(o.current,null),dt=c,Rt=0,Yr=null,go=!1,Pc=Zs(o,c),YS=!1,Tc=xi=VS=xl=ua=nn=0,bs=wd=null,XS=!1,c&8&&(c|=c&32);var y=o.entangledLanes;if(y!==0)for(o=o.entanglements,y&=c;0<y;){var v=31-Yt(y),C=1<<v;c|=o[v],y&=~C}return mo=c,Ef(),h}function oP(o,c){Qe=null,q.H=vs,c===rd?(c=xE(),Rt=3):c===SE?(c=xE(),Rt=4):Rt=c===v2?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Yr=c,rt===null&&(nn=1,qf(o,pi(c,o.current)))}function aP(){var o=q.H;return q.H=vs,o===null?vs:o}function lP(){var o=q.A;return q.A=G7,o}function nv(){nn=4,go||(dt&4194176)!==dt&&yi.current!==null||(Pc=!0),!(ua&134217727)&&!(xl&134217727)||Dt===null||yo(Dt,dt,xi,!1)}function rv(o,c,h){var y=Wt;Wt|=2;var v=aP(),C=lP();(Dt!==o||dt!==c)&&(Jf=null,Ic(o,c)),c=!1;var k=nn;e:do try{if(Rt!==0&&rt!==null){var N=rt,$=Yr;switch(Rt){case 8:tv(),k=6;break e;case 3:case 2:case 6:yi.current===null&&(c=!0);var Q=Rt;if(Rt=0,Yr=null,Mc(o,N,$,Q),h&&Pc){k=0;break e}break;default:Q=Rt,Rt=0,Yr=null,Mc(o,N,$,Q)}}X7(),k=nn;break}catch(ce){oP(o,ce)}while(!0);return c&&o.shellSuspendCounter++,lo=yl=null,Wt=y,q.H=v,q.A=C,rt===null&&(Dt=null,dt=0,Ef()),k}function X7(){for(;rt!==null;)cP(rt)}function W7(o,c){var h=Wt;Wt|=2;var y=aP(),v=lP();Dt!==o||dt!==c?(Jf=null,Qf=br()+500,Ic(o,c)):Pc=Zs(o,c);e:do try{if(Rt!==0&&rt!==null){c=rt;var C=Yr;t:switch(Rt){case 1:Rt=0,Yr=null,Mc(o,c,C,1);break;case 2:if(vE(C)){Rt=0,Yr=null,uP(c);break}c=function(){Rt===2&&Dt===o&&(Rt=7),xs(o)},C.then(c,c);break e;case 3:Rt=7;break e;case 4:Rt=5;break e;case 7:vE(C)?(Rt=0,Yr=null,uP(c)):(Rt=0,Yr=null,Mc(o,c,C,7));break;case 5:var k=null;switch(rt.tag){case 26:k=rt.memoizedState;case 5:case 27:var N=rt;if(!k||FP(k)){Rt=0,Yr=null;var $=N.sibling;if($!==null)rt=$;else{var Q=N.return;Q!==null?(rt=Q,np(Q)):rt=null}break t}}Rt=0,Yr=null,Mc(o,c,C,5);break;case 6:Rt=0,Yr=null,Mc(o,c,C,6);break;case 8:tv(),nn=6;break e;default:throw Error(r(462))}}Z7();break}catch(ce){oP(o,ce)}while(!0);return lo=yl=null,q.H=y,q.A=v,Wt=h,rt!==null?0:(Dt=null,dt=0,Ef(),nn)}function Z7(){for(;rt!==null&&!Ou();)cP(rt)}function cP(o){var c=k2(o.alternate,o,mo);o.memoizedProps=o.pendingProps,c===null?np(o):rt=c}function uP(o){var c=o,h=c.alternate;switch(c.tag){case 15:case 0:c=E2(h,c,c.pendingProps,c.type,void 0,dt);break;case 11:c=E2(h,c,c.pendingProps,c.type.render,c.ref,dt);break;case 5:aS(c);default:nP(h,c),c=rt=J2(c,mo),c=k2(h,c,mo)}o.memoizedProps=o.pendingProps,c===null?np(o):rt=c}function Mc(o,c,h,y){lo=yl=null,aS(c),mc=null,sd=0;var v=c.return;try{if(F7(o,v,c,h,dt)){nn=1,qf(o,pi(h,o.current)),rt=null;return}}catch(C){if(v!==null)throw rt=v,C;nn=1,qf(o,pi(h,o.current)),rt=null;return}c.flags&32768?(mt||y===1?o=!0:Pc||dt&536870912?o=!1:(go=o=!0,(y===2||y===3||y===6)&&(y=yi.current,y!==null&&y.tag===13&&(y.flags|=16384))),dP(c,o)):np(c)}function np(o){var c=o;do{if(c.flags&32768){dP(c,go);return}o=c.return;var h=K7(c.alternate,c,mo);if(h!==null){rt=h;return}if(c=c.sibling,c!==null){rt=c;return}rt=c=o}while(c!==null);nn===0&&(nn=5)}function dP(o,c){do{var h=q7(o.alternate,o);if(h!==null){h.flags&=32767,rt=h;return}if(h=o.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!c&&(o=o.sibling,o!==null)){rt=o;return}rt=o=h}while(o!==null);nn=6,rt=null}function hP(o,c,h,y,v,C,k,N,$,Q){var ce=q.T,Se=ye.p;try{ye.p=2,q.T=null,Q7(o,c,h,y,Se,v,C,k,N,$,Q)}finally{q.T=ce,ye.p=Se}}function Q7(o,c,h,y,v,C,k,N){do Ac();while(wl!==null);if(Wt&6)throw Error(r(327));var $=o.finishedWork;if(y=o.finishedLanes,$===null)return null;if(o.finishedWork=null,o.finishedLanes=0,$===o.current)throw Error(r(177));o.callbackNode=null,o.callbackPriority=0,o.cancelPendingCommit=null;var Q=$.lanes|$.childLanes;if(Q|=Gy,ky(o,y,Q,C,k,N),o===Dt&&(rt=Dt=null,dt=0),!($.subtreeFlags&10256)&&!($.flags&10256)||ep||(ep=!0,ZS=Q,QS=h,n9(Ni,function(){return Ac(),null})),h=($.flags&15990)!==0,$.subtreeFlags&15990||h?(h=q.T,q.T=null,C=ye.p,ye.p=2,k=Wt,Wt|=4,U7(o,$),G2($,o),w7(gv,o.containerInfo),pp=!!pv,gv=pv=null,o.current=$,$2(o,$.alternate,$),Du(),Wt=k,ye.p=C,q.T=h):o.current=$,ep?(ep=!1,wl=o,_d=y):fP(o,Q),Q=o.pendingLanes,Q===0&&(da=null),xr($.stateNode),xs(o),c!==null)for(v=o.onRecoverableError,$=0;$<c.length;$++)Q=c[$],v(Q.value,{componentStack:Q.stack});return _d&3&&Ac(),Q=o.pendingLanes,y&4194218&&Q&42?o===JS?Cd++:(Cd=0,JS=o):Cd=0,Ed(0),null}function fP(o,c){(o.pooledCacheLanes&=c)===0&&(c=o.pooledCache,c!=null&&(o.pooledCache=null,ad(c)))}function Ac(){if(wl!==null){var o=wl,c=ZS;ZS=0;var h=zu(_d),y=q.T,v=ye.p;try{if(ye.p=32>h?32:h,q.T=null,wl===null)var C=!1;else{h=QS,QS=null;var k=wl,N=_d;if(wl=null,_d=0,Wt&6)throw Error(r(331));var $=Wt;if(Wt|=4,Z2(k.current),V2(k,k.current,N,h),Wt=$,Ed(0,!1),Gt&&typeof Gt.onPostCommitFiberRoot=="function")try{Gt.onPostCommitFiberRoot(bt,k)}catch{}C=!0}return C}finally{ye.p=v,q.T=y,fP(o,c)}}return!1}function pP(o,c,h){c=pi(h,c),c=xS(o.stateNode,c,2),o=sa(o,c,2),o!==null&&(Wa(o,2),xs(o))}function At(o,c,h){if(o.tag===3)pP(o,o,h);else for(;c!==null;){if(c.tag===3){pP(c,o,h);break}else if(c.tag===1){var y=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(da===null||!da.has(y))){o=pi(h,o),h=y2(2),y=sa(c,h,2),y!==null&&(S2(h,y,c,o),Wa(y,2),xs(y));break}}c=c.return}}function iv(o,c,h){var y=o.pingCache;if(y===null){y=o.pingCache=new Y7;var v=new Set;y.set(c,v)}else v=y.get(c),v===void 0&&(v=new Set,y.set(c,v));v.has(h)||(YS=!0,v.add(h),o=J7.bind(null,o,c,h),c.then(o,o))}function J7(o,c,h){var y=o.pingCache;y!==null&&y.delete(c),o.pingedLanes|=o.suspendedLanes&h,o.warmLanes&=~h,Dt===o&&(dt&h)===h&&(nn===4||nn===3&&(dt&62914560)===dt&&300>br()-WS?!(Wt&2)&&Ic(o,0):VS|=h,Tc===dt&&(Tc=0)),xs(o)}function gP(o,c){c===0&&(c=Ko()),o=Zo(o,c),o!==null&&(Wa(o,c),xs(o))}function e9(o){var c=o.memoizedState,h=0;c!==null&&(h=c.retryLane),gP(o,h)}function t9(o,c){var h=0;switch(o.tag){case 13:var y=o.stateNode,v=o.memoizedState;v!==null&&(h=v.retryLane);break;case 19:y=o.stateNode;break;case 22:y=o.stateNode._retryCache;break;default:throw Error(r(314))}y!==null&&y.delete(c),gP(o,h)}function n9(o,c){return ci(o,c)}var rp=null,kc=null,sv=!1,ip=!1,ov=!1,_l=0;function xs(o){o!==kc&&o.next===null&&(kc===null?rp=kc=o:kc=kc.next=o),ip=!0,sv||(sv=!0,i9(r9))}function Ed(o,c){if(!ov&&ip){ov=!0;do for(var h=!1,y=rp;y!==null;){if(o!==0){var v=y.pendingLanes;if(v===0)var C=0;else{var k=y.suspendedLanes,N=y.pingedLanes;C=(1<<31-Yt(42|o)+1)-1,C&=v&~(k&~N),C=C&201326677?C&201326677|1:C?C|2:0}C!==0&&(h=!0,SP(y,C))}else C=dt,C=fs(y,y===Dt?C:0),!(C&3)||Zs(y,C)||(h=!0,SP(y,C));y=y.next}while(h);ov=!1}}function r9(){ip=sv=!1;var o=0;_l!==0&&(h9()&&(o=_l),_l=0);for(var c=br(),h=null,y=rp;y!==null;){var v=y.next,C=mP(y,c);C===0?(y.next=null,h===null?rp=v:h.next=v,v===null&&(kc=h)):(h=y,(o!==0||C&3)&&(ip=!0)),y=v}Ed(o)}function mP(o,c){for(var h=o.suspendedLanes,y=o.pingedLanes,v=o.expirationTimes,C=o.pendingLanes&-62914561;0<C;){var k=31-Yt(C),N=1<<k,$=v[k];$===-1?(!(N&h)||N&y)&&(v[k]=Lu(N,c)):$<=c&&(o.expiredLanes|=N),C&=~N}if(c=Dt,h=dt,h=fs(o,o===c?h:0),y=o.callbackNode,h===0||o===c&&Rt===2||o.cancelPendingCommit!==null)return y!==null&&y!==null&&Vs(y),o.callbackNode=null,o.callbackPriority=0;if(!(h&3)||Zs(o,h)){if(c=h&-h,c===o.callbackPriority)return c;switch(y!==null&&Vs(y),zu(h)){case 2:case 8:h=Xs;break;case 32:h=Ni;break;case 268435456:h=ae;break;default:h=Ni}return y=yP.bind(null,o),h=ci(h,y),o.callbackPriority=c,o.callbackNode=h,c}return y!==null&&y!==null&&Vs(y),o.callbackPriority=2,o.callbackNode=null,2}function yP(o,c){var h=o.callbackNode;if(Ac()&&o.callbackNode!==h)return null;var y=dt;return y=fs(o,o===Dt?y:0),y===0?null:(iP(o,y,c),mP(o,br()),o.callbackNode!=null&&o.callbackNode===h?yP.bind(null,o):null)}function SP(o,c){if(Ac())return null;iP(o,c,!0)}function i9(o){p9(function(){Wt&6?ci(Wl,o):o()})}function av(){return _l===0&&(_l=Ql()),_l}function vP(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:rc(""+o)}function bP(o,c){var h=c.ownerDocument.createElement("input");return h.name=c.name,h.value=c.value,o.id&&h.setAttribute("form",o.id),c.parentNode.insertBefore(h,c),o=new FormData(o),h.parentNode.removeChild(h),o}function s9(o,c,h,y,v){if(c==="submit"&&h&&h.stateNode===v){var C=vP((v[Kn]||null).action),k=y.submitter;k&&(c=(c=k[Kn]||null)?vP(c.formAction):k.getAttribute("formAction"),c!==null&&(C=c,k=null));var N=new Pe("action","action",null,y,v);o.push({event:N,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(_l!==0){var $=k?bP(v,k):new FormData(v);mS(h,{pending:!0,data:$,method:v.method,action:C},null,$)}}else typeof C=="function"&&(N.preventDefault(),$=k?bP(v,k):new FormData(v),mS(h,{pending:!0,data:$,method:v.method,action:C},C,$))},currentTarget:v}]})}}for(var lv=0;lv<hE.length;lv++){var cv=hE[lv],o9=cv.toLowerCase(),a9=cv[0].toUpperCase()+cv.slice(1);Vi(o9,"on"+a9)}Vi(aE,"onAnimationEnd"),Vi(lE,"onAnimationIteration"),Vi(cE,"onAnimationStart"),Vi("dblclick","onDoubleClick"),Vi("focusin","onFocus"),Vi("focusout","onBlur"),Vi(C7,"onTransitionRun"),Vi(E7,"onTransitionStart"),Vi(P7,"onTransitionCancel"),Vi(uE,"onTransitionEnd"),Yo("onMouseEnter",["mouseout","mouseover"]),Yo("onMouseLeave",["mouseout","mouseover"]),Yo("onPointerEnter",["pointerout","pointerover"]),Yo("onPointerLeave",["pointerout","pointerover"]),hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),hi("onBeforeInput",["compositionend","keypress","textInput","paste"]),hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l9=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pd));function xP(o,c){c=(c&4)!==0;for(var h=0;h<o.length;h++){var y=o[h],v=y.event;y=y.listeners;e:{var C=void 0;if(c)for(var k=y.length-1;0<=k;k--){var N=y[k],$=N.instance,Q=N.currentTarget;if(N=N.listener,$!==C&&v.isPropagationStopped())break e;C=N,v.currentTarget=Q;try{C(v)}catch(ce){Kf(ce)}v.currentTarget=null,C=$}else for(k=0;k<y.length;k++){if(N=y[k],$=N.instance,Q=N.currentTarget,N=N.listener,$!==C&&v.isPropagationStopped())break e;C=N,v.currentTarget=Q;try{C(v)}catch(ce){Kf(ce)}v.currentTarget=null,C=$}}}}function lt(o,c){var h=c[Fu];h===void 0&&(h=c[Fu]=new Set);var y=o+"__bubble";h.has(y)||(wP(c,o,2,!1),h.add(y))}function uv(o,c,h){var y=0;c&&(y|=4),wP(h,o,y,c)}var sp="_reactListening"+Math.random().toString(36).slice(2);function dv(o){if(!o[sp]){o[sp]=!0,mf.forEach(function(h){h!=="selectionchange"&&(l9.has(h)||uv(h,!1,o),uv(h,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[sp]||(c[sp]=!0,uv("selectionchange",!1,c))}}function wP(o,c,h,y){switch(qP(c)){case 2:var v=D9;break;case 8:v=R9;break;default:v=Cv}h=v.bind(null,c,h,o),v=void 0,!sc||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),y?v!==void 0?o.addEventListener(c,h,{capture:!0,passive:v}):o.addEventListener(c,h,!0):v!==void 0?o.addEventListener(c,h,{passive:v}):o.addEventListener(c,h,!1)}function hv(o,c,h,y,v){var C=y;if(!(c&1)&&!(c&2)&&y!==null)e:for(;;){if(y===null)return;var k=y.tag;if(k===3||k===4){var N=y.stateNode.containerInfo;if(N===v||N.nodeType===8&&N.parentNode===v)break;if(k===4)for(k=y.return;k!==null;){var $=k.tag;if(($===3||$===4)&&($=k.stateNode.containerInfo,$===v||$.nodeType===8&&$.parentNode===v))return;k=k.return}for(;N!==null;){if(k=Js(N),k===null)return;if($=k.tag,$===5||$===6||$===26||$===27){y=C=k;continue e}N=N.parentNode}}y=y.return}ic(function(){var Q=C,ce=qi(h),Se=[];e:{var se=dE.get(o);if(se!==void 0){var le=Pe,De=o;switch(o){case"keypress":if(oc(h)===0)break e;case"keydown":case"keyup":le=t7;break;case"focusin":De="focus",le=Gn;break;case"focusout":De="blur",le=Gn;break;case"beforeblur":case"afterblur":le=Gn;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":le=qn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":le=wn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":le=i7;break;case aE:case lE:case cE:le=Yi;break;case uE:le=o7;break;case"scroll":case"scrollend":le=Ve;break;case"wheel":le=l7;break;case"copy":case"cut":case"paste":le=_f;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":le=$C;break;case"toggle":case"beforetoggle":le=u7}var Ge=(c&4)!==0,rn=!Ge&&(o==="scroll"||o==="scrollend"),J=Ge?se!==null?se+"Capture":null:se;Ge=[];for(var Z=Q,ne;Z!==null;){var pe=Z;if(ne=pe.stateNode,pe=pe.tag,pe!==5&&pe!==26&&pe!==27||ne===null||J===null||(pe=rl(Z,J),pe!=null&&Ge.push(Td(Z,pe,ne))),rn)break;Z=Z.return}0<Ge.length&&(se=new le(se,De,null,h,ce),Se.push({event:se,listeners:Ge}))}}if(!(c&7)){e:{if(se=o==="mouseover"||o==="pointerover",le=o==="mouseout"||o==="pointerout",se&&h!==Yu&&(De=h.relatedTarget||h.fromElement)&&(Js(De)||De[qo]))break e;if((le||se)&&(se=ce.window===ce?ce:(se=ce.ownerDocument)?se.defaultView||se.parentWindow:window,le?(De=h.relatedTarget||h.toElement,le=Q,De=De?Js(De):null,De!==null&&(rn=V(De),Ge=De.tag,De!==rn||Ge!==5&&Ge!==27&&Ge!==6)&&(De=null)):(le=null,De=Q),le!==De)){if(Ge=qn,pe="onMouseLeave",J="onMouseEnter",Z="mouse",(o==="pointerout"||o==="pointerover")&&(Ge=$C,pe="onPointerLeave",J="onPointerEnter",Z="pointer"),rn=le==null?se:Qa(le),ne=De==null?se:Qa(De),se=new Ge(pe,Z+"leave",le,h,ce),se.target=rn,se.relatedTarget=ne,pe=null,Js(ce)===Q&&(Ge=new Ge(J,Z+"enter",De,h,ce),Ge.target=ne,Ge.relatedTarget=rn,pe=Ge),rn=pe,le&&De)t:{for(Ge=le,J=De,Z=0,ne=Ge;ne;ne=jc(ne))Z++;for(ne=0,pe=J;pe;pe=jc(pe))ne++;for(;0<Z-ne;)Ge=jc(Ge),Z--;for(;0<ne-Z;)J=jc(J),ne--;for(;Z--;){if(Ge===J||J!==null&&Ge===J.alternate)break t;Ge=jc(Ge),J=jc(J)}Ge=null}else Ge=null;le!==null&&_P(Se,se,le,Ge,!1),De!==null&&rn!==null&&_P(Se,rn,De,Ge,!0)}}e:{if(se=Q?Qa(Q):window,le=se.nodeName&&se.nodeName.toLowerCase(),le==="select"||le==="input"&&se.type==="file")var ke=WC;else if(VC(se))if(ZC)ke=b7;else{ke=S7;var Je=y7}else le=se.nodeName,!le||le.toLowerCase()!=="input"||se.type!=="checkbox"&&se.type!=="radio"?Q&&Gu(Q.elementType)&&(ke=WC):ke=v7;if(ke&&(ke=ke(o,Q))){XC(Se,ke,h,ce);break e}Je&&Je(o,se,Q),o==="focusout"&&Q&&se.type==="number"&&Q.memoizedProps.value!=null&&Ku(se,"number",se.value)}switch(Je=Q?Qa(Q):window,o){case"focusin":(VC(Je)||Je.contentEditable==="true")&&(uc=Je,Hy=Q,Ju=null);break;case"focusout":Ju=Hy=uc=null;break;case"mousedown":Ky=!0;break;case"contextmenu":case"mouseup":case"dragend":Ky=!1,sE(Se,h,ce);break;case"selectionchange":if(_7)break;case"keydown":case"keyup":sE(Se,h,ce)}var Re;if(Fy)e:{switch(o){case"compositionstart":var $e="onCompositionStart";break e;case"compositionend":$e="onCompositionEnd";break e;case"compositionupdate":$e="onCompositionUpdate";break e}$e=void 0}else cc?GC(o,h)&&($e="onCompositionEnd"):o==="keydown"&&h.keyCode===229&&($e="onCompositionStart");$e&&(HC&&h.locale!=="ko"&&(cc||$e!=="onCompositionStart"?$e==="onCompositionEnd"&&cc&&(Re=wf()):(Gi=ce,to="value"in Gi?Gi.value:Gi.textContent,cc=!0)),Je=op(Q,$e),0<Je.length&&($e=new sl($e,o,null,h,ce),Se.push({event:$e,listeners:Je}),Re?$e.data=Re:(Re=YC(h),Re!==null&&($e.data=Re)))),(Re=h7?f7(o,h):p7(o,h))&&($e=op(Q,"onBeforeInput"),0<$e.length&&(Je=new sl("onBeforeInput","beforeinput",null,h,ce),Se.push({event:Je,listeners:$e}),Je.data=Re)),s9(Se,o,Q,h,ce)}xP(Se,c)})}function Td(o,c,h){return{instance:o,listener:c,currentTarget:h}}function op(o,c){for(var h=c+"Capture",y=[];o!==null;){var v=o,C=v.stateNode;v=v.tag,v!==5&&v!==26&&v!==27||C===null||(v=rl(o,h),v!=null&&y.unshift(Td(o,v,C)),v=rl(o,c),v!=null&&y.push(Td(o,v,C))),o=o.return}return y}function jc(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function _P(o,c,h,y,v){for(var C=c._reactName,k=[];h!==null&&h!==y;){var N=h,$=N.alternate,Q=N.stateNode;if(N=N.tag,$!==null&&$===y)break;N!==5&&N!==26&&N!==27||Q===null||($=Q,v?(Q=rl(h,C),Q!=null&&k.unshift(Td(h,Q,$))):v||(Q=rl(h,C),Q!=null&&k.push(Td(h,Q,$)))),h=h.return}k.length!==0&&o.push({event:c,listeners:k})}var c9=/\r\n?/g,u9=/\u0000|\uFFFD/g;function CP(o){return(typeof o=="string"?o:""+o).replace(c9,`
`).replace(u9,"")}function EP(o,c){return c=CP(c),CP(o)===c}function ap(){}function Tt(o,c,h,y,v,C){switch(h){case"children":typeof y=="string"?c==="body"||c==="textarea"&&y===""||$r(o,y):(typeof y=="number"||typeof y=="bigint")&&c!=="body"&&$r(o,""+y);break;case"className":tc(o,"class",y);break;case"tabIndex":tc(o,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":tc(o,h,y);break;case"style":Ki(o,y,C);break;case"data":if(c!=="object"){tc(o,"data",y);break}case"src":case"href":if(y===""&&(c!=="a"||h!=="href")){o.removeAttribute(h);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){o.removeAttribute(h);break}y=rc(""+y),o.setAttribute(h,y);break;case"action":case"formAction":if(typeof y=="function"){o.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(h==="formAction"?(c!=="input"&&Tt(o,c,"name",v.name,v,null),Tt(o,c,"formEncType",v.formEncType,v,null),Tt(o,c,"formMethod",v.formMethod,v,null),Tt(o,c,"formTarget",v.formTarget,v,null)):(Tt(o,c,"encType",v.encType,v,null),Tt(o,c,"method",v.method,v,null),Tt(o,c,"target",v.target,v,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){o.removeAttribute(h);break}y=rc(""+y),o.setAttribute(h,y);break;case"onClick":y!=null&&(o.onclick=ap);break;case"onScroll":y!=null&&lt("scroll",o);break;case"onScrollEnd":y!=null&&lt("scrollend",o);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(h=y.__html,h!=null){if(v.children!=null)throw Error(r(60));o.innerHTML=h}}break;case"multiple":o.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":o.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){o.removeAttribute("xlink:href");break}h=rc(""+y),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(h,""+y):o.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(h,""):o.removeAttribute(h);break;case"capture":case"download":y===!0?o.setAttribute(h,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(h,y):o.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?o.setAttribute(h,y):o.removeAttribute(h);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?o.removeAttribute(h):o.setAttribute(h,y);break;case"popover":lt("beforetoggle",o),lt("toggle",o),ec(o,"popover",y);break;case"xlinkActuate":Hi(o,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":Hi(o,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":Hi(o,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":Hi(o,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":Hi(o,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":Hi(o,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":Hi(o,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":Hi(o,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":Hi(o,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":ec(o,"is",y);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=Ly.get(h)||h,ec(o,h,y))}}function fv(o,c,h,y,v,C){switch(h){case"style":Ki(o,y,C);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(h=y.__html,h!=null){if(v.children!=null)throw Error(r(60));o.innerHTML=h}}break;case"children":typeof y=="string"?$r(o,y):(typeof y=="number"||typeof y=="bigint")&&$r(o,""+y);break;case"onScroll":y!=null&&lt("scroll",o);break;case"onScrollEnd":y!=null&&lt("scrollend",o);break;case"onClick":y!=null&&(o.onclick=ap);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!yf.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(v=h.endsWith("Capture"),c=h.slice(2,v?h.length-7:void 0),C=o[Kn]||null,C=C!=null?C[h]:null,typeof C=="function"&&o.removeEventListener(c,C,v),typeof y=="function")){typeof C!="function"&&C!==null&&(h in o?o[h]=null:o.hasAttribute(h)&&o.removeAttribute(h)),o.addEventListener(c,y,v);break e}h in o?o[h]=y:y===!0?o.setAttribute(h,""):ec(o,h,y)}}}function jn(o,c,h){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lt("error",o),lt("load",o);var y=!1,v=!1,C;for(C in h)if(h.hasOwnProperty(C)){var k=h[C];if(k!=null)switch(C){case"src":y=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:Tt(o,c,C,k,h,null)}}v&&Tt(o,c,"srcSet",h.srcSet,h,null),y&&Tt(o,c,"src",h.src,h,null);return;case"input":lt("invalid",o);var N=C=k=v=null,$=null,Q=null;for(y in h)if(h.hasOwnProperty(y)){var ce=h[y];if(ce!=null)switch(y){case"name":v=ce;break;case"type":k=ce;break;case"checked":$=ce;break;case"defaultChecked":Q=ce;break;case"value":C=ce;break;case"defaultValue":N=ce;break;case"children":case"dangerouslySetInnerHTML":if(ce!=null)throw Error(r(137,c));break;default:Tt(o,c,y,ce,h,null)}}Hu(o,C,N,$,Q,k,v,!1),el(o);return;case"select":lt("invalid",o),y=k=C=null;for(v in h)if(h.hasOwnProperty(v)&&(N=h[v],N!=null))switch(v){case"value":C=N;break;case"defaultValue":k=N;break;case"multiple":y=N;default:Tt(o,c,v,N,h,null)}c=C,h=k,o.multiple=!!y,c!=null?Vo(o,!!y,c,!1):h!=null&&Vo(o,!!y,h,!0);return;case"textarea":lt("invalid",o),C=v=y=null;for(k in h)if(h.hasOwnProperty(k)&&(N=h[k],N!=null))switch(k){case"value":y=N;break;case"defaultValue":v=N;break;case"children":C=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(r(91));break;default:Tt(o,c,k,N,h,null)}tl(o,y,v,C),el(o);return;case"option":for($ in h)if(h.hasOwnProperty($)&&(y=h[$],y!=null))switch($){case"selected":o.selected=y&&typeof y!="function"&&typeof y!="symbol";break;default:Tt(o,c,$,y,h,null)}return;case"dialog":lt("cancel",o),lt("close",o);break;case"iframe":case"object":lt("load",o);break;case"video":case"audio":for(y=0;y<Pd.length;y++)lt(Pd[y],o);break;case"image":lt("error",o),lt("load",o);break;case"details":lt("toggle",o);break;case"embed":case"source":case"link":lt("error",o),lt("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in h)if(h.hasOwnProperty(Q)&&(y=h[Q],y!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:Tt(o,c,Q,y,h,null)}return;default:if(Gu(c)){for(ce in h)h.hasOwnProperty(ce)&&(y=h[ce],y!==void 0&&fv(o,c,ce,y,h,void 0));return}}for(N in h)h.hasOwnProperty(N)&&(y=h[N],y!=null&&Tt(o,c,N,y,h,null))}function d9(o,c,h,y){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,C=null,k=null,N=null,$=null,Q=null,ce=null;for(le in h){var Se=h[le];if(h.hasOwnProperty(le)&&Se!=null)switch(le){case"checked":break;case"value":break;case"defaultValue":$=Se;default:y.hasOwnProperty(le)||Tt(o,c,le,null,y,Se)}}for(var se in y){var le=y[se];if(Se=h[se],y.hasOwnProperty(se)&&(le!=null||Se!=null))switch(se){case"type":C=le;break;case"name":v=le;break;case"checked":Q=le;break;case"defaultChecked":ce=le;break;case"value":k=le;break;case"defaultValue":N=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(r(137,c));break;default:le!==Se&&Tt(o,c,se,le,y,Se)}}$u(o,k,N,$,Q,ce,C,v);return;case"select":le=k=N=se=null;for(C in h)if($=h[C],h.hasOwnProperty(C)&&$!=null)switch(C){case"value":break;case"multiple":le=$;default:y.hasOwnProperty(C)||Tt(o,c,C,null,y,$)}for(v in y)if(C=y[v],$=h[v],y.hasOwnProperty(v)&&(C!=null||$!=null))switch(v){case"value":se=C;break;case"defaultValue":N=C;break;case"multiple":k=C;default:C!==$&&Tt(o,c,v,C,y,$)}c=N,h=k,y=le,se!=null?Vo(o,!!h,se,!1):!!y!=!!h&&(c!=null?Vo(o,!!h,c,!0):Vo(o,!!h,h?[]:"",!1));return;case"textarea":le=se=null;for(N in h)if(v=h[N],h.hasOwnProperty(N)&&v!=null&&!y.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Tt(o,c,N,null,y,v)}for(k in y)if(v=y[k],C=h[k],y.hasOwnProperty(k)&&(v!=null||C!=null))switch(k){case"value":se=v;break;case"defaultValue":le=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==C&&Tt(o,c,k,v,y,C)}qu(o,se,le);return;case"option":for(var De in h)if(se=h[De],h.hasOwnProperty(De)&&se!=null&&!y.hasOwnProperty(De))switch(De){case"selected":o.selected=!1;break;default:Tt(o,c,De,null,y,se)}for($ in y)if(se=y[$],le=h[$],y.hasOwnProperty($)&&se!==le&&(se!=null||le!=null))switch($){case"selected":o.selected=se&&typeof se!="function"&&typeof se!="symbol";break;default:Tt(o,c,$,se,y,le)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in h)se=h[Ge],h.hasOwnProperty(Ge)&&se!=null&&!y.hasOwnProperty(Ge)&&Tt(o,c,Ge,null,y,se);for(Q in y)if(se=y[Q],le=h[Q],y.hasOwnProperty(Q)&&se!==le&&(se!=null||le!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(r(137,c));break;default:Tt(o,c,Q,se,y,le)}return;default:if(Gu(c)){for(var rn in h)se=h[rn],h.hasOwnProperty(rn)&&se!==void 0&&!y.hasOwnProperty(rn)&&fv(o,c,rn,void 0,y,se);for(ce in y)se=y[ce],le=h[ce],!y.hasOwnProperty(ce)||se===le||se===void 0&&le===void 0||fv(o,c,ce,se,y,le);return}}for(var J in h)se=h[J],h.hasOwnProperty(J)&&se!=null&&!y.hasOwnProperty(J)&&Tt(o,c,J,null,y,se);for(Se in y)se=y[Se],le=h[Se],!y.hasOwnProperty(Se)||se===le||se==null&&le==null||Tt(o,c,Se,se,y,le)}var pv=null,gv=null;function lp(o){return o.nodeType===9?o:o.ownerDocument}function PP(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function TP(o,c){if(o===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&c==="foreignObject"?0:o}function mv(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var yv=null;function h9(){var o=window.event;return o&&o.type==="popstate"?o===yv?!1:(yv=o,!0):(yv=null,!1)}var IP=typeof setTimeout=="function"?setTimeout:void 0,f9=typeof clearTimeout=="function"?clearTimeout:void 0,MP=typeof Promise=="function"?Promise:void 0,p9=typeof queueMicrotask=="function"?queueMicrotask:typeof MP<"u"?function(o){return MP.resolve(null).then(o).catch(g9)}:IP;function g9(o){setTimeout(function(){throw o})}function Sv(o,c){var h=c,y=0;do{var v=h.nextSibling;if(o.removeChild(h),v&&v.nodeType===8)if(h=v.data,h==="/$"){if(y===0){o.removeChild(v),Rd(c);return}y--}else h!=="$"&&h!=="$?"&&h!=="$!"||y++;h=v}while(h);Rd(c)}function vv(o){var c=o.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var h=c;switch(c=c.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":vv(h),Bu(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}o.removeChild(h)}}function m9(o,c,h,y){for(;o.nodeType===1;){var v=h;if(o.nodeName.toLowerCase()!==c.toLowerCase()){if(!y&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(y){if(!o[Za])switch(c){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(C=o.getAttribute("rel"),C==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(C!==v.rel||o.getAttribute("href")!==(v.href==null?null:v.href)||o.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||o.getAttribute("title")!==(v.title==null?null:v.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(C=o.getAttribute("src"),(C!==(v.src==null?null:v.src)||o.getAttribute("type")!==(v.type==null?null:v.type)||o.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&C&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(c==="input"&&o.type==="hidden"){var C=v.name==null?null:""+v.name;if(v.type==="hidden"&&o.getAttribute("name")===C)return o}else return o;if(o=Zi(o.nextSibling),o===null)break}return null}function y9(o,c,h){if(c==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!h||(o=Zi(o.nextSibling),o===null))return null;return o}function Zi(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return o}function AP(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var h=o.data;if(h==="$"||h==="$!"||h==="$?"){if(c===0)return o;c--}else h==="/$"&&c++}o=o.previousSibling}return null}function kP(o,c,h){switch(c=lp(h),o){case"html":if(o=c.documentElement,!o)throw Error(r(452));return o;case"head":if(o=c.head,!o)throw Error(r(453));return o;case"body":if(o=c.body,!o)throw Error(r(454));return o;default:throw Error(r(451))}}var wi=new Map,jP=new Set;function cp(o){return typeof o.getRootNode=="function"?o.getRootNode():o.ownerDocument}var So=ye.d;ye.d={f:S9,r:v9,D:b9,C:x9,L:w9,m:_9,X:E9,S:C9,M:P9};function S9(){var o=So.f(),c=tp();return o||c}function v9(o){var c=_r(o);c!==null&&c.tag===5&&c.type==="form"?s2(c):So.r(o)}var Oc=typeof document>"u"?null:document;function OP(o,c,h){var y=Oc;if(y&&typeof c=="string"&&c){var v=Cr(c);v='link[rel="'+o+'"][href="'+v+'"]',typeof h=="string"&&(v+='[crossorigin="'+h+'"]'),jP.has(v)||(jP.add(v),o={rel:o,crossOrigin:h,href:c},y.querySelector(v)===null&&(c=y.createElement("link"),jn(c,"link",o),hn(c),y.head.appendChild(c)))}}function b9(o){So.D(o),OP("dns-prefetch",o,null)}function x9(o,c){So.C(o,c),OP("preconnect",o,c)}function w9(o,c,h){So.L(o,c,h);var y=Oc;if(y&&o&&c){var v='link[rel="preload"][as="'+Cr(c)+'"]';c==="image"&&h&&h.imageSrcSet?(v+='[imagesrcset="'+Cr(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(v+='[imagesizes="'+Cr(h.imageSizes)+'"]')):v+='[href="'+Cr(o)+'"]';var C=v;switch(c){case"style":C=Dc(o);break;case"script":C=Rc(o)}wi.has(C)||(o=L({rel:"preload",href:c==="image"&&h&&h.imageSrcSet?void 0:o,as:c},h),wi.set(C,o),y.querySelector(v)!==null||c==="style"&&y.querySelector(Id(C))||c==="script"&&y.querySelector(Md(C))||(c=y.createElement("link"),jn(c,"link",o),hn(c),y.head.appendChild(c)))}}function _9(o,c){So.m(o,c);var h=Oc;if(h&&o){var y=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+Cr(y)+'"][href="'+Cr(o)+'"]',C=v;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Rc(o)}if(!wi.has(C)&&(o=L({rel:"modulepreload",href:o},c),wi.set(C,o),h.querySelector(v)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(Md(C)))return}y=h.createElement("link"),jn(y,"link",o),hn(y),h.head.appendChild(y)}}}function C9(o,c,h){So.S(o,c,h);var y=Oc;if(y&&o){var v=Go(y).hoistableStyles,C=Dc(o);c=c||"default";var k=v.get(C);if(!k){var N={loading:0,preload:null};if(k=y.querySelector(Id(C)))N.loading=5;else{o=L({rel:"stylesheet",href:o,"data-precedence":c},h),(h=wi.get(C))&&bv(o,h);var $=k=y.createElement("link");hn($),jn($,"link",o),$._p=new Promise(function(Q,ce){$.onload=Q,$.onerror=ce}),$.addEventListener("load",function(){N.loading|=1}),$.addEventListener("error",function(){N.loading|=2}),N.loading|=4,up(k,c,y)}k={type:"stylesheet",instance:k,count:1,state:N},v.set(C,k)}}}function E9(o,c){So.X(o,c);var h=Oc;if(h&&o){var y=Go(h).hoistableScripts,v=Rc(o),C=y.get(v);C||(C=h.querySelector(Md(v)),C||(o=L({src:o,async:!0},c),(c=wi.get(v))&&xv(o,c),C=h.createElement("script"),hn(C),jn(C,"link",o),h.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},y.set(v,C))}}function P9(o,c){So.M(o,c);var h=Oc;if(h&&o){var y=Go(h).hoistableScripts,v=Rc(o),C=y.get(v);C||(C=h.querySelector(Md(v)),C||(o=L({src:o,async:!0,type:"module"},c),(c=wi.get(v))&&xv(o,c),C=h.createElement("script"),hn(C),jn(C,"link",o),h.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},y.set(v,C))}}function DP(o,c,h,y){var v=(v=at.current)?cp(v):null;if(!v)throw Error(r(446));switch(o){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(c=Dc(h.href),h=Go(v).hoistableStyles,y=h.get(c),y||(y={type:"style",instance:null,count:0,state:null},h.set(c,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){o=Dc(h.href);var C=Go(v).hoistableStyles,k=C.get(o);if(k||(v=v.ownerDocument||v,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(o,k),(C=v.querySelector(Id(o)))&&!C._p&&(k.instance=C,k.state.loading=5),wi.has(o)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},wi.set(o,h),C||T9(v,o,h,k.state))),c&&y===null)throw Error(r(528,""));return k}if(c&&y!==null)throw Error(r(529,""));return null;case"script":return c=h.async,h=h.src,typeof h=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Rc(h),h=Go(v).hoistableScripts,y=h.get(c),y||(y={type:"script",instance:null,count:0,state:null},h.set(c,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,o))}}function Dc(o){return'href="'+Cr(o)+'"'}function Id(o){return'link[rel="stylesheet"]['+o+"]"}function RP(o){return L({},o,{"data-precedence":o.precedence,precedence:null})}function T9(o,c,h,y){o.querySelector('link[rel="preload"][as="style"]['+c+"]")?y.loading=1:(c=o.createElement("link"),y.preload=c,c.addEventListener("load",function(){return y.loading|=1}),c.addEventListener("error",function(){return y.loading|=2}),jn(c,"link",h),hn(c),o.head.appendChild(c))}function Rc(o){return'[src="'+Cr(o)+'"]'}function Md(o){return"script[async]"+o}function LP(o,c,h){if(c.count++,c.instance===null)switch(c.type){case"style":var y=o.querySelector('style[data-href~="'+Cr(h.href)+'"]');if(y)return c.instance=y,hn(y),y;var v=L({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return y=(o.ownerDocument||o).createElement("style"),hn(y),jn(y,"style",v),up(y,h.precedence,o),c.instance=y;case"stylesheet":v=Dc(h.href);var C=o.querySelector(Id(v));if(C)return c.state.loading|=4,c.instance=C,hn(C),C;y=RP(h),(v=wi.get(v))&&bv(y,v),C=(o.ownerDocument||o).createElement("link"),hn(C);var k=C;return k._p=new Promise(function(N,$){k.onload=N,k.onerror=$}),jn(C,"link",y),c.state.loading|=4,up(C,h.precedence,o),c.instance=C;case"script":return C=Rc(h.src),(v=o.querySelector(Md(C)))?(c.instance=v,hn(v),v):(y=h,(v=wi.get(C))&&(y=L({},h),xv(y,v)),o=o.ownerDocument||o,v=o.createElement("script"),hn(v),jn(v,"link",y),o.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&!(c.state.loading&4)&&(y=c.instance,c.state.loading|=4,up(y,h.precedence,o));return c.instance}function up(o,c,h){for(var y=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=y.length?y[y.length-1]:null,C=v,k=0;k<y.length;k++){var N=y[k];if(N.dataset.precedence===c)C=N;else if(C!==v)break}C?C.parentNode.insertBefore(o,C.nextSibling):(c=h.nodeType===9?h.head:h,c.insertBefore(o,c.firstChild))}function bv(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.title==null&&(o.title=c.title)}function xv(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.integrity==null&&(o.integrity=c.integrity)}var dp=null;function NP(o,c,h){if(dp===null){var y=new Map,v=dp=new Map;v.set(h,y)}else v=dp,y=v.get(h),y||(y=new Map,v.set(h,y));if(y.has(o))return y;for(y.set(o,null),h=h.getElementsByTagName(o),v=0;v<h.length;v++){var C=h[v];if(!(C[Za]||C[xn]||o==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var k=C.getAttribute(c)||"";k=o+k;var N=y.get(k);N?N.push(C):y.set(k,[C])}}return y}function zP(o,c,h){o=o.ownerDocument||o,o.head.insertBefore(h,c==="title"?o.querySelector("head > title"):null)}function I9(o,c,h){if(h===1||c.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return o=c.disabled,typeof c.precedence=="string"&&o==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function FP(o){return!(o.type==="stylesheet"&&!(o.state.loading&3))}var Ad=null;function M9(){}function A9(o,c,h){if(Ad===null)throw Error(r(475));var y=Ad;if(c.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&!(c.state.loading&4)){if(c.instance===null){var v=Dc(h.href),C=o.querySelector(Id(v));if(C){o=C._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(y.count++,y=hp.bind(y),o.then(y,y)),c.state.loading|=4,c.instance=C,hn(C);return}C=o.ownerDocument||o,h=RP(h),(v=wi.get(v))&&bv(h,v),C=C.createElement("link"),hn(C);var k=C;k._p=new Promise(function(N,$){k.onload=N,k.onerror=$}),jn(C,"link",h),c.instance=C}y.stylesheets===null&&(y.stylesheets=new Map),y.stylesheets.set(c,o),(o=c.state.preload)&&!(c.state.loading&3)&&(y.count++,c=hp.bind(y),o.addEventListener("load",c),o.addEventListener("error",c))}}function k9(){if(Ad===null)throw Error(r(475));var o=Ad;return o.stylesheets&&o.count===0&&wv(o,o.stylesheets),0<o.count?function(c){var h=setTimeout(function(){if(o.stylesheets&&wv(o,o.stylesheets),o.unsuspend){var y=o.unsuspend;o.unsuspend=null,y()}},6e4);return o.unsuspend=c,function(){o.unsuspend=null,clearTimeout(h)}}:null}function hp(){if(this.count--,this.count===0){if(this.stylesheets)wv(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var fp=null;function wv(o,c){o.stylesheets=null,o.unsuspend!==null&&(o.count++,fp=new Map,c.forEach(j9,o),fp=null,hp.call(o))}function j9(o,c){if(!(c.state.loading&4)){var h=fp.get(o);if(h)var y=h.get(null);else{h=new Map,fp.set(o,h);for(var v=o.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<v.length;C++){var k=v[C];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(h.set(k.dataset.precedence,k),y=k)}y&&h.set(null,y)}v=c.instance,k=v.getAttribute("data-precedence"),C=h.get(k)||y,C===y&&h.set(null,v),h.set(k,v),this.count++,y=hp.bind(this),v.addEventListener("load",y),v.addEventListener("error",y),C?C.parentNode.insertBefore(v,C.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(v,o.firstChild)),c.state.loading|=4}}var kd={$$typeof:S,Provider:null,Consumer:null,_currentValue:ge,_currentValue2:ge,_threadCount:0};function O9(o,c,h,y,v,C,k,N){this.tag=1,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nu(0),this.hiddenUpdates=Nu(null),this.identifierPrefix=y,this.onUncaughtError=v,this.onCaughtError=C,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function BP(o,c,h,y,v,C,k,N,$,Q,ce,Se){return o=new O9(o,c,h,k,N,$,Q,Se),c=1,C===!0&&(c|=24),C=bi(3,null,null,c),o.current=C,C.stateNode=o,c=eS(),c.refCount++,o.pooledCache=c,c.refCount++,C.memoizedState={element:y,isDehydrated:h,cache:c},DS(C),o}function UP(o){return o?(o=fc,o):fc}function $P(o,c,h,y,v,C){v=UP(v),y.context===null?y.context=v:y.pendingContext=v,y=ia(c),y.payload={element:h},C=C===void 0?null:C,C!==null&&(y.callback=C),h=sa(o,y,c),h!==null&&(lr(h,o,c),pd(h,o,c))}function HP(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var h=o.retryLane;o.retryLane=h!==0&&h<c?h:c}}function _v(o,c){HP(o,c),(o=o.alternate)&&HP(o,c)}function KP(o){if(o.tag===13){var c=Zo(o,67108864);c!==null&&lr(c,o,67108864),_v(o,67108864)}}var pp=!0;function D9(o,c,h,y){var v=q.T;q.T=null;var C=ye.p;try{ye.p=2,Cv(o,c,h,y)}finally{ye.p=C,q.T=v}}function R9(o,c,h,y){var v=q.T;q.T=null;var C=ye.p;try{ye.p=8,Cv(o,c,h,y)}finally{ye.p=C,q.T=v}}function Cv(o,c,h,y){if(pp){var v=Ev(y);if(v===null)hv(o,c,y,gp,h),GP(o,y);else if(N9(v,o,c,h,y))y.stopPropagation();else if(GP(o,y),c&4&&-1<L9.indexOf(o)){for(;v!==null;){var C=_r(v);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var k=Bi(C.pendingLanes);if(k!==0){var N=C;for(N.pendingLanes|=2,N.entangledLanes|=2;k;){var $=1<<31-Yt(k);N.entanglements[1]|=$,k&=~$}xs(C),!(Wt&6)&&(Qf=br()+500,Ed(0))}}break;case 13:N=Zo(C,2),N!==null&&lr(N,C,2),tp(),_v(C,2)}if(C=Ev(y),C===null&&hv(o,c,y,gp,h),C===v)break;v=C}v!==null&&y.stopPropagation()}else hv(o,c,y,null,h)}}function Ev(o){return o=qi(o),Pv(o)}var gp=null;function Pv(o){if(gp=null,o=Js(o),o!==null){var c=V(o);if(c===null)o=null;else{var h=c.tag;if(h===13){if(o=ie(c),o!==null)return o;o=null}else if(h===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null)}}return gp=o,null}function qP(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ru()){case Wl:return 2;case Xs:return 8;case Ni:case Zl:return 32;case ae:return 268435456;default:return 32}default:return 32}}var Tv=!1,ha=null,fa=null,pa=null,jd=new Map,Od=new Map,ga=[],L9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function GP(o,c){switch(o){case"focusin":case"focusout":ha=null;break;case"dragenter":case"dragleave":fa=null;break;case"mouseover":case"mouseout":pa=null;break;case"pointerover":case"pointerout":jd.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Od.delete(c.pointerId)}}function Dd(o,c,h,y,v,C){return o===null||o.nativeEvent!==C?(o={blockedOn:c,domEventName:h,eventSystemFlags:y,nativeEvent:C,targetContainers:[v]},c!==null&&(c=_r(c),c!==null&&KP(c)),o):(o.eventSystemFlags|=y,c=o.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),o)}function N9(o,c,h,y,v){switch(c){case"focusin":return ha=Dd(ha,o,c,h,y,v),!0;case"dragenter":return fa=Dd(fa,o,c,h,y,v),!0;case"mouseover":return pa=Dd(pa,o,c,h,y,v),!0;case"pointerover":var C=v.pointerId;return jd.set(C,Dd(jd.get(C)||null,o,c,h,y,v)),!0;case"gotpointercapture":return C=v.pointerId,Od.set(C,Dd(Od.get(C)||null,o,c,h,y,v)),!0}return!1}function YP(o){var c=Js(o.target);if(c!==null){var h=V(c);if(h!==null){if(c=h.tag,c===13){if(c=ie(h),c!==null){o.blockedOn=c,Qs(o.priority,function(){if(h.tag===13){var y=Vr(),v=Zo(h,y);v!==null&&lr(v,h,y),_v(h,y)}});return}}else if(c===3&&h.stateNode.current.memoizedState.isDehydrated){o.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}o.blockedOn=null}function mp(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var h=Ev(o.nativeEvent);if(h===null){h=o.nativeEvent;var y=new h.constructor(h.type,h);Yu=y,h.target.dispatchEvent(y),Yu=null}else return c=_r(h),c!==null&&KP(c),o.blockedOn=h,!1;c.shift()}return!0}function VP(o,c,h){mp(o)&&h.delete(c)}function z9(){Tv=!1,ha!==null&&mp(ha)&&(ha=null),fa!==null&&mp(fa)&&(fa=null),pa!==null&&mp(pa)&&(pa=null),jd.forEach(VP),Od.forEach(VP)}function yp(o,c){o.blockedOn===c&&(o.blockedOn=null,Tv||(Tv=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,z9)))}var Sp=null;function XP(o){Sp!==o&&(Sp=o,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Sp===o&&(Sp=null);for(var c=0;c<o.length;c+=3){var h=o[c],y=o[c+1],v=o[c+2];if(typeof y!="function"){if(Pv(y||h)===null)continue;break}var C=_r(h);C!==null&&(o.splice(c,3),c-=3,mS(C,{pending:!0,data:v,method:h.method,action:y},y,v))}}))}function Rd(o){function c($){return yp($,o)}ha!==null&&yp(ha,o),fa!==null&&yp(fa,o),pa!==null&&yp(pa,o),jd.forEach(c),Od.forEach(c);for(var h=0;h<ga.length;h++){var y=ga[h];y.blockedOn===o&&(y.blockedOn=null)}for(;0<ga.length&&(h=ga[0],h.blockedOn===null);)YP(h),h.blockedOn===null&&ga.shift();if(h=(o.ownerDocument||o).$$reactFormReplay,h!=null)for(y=0;y<h.length;y+=3){var v=h[y],C=h[y+1],k=v[Kn]||null;if(typeof C=="function")k||XP(h);else if(k){var N=null;if(C&&C.hasAttribute("formAction")){if(v=C,k=C[Kn]||null)N=k.formAction;else if(Pv(v)!==null)continue}else N=k.action;typeof N=="function"?h[y+1]=N:(h.splice(y,3),y-=3),XP(h)}}}function Iv(o){this._internalRoot=o}vp.prototype.render=Iv.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(r(409));var h=c.current,y=Vr();$P(h,y,o,c,null,null)},vp.prototype.unmount=Iv.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;o.tag===0&&Ac(),$P(o.current,2,null,o,null,null),tp(),c[qo]=null}};function vp(o){this._internalRoot=o}vp.prototype.unstable_scheduleHydration=function(o){if(o){var c=Jl();o={blockedOn:null,target:o,priority:c};for(var h=0;h<ga.length&&c!==0&&c<ga[h].priority;h++);ga.splice(h,0,o),h===0&&YP(o)}};var WP=e.version;if(WP!=="19.0.0")throw Error(r(527,WP,"19.0.0"));ye.findDOMNode=function(o){var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(r(188)):(o=Object.keys(o).join(","),Error(r(268,o)));return o=re(c),o=o!==null?me(o):null,o=o===null?null:o.stateNode,o};var F9={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:q,findFiberByHostInstance:Js,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bp.isDisabled&&bp.supportsFiber)try{bt=bp.inject(F9),Gt=bp}catch{}}return Nd.createRoot=function(o,c){if(!i(o))throw Error(r(299));var h=!1,y="",v=f2,C=p2,k=g2,N=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(C=c.onCaughtError),c.onRecoverableError!==void 0&&(k=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(N=c.unstable_transitionCallbacks)),c=BP(o,1,!1,null,null,h,y,v,C,k,N,null),o[qo]=c.current,dv(o.nodeType===8?o.parentNode:o),new Iv(c)},Nd.hydrateRoot=function(o,c,h){if(!i(o))throw Error(r(299));var y=!1,v="",C=f2,k=p2,N=g2,$=null,Q=null;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(v=h.identifierPrefix),h.onUncaughtError!==void 0&&(C=h.onUncaughtError),h.onCaughtError!==void 0&&(k=h.onCaughtError),h.onRecoverableError!==void 0&&(N=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&($=h.unstable_transitionCallbacks),h.formState!==void 0&&(Q=h.formState)),c=BP(o,1,!0,c,h??null,y,v,C,k,N,$,Q),c.context=UP(null),h=c.current,y=Vr(),v=ia(y),v.callback=null,sa(h,v,y),c.current.lanes=y,Wa(c,y),xs(c),o[qo]=c.current,dv(o),new vp(c)},Nd.version="19.0.0",Nd}var oT;function Q9(){if(oT)return kv.exports;oT=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),kv.exports=Z9(),kv.exports}var yj=Q9();const Rv="__TLDRAW_LIBRARY_VERSIONS__";function J9(){if(globalThis[Rv])return globalThis[Rv];const n={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,Rv,{value:n,writable:!1,configurable:!1,enumerable:!1}),n}function Fa(n,e,t){if(!n)throw new Error("Missing name/version/module system in built version of tldraw library");const r=J9();if(r.versions.push({name:n,version:e,modules:t}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,aT(r)},100)}catch{aT(r)}}function aT(n){if(!n.versions.length||n.didWarn)return;const e=n.versions.sort((l,u)=>lT(l.version,u.version)),t=e[e.length-1].version,r=new Set,i=new Map;for(const l of e){if(i.has(l.name)){r.delete(l.name),Lv(i,l.name,new Set).add(l.version);continue}l.version===t?r.add(l.name):(r.delete(l.name),Lv(i,l.name,new Set).add(l.version))}if(i.size>0){const l=[`${vo("[tldraw]",["bold","bgRed","textWhite"])} ${vo("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${vo(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,u=>`    ${vo(u,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([u,d])=>{const f=Array.from(d).sort(lT).map(g=>vo(`v${g}`,g===t?["textGreen"]:["textRed"]));return`    ${vo(u,["bold"])} (${f.join(", ")})`})];console.log(l.join(`
`)),n.didWarn=!0;return}const s=new Map;for(const l of e)Lv(s,l.name,{version:l.version,modules:[]}).modules.push(l.modules);const a=new Map;for(const[l,u]of s)u.modules.length>1&&a.set(l,u);if(a.size>0){const l=[`${vo("[tldraw]",["bold","bgRed","textWhite"])} ${vo("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(a,([u,d])=>{const f=d.modules.map((g,m)=>g==="esm"?`      ${m+1}. ES Modules`:`      ${m+1}. CommonJS`).join(`
`);return`    ${vo(u,["bold"])} v${d.version}: 
${f}`}),"","You should configure your bundler to only import one version of each library."];console.log(l.join(`
`)),n.didWarn=!0;return}}function lT(n,e){const t=n.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!r?n.localeCompare(e):t[1]!==r[1]?Number(t[1])-Number(r[1]):t[2]!==r[2]?Number(t[2])-Number(r[2]):t[3]!==r[3]?Number(t[3])-Number(r[3]):t[4]&&r[4]?t[4].localeCompare(r[4]):t[4]?1:r[4]?-1:0}const eF={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function vo(n,e=[]){return`\x1B[${e.map(t=>eF[t]).join(";")}m${n}\x1B[m`}function Lv(n,e,t){return n.has(e)?n.get(e):(n.set(e,t),t)}var Nv,cT;function tF(){if(cT)return Nv;cT=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,l=parseInt,u=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,d=typeof self=="object"&&self&&self.Object===Object&&self,f=u||d||Function("return this")(),g=Object.prototype,m=g.toString,S=Math.max,b=Math.min,x=function(){return f.Date.now()};function w(j,D,R){var q,L,K,G,z,U,Y=0,H=!1,X=!1,V=!0;if(typeof j!="function")throw new TypeError(n);D=A(D)||0,E(R)&&(H=!!R.leading,X="maxWait"in R,K=X?S(A(R.maxWait)||0,D):K,V="trailing"in R?!!R.trailing:V);function ie(we){var Te=q,je=L;return q=L=void 0,Y=we,G=j.apply(je,Te),G}function B(we){return Y=we,z=setTimeout(de,D),H?ie(we):G}function re(we){var Te=we-U,je=we-Y,He=D-Te;return X?b(He,K-je):He}function me(we){var Te=we-U,je=we-Y;return U===void 0||Te>=D||Te<0||X&&je>=K}function de(){var we=x();if(me(we))return ye(we);z=setTimeout(de,re(we))}function ye(we){return z=void 0,V&&q?ie(we):(q=L=void 0,G)}function ge(){z!==void 0&&clearTimeout(z),Y=0,q=U=L=z=void 0}function Ie(){return z===void 0?G:ye(x())}function Ne(){var we=x(),Te=me(we);if(q=arguments,L=this,U=we,Te){if(z===void 0)return B(U);if(X)return z=setTimeout(de,D),ie(U)}return z===void 0&&(z=setTimeout(de,D)),G}return Ne.cancel=ge,Ne.flush=Ie,Ne}function _(j,D,R){var q=!0,L=!0;if(typeof j!="function")throw new TypeError(n);return E(R)&&(q="leading"in R?!!R.leading:q,L="trailing"in R?!!R.trailing:L),w(j,D,{leading:q,maxWait:D,trailing:L})}function E(j){var D=typeof j;return!!j&&(D=="object"||D=="function")}function M(j){return!!j&&typeof j=="object"}function I(j){return typeof j=="symbol"||M(j)&&m.call(j)==t}function A(j){if(typeof j=="number")return j;if(I(j))return e;if(E(j)){var D=typeof j.valueOf=="function"?j.valueOf():j;j=E(D)?D+"":D}if(typeof j!="string")return j===0?j:+j;j=j.replace(r,"");var R=s.test(j);return R||a.test(j)?l(j.slice(2),R?2:8):i.test(j)?e:+j}return Nv=_,Nv}var nF=tF();const Sj=za(nF);var zv,uT;function rF(){if(uT)return zv;uT=1;var n=200,e="__lodash_hash_undefined__",t=1/0,r="[object Function]",i="[object GeneratorFunction]",s=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,l=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,u=typeof self=="object"&&self&&self.Object===Object&&self,d=l||u||Function("return this")();function f(ae,xe){var Ue=ae?ae.length:0;return!!Ue&&m(ae,xe,0)>-1}function g(ae,xe,Ue,bt){for(var Gt=ae.length,xr=Ue+-1;++xr<Gt;)if(xe(ae[xr],xr,ae))return xr;return-1}function m(ae,xe,Ue){if(xe!==xe)return g(ae,S,Ue);for(var bt=Ue-1,Gt=ae.length;++bt<Gt;)if(ae[bt]===xe)return bt;return-1}function S(ae){return ae!==ae}function b(ae,xe){return ae.has(xe)}function x(ae,xe){return ae==null?void 0:ae[xe]}function w(ae){var xe=!1;if(ae!=null&&typeof ae.toString!="function")try{xe=!!(ae+"")}catch{}return xe}function _(ae){var xe=-1,Ue=Array(ae.size);return ae.forEach(function(bt){Ue[++xe]=bt}),Ue}var E=Array.prototype,M=Function.prototype,I=Object.prototype,A=d["__core-js_shared__"],j=function(){var ae=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||"");return ae?"Symbol(src)_1."+ae:""}(),D=M.toString,R=I.hasOwnProperty,q=I.toString,L=RegExp("^"+D.call(R).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=E.splice,G=Vs(d,"Map"),z=Vs(d,"Set"),U=Vs(Object,"create");function Y(ae){var xe=-1,Ue=ae?ae.length:0;for(this.clear();++xe<Ue;){var bt=ae[xe];this.set(bt[0],bt[1])}}function H(){this.__data__=U?U(null):{}}function X(ae){return this.has(ae)&&delete this.__data__[ae]}function V(ae){var xe=this.__data__;if(U){var Ue=xe[ae];return Ue===e?void 0:Ue}return R.call(xe,ae)?xe[ae]:void 0}function ie(ae){var xe=this.__data__;return U?xe[ae]!==void 0:R.call(xe,ae)}function B(ae,xe){var Ue=this.__data__;return Ue[ae]=U&&xe===void 0?e:xe,this}Y.prototype.clear=H,Y.prototype.delete=X,Y.prototype.get=V,Y.prototype.has=ie,Y.prototype.set=B;function re(ae){var xe=-1,Ue=ae?ae.length:0;for(this.clear();++xe<Ue;){var bt=ae[xe];this.set(bt[0],bt[1])}}function me(){this.__data__=[]}function de(ae){var xe=this.__data__,Ue=gt(xe,ae);if(Ue<0)return!1;var bt=xe.length-1;return Ue==bt?xe.pop():K.call(xe,Ue,1),!0}function ye(ae){var xe=this.__data__,Ue=gt(xe,ae);return Ue<0?void 0:xe[Ue][1]}function ge(ae){return gt(this.__data__,ae)>-1}function Ie(ae,xe){var Ue=this.__data__,bt=gt(Ue,ae);return bt<0?Ue.push([ae,xe]):Ue[bt][1]=xe,this}re.prototype.clear=me,re.prototype.delete=de,re.prototype.get=ye,re.prototype.has=ge,re.prototype.set=Ie;function Ne(ae){var xe=-1,Ue=ae?ae.length:0;for(this.clear();++xe<Ue;){var bt=ae[xe];this.set(bt[0],bt[1])}}function we(){this.__data__={hash:new Y,map:new(G||re),string:new Y}}function Te(ae){return ci(this,ae).delete(ae)}function je(ae){return ci(this,ae).get(ae)}function He(ae){return ci(this,ae).has(ae)}function Ft(ae,xe){return ci(this,ae).set(ae,xe),this}Ne.prototype.clear=we,Ne.prototype.delete=Te,Ne.prototype.get=je,Ne.prototype.has=He,Ne.prototype.set=Ft;function at(ae){var xe=-1,Ue=ae?ae.length:0;for(this.__data__=new Ne;++xe<Ue;)this.add(ae[xe])}function Bt(ae){return this.__data__.set(ae,e),this}function _t(ae){return this.__data__.has(ae)}at.prototype.add=at.prototype.push=Bt,at.prototype.has=_t;function gt(ae,xe){for(var Ue=ae.length;Ue--;)if(Wl(ae[Ue][0],xe))return Ue;return-1}function Sr(ae){if(!Ni(ae)||Du(ae))return!1;var xe=Xs(ae)||w(ae)?L:a;return xe.test(br(ae))}function Hn(ae,xe,Ue){var bt=-1,Gt=f,xr=ae.length,wr=!0,Yt=[],zi=Yt;if(xr>=n){var ui=vr(ae);if(ui)return _(ui);wr=!1,Gt=b,zi=new at}else zi=Yt;e:for(;++bt<xr;){var Fi=ae[bt],di=Fi;if(Fi=Fi!==0?Fi:0,wr&&di===di){for(var Ws=zi.length;Ws--;)if(zi[Ws]===di)continue e;Yt.push(Fi)}else Gt(zi,di,Ue)||(zi!==Yt&&zi.push(di),Yt.push(Fi))}return Yt}var vr=z&&1/_(new z([,-0]))[1]==t?function(ae){return new z(ae)}:Zl;function ci(ae,xe){var Ue=ae.__data__;return Ou(xe)?Ue[typeof xe=="string"?"string":"hash"]:Ue.map}function Vs(ae,xe){var Ue=x(ae,xe);return Sr(Ue)?Ue:void 0}function Ou(ae){var xe=typeof ae;return xe=="string"||xe=="number"||xe=="symbol"||xe=="boolean"?ae!=="__proto__":ae===null}function Du(ae){return!!j&&j in ae}function br(ae){if(ae!=null){try{return D.call(ae)}catch{}try{return ae+""}catch{}}return""}function Ru(ae){return ae&&ae.length?Hn(ae):[]}function Wl(ae,xe){return ae===xe||ae!==ae&&xe!==xe}function Xs(ae){var xe=Ni(ae)?q.call(ae):"";return xe==r||xe==i}function Ni(ae){var xe=typeof ae;return!!ae&&(xe=="object"||xe=="function")}function Zl(){}return zv=Ru,zv}var iF=rF();const sF=za(iF);function vj(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const bh=()=>{},Ia={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function mn(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const vt=vj((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),jr=vj((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function g1(){let n,e;const t=new Promise((r,i)=>{n=r,e=i});return Object.assign(t,{resolve:n,reject:e})}function ew(n){return new Promise(e=>setTimeout(e,n))}const Jd={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},oF=Jd.Good;class bj{constructor(){O(this,"startTime",0);O(this,"name","");O(this,"frames",0);O(this,"started",!1);O(this,"frame",null);O(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),r=t>55?Jd.Good:t>30?Jd.Mid:Jd.Poor,i=r===Jd.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${t}%c fps`,`color: white; background: ${oF};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function m1(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function Ye(n){return n.filter(e=>e!=null)}function Rn(n){return n[n.length-1]}function aF(n,e){let t,r=1/0;for(const i of n){const s=e(i);s<r&&(t=i,r=s)}return t}function lF(n,e){let t,r=-1/0;for(const i of n){const s=e(i);s>r&&(t=i,r=s)}return t}function xj(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function Fv(n,e,t){const r=new Set(e.map(s=>s[n])),i=[];for(const s of t)r.has(s[n])||i.push(s);for(const s of e)i.push(s);return i}function Lr(...n){if(n.length===2){const[e,t]=n;t.addInitializer(function(){vt(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const i=e.bind(this),s=Reflect.defineProperty(this,t.name,{value:i,writable:!0,configurable:!0});vt(s,"Cannot bind a non-configurable class method.")})}else{const[e,t,r]=n;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const i=r.value.bind(this);return Object.defineProperty(this,t,{value:i,configurable:!0,writable:!0}),i}}}}class Rs{constructor(){O(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function y1(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((s,a)=>{t.resolve=s,t.reject=a})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const s=t;t=void 0;try{s.resolve(n(...s.latestArgs))}catch(a){s.reject(a)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const dT=new WeakMap;function S1(n,e){if(typeof n!="object"||n===null)return;let t=dT.get(n);t||(t={tags:{},extras:{}},dT.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function Ls(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const xh=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class ts{static async dataUrlToArrayBuffer(e){return Ls(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function v1(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function wj(n){const e=new DataView(n);let t=0;for(let r=0;r<e.byteLength;r++)t=(t<<5)-t+e.getUint8(r),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const hT=globalThis.crypto,cF="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",uF=128;let El,Vc;function dF(n){!El||El.length<n?(El=new Uint8Array(n*uF),hT.getRandomValues(El),Vc=0):Vc+n>El.length&&(hT.getRandomValues(El),Vc=0),Vc+=n}function hF(n=21){dF(n-=0);let e="";for(let t=Vc-n;t<Vc;t++)e+=cF[El[t]&63];return e}let fF=hF;function Ct(n){return fF(n)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function pF(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(s,a,l,u,d=1024){if(!a)return-1;a=new RegExp(a,"g");const f=a.source.length,g=new TextDecoder,m=s.length;if(typeof u>"u"&&(u=m),l>=m||u<=0||l>=u)return-1;s=s.subarray(l,u);let S=-1,b=0,x=0,w="";e:for(;b<s.length;){const _=b+d,E=s.subarray(b,_),M=g.decode(E,{stream:!0}),I=w+M;let A,j=-1;for(;(A=a.exec(I))!==null;){j=A.index-w.length,S=x+j;break e}b=_,x+=M.length;const D=j>-1?j+f:M.length-f;w=M.slice(D)}return S>=0&&(S+=l>=0?l:m+l),S}const i=r(e,"IDAT",12);return i>=12?r(e,"acTL",8,i)>=8:!1}const gF=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function fT(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function mF(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function yF(n){const e=new Uint8Array(n);let t,r,i=0,s=0;if(!mF(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;s<2&&i<e.length;)switch(e[i]){case 44:s+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=fT(e,i+1)+1;break;case 33:i+=2,i+=fT(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return s>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let tw=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(tw=new Int32Array(tw));const SF=(n,e)=>{let t=-1;for(let r=0;r<n.length;r++)t=tw[(t^n[r])&255]^t>>>8;return t^-1},pT=4,gT=4;class Ps{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!Ps.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,s=e.getInt32(t);t+=4;const a=Ps.getChunkType(e,t);if(a==="IDAT"&&r[a]){t+=s+pT+gT;continue}if(a==="IEND")break;r[a]={start:i,dataOffset:t+4,size:s},t+=s+pT+gT}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return Ps.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,s=0;const a=Ps.findChunk(e,"pHYs");a&&(i=a.start,s=a.size);const l=Ps.findChunk(e,"IDAT");l&&(i=l.start,s=0);const u=new ArrayBuffer(21),d=new DataView(u);d.setUint32(0,9),d.setUint8(4,112),d.setUint8(5,72),d.setUint8(6,89),d.setUint8(7,115);const f=2835.5;d.setInt32(8,f*t),d.setInt32(12,f*t),d.setInt8(16,1);const g=new Uint8Array(u.slice(4,17));d.setInt32(17,SF(g));const m=e.buffer.slice(0,i),S=e.buffer.slice(i+s);return new Blob([m,u,S],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function vF(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function bF(n){const e=new Uint8Array(n);return!vF(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const _j=Object.freeze(["image/svg+xml"]),Cj=Object.freeze(["image/jpeg","image/png","image/webp"]),Ej=Object.freeze(["image/gif","image/apng","image/avif"]),Nh=Object.freeze([...Cj,..._j,...Ej]),_m=Object.freeze(["video/mp4","video/webm","video/quicktime"]),xF=[...Nh,..._m].join(",");class Zr{static loadVideo(e){return new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const r=g1();let i=!1;const s=()=>{if(!i)if(e.readyState>=e.HAVE_METADATA)i=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const l=document.createElement("canvas");l.width=e.videoWidth,l.height=e.videoHeight;const u=l.getContext("2d");if(!u)throw new Error("Could not get 2d context");u.drawImage(e,0,0),r.resolve(l.toDataURL())}},a=l=>{console.error(l),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",s),e.addEventListener("loadeddata",s),e.addEventListener("canplay",s),e.addEventListener("seeked",s),e.addEventListener("error",a),e.addEventListener("stalled",a),s();try{return await r}finally{e.removeEventListener("loadedmetadata",s),e.removeEventListener("loadeddata",s),e.removeEventListener("canplay",s),e.removeEventListener("seeked",s),e.removeEventListener("error",a),e.removeEventListener("stalled",a)}}static loadImage(e){return new Promise((t,r)=>{const i=xh();i.onload=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e})}static async getVideoSize(e){return Zr.usingObjectURL(e,async t=>{const r=await Zr.loadVideo(t);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const t=await Zr.usingObjectURL(e,Zr.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(Ps.isPng(r,0)){const i=Ps.findChunk(r,"pHYs");if(i){const s=Ps.parsePhys(r,i.dataOffset);if(s.unit===0&&s.ppux===s.ppuy){const a=Math.max(s.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/a),h:Math.round(t.naturalHeight/a)}}}}}}catch(r){return console.error(r),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?yF(await e.arrayBuffer()):e.type==="image/avif"?gF(await e.arrayBuffer()):e.type==="image/webp"?bF(await e.arrayBuffer()):e.type==="image/apng"?pF(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return Ej.includes(e||"")}static isStaticImageType(e){return Cj.includes(e||"")}static isVectorImageType(e){return _j.includes(e||"")}static isImageType(e){return Nh.includes(e)}static async usingObjectURL(e,t){const r=URL.createObjectURL(e);try{return await t(r)}finally{URL.revokeObjectURL(r)}}}function st(n,e,t){return n+(e-n)*t}function ls(n=""){let e=0,t=0,r=0,i=0;function s(){const a=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^a^a>>>8)>>>0,i/4294967296*2}for(let a=0;a<n.length+64;a++)e^=n.charCodeAt(a)|0,s();return s}function lu(n,e,t,r=!1){const[i,s]=e,[a,l]=t,u=a+(n-i)/(s-i)*(l-a);return r?a<l?Math.max(Math.min(u,l),a):Math.max(Math.min(u,a),l):u}function Ii(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function tr(n,e){if(Ii(n,e))return n[e]}function mT(n){return Object.keys(n)}function Zt(n){return Object.values(n)}function Nr(n){return Object.entries(n)}function b1(n){return Object.fromEntries(n)}function uh(n,e){const t={};let r=!1;for(const[i,s]of Nr(n))e(i,s)?t[i]=s:r=!0;return r?t:n}function zh(n,e){const t={};for(const[r,i]of Nr(n)){const s=e(r,i);t[r]=s}return t}function Pj(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}function wF(n){const e=_F(n.chars),t=CF(e,n.firstPositive,n.mostPositive,n.mostNegative),r=n.jitterRange??Math.floor(Math.pow(e.length,3)/5),i=EF(r,e.length);return{chars:n.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:t.firstPositive,mostPositive:t.mostPositive,firstNegative:t.firstNegative,mostNegative:t.mostNegative,jitterRange:r,paddingDict:i}}function _F(n){const e={},t={},r=n.length;for(let i=0;i<r;i++){const s=n[i];e[i]=s,t[s]=i}return{byCode:e,byChar:t,length:r}}function CF(n,e,t,r){const i=n.byChar[e],s=n.byChar[t],a=n.byChar[r];if(i===void 0||s===void 0||a===void 0)throw new Error("invalid charSet");if(s-i<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(i-a<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:n.byCode[i],mostPositive:n.byCode[s],firstNegative:n.byCode[i-1],mostNegative:n.byCode[a]}}function EF(n,e){const t={};for(let r=0;r<100&&(t[r]=Math.pow(e,r),!(t[r]>n));r++);return t}var Bv=null;function x1(){return Bv||(Bv=wF({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function Ea(n,e,t){const r=t.byChar[n],i=t.byChar[e];return Math.abs(r-i)}function w1(n,e){const t=n[0];if(t>e.mostPositive||t<e.mostNegative)throw new Error("invalid firstChar on key");return t===e.mostPositive?Ea(t,e.firstPositive,e)+1+zg(n.slice(1),"positive",e):t===e.mostNegative?Ea(t,e.firstNegative,e)+1+zg(n.slice(1),"negative",e):t>=e.firstPositive?Ea(t,e.firstPositive,e)+2:Ea(t,e.firstNegative,e)+2}function zg(n,e,t){const r=n[0];if(r>t.mostPositive||r<t.mostNegative)throw new Error("invalid firstChar on key");return r===t.mostPositive&&e==="positive"?Ea(r,t.mostNegative,t)+1+zg(n.slice(1),e,t):r===t.mostNegative&&e==="negative"?Ea(r,t.mostPositive,t)+1+zg(n.slice(1),e,t):e==="positive"?Ea(r,t.mostNegative,t)+2:Ea(r,t.mostPositive,t)+2}function Cm(n,e,t,r,i){const s=Math.max(n.length,e.length);return t==="start"?[n.padStart(s,r),e.padStart(s,r)]:[n.padEnd(s,r),e.padEnd(s,r)]}function PF(n,e,t){let[r,i]=Cm(n,e,"end",t.first),s=nw(r,i,t);s===1&&(r=r.padEnd(r.length+1,t.first),s=t.length);const a=Mj(Math.floor(s/2),t);return _1(r,a,t)}function nw(n,e,t){const[r,i]=Cm(n,e,"end",t.first).sort(),s=Tj(i,r,t);return TF(s,t)}function _1(n,e,t){const r=t.length,[i,s]=Cm(n,e,"start",t.first),a=[];let l=0;for(let u=i.length-1;u>=0;u--){const d=t.byChar[i[u]],f=t.byChar[s[u]],g=d+f+l;l=Math.floor(g/r);const m=g%r;a.unshift(t.byCode[m])}return l>0&&a.unshift(t.byCode[l]),a.join("")}function Tj(n,e,t){const r=t.length,[i,s]=Cm(n,e,"start",t.first),a=[];let l=0;for(let u=i.length-1;u>=0;u--){let d=t.byChar[i[u]];const f=t.byChar[s[u]]+l;d<f?(l=1,d+=r):l=0;const g=d-f;a.unshift(t.byCode[g])}if(l>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;a.length>1&&a[0]===t.byCode[0];)a.shift();return a.join("")}function Ij(n,e){return _1(n,e.byCode[1],e)}function rw(n,e){return Tj(n,e.byCode[1],e)}function Mj(n,e){if(n===0)return e.byCode[0];let t="";const r=e.length;for(;n>0;)t=e.byCode[n%r]+t,n=Math.floor(n/r);return t}function TF(n,e){let t=0;const r=n.length,i=e.length;for(let s=0;s<r;s++)t+=e.byChar[n[s]]*Math.pow(i,r-s-1);return t}function IF(n){return n.firstPositive+n.byCode[0]}function MF(n,e){return w1(n,e)===n.length}function yT(n,e){Fg(n,e)}function Fg(n,e){const t=jj(n,e),r=w1(t,e);if(r>n.length)throw new Error("invalid order key length: "+n);return n.slice(0,r)}function Aj(n,e){if(!MF(n,e))throw new Error("invalid integer length: "+n)}function kj(n,e){Aj(n,e);const[t,r]=Oj(n,e);if(r.split("").some(a=>a!==e.byCode[e.length-1])){const a=Ij(r,e);return t+a}const s=kF(t,e);return Dj(s,"lower",e)}function AF(n,e){Aj(n,e);const[t,r]=Oj(n,e);if(r.split("").some(a=>a!==e.byCode[0])){const a=rw(r,e);return t+a}const s=jF(t,e);return Dj(s,"upper",e)}function jj(n,e){let t=0;if(n[0]===e.mostPositive)for(;n[t]===e.mostPositive;)t=t+1;if(n[0]===e.mostNegative)for(;n[t]===e.mostNegative;)t=t+1;return n.slice(0,t+1)}function Oj(n,e){const t=jj(n,e),r=n.slice(t.length);return[t,r]}function kF(n,e){const t=n>=e.firstPositive,r=Ij(n,e),i=n[n.length-1]===e.mostPositive,s=r[r.length-1]===e.mostPositive;return t&&s?r+e.mostNegative:!t&&i?n.slice(0,n.length-1):r}function jF(n,e){const t=n>=e.firstPositive,r=n[n.length-1]===e.mostNegative;if(t&&r){const i=n.slice(0,n.length-1);return rw(i,e)}return!t&&r?n+e.mostPositive:rw(n,e)}function Dj(n,e,t){const r=w1(n,t),i=e==="upper"?t.byCode[t.length-1]:t.byCode[0];return n+i.repeat(r-n.length)}function Rj(n,e){const t=Mj(Math.floor(Math.random()*e.jitterRange),e);return _1(n,t,e)}function OF(n,e,t){const r=n.padEnd(n.length+e,t.first);return Rj(r,t)}function DF(n,e,t){const r=Fg(n,t),i=kj(r,t);let s=0;if(e!==null){const l=nw(n,e,t);l<t.jitterRange+1&&(s=Math.max(s,ST(l,t)))}const a=nw(n,i,t);return a<t.jitterRange+1&&(s=Math.max(s,ST(a,t))),s}function ST(n,e){const t=e.jitterRange-n,r=Object.entries(e.paddingDict).find(([i,s])=>s>t);return r?parseInt(r[0]):0}function RF(n,e,t=x1()){if(n!==null&&yT(n,t),e!==null&&yT(e,t),n===null&&e===null)return IF(t);if(n===null){const r=Fg(e,t);return AF(r,t)}if(e===null){const r=Fg(n,t);return kj(r,t)}if(n>=e)throw new Error(n+" >= "+e);return PF(n,e,t)}function Lj(n,e,t=x1()){const r=RF(n,e,t),i=DF(r,e,t);return i?OF(r,i,t):Rj(r,t)}function Nj(n,e,t,r=x1()){return LF(n,e,t,r,Lj,Nj)}function LF(n,e,t,r,i,s){if(t===0)return[];if(t===1)return[i(n,e,r)];if(e==null){let u=i(n,e,r);const d=[u];for(let f=0;f<t-1;f++)u=i(u,e,r),d.push(u);return d}if(n==null){let u=i(n,e,r);const d=[u];for(let f=0;f<t-1;f++)u=i(n,u,r),d.push(u);return d.reverse(),d}const a=Math.floor(t/2),l=i(n,e,r);return[...s(n,l,a,r),l,...s(l,e,t-a-1,r)]}const yu=Nj,zj="a0";function NF(n){try{Lj(n,null)}catch{throw new Error("invalid index: "+n)}}function cu(n,e,t){return yu(n??null,e??null,t)}function Uv(n,e){return yu(n??null,null,e)}function wh(n,e){return yu(n??null,e??null,1)[0]}function Is(n=null){return yu(n,null,1)[0]}function zF(n=null){return yu(null,n,1)[0]}function _h(n,e="a1"){return[e,...yu(e,null,n)]}function Jn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function FF(n,e){return n.id>e.id?1:-1}function C1(n){try{return localStorage.getItem(n)}catch{return null}}function E1(n,e){try{localStorage.setItem(n,e)}catch{}}function BF(){try{localStorage.clear()}catch{}}function Fj(n){try{return sessionStorage.getItem(n)}catch{return null}}function P1(n,e){try{sessionStorage.setItem(n,e)}catch{}}function Bj(n){try{sessionStorage.removeItem(n)}catch{}}function UF(){try{sessionStorage.clear()}catch{}}const Xc=[],$F=60,ig=Math.ceil(1e3/$F);let zd,$v=0,iw=0;const HF=()=>{const n=Xc.splice(0,Xc.length);for(const e of n)e()};function Uj(){if(zd)return;const n=Date.now(),e=n-iw;if($v+e<ig){zd=requestAnimationFrame(()=>{zd=void 0,Uj()});return}zd=requestAnimationFrame(()=>{zd=void 0,iw=n,$v=Math.min($v+e-ig,ig*10),HF()})}let vT=!1;function $j(n){return Xc.includes(n)||(Xc.push(n),vT||(vT=!0,iw=Date.now()-ig-1),Uj()),()=>{const e=Xc.indexOf(n);e>-1&&Xc.splice(e,1)}}class KF{constructor(){O(this,"timeouts",new Map);O(this,"intervals",new Map);O(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,r,...i){const s=window.setTimeout(t,r,i),a=this.timeouts.get(e)??[];return this.timeouts.set(e,[...a,s]),s}setInterval(e,t,r,...i){const s=window.setInterval(t,r,i),a=this.intervals.get(e)??[];return this.intervals.set(e,[...a,s]),s}requestAnimationFrame(e,t){const r=window.requestAnimationFrame(t),i=this.rafs.get(e)??[];return this.rafs.set(e,[...i,r]),r}dispose(e){var t,r,i;(t=this.timeouts.get(e))==null||t.forEach(s=>clearTimeout(s)),(r=this.intervals.get(e))==null||r.forEach(s=>clearInterval(s)),(i=this.rafs.get(e))==null||i.forEach(s=>cancelAnimationFrame(s)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,r,...i)=>this.setTimeout(e,t,r,i),setInterval:(t,r,...i)=>this.setInterval(e,t,r,i),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const Ke=(n,e)=>{try{return new URL(n,e)}catch{return}};function qF(n){return n!==void 0}function GF(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const Hj=GF(),$t=Hj[0];Hj[1];const YF=Object.getPrototypeOf($t({}));Fa("@tldraw/utils","3.8.1","esm");var bT={},Fd,xT;function dr(){if(xT)return Fd;xT=1;var n=function(e){return e&&e.Math===Math&&e};return Fd=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof Rr=="object"&&Rr)||n(typeof Fd=="object"&&Fd)||function(){return this}()||Function("return this")(),Fd}var Hv={},Kv,wT;function hr(){return wT||(wT=1,Kv=function(n){try{return!!n()}catch{return!0}}),Kv}var qv,_T;function Ba(){if(_T)return qv;_T=1;var n=hr();return qv=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),qv}var Gv,CT;function Em(){if(CT)return Gv;CT=1;var n=hr();return Gv=!n(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),Gv}var Yv,ET;function zo(){if(ET)return Yv;ET=1;var n=Em(),e=Function.prototype.call;return Yv=n?e.bind(e):function(){return e.apply(e,arguments)},Yv}var Vv={},PT;function VF(){if(PT)return Vv;PT=1;var n={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!n.call({1:2},1);return Vv.f=t?function(i){var s=e(this,i);return!!s&&s.enumerable}:n,Vv}var Xv,TT;function Kj(){return TT||(TT=1,Xv=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}}),Xv}var Wv,IT;function In(){if(IT)return Wv;IT=1;var n=Em(),e=Function.prototype,t=e.call,r=n&&e.bind.bind(t,t);return Wv=n?r:function(i){return function(){return t.apply(i,arguments)}},Wv}var Zv,MT;function Su(){if(MT)return Zv;MT=1;var n=In(),e=n({}.toString),t=n("".slice);return Zv=function(r){return t(e(r),8,-1)},Zv}var Qv,AT;function XF(){if(AT)return Qv;AT=1;var n=In(),e=hr(),t=Su(),r=Object,i=n("".split);return Qv=e(function(){return!r("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?i(s,""):r(s)}:r,Qv}var Jv,kT;function Pm(){return kT||(kT=1,Jv=function(n){return n==null}),Jv}var e0,jT;function vu(){if(jT)return e0;jT=1;var n=Pm(),e=TypeError;return e0=function(t){if(n(t))throw new e("Can't call method on "+t);return t},e0}var t0,OT;function Tm(){if(OT)return t0;OT=1;var n=XF(),e=vu();return t0=function(t){return n(e(t))},t0}var n0,DT;function fr(){if(DT)return n0;DT=1;var n=typeof document=="object"&&document.all;return n0=typeof n>"u"&&n!==void 0?function(e){return typeof e=="function"||e===n}:function(e){return typeof e=="function"},n0}var r0,RT;function Kl(){if(RT)return r0;RT=1;var n=fr();return r0=function(e){return typeof e=="object"?e!==null:n(e)},r0}var i0,LT;function Im(){if(LT)return i0;LT=1;var n=dr(),e=fr(),t=function(r){return e(r)?r:void 0};return i0=function(r,i){return arguments.length<2?t(n[r]):n[r]&&n[r][i]},i0}var s0,NT;function qj(){if(NT)return s0;NT=1;var n=In();return s0=n({}.isPrototypeOf),s0}var o0,zT;function WF(){if(zT)return o0;zT=1;var n=dr(),e=n.navigator,t=e&&e.userAgent;return o0=t?String(t):"",o0}var a0,FT;function ZF(){if(FT)return a0;FT=1;var n=dr(),e=WF(),t=n.process,r=n.Deno,i=t&&t.versions||r&&r.version,s=i&&i.v8,a,l;return s&&(a=s.split("."),l=a[0]>0&&a[0]<4?1:+(a[0]+a[1])),!l&&e&&(a=e.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=e.match(/Chrome\/(\d+)/),a&&(l=+a[1]))),a0=l,a0}var l0,BT;function Gj(){if(BT)return l0;BT=1;var n=ZF(),e=hr(),t=dr(),r=t.String;return l0=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!r(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&n&&n<41}),l0}var c0,UT;function Yj(){if(UT)return c0;UT=1;var n=Gj();return c0=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol",c0}var u0,$T;function Vj(){if($T)return u0;$T=1;var n=Im(),e=fr(),t=qj(),r=Yj(),i=Object;return u0=r?function(s){return typeof s=="symbol"}:function(s){var a=n("Symbol");return e(a)&&t(a.prototype,i(s))},u0}var d0,HT;function QF(){if(HT)return d0;HT=1;var n=String;return d0=function(e){try{return n(e)}catch{return"Object"}},d0}var h0,KT;function T1(){if(KT)return h0;KT=1;var n=fr(),e=QF(),t=TypeError;return h0=function(r){if(n(r))return r;throw new t(e(r)+" is not a function")},h0}var f0,qT;function I1(){if(qT)return f0;qT=1;var n=T1(),e=Pm();return f0=function(t,r){var i=t[r];return e(i)?void 0:n(i)},f0}var p0,GT;function JF(){if(GT)return p0;GT=1;var n=zo(),e=fr(),t=Kl(),r=TypeError;return p0=function(i,s){var a,l;if(s==="string"&&e(a=i.toString)&&!t(l=n(a,i))||e(a=i.valueOf)&&!t(l=n(a,i))||s!=="string"&&e(a=i.toString)&&!t(l=n(a,i)))return l;throw new r("Can't convert object to primitive value")},p0}var g0={exports:{}},m0,YT;function Xj(){return YT||(YT=1,m0=!1),m0}var y0,VT;function M1(){if(VT)return y0;VT=1;var n=dr(),e=Object.defineProperty;return y0=function(t,r){try{e(n,t,{value:r,configurable:!0,writable:!0})}catch{n[t]=r}return r},y0}var XT;function A1(){if(XT)return g0.exports;XT=1;var n=Xj(),e=dr(),t=M1(),r="__core-js_shared__",i=g0.exports=e[r]||t(r,{});return(i.versions||(i.versions=[])).push({version:"3.40.0",mode:n?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"}),g0.exports}var S0,WT;function k1(){if(WT)return S0;WT=1;var n=A1();return S0=function(e,t){return n[e]||(n[e]=t||{})},S0}var v0,ZT;function Fh(){if(ZT)return v0;ZT=1;var n=vu(),e=Object;return v0=function(t){return e(n(t))},v0}var b0,QT;function Ua(){if(QT)return b0;QT=1;var n=In(),e=Fh(),t=n({}.hasOwnProperty);return b0=Object.hasOwn||function(i,s){return t(e(i),s)},b0}var x0,JT;function Wj(){if(JT)return x0;JT=1;var n=In(),e=0,t=Math.random(),r=n(1 .toString);return x0=function(i){return"Symbol("+(i===void 0?"":i)+")_"+r(++e+t,36)},x0}var w0,eI;function Fo(){if(eI)return w0;eI=1;var n=dr(),e=k1(),t=Ua(),r=Wj(),i=Gj(),s=Yj(),a=n.Symbol,l=e("wks"),u=s?a.for||a:a&&a.withoutSetter||r;return w0=function(d){return t(l,d)||(l[d]=i&&t(a,d)?a[d]:u("Symbol."+d)),l[d]},w0}var _0,tI;function eB(){if(tI)return _0;tI=1;var n=zo(),e=Kl(),t=Vj(),r=I1(),i=JF(),s=Fo(),a=TypeError,l=s("toPrimitive");return _0=function(u,d){if(!e(u)||t(u))return u;var f=r(u,l),g;if(f){if(d===void 0&&(d="default"),g=n(f,u,d),!e(g)||t(g))return g;throw new a("Can't convert object to primitive value")}return d===void 0&&(d="number"),i(u,d)},_0}var C0,nI;function Zj(){if(nI)return C0;nI=1;var n=eB(),e=Vj();return C0=function(t){var r=n(t,"string");return e(r)?r:r+""},C0}var E0,rI;function Qj(){if(rI)return E0;rI=1;var n=dr(),e=Kl(),t=n.document,r=e(t)&&e(t.createElement);return E0=function(i){return r?t.createElement(i):{}},E0}var P0,iI;function Jj(){if(iI)return P0;iI=1;var n=Ba(),e=hr(),t=Qj();return P0=!n&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),P0}var sI;function eO(){if(sI)return Hv;sI=1;var n=Ba(),e=zo(),t=VF(),r=Kj(),i=Tm(),s=Zj(),a=Ua(),l=Jj(),u=Object.getOwnPropertyDescriptor;return Hv.f=n?u:function(f,g){if(f=i(f),g=s(g),l)try{return u(f,g)}catch{}if(a(f,g))return r(!e(t.f,f,g),f[g])},Hv}var T0={},I0,oI;function tO(){if(oI)return I0;oI=1;var n=Ba(),e=hr();return I0=n&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),I0}var M0,aI;function ql(){if(aI)return M0;aI=1;var n=Kl(),e=String,t=TypeError;return M0=function(r){if(n(r))return r;throw new t(e(r)+" is not an object")},M0}var lI;function Bh(){if(lI)return T0;lI=1;var n=Ba(),e=Jj(),t=tO(),r=ql(),i=Zj(),s=TypeError,a=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",f="writable";return T0.f=n?t?function(m,S,b){if(r(m),S=i(S),r(b),typeof m=="function"&&S==="prototype"&&"value"in b&&f in b&&!b[f]){var x=l(m,S);x&&x[f]&&(m[S]=b.value,b={configurable:d in b?b[d]:x[d],enumerable:u in b?b[u]:x[u],writable:!1})}return a(m,S,b)}:a:function(m,S,b){if(r(m),S=i(S),r(b),e)try{return a(m,S,b)}catch{}if("get"in b||"set"in b)throw new s("Accessors not supported");return"value"in b&&(m[S]=b.value),m},T0}var A0,cI;function j1(){if(cI)return A0;cI=1;var n=Ba(),e=Bh(),t=Kj();return A0=n?function(r,i,s){return e.f(r,i,t(1,s))}:function(r,i,s){return r[i]=s,r},A0}var k0={exports:{}},j0,uI;function tB(){if(uI)return j0;uI=1;var n=Ba(),e=Ua(),t=Function.prototype,r=n&&Object.getOwnPropertyDescriptor,i=e(t,"name"),s=i&&(function(){}).name==="something",a=i&&(!n||n&&r(t,"name").configurable);return j0={EXISTS:i,PROPER:s,CONFIGURABLE:a},j0}var O0,dI;function nO(){if(dI)return O0;dI=1;var n=In(),e=fr(),t=A1(),r=n(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(i){return r(i)}),O0=t.inspectSource,O0}var D0,hI;function nB(){if(hI)return D0;hI=1;var n=dr(),e=fr(),t=n.WeakMap;return D0=e(t)&&/native code/.test(String(t)),D0}var R0,fI;function rO(){if(fI)return R0;fI=1;var n=k1(),e=Wj(),t=n("keys");return R0=function(r){return t[r]||(t[r]=e(r))},R0}var L0,pI;function O1(){return pI||(pI=1,L0={}),L0}var N0,gI;function iO(){if(gI)return N0;gI=1;var n=nB(),e=dr(),t=Kl(),r=j1(),i=Ua(),s=A1(),a=rO(),l=O1(),u="Object already initialized",d=e.TypeError,f=e.WeakMap,g,m,S,b=function(E){return S(E)?m(E):g(E,{})},x=function(E){return function(M){var I;if(!t(M)||(I=m(M)).type!==E)throw new d("Incompatible receiver, "+E+" required");return I}};if(n||s.state){var w=s.state||(s.state=new f);w.get=w.get,w.has=w.has,w.set=w.set,g=function(E,M){if(w.has(E))throw new d(u);return M.facade=E,w.set(E,M),M},m=function(E){return w.get(E)||{}},S=function(E){return w.has(E)}}else{var _=a("state");l[_]=!0,g=function(E,M){if(i(E,_))throw new d(u);return M.facade=E,r(E,_,M),M},m=function(E){return i(E,_)?E[_]:{}},S=function(E){return i(E,_)}}return N0={set:g,get:m,has:S,enforce:b,getterFor:x},N0}var mI;function rB(){if(mI)return k0.exports;mI=1;var n=In(),e=hr(),t=fr(),r=Ua(),i=Ba(),s=tB().CONFIGURABLE,a=nO(),l=iO(),u=l.enforce,d=l.get,f=String,g=Object.defineProperty,m=n("".slice),S=n("".replace),b=n([].join),x=i&&!e(function(){return g(function(){},"length",{value:8}).length!==8}),w=String(String).split("String"),_=k0.exports=function(E,M,I){m(f(M),0,7)==="Symbol("&&(M="["+S(f(M),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),I&&I.getter&&(M="get "+M),I&&I.setter&&(M="set "+M),(!r(E,"name")||s&&E.name!==M)&&(i?g(E,"name",{value:M,configurable:!0}):E.name=M),x&&I&&r(I,"arity")&&E.length!==I.arity&&g(E,"length",{value:I.arity});try{I&&r(I,"constructor")&&I.constructor?i&&g(E,"prototype",{writable:!1}):E.prototype&&(E.prototype=void 0)}catch{}var A=u(E);return r(A,"source")||(A.source=b(w,typeof M=="string"?M:"")),E};return Function.prototype.toString=_(function(){return t(this)&&d(this).source||a(this)},"toString"),k0.exports}var z0,yI;function sO(){if(yI)return z0;yI=1;var n=fr(),e=Bh(),t=rB(),r=M1();return z0=function(i,s,a,l){l||(l={});var u=l.enumerable,d=l.name!==void 0?l.name:s;if(n(a)&&t(a,d,l),l.global)u?i[s]=a:r(s,a);else{try{l.unsafe?i[s]&&(u=!0):delete i[s]}catch{}u?i[s]=a:e.f(i,s,{value:a,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return i},z0}var F0={},B0,SI;function iB(){if(SI)return B0;SI=1;var n=Math.ceil,e=Math.floor;return B0=Math.trunc||function(r){var i=+r;return(i>0?e:n)(i)},B0}var U0,vI;function Gl(){if(vI)return U0;vI=1;var n=iB();return U0=function(e){var t=+e;return t!==t||t===0?0:n(t)},U0}var $0,bI;function sB(){if(bI)return $0;bI=1;var n=Gl(),e=Math.max,t=Math.min;return $0=function(r,i){var s=n(r);return s<0?e(s+i,0):t(s,i)},$0}var H0,xI;function oO(){if(xI)return H0;xI=1;var n=Gl(),e=Math.min;return H0=function(t){var r=n(t);return r>0?e(r,9007199254740991):0},H0}var K0,wI;function Uh(){if(wI)return K0;wI=1;var n=oO();return K0=function(e){return n(e.length)},K0}var q0,_I;function oB(){if(_I)return q0;_I=1;var n=Tm(),e=sB(),t=Uh(),r=function(i){return function(s,a,l){var u=n(s),d=t(u);if(d===0)return!i&&-1;var f=e(l,d),g;if(i&&a!==a){for(;d>f;)if(g=u[f++],g!==g)return!0}else for(;d>f;f++)if((i||f in u)&&u[f]===a)return i||f||0;return!i&&-1}};return q0={includes:r(!0),indexOf:r(!1)},q0}var G0,CI;function aO(){if(CI)return G0;CI=1;var n=In(),e=Ua(),t=Tm(),r=oB().indexOf,i=O1(),s=n([].push);return G0=function(a,l){var u=t(a),d=0,f=[],g;for(g in u)!e(i,g)&&e(u,g)&&s(f,g);for(;l.length>d;)e(u,g=l[d++])&&(~r(f,g)||s(f,g));return f},G0}var Y0,EI;function D1(){return EI||(EI=1,Y0=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Y0}var PI;function aB(){if(PI)return F0;PI=1;var n=aO(),e=D1(),t=e.concat("length","prototype");return F0.f=Object.getOwnPropertyNames||function(i){return n(i,t)},F0}var V0={},TI;function lB(){return TI||(TI=1,V0.f=Object.getOwnPropertySymbols),V0}var X0,II;function cB(){if(II)return X0;II=1;var n=Im(),e=In(),t=aB(),r=lB(),i=ql(),s=e([].concat);return X0=n("Reflect","ownKeys")||function(l){var u=t.f(i(l)),d=r.f;return d?s(u,d(l)):u},X0}var W0,MI;function uB(){if(MI)return W0;MI=1;var n=Ua(),e=cB(),t=eO(),r=Bh();return W0=function(i,s,a){for(var l=e(s),u=r.f,d=t.f,f=0;f<l.length;f++){var g=l[f];!n(i,g)&&!(a&&n(a,g))&&u(i,g,d(s,g))}},W0}var Z0,AI;function dB(){if(AI)return Z0;AI=1;var n=hr(),e=fr(),t=/#|\.prototype\./,r=function(u,d){var f=s[i(u)];return f===l?!0:f===a?!1:e(d)?n(d):!!d},i=r.normalize=function(u){return String(u).replace(t,".").toLowerCase()},s=r.data={},a=r.NATIVE="N",l=r.POLYFILL="P";return Z0=r,Z0}var Q0,kI;function bu(){if(kI)return Q0;kI=1;var n=dr(),e=eO().f,t=j1(),r=sO(),i=M1(),s=uB(),a=dB();return Q0=function(l,u){var d=l.target,f=l.global,g=l.stat,m,S,b,x,w,_;if(f?S=n:g?S=n[d]||i(d,{}):S=n[d]&&n[d].prototype,S)for(b in u){if(w=u[b],l.dontCallGetSet?(_=e(S,b),x=_&&_.value):x=S[b],m=a(f?b:d+(g?".":"#")+b,l.forced),!m&&x!==void 0){if(typeof w==typeof x)continue;s(w,x)}(l.sham||x&&x.sham)&&t(w,"sham",!0),r(S,b,w,l)}},Q0}var J0={},eb,jI;function hB(){if(jI)return eb;jI=1;var n=aO(),e=D1();return eb=Object.keys||function(r){return n(r,e)},eb}var OI;function fB(){if(OI)return J0;OI=1;var n=Ba(),e=tO(),t=Bh(),r=ql(),i=Tm(),s=hB();return J0.f=n&&!e?Object.defineProperties:function(l,u){r(l);for(var d=i(u),f=s(u),g=f.length,m=0,S;g>m;)t.f(l,S=f[m++],d[S]);return l},J0}var tb,DI;function pB(){if(DI)return tb;DI=1;var n=Im();return tb=n("document","documentElement"),tb}var nb,RI;function lO(){if(RI)return nb;RI=1;var n=ql(),e=fB(),t=D1(),r=O1(),i=pB(),s=Qj(),a=rO(),l=">",u="<",d="prototype",f="script",g=a("IE_PROTO"),m=function(){},S=function(E){return u+f+l+E+u+"/"+f+l},b=function(E){E.write(S("")),E.close();var M=E.parentWindow.Object;return E=null,M},x=function(){var E=s("iframe"),M="java"+f+":",I;return E.style.display="none",i.appendChild(E),E.src=String(M),I=E.contentWindow.document,I.open(),I.write(S("document.F=Object")),I.close(),I.F},w,_=function(){try{w=new ActiveXObject("htmlfile")}catch{}_=typeof document<"u"?document.domain&&w?b(w):x():b(w);for(var E=t.length;E--;)delete _[d][t[E]];return _()};return r[g]=!0,nb=Object.create||function(M,I){var A;return M!==null?(m[d]=n(M),A=new m,m[d]=null,A[g]=M):A=_(),I===void 0?A:e.f(A,I)},nb}var rb,LI;function R1(){if(LI)return rb;LI=1;var n=Fo(),e=lO(),t=Bh().f,r=n("unscopables"),i=Array.prototype;return i[r]===void 0&&t(i,r,{configurable:!0,value:e(null)}),rb=function(s){i[r][s]=!0},rb}var NI;function gB(){if(NI)return bT;NI=1;var n=bu(),e=Fh(),t=Uh(),r=Gl(),i=R1();return n({target:"Array",proto:!0},{at:function(a){var l=e(this),u=t(l),d=r(a),f=d>=0?d:u+d;return f<0||f>=u?void 0:l[f]}}),i("at"),bT}var ib,zI;function $h(){if(zI)return ib;zI=1;var n=dr(),e=In();return ib=function(t,r){return e(n[t].prototype[r])},ib}var sb,FI;function mB(){if(FI)return sb;FI=1,gB();var n=$h();return sb=n("Array","at"),sb}var ob,BI;function yB(){if(BI)return ob;BI=1;var n=mB();return ob=n,ob}yB();var UI={},ab,$I;function cO(){if($I)return ab;$I=1;var n=Su();return ab=Array.isArray||function(t){return n(t)==="Array"},ab}var lb,HI;function SB(){if(HI)return lb;HI=1;var n=TypeError,e=9007199254740991;return lb=function(t){if(t>e)throw n("Maximum allowed index exceeded");return t},lb}var cb,KI;function vB(){if(KI)return cb;KI=1;var n=Su(),e=In();return cb=function(t){if(n(t)==="Function")return e(t)},cb}var ub,qI;function bB(){if(qI)return ub;qI=1;var n=vB(),e=T1(),t=Em(),r=n(n.bind);return ub=function(i,s){return e(i),s===void 0?i:t?r(i,s):function(){return i.apply(s,arguments)}},ub}var db,GI;function uO(){if(GI)return db;GI=1;var n=cO(),e=Uh(),t=SB(),r=bB(),i=function(s,a,l,u,d,f,g,m){for(var S=d,b=0,x=g?r(g,m):!1,w,_;b<u;)b in l&&(w=x?x(l[b],b,a):l[b],f>0&&n(w)?(_=e(w),S=i(s,a,w,_,S,f-1)-1):(t(S+1),s[S]=w),S++),b++;return S};return db=i,db}var hb,YI;function xB(){if(YI)return hb;YI=1;var n=Fo(),e=n("toStringTag"),t={};return t[e]="z",hb=String(t)==="[object z]",hb}var fb,VI;function dO(){if(VI)return fb;VI=1;var n=xB(),e=fr(),t=Su(),r=Fo(),i=r("toStringTag"),s=Object,a=t(function(){return arguments}())==="Arguments",l=function(u,d){try{return u[d]}catch{}};return fb=n?t:function(u){var d,f,g;return u===void 0?"Undefined":u===null?"Null":typeof(f=l(d=s(u),i))=="string"?f:a?t(d):(g=t(d))==="Object"&&e(d.callee)?"Arguments":g},fb}var pb,XI;function wB(){if(XI)return pb;XI=1;var n=In(),e=hr(),t=fr(),r=dO(),i=Im(),s=nO(),a=function(){},l=i("Reflect","construct"),u=/^\s*(?:class|function)\b/,d=n(u.exec),f=!u.test(a),g=function(b){if(!t(b))return!1;try{return l(a,[],b),!0}catch{return!1}},m=function(b){if(!t(b))return!1;switch(r(b)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!d(u,s(b))}catch{return!0}};return m.sham=!0,pb=!l||e(function(){var S;return g(g.call)||!g(Object)||!g(function(){S=!0})||S})?m:g,pb}var gb,WI;function _B(){if(WI)return gb;WI=1;var n=cO(),e=wB(),t=Kl(),r=Fo(),i=r("species"),s=Array;return gb=function(a){var l;return n(a)&&(l=a.constructor,e(l)&&(l===s||n(l.prototype))?l=void 0:t(l)&&(l=l[i],l===null&&(l=void 0))),l===void 0?s:l},gb}var mb,ZI;function hO(){if(ZI)return mb;ZI=1;var n=_B();return mb=function(e,t){return new(n(e))(t===0?0:t)},mb}var QI;function CB(){if(QI)return UI;QI=1;var n=bu(),e=uO(),t=T1(),r=Fh(),i=Uh(),s=hO();return n({target:"Array",proto:!0},{flatMap:function(l){var u=r(this),d=i(u),f;return t(l),f=s(u,0),f.length=e(f,u,u,d,0,1,l,arguments.length>1?arguments[1]:void 0),f}}),UI}var JI={},eM;function EB(){if(eM)return JI;eM=1;var n=R1();return n("flatMap"),JI}var yb,tM;function PB(){if(tM)return yb;tM=1,CB(),EB();var n=$h();return yb=n("Array","flatMap"),yb}var Sb,nM;function TB(){if(nM)return Sb;nM=1;var n=PB();return Sb=n,Sb}TB();var rM={},iM;function IB(){if(iM)return rM;iM=1;var n=bu(),e=uO(),t=Fh(),r=Uh(),i=Gl(),s=hO();return n({target:"Array",proto:!0},{flat:function(){var l=arguments.length?arguments[0]:void 0,u=t(this),d=r(u),f=s(u,0);return f.length=e(f,u,u,d,0,l===void 0?1:i(l)),f}}),rM}var sM={},oM;function MB(){if(oM)return sM;oM=1;var n=R1();return n("flat"),sM}var vb,aM;function AB(){if(aM)return vb;aM=1,IB(),MB();var n=$h();return vb=n("Array","flat"),vb}var bb,lM;function kB(){if(lM)return bb;lM=1;var n=AB();return bb=n,bb}kB();var cM={},xb,uM;function Hh(){if(uM)return xb;uM=1;var n=dO(),e=String;return xb=function(t){if(n(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},xb}var dM;function jB(){if(dM)return cM;dM=1;var n=bu(),e=In(),t=vu(),r=Gl(),i=Hh(),s=hr(),a=e("".charAt),l=s(function(){return"".at(-2)!=="\uD842"});return n({target:"String",proto:!0,forced:l},{at:function(d){var f=i(t(this)),g=f.length,m=r(d),S=m>=0?m:g+m;return S<0||S>=g?void 0:a(f,S)}}),cM}var wb,hM;function OB(){if(hM)return wb;hM=1,jB();var n=$h();return wb=n("String","at"),wb}var _b,fM;function DB(){if(fM)return _b;fM=1;var n=OB();return _b=n,_b}DB();var pM={},Cb,gM;function fO(){if(gM)return Cb;gM=1;var n=ql();return Cb=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Cb}var Eb,mM;function RB(){if(mM)return Eb;mM=1;var n=hr(),e=dr(),t=e.RegExp,r=n(function(){var a=t("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),i=r||n(function(){return!t("a","y").sticky}),s=r||n(function(){var a=t("^r","gy");return a.lastIndex=2,a.exec("str")!==null});return Eb={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:r},Eb}var Pb,yM;function LB(){if(yM)return Pb;yM=1;var n=hr(),e=dr(),t=e.RegExp;return Pb=n(function(){var r=t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),Pb}var Tb,SM;function NB(){if(SM)return Tb;SM=1;var n=hr(),e=dr(),t=e.RegExp;return Tb=n(function(){var r=t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),Tb}var Ib,vM;function L1(){if(vM)return Ib;vM=1;var n=zo(),e=In(),t=Hh(),r=fO(),i=RB(),s=k1(),a=lO(),l=iO().get,u=LB(),d=NB(),f=s("native-string-replace",String.prototype.replace),g=RegExp.prototype.exec,m=g,S=e("".charAt),b=e("".indexOf),x=e("".replace),w=e("".slice),_=function(){var A=/a/,j=/b*/g;return n(g,A,"a"),n(g,j,"a"),A.lastIndex!==0||j.lastIndex!==0}(),E=i.BROKEN_CARET,M=/()??/.exec("")[1]!==void 0,I=_||M||E||u||d;return I&&(m=function(j){var D=this,R=l(D),q=t(j),L=R.raw,K,G,z,U,Y,H,X;if(L)return L.lastIndex=D.lastIndex,K=n(m,L,q),D.lastIndex=L.lastIndex,K;var V=R.groups,ie=E&&D.sticky,B=n(r,D),re=D.source,me=0,de=q;if(ie&&(B=x(B,"y",""),b(B,"g")===-1&&(B+="g"),de=w(q,D.lastIndex),D.lastIndex>0&&(!D.multiline||D.multiline&&S(q,D.lastIndex-1)!==`
`)&&(re="(?: "+re+")",de=" "+de,me++),G=new RegExp("^(?:"+re+")",B)),M&&(G=new RegExp("^"+re+"$(?!\\s)",B)),_&&(z=D.lastIndex),U=n(g,ie?G:D,de),ie?U?(U.input=w(U.input,me),U[0]=w(U[0],me),U.index=D.lastIndex,D.lastIndex+=U[0].length):D.lastIndex=0:_&&U&&(D.lastIndex=D.global?U.index+U[0].length:z),M&&U&&U.length>1&&n(f,U[0],G,function(){for(Y=1;Y<arguments.length-2;Y++)arguments[Y]===void 0&&(U[Y]=void 0)}),U&&V)for(U.groups=H=a(null),Y=0;Y<V.length;Y++)X=V[Y],H[X[0]]=U[X[1]];return U}),Ib=m,Ib}var bM;function pO(){if(bM)return pM;bM=1;var n=bu(),e=L1();return n({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),pM}var xM={},Mb,wM;function zB(){if(wM)return Mb;wM=1;var n=Em(),e=Function.prototype,t=e.apply,r=e.call;return Mb=typeof Reflect=="object"&&Reflect.apply||(n?r.bind(t):function(){return r.apply(t,arguments)}),Mb}var Ab,_M;function FB(){if(_M)return Ab;_M=1,pO();var n=zo(),e=sO(),t=L1(),r=hr(),i=Fo(),s=j1(),a=i("species"),l=RegExp.prototype;return Ab=function(u,d,f,g){var m=i(u),S=!r(function(){var _={};return _[m]=function(){return 7},""[u](_)!==7}),b=S&&!r(function(){var _=!1,E=/a/;return u==="split"&&(E={},E.constructor={},E.constructor[a]=function(){return E},E.flags="",E[m]=/./[m]),E.exec=function(){return _=!0,null},E[m](""),!_});if(!S||!b||f){var x=/./[m],w=d(m,""[u],function(_,E,M,I,A){var j=E.exec;return j===t||j===l.exec?S&&!A?{done:!0,value:n(x,E,M,I)}:{done:!0,value:n(_,M,E,I)}:{done:!1}});e(String.prototype,u,w[0]),e(l,m,w[1])}g&&s(l[m],"sham",!0)},Ab}var kb,CM;function BB(){if(CM)return kb;CM=1;var n=In(),e=Gl(),t=Hh(),r=vu(),i=n("".charAt),s=n("".charCodeAt),a=n("".slice),l=function(u){return function(d,f){var g=t(r(d)),m=e(f),S=g.length,b,x;return m<0||m>=S?u?"":void 0:(b=s(g,m),b<55296||b>56319||m+1===S||(x=s(g,m+1))<56320||x>57343?u?i(g,m):b:u?a(g,m,m+2):(b-55296<<10)+(x-56320)+65536)}};return kb={codeAt:l(!1),charAt:l(!0)},kb}var jb,EM;function UB(){if(EM)return jb;EM=1;var n=BB().charAt;return jb=function(e,t,r){return t+(r?n(e,t).length:1)},jb}var Ob,PM;function gO(){if(PM)return Ob;PM=1;var n=In(),e=Fh(),t=Math.floor,r=n("".charAt),i=n("".replace),s=n("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;return Ob=function(u,d,f,g,m,S){var b=f+u.length,x=g.length,w=l;return m!==void 0&&(m=e(m),w=a),i(S,w,function(_,E){var M;switch(r(E,0)){case"$":return"$";case"&":return u;case"`":return s(d,0,f);case"'":return s(d,b);case"<":M=m[s(E,1,-1)];break;default:var I=+E;if(I===0)return _;if(I>x){var A=t(I/10);return A===0?_:A<=x?g[A-1]===void 0?r(E,1):g[A-1]+r(E,1):_}M=g[I-1]}return M===void 0?"":M})},Ob}var Db,TM;function $B(){if(TM)return Db;TM=1;var n=zo(),e=ql(),t=fr(),r=Su(),i=L1(),s=TypeError;return Db=function(a,l){var u=a.exec;if(t(u)){var d=n(u,a,l);return d!==null&&e(d),d}if(r(a)==="RegExp")return n(i,a,l);throw new s("RegExp#exec called on incompatible receiver")},Db}var IM;function HB(){if(IM)return xM;IM=1;var n=zB(),e=zo(),t=In(),r=FB(),i=hr(),s=ql(),a=fr(),l=Pm(),u=Gl(),d=oO(),f=Hh(),g=vu(),m=UB(),S=I1(),b=gO(),x=$B(),w=Fo(),_=w("replace"),E=Math.max,M=Math.min,I=t([].concat),A=t([].push),j=t("".indexOf),D=t("".slice),R=function(G){return G===void 0?G:String(G)},q=function(){return"a".replace(/./,"$0")==="$0"}(),L=function(){return/./[_]?/./[_]("a","$0")==="":!1}(),K=!i(function(){var G=/./;return G.exec=function(){var z=[];return z.groups={a:"7"},z},"".replace(G,"$<a>")!=="7"});return r("replace",function(G,z,U){var Y=L?"$":"$0";return[function(X,V){var ie=g(this),B=l(X)?void 0:S(X,_);return B?e(B,X,ie,V):e(z,f(ie),X,V)},function(H,X){var V=s(this),ie=f(H);if(typeof X=="string"&&j(X,Y)===-1&&j(X,"$<")===-1){var B=U(z,V,ie,X);if(B.done)return B.value}var re=a(X);re||(X=f(X));var me=V.global,de;me&&(de=V.unicode,V.lastIndex=0);for(var ye=[],ge;ge=x(V,ie),!(ge===null||(A(ye,ge),!me));){var Ie=f(ge[0]);Ie===""&&(V.lastIndex=m(ie,d(V.lastIndex),de))}for(var Ne="",we=0,Te=0;Te<ye.length;Te++){ge=ye[Te];for(var je=f(ge[0]),He=E(M(u(ge.index),ie.length),0),Ft=[],at,Bt=1;Bt<ge.length;Bt++)A(Ft,R(ge[Bt]));var _t=ge.groups;if(re){var gt=I([je],Ft,He,ie);_t!==void 0&&A(gt,_t),at=f(n(X,void 0,gt))}else at=b(je,ie,He,Ft,_t,X);He>=we&&(Ne+=D(ie,we,He)+at,we=He+je.length)}return Ne+D(ie,we)}]},!K||!q||L),xM}var MM={},Rb,AM;function KB(){if(AM)return Rb;AM=1;var n=Kl(),e=Su(),t=Fo(),r=t("match");return Rb=function(i){var s;return n(i)&&((s=i[r])!==void 0?!!s:e(i)==="RegExp")},Rb}var Lb,kM;function qB(){if(kM)return Lb;kM=1;var n=zo(),e=Ua(),t=qj(),r=fO(),i=RegExp.prototype;return Lb=function(s){var a=s.flags;return a===void 0&&!("flags"in i)&&!e(s,"flags")&&t(i,s)?n(r,s):a},Lb}var jM;function GB(){if(jM)return MM;jM=1;var n=bu(),e=zo(),t=In(),r=vu(),i=fr(),s=Pm(),a=KB(),l=Hh(),u=I1(),d=qB(),f=gO(),g=Fo(),m=Xj(),S=g("replace"),b=TypeError,x=t("".indexOf),w=t("".replace),_=t("".slice),E=Math.max;return n({target:"String",proto:!0},{replaceAll:function(I,A){var j=r(this),D,R,q,L,K,G,z,U,Y,H,X=0,V="";if(!s(I)){if(D=a(I),D&&(R=l(r(d(I))),!~x(R,"g")))throw new b("`.replaceAll` does not allow non-global regexes");if(q=u(I,S),q)return e(q,I,j,A);if(m&&D)return w(l(j),I,A)}for(L=l(j),K=l(I),G=i(A),G||(A=l(A)),z=K.length,U=E(1,z),Y=x(L,K);Y!==-1;)H=G?l(A(K,Y,L)):f(K,L,Y,[],void 0,A),V+=_(L,X,Y)+H,X=Y+z,Y=Y+U>L.length?-1:x(L,K,Y+U);return X<L.length&&(V+=_(L,X)),V}}),MM}var Nb,OM;function YB(){if(OM)return Nb;OM=1,pO(),HB(),GB();var n=$h();return Nb=n("String","replaceAll"),Nb}var zb,DM;function VB(){if(DM)return zb;DM=1;var n=YB();return zb=n,zb}VB();function mO(n){return n&&typeof n=="object"&&"parents"in n}function yO(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}function Bg(n,e){if(n.children.remove(e)&&n.children.isEmpty&&mO(n))for(let t=0,r=n.parents.length;t<r;t++)Bg(n.parents[t],n)}function N1(n,e){if(n.children.add(e)&&mO(n))for(let t=0,r=n.parents.length;t<r;t++)N1(n.parents[t],n)}function SO(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function $a(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const Mo=$a("empty_array",()=>Object.freeze([])),RM=8;class Ug{constructor(){O(this,"arraySize",0);O(this,"array",Array(RM));O(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<RM?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Jr=Symbol.for("com.tldraw.state/RESET_VALUE");class vO{constructor(e){O(this,"index",0);O(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===Jr){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let s=0;s<r;s++){const a=(t-1+r-s)%r,l=i[a];if(!l)return Jr;const[u,d]=l;if(s===0&&e>=d)return[];if(u<=e&&e<d){const f=s+1,g=new Array(f);for(let m=0;m<f;m++)g[m]=i[(a+m)%r][2];return g}}return Jr}}class XB{constructor(e,t){O(this,"offset",0);O(this,"maybeRemoved");this.below=e,this.child=t}}const Kt=$a("capture",()=>({stack:null}));function xp(n){const e=Kt.stack;Kt.stack=null;try{return n()}finally{Kt.stack=e}}function bO(n){Kt.stack=new XB(Kt.stack,n),n.parentSet.clear()}function xO(){const n=Kt.stack;if(Kt.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||Bg(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||Bg(t,n.child)}}function $g(n){if(Kt.stack){if(Kt.stack.child.parentSet.has(n))return;if(Kt.stack.child.parentSet.add(n),Kt.stack.child.isActivelyListening&&N1(n,Kt.stack.child),Kt.stack.offset<Kt.stack.child.parents.length){const t=Kt.stack.child.parents[Kt.stack.offset];t!==n&&(Kt.stack.maybeRemoved?Kt.stack.maybeRemoved.push(t):Kt.stack.maybeRemoved=[t])}Kt.stack.child.parents[Kt.stack.offset]=n,Kt.stack.child.parentEpochs[Kt.stack.offset]=n.lastChangedEpoch,Kt.stack.offset++}}const Pa=-1;class WB{constructor(e,t,r){O(this,"_isActivelyListening",!1);O(this,"lastTraversedEpoch",Pa);O(this,"lastReactedEpoch",Pa);O(this,"_scheduleCount",0);O(this,"parentSet",new Ug);O(this,"parentEpochs",[]);O(this,"parents",[]);O(this,"_scheduleEffect");O(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Ar()){if(this.parents.length&&!yO(this)){this.lastReactedEpoch=Ar();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)N1(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Bg(this.parents[e],this)}execute(){try{bO(this);const e=Ar(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{xO()}}}const xu=$a("EffectScheduler",()=>WB);function js(n,e,t){const r=new xu(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function ZB(n,e,t){const r=new xu(n,e,t);return{scheduler:r,start:i=>{const s=(i==null?void 0:i.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class QB{constructor(e){O(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(St.globalIsReacting)for(const e of this.initialAtomValues.keys())_O(e);else this.isRoot?wO(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){St.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}}const St=$a("transactions",()=>({globalEpoch:Pa+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:Pa+1}));function JB(){return St.reactionEpoch}function Ar(){return St.globalEpoch}function eU(){return St.globalIsReacting}function z1(n,e){e.lastTraversedEpoch!==St.globalEpoch&&(e.lastTraversedEpoch=St.globalEpoch,e instanceof xu?n.add(e):e.children.visit(t=>z1(n,t)))}function wO(n){var t;if(St.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=St.currentTransaction;try{St.currentTransaction=null,St.globalIsReacting=!0,St.reactionEpoch=St.globalEpoch;const r=new Set;for(const s of n)s.children.visit(a=>z1(r,a));for(const s of r)s.maybeScheduleEffect();let i=0;for(;(t=St.cleanupReactors)!=null&&t.size;){if(i++>1e3)throw new Error("Reaction update depth limit exceeded");const s=St.cleanupReactors;St.cleanupReactors=null;for(const a of s)a.maybeScheduleEffect()}}finally{St.cleanupReactors=null,St.globalIsReacting=!1,St.currentTransaction=e}}function tU(n,e){St.currentTransaction?St.currentTransaction.initialAtomValues.has(n)||St.currentTransaction.initialAtomValues.set(n,e):St.globalIsReacting?_O(n):wO([n])}function _O(n){const e=St.cleanupReactors??(St.cleanupReactors=new Set);n.children.visit(t=>z1(e,t))}function nU(){St.globalEpoch++}function rU(n){const e=new QB(St.currentTransaction);St.currentTransaction=e;try{let t,r=!1;try{t=n(()=>r=!0)}catch(i){throw e.abort(),i}return r?e.abort():e.commit(),t}finally{St.currentTransaction=St.currentTransaction.parent}}function Os(n){return St.currentTransaction?n():rU(n)}class iU{constructor(e,t,r){O(this,"isEqual");O(this,"computeDiff");O(this,"lastChangedEpoch",Ar());O(this,"children",new Ug);O(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new vO(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return $g(this),this.current}set(e,t){var i,s;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??SO(this.current,e))return this.current;nU(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Ar(),t??((s=this.computeDiff)==null?void 0:s.call(this,this.current,e,this.lastChangedEpoch,Ar()))??Jr),this.lastChangedEpoch=Ar();const r=this.current;return this.current=e,tU(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return $g(this),e>=this.lastChangedEpoch?Mo:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Jr}}const sU=$a("Atom",()=>iU);function yn(n,e,t){return new sU(n,e,t)}let LM=!1;function oU(){LM||(LM=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const eh=Symbol.for("com.tldraw.state/UNINITIALIZED");function Il(n){return n===eh}const sw=$a("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function th(n,e){return new sw(n,e)}class aU{constructor(e,t,r){O(this,"lastChangedEpoch",Pa);O(this,"lastTraversedEpoch",Pa);O(this,"lastCheckedEpoch",Pa);O(this,"parentSet",new Ug);O(this,"parents",[]);O(this,"parentEpochs",[]);O(this,"children",new Ug);O(this,"historyBuffer");O(this,"state",eh);O(this,"error",null);O(this,"computeDiff");O(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new vO(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??SO}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const t=this.lastChangedEpoch===Pa,r=Ar();if(!t&&(this.lastCheckedEpoch===r||this.isActivelyListening&&eU()&&this.lastTraversedEpoch<JB()||!yO(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{bO(this);const s=this.derive(this.state,this.lastCheckedEpoch),a=s instanceof sw?s.value:s,l=this.state===eh;if(l||!this.isEqual(a,this.state)){if(this.historyBuffer&&!l){const u=s instanceof sw?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Ar(),u??((i=this.computeDiff)==null?void 0:i.call(this,this.state,a,this.lastCheckedEpoch,Ar()))??Jr)}this.lastChangedEpoch=Ar(),this.state=a}return this.error=null,this.lastCheckedEpoch=Ar(),this.state}catch(s){if(this.state!==eh&&(this.state=eh,this.lastChangedEpoch=Ar()),this.lastCheckedEpoch=Ar(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{xO()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{$g(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),$g(this),e>=this.lastChangedEpoch?Mo:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Jr}}const Mm=$a("Computed",()=>aU);function lU(n={},e,t,r){const i=r.value,s=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let a=this[s];return a||(a=new Mm(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:a})),a.get()},r.value[CO]=!0,r}function cU(n={},e,t,r){const i=r.get,s=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let a=this[s];return a||(a=new Mm(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:a})),a.get()},r}function uU(n,e,t){vt(t.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(t.name)),i=function(){let s=this[r];return s||(s=new Mm(String(t.name),e.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()};return i[CO]=!0,i}function NM(n={},e){if(e.length===2){const[t,r]=e;return uU(n,t,r)}else{const[t,r,i]=e;return i.get?(oU(),cU(n,t,r,i)):lU(n,t,r,i)}}const CO="@@__isComputedMethod__@@";function ue(){if(arguments.length===1){const n=arguments[0];return(...e)=>NM(n,e)}else return typeof arguments[0]=="string"?new Mm(arguments[0],arguments[1],arguments[2]):NM(void 0,arguments)}const EO=1,dU=$a("apiVersion",()=>EO);if(dU!==EO)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");Fa("@tldraw/state","3.8.1","esm");function Am(n,e,t=[]){const r=ct.useRef(e);r.current=e;const[i,s,a]=ct.useMemo(()=>{let l=null;const u=g=>(l=g,()=>{l=null}),d=new xu(`useStateTracking(${n})`,()=>{var g;return(g=r.current)==null?void 0:g.call(r)},{scheduleEffect(){l==null||l()}});return[d,u,()=>d.scheduleCount]},[n,...t]);return ct.useSyncExternalStore(s,a,a),ct.useEffect(()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()}),[i]),i.execute()}const zM={apply(n,e,t){return Am(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},hU=Symbol.for("react.memo"),fU=Symbol.for("react.forward_ref");function Bn(n){let e=null;const t=n.$$typeof;return t===hU&&(n=n.type,e=n.compare),t===fU?T.memo(T.forwardRef(new Proxy(n.render,zM))):T.memo(new Proxy(n,zM),e)}function F1(n,e,t){return T.useState(()=>{const r=typeof e=="function"?e():e;return yn(`useAtom(${n})`,r,t)})[0]}function pU(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return T.useMemo(()=>ue(`useComputed(${n})`,e,t),r)}function Ma(n,e,t=Mo){T.useEffect(()=>{const r=new xu(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function oe(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=T.useRef(!0);r.current=!0;const i=T.useMemo(()=>n.length===1?n[0]:ue(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:s,getSnapshot:a}=T.useMemo(()=>({subscribe:l=>js(`useValue(${t})`,()=>{i.get(),l()}),getSnapshot:()=>i.get()}),[i]);return T.useSyncExternalStore(s,a,a)}finally{r.current=!1}}Fa("@tldraw/state-react","3.8.1","esm");const Tn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};function ft(n){return`${ee(n.x)},${ee(n.y)} `}function Or(n,e){return`${ee((n.x+e.x)/2)},${ee((n.y+e.y)/2)} `}const pt=Math.PI,Nt=pt/2,wt=pt*2,gU=Math.sin;function On(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function wp(n,e=1e10){return n?Math.round(n*e)/e:0}function Aa(n,e,t=1e-6){return Math.abs(n-e)<=t}function PO(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return pt*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function Ml(n){return n=n%wt,n<0?n=n+wt:n===0&&(n=0),n}function Kh(n,e){return n=Ml(n),e=Ml(e),n>e&&(e+=wt),e-n}function TO(n,e){return wt-Kh(n,e)}function sg(n,e){const t=(e-n)%wt;return 2*t%wt-t}function ow(n){return(wt+n)%wt}function Hg(n,e){const t=wt/e;let r=Math.floor((ow(n)+t/2)/t)*t%wt;return r<pt&&(r+=wt),r>pt&&(r-=wt),r}function IO(n,e){return n===e||Aa(n%(Math.PI/2)-e%(Math.PI/2),0)}function mU(n){return n*pt/180}function yU(n){return n*180/pt}function jl(n,e,t){return new P(n.x,n.y).add(P.FromAngle(t,e))}function Fb(n,e,t){const r=n/2,i=e/2,s=[];let a=1/0,l=-1/0,u=1/0,d=-1/0;for(let b=0;b<t;b++){const x=wt/t,w=-Nt+b*x,_=r+r*Math.cos(w),E=i+i*Math.sin(w);_<a&&(a=_),E<u&&(u=E),_>l&&(l=_),E>d&&(d=E),s.push(new P(_,E))}const f=l-a,g=d-u,m=n-f,S=e-g;if(m!==0||S!==0)for(let b=0;b<s.length;b++){const x=s[b];x.x=(x.x-a)/f*n,x.y=(x.y-u)/g*e}return s}function Bd(n,e,t,r){return n<r&&t<e}function Qi(n,e,t,r){const i=Math.max(n,t),s=Math.min(e,r);return i<=s?[i,s]:null}function FM(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function ei(n,e){let t=0,r,i;for(let s=0;s<e.length;s++){if(r=e[s],r.x===n.x&&r.y===n.y||(i=e[(s+1)%e.length],P.Dist(n,r)+P.Dist(n,i)===P.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&FM(r,i,n)>0&&(t+=1):i.y<=n.y&&FM(r,i,n)<0&&(t-=1)}return t!==0}function ee(n){return Math.round(n*1e4)/1e4}function Po(n){return Math.round(n*100)/100}const BM=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function _a(n,e,t){return t<0?Kh(n,e):TO(n,e)}function aw(n,e,t,r){let i;if(Math.abs(n)>pt){i=sg(e,r);const s=sg(r,t);return Math.abs(i)<Math.abs(s)?i/n:(n-s)/n}else{i=sg(e,r);const s=i/n;return Math.sign(i)!==Math.sign(n)?Math.abs(s)>.5?1:0:s}}function SU(n,e,t,r){const i=2*((e-n)%wt)%wt-(e-n)%wt;return r?(wt-Math.abs(i))*(t?1:-1):i}function B1(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i=((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,s=((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r;return!Number.isFinite(i)||!Number.isFinite(s)?null:new P(i,s)}function vU(n,e,t,r,i){if(t===null)return[P.From(n),P.From(e)];const s=[],a=P.Angle(t,n),l=P.Angle(t,e),u=Kh(a,l);for(let d=0;d<i;d++){const f=d/(i-1),g=a+u*f,m=jl(t,r,g);s.push(m)}return s}class P{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),s=Math.cos(e);return this.x=t*s-r*i,this.y=t*i+r*s,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,s=Math.sin(t),a=Math.cos(t);return this.x=e.x+(r*a-i*s),this.y=e.y+(r*s+i*a),this}clone(){const{x:e,y:t,z:r}=this;return new P(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=P.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return P.Dpr(this,e)}cpr(e){return P.Cpr(this,e)}len2(){return P.Len2(this)}len(){return P.Len(this)}pry(e){return P.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return P.Uni(this)}tan(e){return P.Tan(this,e)}dist(e){return P.Dist(this,e)}distanceToLineSegment(e,t){return P.DistanceToLineSegment(e,t,this)}slope(e){return P.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return P.Angle(this,e)}toAngle(){return P.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return P.Equals(this,e)}equalsXY(e,t){return P.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return P.ToFixed(this)}toString(){return P.ToString(P.ToFixed(this))}toJson(){return P.ToJson(this)}toArray(){return P.ToArray(this)}static Add(e,t){return new P(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new P(e.x+t,e.y+r)}static Sub(e,t){return new P(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new P(e.x-t,e.y-r)}static AddScalar(e,t){return new P(e.x+t,e.y+t)}static SubScalar(e,t){return new P(e.x-t,e.y-t)}static Div(e,t){return new P(e.x/t,e.y/t)}static Mul(e,t){return new P(e.x*t,e.y*t)}static DivV(e,t){return new P(e.x/t.x,e.y/t.y)}static MulV(e,t){return new P(e.x*t.x,e.y*t.y)}static Neg(e){return new P(-e.x,-e.y)}static Per(e){return new P(e.y,-e.x)}static Abs(e){return new P(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,r){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<r**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new P(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return P.Dpr(e,t)/P.Len(t)}static Uni(e){return P.Div(e,P.Len(e))}static Tan(e,t){return P.Uni(P.Sub(e,t))}static Min(e,t){return new P(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new P(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new P(e,t,r)}static FromArray(e){return new P(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new P(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,s=e.y-t.y,a=Math.sin(r),l=Math.cos(r);return new P(t.x+(i*l-s*a),t.y+(i*a+s*l))}static NearestPointOnLineThroughPoint(e,t,r){return P.Mul(t,P.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){if(P.Equals(e,r)||P.Equals(t,r))return P.From(r);const s=P.Tan(t,e),a=P.Add(e,P.Mul(s,P.Sub(r,e).pry(s)));if(i){if(a.x<Math.min(e.x,t.x))return P.Cast(e.x<t.x?e:t);if(a.x>Math.max(e.x,t.x))return P.Cast(e.x>t.x?e:t);if(a.y<Math.min(e.y,t.y))return P.Cast(e.y<t.y?e:t);if(a.y>Math.max(e.y,t.y))return P.Cast(e.y>t.y?e:t)}return a}static DistanceToLineThroughPoint(e,t,r){return P.Dist(r,P.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return P.Dist(r,P.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof P?e:P.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return P.Sub(t,e).mul(r).add(e)}static Med(e,t){return new P((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=P.Len(e);return new P(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return P.Sub(e,r).mul(t).add(r)}static ToFixed(e){return new P(Po(e.x),Po(e.y))}static ToInt(e){return new P(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,r){return P.Add(e,P.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new P(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new P(0,0);if(t===0)return r;for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new P(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new P(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let s=0;s<r;s++){const a=Tn.easeInQuad(s/(r-1)),l=P.Lrp(e,t,a);l.z=Math.min(1,.5+Math.abs(.5-bU(a))*.65),i.push(l)}return i}static SnapToGrid(e,t=8){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const bU=n=>n<.5?2*n*n:-1+(4-2*n)*n;function MO(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i,handle:s}){let a;switch(s){case"bottom_left":case"bottom_right":case"top_left":case"top_right":{a=Math.max(.01,Math.max(Math.abs(t),Math.abs(r)));break}case"left":case"right":{a=Math.max(.01,Math.abs(t));break}case"bottom":case"top":{a=Math.max(.01,Math.abs(r));break}default:throw mn(s)}const l=new P(0,0);t<0&&(l.x=-(e.width*a)),r<0&&(l.y=-(e.height*a));const{x:u,y:d}=P.Add(i,l.rot(n.rotation));return{x:u,y:d,props:{scale:a*n.props.scale}}}const xU=(n,e)=>e.some(t=>n instanceof t);let UM,$M;function wU(){return UM||(UM=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _U(){return $M||($M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const AO=new WeakMap,lw=new WeakMap,kO=new WeakMap,Bb=new WeakMap,U1=new WeakMap;function CU(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Ao(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&AO.set(t,n)}).catch(()=>{}),U1.set(e,n),e}function EU(n){if(lw.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});lw.set(n,e)}let cw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return lw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||kO.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ao(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function PU(n){cw=n(cw)}function TU(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ub(this),e,...t);return kO.set(r,e.sort?e.sort():[e]),Ao(r)}:_U().includes(n)?function(...e){return n.apply(Ub(this),e),Ao(AO.get(this))}:function(...e){return Ao(n.apply(Ub(this),e))}}function IU(n){return typeof n=="function"?TU(n):(n instanceof IDBTransaction&&EU(n),xU(n,wU())?new Proxy(n,cw):n)}function Ao(n){if(n instanceof IDBRequest)return CU(n);if(Bb.has(n))return Bb.get(n);const e=IU(n);return e!==n&&(Bb.set(n,e),U1.set(e,n)),e}const Ub=n=>U1.get(n);function jO(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),l=Ao(a);return r&&a.addEventListener("upgradeneeded",u=>{r(Ao(a.result),u.oldVersion,u.newVersion,Ao(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}function OO(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ao(t).then(()=>{})}const MU=["get","getKey","getAll","getAllKeys","count"],AU=["put","add","delete","clear"],$b=new Map;function HM(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if($b.get(e))return $b.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=AU.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||MU.includes(t)))return;const s=async function(a,...l){const u=this.transaction(a,i?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),i&&u.done]))[0]};return $b.set(e,s),s}PU(n=>({...n,get:(e,t,r)=>HM(e,t)||n.get(e,t,r),has:(e,t)=>!!HM(e,t)||n.has(e,t)}));const kU="TLDRAW_DOCUMENT_v2",jU="TLDRAW_ASSET_STORE_v1",DO="TLDRAW_DB_NAME_INDEX_v2",it={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function RO(n){const e=kU+n;return DU(e),await jO(e,4,{upgrade(t){t.objectStoreNames.contains(it.Records)||t.createObjectStore(it.Records),t.objectStoreNames.contains(it.Schema)||t.createObjectStore(it.Schema),t.objectStoreNames.contains(it.SessionState)||t.createObjectStore(it.SessionState),t.objectStoreNames.contains(it.Assets)||t.createObjectStore(it.Assets)}})}async function OU(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(m=>m.name):$1(),t=jU+n;if(!e.find(m=>m===t))return;const i=await jO(t,1,{upgrade(m){m.objectStoreNames.contains("assets")||m.createObjectStore("assets")}});if(!i.objectStoreNames.contains("assets"))return;const s=i.transaction(["assets"],"readonly"),a=s.objectStore("assets"),l=await a.getAllKeys(),u=await Promise.all(l.map(async m=>[m,await a.get(m)]));await s.done;const d=await RO(n),f=d.transaction([it.Assets],"readwrite"),g=f.objectStore(it.Assets);for(const[m,S]of u)g.put(S,m);await f.done,i.close(),d.close(),await OO(t)}const vh=class vh{constructor(e){O(this,"getDbPromise");O(this,"isClosed",!1);O(this,"pendingTransactionSet",new Set);vh.connectedInstances.add(this),this.getDbPromise=(async()=>(await OU(e),await RO(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(bh)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),vh.connectedInstances.delete(this))}tx(e,t,r){const i=(async()=>{vt(!this.isClosed,"db is closed");const a=(await this.getDb()).transaction(t,e),l=a.done.catch(u=>{if(!this.isClosed)throw u});try{return await r(a)}finally{this.isClosed?a.abort():await l}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[it.Records,it.Schema,it.SessionState],async t=>{var u,d;const r=t.objectStore(it.Records),i=t.objectStore(it.Schema),s=t.objectStore(it.SessionState);let a=e?(u=await s.get(e))==null?void 0:u.snapshot:null;return a||(a=(d=(await s.getAll()).sort((g,m)=>g.updatedAt-m.updatedAt).pop())==null?void 0:d.snapshot),{records:await r.getAll(),schema:await i.get(it.Schema),sessionStateSnapshot:a}})}async storeChanges({schema:e,changes:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[it.Records,it.Schema,it.SessionState],async s=>{const a=s.objectStore(it.Records),l=s.objectStore(it.Schema),u=s.objectStore(it.SessionState);for(const[d,f]of Object.entries(t.added))await a.put(f,d);for(const[d,f]of Object.values(t.updated))await a.put(f,f.id);for(const d of Object.keys(t.removed))await a.delete(d);l.put(e.serialize(),it.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[it.Records,it.Schema,it.SessionState],async s=>{const a=s.objectStore(it.Records),l=s.objectStore(it.Schema),u=s.objectStore(it.SessionState);await a.clear();for(const[d,f]of Object.entries(t))await a.put(f,d);l.put(e.serialize(),it.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[it.SessionState],async e=>{const t=e.objectStore(it.SessionState),r=(await t.getAll()).sort((s,a)=>s.updatedAt-a.updatedAt);if(r.length<10){await e.done;return}const i=r.slice(0,r.length-10);for(const{id:s}of i)await t.delete(s)})}async getAsset(e){return await this.tx("readonly",[it.Assets],async t=>await t.objectStore(it.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[it.Assets],async r=>{await r.objectStore(it.Assets).put(t,e)})}};O(vh,"connectedInstances",new Set);let Kg=vh;function $1(){const n=JSON.parse(C1(DO)||"[]")??[];return Array.isArray(n)?n:[]}function DU(n){const e=new Set($1());e.add(n),E1(DO,JSON.stringify([...e]))}class og{constructor(e){O(this,"nextValue");O(this,"diff");this.previousValue=e}get(){var r,i,s,a;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((a=(s=this.diff)==null?void 0:s.added)==null?void 0:a.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,s,a;const t=this.previousValue.has(e);if(t)return((s=(i=this.diff)==null?void 0:i.removed)==null?void 0:s.has(e))?this._add(e,t):void 0;(a=this.nextValue)!=null&&a.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,s,a,l;const t=this.previousValue.has(e);if(!t)return((s=(i=this.diff)==null?void 0:i.added)==null?void 0:s.has(e))?this._remove(e,t):void 0;(l=(a=this.diff)==null?void 0:a.removed)!=null&&l.has(e)||this._remove(e,t)}}class km{constructor(e,t){O(this,"createDefaultProperties");O(this,"validator");O(this,"ephemeralKeys");O(this,"ephemeralKeySet");O(this,"scope");this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:i=>i},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[i,s]of Nr(t.ephemeralKeys))s&&r.add(i);this.ephemeralKeySet=r}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...$t(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Ct())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new km(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function Hs(n,e){return new km(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function qg(){return{added:{},updated:{},removed:{}}}function uw(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,r]of Object.values(n.updated))e.updated[t.id]=[r,t];return e}function LO(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function H1(n){const e={added:{},removed:{},updated:{}};return dh(e,n),e}function dh(n,e){for(const t of e){for(const[r,i]of Nr(t.added))if(n.removed[r]){const s=n.removed[r];delete n.removed[r],s!==i&&(n.updated[r]=[s,i])}else n.added[r]=i;for(const[r,[i,s]]of Nr(t.updated)){if(n.added[r]){n.added[r]=s,delete n.updated[r],delete n.removed[r];continue}if(n.updated[r]){n.updated[r]=[n.updated[r][0],s],delete n.removed[r];continue}n.updated[r]=t.updated[r],delete n.removed[r]}for(const[r,i]of Nr(t.removed))n.added[r]?delete n.added[r]:n.updated[r]?(n.removed[r]=n.updated[r][0],delete n.updated[r]):n.removed[r]=i}}var nh={exports:{}};nh.exports;var KM;function RU(){return KM||(KM=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,a=9007199254740991,l="[object Arguments]",u="[object Array]",d="[object AsyncFunction]",f="[object Boolean]",g="[object Date]",m="[object Error]",S="[object Function]",b="[object GeneratorFunction]",x="[object Map]",w="[object Number]",_="[object Null]",E="[object Object]",M="[object Promise]",I="[object Proxy]",A="[object RegExp]",j="[object Set]",D="[object String]",R="[object Symbol]",q="[object Undefined]",L="[object WeakMap]",K="[object ArrayBuffer]",G="[object DataView]",z="[object Float32Array]",U="[object Float64Array]",Y="[object Int8Array]",H="[object Int16Array]",X="[object Int32Array]",V="[object Uint8Array]",ie="[object Uint8ClampedArray]",B="[object Uint16Array]",re="[object Uint32Array]",me=/[\\^$.*+?()[\]{}|]/g,de=/^\[object .+?Constructor\]$/,ye=/^(?:0|[1-9]\d*)$/,ge={};ge[z]=ge[U]=ge[Y]=ge[H]=ge[X]=ge[V]=ge[ie]=ge[B]=ge[re]=!0,ge[l]=ge[u]=ge[K]=ge[f]=ge[G]=ge[g]=ge[m]=ge[S]=ge[x]=ge[w]=ge[E]=ge[A]=ge[j]=ge[D]=ge[L]=!1;var Ie=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,Ne=typeof self=="object"&&self&&self.Object===Object&&self,we=Ie||Ne||Function("return this")(),Te=e&&!e.nodeType&&e,je=Te&&!0&&n&&!n.nodeType&&n,He=je&&je.exports===Te,Ft=He&&Ie.process,at=function(){try{return Ft&&Ft.binding&&Ft.binding("util")}catch{}}(),Bt=at&&at.isTypedArray;function _t(F,W){for(var fe=-1,Pe=F==null?0:F.length,xt=0,Ve=[];++fe<Pe;){var Ot=F[fe];W(Ot,fe,F)&&(Ve[xt++]=Ot)}return Ve}function gt(F,W){for(var fe=-1,Pe=W.length,xt=F.length;++fe<Pe;)F[xt+fe]=W[fe];return F}function Sr(F,W){for(var fe=-1,Pe=F==null?0:F.length;++fe<Pe;)if(W(F[fe],fe,F))return!0;return!1}function Hn(F,W){for(var fe=-1,Pe=Array(F);++fe<F;)Pe[fe]=W(fe);return Pe}function vr(F){return function(W){return F(W)}}function ci(F,W){return F.has(W)}function Vs(F,W){return F==null?void 0:F[W]}function Ou(F){var W=-1,fe=Array(F.size);return F.forEach(function(Pe,xt){fe[++W]=[xt,Pe]}),fe}function Du(F,W){return function(fe){return F(W(fe))}}function br(F){var W=-1,fe=Array(F.size);return F.forEach(function(Pe){fe[++W]=Pe}),fe}var Ru=Array.prototype,Wl=Function.prototype,Xs=Object.prototype,Ni=we["__core-js_shared__"],Zl=Wl.toString,ae=Xs.hasOwnProperty,xe=function(){var F=/[^.]+$/.exec(Ni&&Ni.keys&&Ni.keys.IE_PROTO||"");return F?"Symbol(src)_1."+F:""}(),Ue=Xs.toString,bt=RegExp("^"+Zl.call(ae).replace(me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=He?we.Buffer:void 0,xr=we.Symbol,wr=we.Uint8Array,Yt=Xs.propertyIsEnumerable,zi=Ru.splice,ui=xr?xr.toStringTag:void 0,Fi=Object.getOwnPropertySymbols,di=Gt?Gt.isBuffer:void 0,Ws=Du(Object.keys,Object),Bi=$r(we,"DataView"),fs=$r(we,"Map"),Zs=$r(we,"Promise"),Lu=$r(we,"Set"),Ql=$r(we,"WeakMap"),Ko=$r(Object,"create"),Nu=qi(Bi),Wa=qi(fs),ky=qi(Zs),ff=qi(Lu),pf=qi(Ql),zu=xr?xr.prototype:void 0,Jl=zu?zu.valueOf:void 0;function Qs(F){var W=-1,fe=F==null?0:F.length;for(this.clear();++W<fe;){var Pe=F[W];this.set(Pe[0],Pe[1])}}function ps(){this.__data__=Ko?Ko(null):{},this.size=0}function xn(F){var W=this.has(F)&&delete this.__data__[F];return this.size-=W?1:0,W}function Kn(F){var W=this.__data__;if(Ko){var fe=W[F];return fe===r?void 0:fe}return ae.call(W,F)?W[F]:void 0}function qo(F){var W=this.__data__;return Ko?W[F]!==void 0:ae.call(W,F)}function Fu(F,W){var fe=this.__data__;return this.size+=this.has(F)?0:1,fe[F]=Ko&&W===void 0?r:W,this}Qs.prototype.clear=ps,Qs.prototype.delete=xn,Qs.prototype.get=Kn,Qs.prototype.has=qo,Qs.prototype.set=Fu;function Ui(F){var W=-1,fe=F==null?0:F.length;for(this.clear();++W<fe;){var Pe=F[W];this.set(Pe[0],Pe[1])}}function jy(){this.__data__=[],this.size=0}function gf(F){var W=this.__data__,fe=Mn(W,F);if(fe<0)return!1;var Pe=W.length-1;return fe==Pe?W.pop():zi.call(W,fe,1),--this.size,!0}function Za(F){var W=this.__data__,fe=Mn(W,F);return fe<0?void 0:W[fe][1]}function Bu(F){return Mn(this.__data__,F)>-1}function Js(F,W){var fe=this.__data__,Pe=Mn(fe,F);return Pe<0?(++this.size,fe.push([F,W])):fe[Pe][1]=W,this}Ui.prototype.clear=jy,Ui.prototype.delete=gf,Ui.prototype.get=Za,Ui.prototype.has=Bu,Ui.prototype.set=Js;function _r(F){var W=-1,fe=F==null?0:F.length;for(this.clear();++W<fe;){var Pe=F[W];this.set(Pe[0],Pe[1])}}function Qa(){this.size=0,this.__data__={hash:new Qs,map:new(fs||Ui),string:new Qs}}function Go(F){var W=tl(this,F).delete(F);return this.size-=W?1:0,W}function hn(F){return tl(this,F).get(F)}function mf(F){return tl(this,F).has(F)}function yf(F,W){var fe=tl(this,F),Pe=fe.size;return fe.set(F,W),this.size+=fe.size==Pe?0:1,this}_r.prototype.clear=Qa,_r.prototype.delete=Go,_r.prototype.get=hn,_r.prototype.has=mf,_r.prototype.set=yf;function hi(F){var W=-1,fe=F==null?0:F.length;for(this.__data__=new _r;++W<fe;)this.add(F[W])}function Yo(F){return this.__data__.set(F,r),this}function $i(F){return this.__data__.has(F)}hi.prototype.add=hi.prototype.push=Yo,hi.prototype.has=$i;function gs(F){var W=this.__data__=new Ui(F);this.size=W.size}function Sf(){this.__data__=new Ui,this.size=0}function vf(F){var W=this.__data__,fe=W.delete(F);return this.size=W.size,fe}function Oy(F){return this.__data__.get(F)}function ec(F){return this.__data__.has(F)}function tc(F,W){var fe=this.__data__;if(fe instanceof Ui){var Pe=fe.__data__;if(!fs||Pe.length<t-1)return Pe.push([F,W]),this.size=++fe.size,this;fe=this.__data__=new _r(Pe)}return fe.set(F,W),this.size=fe.size,this}gs.prototype.clear=Sf,gs.prototype.delete=vf,gs.prototype.get=Oy,gs.prototype.has=ec,gs.prototype.set=tc;function Hi(F,W){var fe=nl(F),Pe=!fe&&Xo(F),xt=!fe&&!Pe&&ic(F),Ve=!fe&&!Pe&&!xt&&il(F),Ot=fe||Pe||xt||Ve,en=Ot?Hn(F.length,String):[],Vt=en.length;for(var Et in F)ae.call(F,Et)&&!(Ot&&(Et=="length"||xt&&(Et=="offset"||Et=="parent")||Ve&&(Et=="buffer"||Et=="byteLength"||Et=="byteOffset")||Gu(Et,Vt)))&&en.push(Et);return en}function Mn(F,W){for(var fe=F.length;fe--;)if(eo(F[fe][0],W))return fe;return-1}function bf(F,W,fe){var Pe=W(F);return nl(F)?Pe:gt(Pe,fe(F))}function Ja(F){return F==null?F===void 0?q:_:ui&&ui in Object(F)?Ry(F):Yu(F)}function el(F){return to(F)&&Ja(F)==l}function Uu(F,W,fe,Pe,xt){return F===W?!0:F==null||W==null||!to(F)&&!to(W)?F!==F&&W!==W:nc(F,W,fe,Pe,Uu,xt)}function nc(F,W,fe,Pe,xt,Ve){var Ot=nl(F),en=nl(W),Vt=Ot?u:Ki(F),Et=en?u:Ki(W);Vt=Vt==l?E:Vt,Et=Et==l?E:Et;var qn=Vt==E,Hr=Et==E,wn=Vt==Et;if(wn&&ic(F)){if(!ic(W))return!1;Ot=!0,qn=!1}if(wn&&!qn)return Ve||(Ve=new gs),Ot||il(F)?Hu(F,W,fe,Pe,xt,Ve):Ku(F,W,Vt,fe,Pe,xt,Ve);if(!(fe&i)){var Er=qn&&ae.call(F,"__wrapped__"),Gn=Hr&&ae.call(W,"__wrapped__");if(Er||Gn){var ms=Er?F.value():F,Yi=Gn?W.value():W;return Ve||(Ve=new gs),xt(ms,Yi,fe,Pe,Ve)}}return wn?(Ve||(Ve=new gs),Vo(F,W,fe,Pe,xt,Ve)):!1}function Dy(F){if(!Gi(F)||Ny(F))return!1;var W=sc(F)?bt:de;return W.test(qi(F))}function Cr(F){return to(F)&&Wo(F.length)&&!!ge[Ja(F)]}function $u(F){if(!rc(F))return Ws(F);var W=[];for(var fe in Object(F))ae.call(F,fe)&&fe!="constructor"&&W.push(fe);return W}function Hu(F,W,fe,Pe,xt,Ve){var Ot=fe&i,en=F.length,Vt=W.length;if(en!=Vt&&!(Ot&&Vt>en))return!1;var Et=Ve.get(F);if(Et&&Ve.get(W))return Et==W;var qn=-1,Hr=!0,wn=fe&s?new hi:void 0;for(Ve.set(F,W),Ve.set(W,F);++qn<en;){var Er=F[qn],Gn=W[qn];if(Pe)var ms=Ot?Pe(Gn,Er,qn,W,F,Ve):Pe(Er,Gn,qn,F,W,Ve);if(ms!==void 0){if(ms)continue;Hr=!1;break}if(wn){if(!Sr(W,function(Yi,no){if(!ci(wn,no)&&(Er===Yi||xt(Er,Yi,fe,Pe,Ve)))return wn.push(no)})){Hr=!1;break}}else if(!(Er===Gn||xt(Er,Gn,fe,Pe,Ve))){Hr=!1;break}}return Ve.delete(F),Ve.delete(W),Hr}function Ku(F,W,fe,Pe,xt,Ve,Ot){switch(fe){case G:if(F.byteLength!=W.byteLength||F.byteOffset!=W.byteOffset)return!1;F=F.buffer,W=W.buffer;case K:return!(F.byteLength!=W.byteLength||!Ve(new wr(F),new wr(W)));case f:case g:case w:return eo(+F,+W);case m:return F.name==W.name&&F.message==W.message;case A:case D:return F==W+"";case x:var en=Ou;case j:var Vt=Pe&i;if(en||(en=br),F.size!=W.size&&!Vt)return!1;var Et=Ot.get(F);if(Et)return Et==W;Pe|=s,Ot.set(F,W);var qn=Hu(en(F),en(W),Pe,xt,Ve,Ot);return Ot.delete(F),qn;case R:if(Jl)return Jl.call(F)==Jl.call(W)}return!1}function Vo(F,W,fe,Pe,xt,Ve){var Ot=fe&i,en=qu(F),Vt=en.length,Et=qu(W),qn=Et.length;if(Vt!=qn&&!Ot)return!1;for(var Hr=Vt;Hr--;){var wn=en[Hr];if(!(Ot?wn in W:ae.call(W,wn)))return!1}var Er=Ve.get(F);if(Er&&Ve.get(W))return Er==W;var Gn=!0;Ve.set(F,W),Ve.set(W,F);for(var ms=Ot;++Hr<Vt;){wn=en[Hr];var Yi=F[wn],no=W[wn];if(Pe)var _f=Ot?Pe(no,Yi,wn,W,F,Ve):Pe(Yi,no,wn,F,W,Ve);if(!(_f===void 0?Yi===no||xt(Yi,no,fe,Pe,Ve):_f)){Gn=!1;break}ms||(ms=wn=="constructor")}if(Gn&&!ms){var lc=F.constructor,sl=W.constructor;lc!=sl&&"constructor"in F&&"constructor"in W&&!(typeof lc=="function"&&lc instanceof lc&&typeof sl=="function"&&sl instanceof sl)&&(Gn=!1)}return Ve.delete(F),Ve.delete(W),Gn}function qu(F){return bf(F,wf,xf)}function tl(F,W){var fe=F.__data__;return Ly(W)?fe[typeof W=="string"?"string":"hash"]:fe.map}function $r(F,W){var fe=Vs(F,W);return Dy(fe)?fe:void 0}function Ry(F){var W=ae.call(F,ui),fe=F[ui];try{F[ui]=void 0;var Pe=!0}catch{}var xt=Ue.call(F);return Pe&&(W?F[ui]=fe:delete F[ui]),xt}var xf=Fi?function(F){return F==null?[]:(F=Object(F),_t(Fi(F),function(W){return Yt.call(F,W)}))}:oc,Ki=Ja;(Bi&&Ki(new Bi(new ArrayBuffer(1)))!=G||fs&&Ki(new fs)!=x||Zs&&Ki(Zs.resolve())!=M||Lu&&Ki(new Lu)!=j||Ql&&Ki(new Ql)!=L)&&(Ki=function(F){var W=Ja(F),fe=W==E?F.constructor:void 0,Pe=fe?qi(fe):"";if(Pe)switch(Pe){case Nu:return G;case Wa:return x;case ky:return M;case ff:return j;case pf:return L}return W});function Gu(F,W){return W=W??a,!!W&&(typeof F=="number"||ye.test(F))&&F>-1&&F%1==0&&F<W}function Ly(F){var W=typeof F;return W=="string"||W=="number"||W=="symbol"||W=="boolean"?F!=="__proto__":F===null}function Ny(F){return!!xe&&xe in F}function rc(F){var W=F&&F.constructor,fe=typeof W=="function"&&W.prototype||Xs;return F===fe}function Yu(F){return Ue.call(F)}function qi(F){if(F!=null){try{return Zl.call(F)}catch{}try{return F+""}catch{}}return""}function eo(F,W){return F===W||F!==F&&W!==W}var Xo=el(function(){return arguments}())?el:function(F){return to(F)&&ae.call(F,"callee")&&!Yt.call(F,"callee")},nl=Array.isArray;function Vu(F){return F!=null&&Wo(F.length)&&!sc(F)}var ic=di||ac;function rl(F,W){return Uu(F,W)}function sc(F){if(!Gi(F))return!1;var W=Ja(F);return W==S||W==b||W==d||W==I}function Wo(F){return typeof F=="number"&&F>-1&&F%1==0&&F<=a}function Gi(F){var W=typeof F;return F!=null&&(W=="object"||W=="function")}function to(F){return F!=null&&typeof F=="object"}var il=Bt?vr(Bt):Cr;function wf(F){return Vu(F)?Hi(F):$u(F)}function oc(){return[]}function ac(){return!1}n.exports=rl}(nh,nh.exports)),nh.exports}var LU=RU();const NO=za(LU);function NU(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(s=>s.has(i))&&r.add(i);return r}function zU(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function qM(n,e){for(const[t,r]of Object.entries(n)){const i=r,s=e[t];if("eq"in i&&s!==i.eq||"neq"in i&&s===i.neq||"gt"in i&&(typeof s!="number"||s<=i.gt))return!1}return!0}function GM(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,s]of Object.entries(t))if("eq"in s){const l=n.index(e,i).get().get(s.eq);if(l)for(const u of l)r[i].add(u)}else if("neq"in s){const a=n.index(e,i);for(const[l,u]of a.get())if(l!==s.neq)for(const d of u)r[i].add(d)}else if("gt"in s){const a=n.index(e,i);for(const[l,u]of a.get())if(l>s.gt)for(const d of u)r[i].add(d)}return NU(Object.values(r))}class FU{constructor(e,t){O(this,"indexCache",new Map);O(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=ue("filterHistory:"+e,(r,i)=>{if(Il(r))return this.history.get();const s=this.history.getDiffSince(i);if(s===Jr)return this.history.get();const a={added:{},removed:{},updated:{}};let l=0,u=0,d=0;for(const f of s){for(const g of Zt(f.added))if(g.typeName===e)if(a.removed[g.id]){const m=a.removed[g.id];delete a.removed[g.id],u--,m!==g&&(a.updated[g.id]=[m,g],d++)}else a.added[g.id]=g,l++;for(const[g,m]of Zt(f.updated))m.typeName===e&&(a.added[m.id]?a.added[m.id]=m:a.updated[m.id]?a.updated[m.id]=[a.updated[m.id][0],m]:(a.updated[m.id]=[g,m],d++));for(const g of Zt(f.removed))g.typeName===e&&(a.added[g.id]?(delete a.added[g.id],l--):a.updated[g.id]?(a.removed[g.id]=a.updated[g.id][0],delete a.updated[g.id],d--,u++):(a.removed[g.id]=g,u++))}return l||u||d?th(this.history.get(),a):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const s=new Map;for(const a of Zt(this.atoms.get())){const l=a.get();if(l.typeName===e){const u=l[t];s.has(u)||s.set(u,new Set),s.get(u).add(l.id)}}return s};return ue("index:"+e+":"+t,(s,a)=>{if(Il(s))return i();const l=r.getDiffSince(a);if(l===Jr)return i();const u=new Map,d=(S,b)=>{let x=u.get(S);x||(x=new og(s.get(S)??new Set)),x.add(b),u.set(S,x)},f=(S,b)=>{let x=u.get(S);x||(x=new og(s.get(S)??new Set)),x.remove(b),u.set(S,x)};for(const S of l){for(const b of Zt(S.added))if(b.typeName===e){const x=b[t];d(x,b.id)}for(const[b,x]of Zt(S.updated))if(x.typeName===e){const w=b[t],_=x[t];w!==_&&(f(w,x.id),d(_,x.id))}for(const b of Zt(S.removed))if(b.typeName===e){const x=b[t];f(x,b.id)}}let g,m;for(const[S,b]of u){const x=b.get();x&&(g||(g=new Map(s)),m||(m=new Map),x.value.size===0?g.delete(S):g.set(S,x.value),m.set(S,x.diff))}return g&&m?th(g,m):s},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return ue(r,()=>{var s;for(const a of i.get())return(s=this.atoms.get()[a])==null?void 0:s.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return ue(r,()=>{const s=this.atoms.get();return[...i.get()].map(a=>{const l=s[a];if(!l)throw new Error("no atom found for record id: "+a);return l.get()})},{isEqual:xj})}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const u=t();return Object.keys(u).length===0?new Set(Zt(this.atoms.get()).flatMap(d=>{const f=d.get();return f.typeName===e?f.id:[]})):GM(this,e,u)},a=u=>{const d=s(),f=zU(u,d);return f?th(d,f):u},l=ue("ids_query:"+r,t,{isEqual:NO});return ue("query:"+r,(u,d)=>{const f=l.get();if(Il(u))return s();if(d<l.lastChangedEpoch)return a(u);const g=i.getDiffSince(d);if(g===Jr)return a(u);const m=new og(u);for(const b of g){for(const x of Zt(b.added))x.typeName===e&&qM(f,x)&&m.add(x.id);for(const[x,w]of Zt(b.updated))w.typeName===e&&(qM(f,w)?m.add(w.id):m.remove(w.id));for(const x of Zt(b.removed))x.typeName===e&&m.remove(x.id)}const S=m.get();return S?th(S.value,S.diff):u},{historyLength:50})}exec(e,t){const r=GM(this,e,t);if(r.size===0)return Mo;const i=this.atoms.get();return[...r].map(s=>i[s].get())}}class BU{constructor(e){O(this,"_beforeCreateHandlers",{});O(this,"_afterCreateHandlers",{});O(this,"_beforeChangeHandlers",{});O(this,"_afterChangeHandlers",{});O(this,"_beforeDeleteHandlers",{});O(this,"_afterDeleteHandlers",{});O(this,"_operationCompleteHandlers",[]);O(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let i=e;for(const s of r)i=s(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleBeforeChange(e,t,r){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let s=t;for(const a of i)s=a(e,s,r);return s}return t}handleAfterChange(e,t,r){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const s of i)s(e,t,r)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const i of r)if(i(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[r,i]of Object.entries(e))i!=null&&i.beforeCreate&&t.push(this.registerBeforeCreateHandler(r,i.beforeCreate)),i!=null&&i.afterCreate&&t.push(this.registerAfterCreateHandler(r,i.afterCreate)),i!=null&&i.beforeChange&&t.push(this.registerBeforeChangeHandler(r,i.beforeChange)),i!=null&&i.afterChange&&t.push(this.registerAfterChangeHandler(r,i.afterChange)),i!=null&&i.beforeDelete&&t.push(this.registerBeforeDeleteHandler(r,i.beforeDelete)),i!=null&&i.afterDelete&&t.push(this.registerAfterDeleteHandler(r,i.afterDelete));return()=>{for(const r of t)r()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Cl(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Cl(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Cl(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Cl(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Cl(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Cl(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Cl(this._operationCompleteHandlers,e)}}function Cl(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class K1{constructor(e){O(this,"id");O(this,"atoms",yn("store_atoms",{}));O(this,"history",yn("history",0,{historyLength:1e3}));O(this,"query",new FU(this.atoms,this.history));O(this,"listeners",new Set);O(this,"historyAccumulator",new $U);O(this,"historyReactor");O(this,"schema");O(this,"props");O(this,"scopedTypes");O(this,"sideEffects",new BU(this));O(this,"isMergingRemoteChanges",!1);O(this,"_integrityChecker");O(this,"_isPossiblyCorrupted",!1);O(this,"pendingAfterEvents",null);O(this,"_isInAtomicOp",!1);const{initialData:t,schema:r,id:i}=e;this.id=i??Ct(),this.schema=r,this.props=e.props,t&&this.atoms.set(b1(Nr(t).map(([s,a])=>[s,yn("atom:"+s,this.schema.validateRecord(this,a,"initialize",null))]))),this.historyReactor=ZB("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=$j(s)}),this.scopedTypes={document:new Set(Zt(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(Zt(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(Zt(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,s=null,a=null;for(const{onHistory:l,filters:u}of this.listeners)if(!(u.source!=="all"&&u.source!==r))if(u.scope!=="all")if(u.scope==="document"){if(s??(s=this.filterChangesByScope(t,"document")),!s)continue;l({changes:s,source:r})}else if(u.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;l({changes:i,source:r})}else{if(a??(a=this.filterChangesByScope(t,"presence")),!a)continue;l({changes:a,source:r})}else l({changes:t,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const r={added:uh(e.added,(i,s)=>this.scopedTypes[t].has(s.typeName)),updated:uh(e.updated,(i,s)=>this.scopedTypes[t].has(s[1].typeName)),removed:uh(e.removed,(i,s)=>this.scopedTypes[t].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const r={},i={},s=this.atoms.__unsafe__getWithoutCapture();let a=null,l,u=!1;const d=this.isMergingRemoteChanges?"remote":"user";for(let f=0,g=e.length;f<g;f++){l=e[f];const m=(a??s)[l.id];if(m){const S=m.__unsafe__getWithoutCapture();if(l=this.sideEffects.handleBeforeChange(S,l,d),this.schema.validateRecord(this,l,t??"updateRecord",S)===S)continue;m.set(l),u=!0;const x=m.__unsafe__getWithoutCapture();r[l.id]=[S,x],this.addDiffForAfterEvent(S,x)}else l=this.sideEffects.handleBeforeCreate(l,d),u=!0,l=this.schema.validateRecord(this,l,t??"createRecord",null),i[l.id]=l,this.addDiffForAfterEvent(null,l),a||(a={...s}),a[l.id]=yn("atom:"+l.id,l)}a&&this.atoms.set(a),u&&this.updateHistory({added:i,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const a=this.atoms.__unsafe__getWithoutCapture()[s];a&&this.sideEffects.handleBeforeDelete(a.get(),r)===!1&&t.add(s)}let i;this.atoms.update(s=>{let a;for(const l of e){if(t.has(l)||!(l in s))continue;a||(a={...s}),i||(i={}),delete a[l];const u=s[l].get();i[l]=u,this.addDiffForAfterEvent(u,null)}return a??s}),i&&this.updateHistory({added:{},updated:{},removed:i})})}get(e){var t;return(t=this.atoms.get()[e])==null?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()}serialize(e="document"){const t={};for(const[r,i]of Nr(this.atoms.get())){const s=i.get();(e==="all"||this.scopedTypes[e].has(s.typeName))&&(t[r]=s)}return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return Zt(this.atoms.get()).map(e=>e.get())}clear(){this.remove(mT(this.atoms.get()))}update(e,t){const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,t){this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(r),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Os(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],r=this.historyAccumulator.addInterceptor(i=>t.push(i.changes));try{return Os(e),H1(t)}finally{r()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const i=Zt(e.added);for(const[a,l]of Zt(e.updated)){const u=this.schema.getType(l.typeName);if(r&&u.ephemeralKeySet.size){const d=this.get(l.id);if(!d){i.push(l);continue}let f=null;for(const[g,m]of Object.entries(l))u.ephemeralKeySet.has(g)||Object.is(m,tr(d,g))||(f||(f={...d}),f[g]=m);f&&i.push(f)}else i.push(l)}const s=mT(e.removed);i.length&&this.put(i),s.length&&this.remove(s)},t)}createComputedCache(e,t,r){const i=new Rs;return{get:s=>{const a=this.atoms.get()[s];if(a)return i.get(a,()=>{const l=r?ue(a.name+":equals",()=>a.get(),{isEqual:r}):a;return ue(e+":"+s,()=>t(l.get()))}).get()}}}createSelectedComputedCache(e,t,r){const i=new Rs;return{get:s=>{const a=this.atoms.get()[s];if(a)return i.get(a,()=>{const l=ue(e+":"+s+":selector",()=>t(a.get()));return ue(e+":"+s,()=>r(l.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(vt(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&vt(e.id===t.id),!e&&!t))return;const r=(e||t).id,i=this.pendingAfterEvents.get(r);i?i.after=t:this.pendingAfterEvents.set(r,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:i,after:s}of r.values())i&&s?this.sideEffects.handleAfterChange(i,s,t):i&&!s?this.sideEffects.handleAfterDelete(i,t):!i&&s&&this.sideEffects.handleAfterCreate(s,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return Os(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0;try{const i=e();return this.flushAtomicCallbacks(),i}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function UU(n){if(n.length===0)return[];const e=[];let t=[n[0]],r;for(let i=1,s=n.length;i<s;i++)r=n[i],t[0].source!==r.source&&(e.push(t),t=[]),t.push(r);return e.push(t),e.map(i=>({source:i[0].source,changes:H1(i.map(s=>s.changes))}))}class $U{constructor(){O(this,"_history",[]);O(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=UU(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function HU(n,e,t){const r=new Rs;return{get(i,s){return r.get(i,()=>(i instanceof K1?i:i.store).createComputedCache(n,u=>e(i,u),t)).get(s)}}}function KU(n){const e=[];for(let t=n.length-1;t>=0;t--){const r=n[t];if("id"in r)e.unshift(r);else{const i=r.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:i.concat(s.dependsOn??[])})}}return e}function tu({sequence:n,sequenceId:e,retroactive:t=!0}){const r={sequenceId:e,retroactive:t,sequence:KU(n)};return zO(r),r}function Fr(n,e){return Object.fromEntries(Nr(e).map(([t,r])=>[t,`${n}/${r}`]))}function oi(n){const e=n.sequenceId;return tu({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:r=>{var i,s;return r.typeName===n.recordType&&(((i=t.filter)==null?void 0:i.call(t,r))??!0)&&(((s=n.filter)==null?void 0:s.call(n,r))??!0)}}:t)})}function qU(n){const e=new Map(n.map(s=>[s.id,s])),t=new Set,r=[];function i(s){vt(!t.has(s.id),`Circular dependency in migrations: ${s.id}`),t.add(s.id);const{version:a,sequenceId:l}=Gg(s.id),u=e.get(`${l}/${a-1}`);if(u&&i(u),s.dependsOn)for(const d of s.dependsOn){const f=e.get(d);f&&i(f)}e.delete(s.id),r.push(s)}for(const s of e.values())i(s);return r}function Gg(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function YM(n,e){e&&vt(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),vt(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function zO(n){if(vt(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),vt(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;YM(n.sequence[0].id,n.sequenceId);let e=Gg(n.sequence[0].id).version;vt(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const r=n.sequence[t].id;YM(r,n.sequenceId);const i=Gg(r).version;vt(i===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=i}}var ba=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(ba||{});function GU(n){if(n.schemaVersion>2||n.schemaVersion<1)return Ia.err("Bad schema version");if(n.schemaVersion===2)return Ia.ok(n);const e={schemaVersion:2,sequences:{"com.tldraw.store":n.storeVersion}};for(const[t,r]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=r.version,"subTypeKey"in r)for(const[i,s]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${t}.${i}`]=s;return Ia.ok(e)}class q1{constructor(e,t){O(this,"migrations",{});O(this,"sortedMigrations");var i;this.types=e,this.options=t;for(const s of t.migrations??[])vt(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),zO(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=qU(r);for(const s of this.sortedMigrations)if((i=s.dependsOn)!=null&&i.length)for(const a of s.dependsOn){const l=r.find(u=>u.id===a);vt(l,`Migration '${s.id}' depends on missing migration '${a}'`)}}static create(e,t){return new q1(e,t??{})}validateRecord(e,t,r,i){try{const s=tr(this.types,t.typeName);if(!s)throw new Error(`Missing definition for record type ${t.typeName}`);return s.validate(t,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const t=GU(e);if(!t.ok)return t;const r=t.value,i=new Set(Object.keys(r.sequences).filter(a=>this.migrations[a]));for(const a in this.migrations)r.sequences[a]===void 0&&this.migrations[a].retroactive&&i.add(a);if(i.size===0)return Ia.ok([]);const s=new Set;for(const a of i){const l=r.sequences[a];if(typeof l!="number"&&this.migrations[a].retroactive||l===0){for(const f of this.migrations[a].sequence)s.add(f.id);continue}const u=`${a}/${l}`,d=this.migrations[a].sequence.findIndex(f=>f.id===u);if(d===-1)return Ia.err("Incompatible schema?");for(const f of this.migrations[a].sequence.slice(d+1))s.add(f.id)}return Ia.ok(this.sortedMigrations.filter(({id:a})=>s.has(a)))}migratePersistedRecord(e,t,r="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:ba.MigrationError};let s=i.value;if(s.length===0)return{type:"success",value:e};if(s.some(a=>a.scope==="store"))return{type:"error",reason:r==="down"?ba.TargetVersionTooOld:ba.TargetVersionTooNew};if(r==="down"){if(!s.every(a=>a.down))return{type:"error",reason:ba.TargetVersionTooOld};s=s.slice().reverse()}e=$t(e);try{for(const a of s){if(a.scope==="store")throw new Error;if(!(a.filter?a.filter(e):!0))continue;const u=a[r](e);u&&(e=$t(u))}}catch(a){return console.error("Error migrating record",a),{type:"error",reason:ba.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:ba.MigrationError};const i=r.value;if(i.length===0)return{type:"success",value:t};t=$t(t);try{for(const s of i)if(s.scope==="record")for(const[a,l]of Object.entries(t)){if(!(s.filter?s.filter(l):!0))continue;const d=s.up(l);d&&(t[a]=$t(d))}else if(s.scope==="store"){const a=s.up(t);a&&(t=$t(a))}else mn(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:ba.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?Gg(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=tr(this.types,e);return vt(t,"record type does not exists"),t}}Fa("@tldraw/store","3.8.1","esm");function YU(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class ut extends Error{constructor(t,r=[]){const i=YU(r),s=t.split(`
`).map((a,l)=>l===0?a:`  ${a}`).join(`
`);super(r?`At ${i}: ${s}`:s);O(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function zr(n,e){try{return e()}catch(t){throw t instanceof ut?new ut(t.rawMessage,[n,...t.path]):new ut(t.toString(),[n])}}function ka(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:mn(e)}}class pr{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return JU(this)}optional(){return BO(this)}refine(e){return new pr(t=>e(this.validate(t)),(t,r)=>{const i=this.validateUsingKnownGoodVersion(t,r);return Object.is(t,i)?t:e(i)})}check(e,t){return typeof e=="string"?this.refine(r=>(zr(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class VU extends pr{constructor(e){super(t=>{const r=VM.validate(t);for(let i=0;i<r.length;i++)zr(i,()=>e.validate(r[i]));return r},(t,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const i=VM.validate(r);let s=t.length!==i.length;for(let a=0;a<i.length;a++){const l=i[a];if(a>=t.length){s=!0,zr(a,()=>e.validate(l));continue}if(Object.is(t[a],l))continue;const u=zr(a,()=>e.validateUsingKnownGoodVersion(t[a],l));Object.is(u,t[a])||(s=!0)}return s?r:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new ut("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ut("Expected an array with length greater than 1")})}}class Yg extends pr{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new ut(`Expected object, got ${ka(r)}`);for(const[i,s]of Object.entries(e))zr(i,()=>{s.validate(tr(r,i))});if(!t){for(const i of Object.keys(r))if(!Ii(e,i))throw new ut("Unexpected property",[i])}return r},(r,i)=>{if(typeof i!="object"||i===null)throw new ut(`Expected object, got ${ka(i)}`);let s=!1;for(const[a,l]of Object.entries(e)){const u=tr(r,a),d=tr(i,a);if(Object.is(u,d))continue;const f=zr(a,()=>{const g=l;return g.validateUsingKnownGoodVersion?g.validateUsingKnownGoodVersion(u,d):g.validate(d)});Object.is(f,u)||(s=!0)}if(!t){for(const a of Object.keys(i))if(!Ii(e,a))throw new ut("Unexpected property",[a])}for(const a of Object.keys(r))if(!Ii(i,a)){s=!0;break}return s?i:r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Yg(this.config,!0)}extend(e){return new Yg({...this.config,...e})}}class jm extends pr{constructor(e,t,r,i){super(s=>{this.expectObject(s);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(s);return a===void 0?this.unknownValueValidation(s,l):zr(`(${e} = ${l})`,()=>a.validate(s))},(s,a)=>{this.expectObject(a),this.expectObject(s);const{matchingSchema:l,variant:u}=this.getMatchingSchemaAndVariant(a);return l===void 0?this.unknownValueValidation(a,u):tr(s,e)!==tr(a,e)?zr(`(${e} = ${u})`,()=>l.validate(a)):zr(`(${e} = ${u})`,()=>l.validateUsingKnownGoodVersion?l.validateUsingKnownGoodVersion(s,a):l.validate(a))}),this.key=e,this.config=t,this.unknownValueValidation=r,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new ut(`Expected an object, got ${ka(e)}`,[])}getMatchingSchemaAndVariant(e){const t=tr(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new ut(`Expected a string for key "${this.key}", got ${ka(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new ut(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Ii(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new jm(this.key,this.config,e,this.useNumberKeys)}}class XU extends pr{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new ut(`Expected object, got ${ka(r)}`);for(const[i,s]of Object.entries(r))zr(i,()=>{e.validate(i),t.validate(s)});return r},(r,i)=>{if(typeof i!="object"||i===null)throw new ut(`Expected object, got ${ka(i)}`);let s=!1;for(const[a,l]of Object.entries(i)){if(!Ii(r,a)){s=!0,zr(a,()=>{e.validate(a),t.validate(l)});continue}const u=tr(r,a),d=l;if(Object.is(u,d))continue;const f=zr(a,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(u,d):t.validate(d));Object.is(f,u)||(s=!0)}for(const a of Object.keys(r))if(!Ii(i,a)){s=!0;break}return s?i:r}),this.keyValidator=e,this.valueValidator=t}}function G1(n){return new pr(e=>{if(typeof e!==n)throw new ut(`Expected ${n}, got ${ka(e)}`);return e})}const WU=new pr(n=>n),qe=G1("string"),Fe=G1("number").check(n=>{if(Number.isNaN(n))throw new ut("Expected a number, got NaN");if(!Number.isFinite(n))throw new ut(`Expected a finite number, got ${n}`)}),Vg=Fe.check(n=>{if(n<0)throw new ut(`Expected a positive number, got ${n}`)}),un=Fe.check(n=>{if(n<=0)throw new ut(`Expected a non-zero positive number, got ${n}`)}),FO=Fe.check(n=>{if(!Number.isInteger(n))throw new ut(`Expected an integer, got ${n}`)}),ag=FO.check(n=>{if(n<0)throw new ut(`Expected a positive integer, got ${n}`)}),ZU=FO.check(n=>{if(n<=0)throw new ut(`Expected a non-zero positive integer, got ${n}`)}),et=G1("boolean");function ir(n){return new pr(e=>{if(e!==n)throw new ut(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const VM=new pr(n=>{if(!Array.isArray(n))throw new ut(`Expected an array, got ${ka(n)}`);return n});function Ln(n){return new VU(n)}function nt(n){return new Yg(n)}function dw(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===YF)}function hw(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(hw):dw(n)?Object.values(n).every(hw):!1}const Nn=new pr(n=>{if(hw(n))return n;throw new ut(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let r=0;r<e.length;r++){if(r>=n.length){t=!0,Nn.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const a=Nn.validateUsingKnownGoodVersion(i,s);Object.is(a,i)||(t=!0)}return t?e:n}else if(dw(n)&&dw(e)){let t=!1;for(const r of Object.keys(e)){if(!Ii(n,r)){t=!0,Nn.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const a=Nn.validateUsingKnownGoodVersion(i,s);Object.is(a,i)||(t=!0)}for(const r of Object.keys(n))if(!Ii(e,r)){t=!0;break}return t?e:n}else return Nn.validate(e)});function Xg(n,e){return new XU(n,e)}function Y1(n,e){return new jm(n,e,(t,r)=>{throw new ut(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!1)}function QU(n,e){return new jm(n,e,(t,r)=>{throw new ut(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!0)}function Ks(n,e){return new pr(t=>zr(n,()=>e.validate(t)),(t,r)=>zr(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,r):e.validate(r)))}function Om(n){return new pr(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new ut(`Expected ${t}, got ${e}`)}return e})}function BO(n){return new pr(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function JU(n){return new pr(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function Dm(...n){return Om(new Set(n))}function V1(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new ut(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new ut(`Expected a valid url, got ${JSON.stringify(n)}`)}}const e$=new Set(["http:","https:","mailto:"]),ri=qe.check(n=>{if(n==="")return;const e=V1(n);if(!e$.has(e.protocol.toLowerCase()))throw new ut(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),t$=new Set(["http:","https:","data:","asset:"]),Ol=qe.check(n=>{if(n==="")return;const e=V1(n);if(!t$.has(e.protocol.toLowerCase()))throw new ut(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});qe.check(n=>{if(n==="")return;if(!V1(n).protocol.toLowerCase().match(/^https?:$/))throw new ut(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const X1=qe.refine(n=>{try{return NF(n),n}catch{throw new ut(`Expected an index key, got ${JSON.stringify(n)}`)}});Fa("@tldraw/validate","3.8.1","esm");function ti(n){return qe.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const Rm=ti("asset");function W1(n,e){return nt({id:Rm,typeName:ir("asset"),type:ir(n),props:e,meta:Nn})}const Dl=nt({x:Fe,y:Fe,z:Fe.optional()}),hh=nt({x:Fe,y:Fe,w:Fe,h:Fe}),UO=Fe.check(n=>{if(n<0||n>1)throw new ut("Opacity must be between 0 and 1")}),n$=qe.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),_i=ti("shape");function r$(n,e,t){return nt({id:_i,typeName:ir("shape"),x:Fe,y:Fe,rotation:Fe,index:X1,parentId:n$,type:ir(n),isLocked:et,opacity:UO,props:e?nt(e):Nn,meta:t?nt(t):Nn})}const i$=ti("binding");function s$(n,e,t){return nt({id:i$,typeName:ir("binding"),type:ir(n),fromId:_i,toId:_i,props:e?nt(e):Nn,meta:t?nt(t):Nn})}Fr("com.tldraw.binding",{});oi({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Al(n){return`binding:${Ct()}`}function o$(n){return Hs("binding",{scope:"document",validator:Ks("binding",Y1("type",zh(n,(e,{props:t,meta:r})=>s$(e,t,r))))}).withDefaultProperties(()=>({meta:{}}))}class Un{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=WU}=t;return new Un(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new a$(e,r,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class a$ extends Un{constructor(e,t,r){super(e,t,Dm(...r)),this.values=r}}const _p=Fr("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),l$=oi({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:_p.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:_p.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:_p.AddMeta,up:n=>{n.meta={}}},{id:_p.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function Wc(n){return n?n.typeName==="shape":!1}function kr(n){return n?n.startsWith("shape:"):!1}function Mt(n){return`shape:${n??Ct()}`}function $O(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof Un){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function cs(n,e){return zh(e,(t,r)=>`com.tldraw.shape.${n}/${r}`)}function c$(n){return Hs("shape",{scope:"document",validator:Ks("shape",Y1("type",zh(n,(e,{props:t,meta:r})=>r$(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function XM(n,e){const t=[];for(const[r,{migrations:i}]of Object.entries(e)){const s=`com.tldraw.${n}.${r}`;i?"sequenceId"in i?(vt(s===i.sequenceId,`sequenceId mismatch for ${r} ${km} migrations. Expected '${s}', got '${i.sequenceId}'`),t.push(i)):"sequence"in i?t.push(tu({sequenceId:s,retroactive:!1,sequence:i.sequence.map(a=>"id"in a?HO(n,r,a):a)})):t.push(tu({sequenceId:s,retroactive:!1,sequence:Object.keys(i.migrators).map(a=>Number(a)).sort((a,l)=>a-l).map(a=>({id:`${s}/${a}`,scope:"record",filter:l=>l.typeName===n&&l.type===r,up:l=>{const u=i.migrators[a].up(l);if(u)return u},down:l=>{const u=i.migrators[a].down(l);if(u)return u}}))})):t.push(tu({sequenceId:s,retroactive:!1,sequence:[]}))}return t}function HO(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:r=>r.typeName===n&&r.type===e,up:r=>{const i=t.up(r.props);i&&(r.props=i)},down:typeof t.down=="function"?r=>{const i=t.down(r.props);i&&(r.props=i)}:void 0}}const KO=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],Wg={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Bo(n){return n.isDarkMode?Wg.darkMode:Wg.lightMode}const ii=Un.defineEnum("tldraw:color",{defaultValue:"black",values:KO}),Z1=Un.defineEnum("tldraw:labelColor",{defaultValue:"black",values:KO}),Rl=Un.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Ll=Un.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Ns=Un.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),qO={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},zs=Un.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),GO=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Zg=Un.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:GO}),Qg=Un.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:GO}),YO={labelColor:Z1,color:ii,fill:Ll,dash:Rl,size:zs,arrowheadStart:Zg,arrowheadEnd:Qg,font:Ns,start:Dl,end:Dl,bend:Fe,text:qe,labelPosition:Fe,scale:un},qc=cs("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Cp(n){return HO("shape","arrow",n)}const VO=tu({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Cp({id:qc.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),Cp({id:qc.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Cp({id:qc.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:qc.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:r,end:i}=t.props;if(r.type==="binding"){const s=Al(),a={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[s]=a,t.props.start={x:0,y:0}}else delete t.props.start.type;if(i.type==="binding"){const s=Al(),a={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};n[s]=a,t.props.end={x:0,y:0}}else delete t.props.end.type}}},Cp({id:qc.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),XO={terminal:Dm("start","end"),normalizedAnchor:Dl,isExact:et,isPrecise:et},WO={sequence:[{dependsOn:[qc.ExtractBindings]}]},u$=Ks("camera",nt({typeName:ir("camera"),id:ti("camera"),x:Fe,y:Fe,z:Fe,meta:Nn})),d$=Fr("com.tldraw.camera",{AddMeta:1}),h$=oi({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:d$.AddMeta,up:n=>{n.meta={}}}]}),Ms=Hs("camera",{validator:u$,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),f$=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),ZO=Om(f$),p$=nt({type:ZO,rotation:Fe}),g$=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),m$=Om(g$),y$=new Set(["starting","paused","active","stopping"]),QO=nt({id:qe,points:Ln(Dl),size:Vg,color:m$,opacity:Fe,state:Om(y$),delay:Fe,shrink:Fe,taper:et}),Ch=ti("page"),S$=Ks("page",nt({typeName:ir("page"),id:Ch,name:qe,index:X1,meta:Nn})),v$=Fr("com.tldraw.page",{AddMeta:1}),b$=oi({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:v$.AddMeta,up:n=>{n.meta={}}}]}),si=Hs("page",{validator:S$,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Ir(n){return si.isId(n)}const x$={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function JO(n){return n?uh(n,e=>x$[e]):null}ti("instance");function w$(n){const e={};for(const[r,i]of n)e[r]=BO(i);const t=Ks("instance",nt({typeName:ir("instance"),id:ti("instance"),currentPageId:Ch,followingUserId:qe.nullable(),brush:hh.nullable(),opacityForNextShape:UO,stylesForNextShape:nt(e),cursor:p$,scribbles:Ln(QO),isFocusMode:et,isDebugMode:et,isToolLocked:et,exportBackground:et,screenBounds:hh,insets:Ln(et),zoomBrush:hh.nullable(),isPenMode:et,isGridMode:et,chatMessage:qe,isChatting:et,highlightedUserIds:Ln(qe),isFocused:et,devicePixelRatio:Fe,isCoarsePointer:et,isHoveringCanvas:et.nullable(),openMenus:Ln(qe),isChangingStyle:et,isReadonly:et,meta:Nn,duplicateProps:nt({shapeIds:Ln(ti("shape")),offset:nt({x:Fe,y:Fe})}).nullable()}));return Hs("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Ut=Fr("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),_$=oi({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Ut.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:Ut.RemoveDialog,up:({dialog:n,...e})=>e},{id:Ut.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:Ut.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Ut.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:Ut.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:Ut.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:Ut.AddZoom,up:n=>({...n,zoomBrush:null})},{id:Ut.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:Ut.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:Ut.RemoveUserId,up:({userId:n,...e})=>e},{id:Ut.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:Ut.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:Ut.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:Ut.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:Ut.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:Ut.AddMeta,up:n=>({...n,meta:{}})},{id:Ut.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:Ut.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Ut.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:Ut.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:Ut.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:Ut.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:Ut.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:Ut.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),ur="instance:instance",C$=Ks("instance_page_state",nt({typeName:ir("instance_page_state"),id:ti("instance_page_state"),pageId:Ch,selectedShapeIds:Ln(_i),hintingShapeIds:Ln(_i),erasingShapeIds:Ln(_i),hoveredShapeId:_i.nullable(),editingShapeId:_i.nullable(),croppingShapeId:_i.nullable(),focusedGroupId:_i.nullable(),meta:Nn})),Ud=Fr("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),E$=oi({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Ud.AddCroppingId,up(n){n.croppingShapeId=null}},{id:Ud.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:Ud.AddMeta,up:n=>{n.meta={}}},{id:Ud.RenameProperties,up:n=>{},down:n=>{}},{id:Ud.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),ns=Hs("instance_page_state",{validator:C$,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),P$=Ks("pointer",nt({typeName:ir("pointer"),id:ti("pointer"),x:Fe,y:Fe,lastActivityTimestamp:Fe,meta:Nn})),T$=Fr("com.tldraw.pointer",{AddMeta:1}),I$=oi({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:T$.AddMeta,up:n=>{n.meta={}}}]}),Q1=Hs("pointer",{validator:P$,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Jg=Q1.createId("pointer"),M$=Ks("instance_presence",nt({typeName:ir("instance_presence"),id:ti("instance_presence"),userId:qe,userName:qe,lastActivityTimestamp:Fe.nullable(),followingUserId:qe.nullable(),cursor:nt({x:Fe,y:Fe,type:ZO,rotation:Fe}).nullable(),color:qe,camera:nt({x:Fe,y:Fe,z:Fe}).nullable(),screenBounds:hh.nullable(),selectedShapeIds:Ln(ti("shape")),currentPageId:ti("page"),brush:hh.nullable(),scribbles:Ln(QO),chatMessage:qe,meta:Nn})),Lc=Fr("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),A$=oi({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Lc.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:Lc.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:Lc.AddChatMessage,up:n=>{n.chatMessage=""}},{id:Lc.AddMeta,up:n=>{n.meta={}}},{id:Lc.RenameSelectedShapeIds,up:n=>{}},{id:Lc.NullableCameraCursor,up:n=>{},down:n=>{n.camera===null&&(n.camera={x:0,y:0,z:1}),n.lastActivityTimestamp===null&&(n.lastActivityTimestamp=0),n.cursor===null&&(n.cursor={type:"default",x:0,y:0,rotation:0}),n.screenBounds===null&&(n.screenBounds={x:0,y:0,w:1,h:1})}}]}),k$=Hs("instance_presence",{validator:M$,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),j$=Ks("document",nt({typeName:ir("document"),id:ir("document:document"),gridSize:Fe,name:qe,meta:Nn})),WM=Fr("com.tldraw.document",{AddName:1,AddMeta:2}),O$=oi({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:WM.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:WM.AddMeta,up:n=>{n.meta={}}}]}),J1=Hs("document",{validator:j$,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),fw=J1.createId("document");function D$(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function ZM(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}function R$({error:n,phase:e,record:t,recordBefore:r}){throw S1(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?ZM($t(r)):void 0,recordAfter:ZM($t(t))}}),n}function L$(){return[si.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function N$(n){const e=n.query.ids("page"),t=n.query.records("instance_page_state"),r=()=>{if(!n.has(fw))return n.put([J1.create({id:fw,name:n.props.defaultName})]),r();if(!n.has(Jg))return n.put([Q1.create({id:Jg})]),r();const i=e.get();if(i.size===0)return n.put(L$()),r();const s=()=>[...i].map(f=>n.get(f)).sort(D$)[0].id,a=n.get(ur);if(a){if(!i.has(a.currentPageId))return n.put([{...a,currentPageId:s()}]),r()}else return n.put([n.schema.types.instance.create({id:ur,currentPageId:s(),exportBackground:!0})]),r();const l=new Set,u=new Set;for(const f of i){const g=ns.createId(f);n.get(g)||l.add(g);const S=Ms.createId(f);n.has(S)||u.add(S)}l.size>0&&n.put([...l].map(f=>ns.create({id:f,pageId:ns.parseId(f)}))),u.size>0&&n.put([...u].map(f=>Ms.create({id:f})));const d=t.get();for(const f of d){if(!i.has(f.pageId)){n.remove([f.id]);continue}if(f.croppingShapeId&&!n.has(f.croppingShapeId))return n.put([{...f,croppingShapeId:null}]),r();if(f.focusedGroupId&&!n.has(f.focusedGroupId))return n.put([{...f,focusedGroupId:null}]),r();if(f.hoveredShapeId&&!n.has(f.hoveredShapeId))return n.put([{...f,hoveredShapeId:null}]),r();const g=f.selectedShapeIds.filter(b=>n.has(b));if(g.length!==f.selectedShapeIds.length)return n.put([{...f,selectedShapeIds:g}]),r();const m=f.hintingShapeIds.filter(b=>n.has(b));if(m.length!==f.hintingShapeIds.length)return n.put([{...f,hintingShapeIds:m}]),r();const S=f.erasingShapeIds.filter(b=>n.has(b));if(S.length!==f.erasingShapeIds.length)return n.put([{...f,erasingShapeIds:S}]),r()}};return r}const z$=W1("bookmark",nt({title:qe,description:qe,image:qe,favicon:qe,src:Ol.nullable()})),QM=Fr("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),F$=oi({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:QM.MakeUrlsValid,up:n=>{Ol.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:QM.AddFavicon,up:n=>{Ol.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),B$=W1("image",nt({w:Fe,h:Fe,name:qe,isAnimated:et,mimeType:qe.nullable(),src:Ol.nullable(),fileSize:un.optional()})),$d=Fr("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),U$=oi({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:$d.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:$d.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:$d.MakeUrlsValid,up:n=>{Ol.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:$d.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:$d.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),$$=W1("video",nt({w:Fe,h:Fe,name:qe,isAnimated:et,mimeType:qe.nullable(),src:Ol.nullable(),fileSize:Fe.optional()})),Hd=Fr("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),H$=oi({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:Hd.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Hd.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Hd.MakeUrlsValid,up:n=>{Ol.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Hd.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:Hd.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),K$=Ks("asset",Y1("type",{image:B$,video:$$,bookmark:z$})),q$=Fr("com.tldraw.asset",{AddMeta:1}),G$=oi({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:q$.AddMeta,up:n=>{n.meta={}}}]}),ja=Hs("asset",{validator:K$,scope:"document"}).withDefaultProperties(()=>({meta:{}})),eD={w:un,h:un,assetId:Rm.nullable(),url:ri},JM=cs("bookmark",{NullAssetId:1,MakeUrlsValid:2}),tD={sequence:[{id:JM.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:JM.MakeUrlsValid,up:n=>{ri.isValid(n.url)||(n.url="")},down:n=>{}}]},nD=nt({type:Dm("free","straight"),points:Ln(Dl)}),rD={color:ii,fill:Ll,dash:Rl,size:zs,segments:Ln(nD),isComplete:et,isClosed:et,isPen:et,scale:un},eA=cs("draw",{AddInPen:1,AddScale:2}),iD={sequence:[{id:eA.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:eA.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},Y$=/(^\/r\/[^/]+\/?$)/,V$=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(Y$))return n}},{hostnames:["figma.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:n=>{const e=Ke(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:n=>{const e=Ke(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:n=>{const e=Ke(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:n=>{const e=Ke(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{hostnames:["replit.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hash.match(/#room=/))return n}},{hostnames:["observablehq.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],sD={w:un,h:un,url:qe},Ep=cs("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),oD={sequence:[{id:Ep.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let r;for(const i of V$)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(s){console.warn(s)}n.tmpOldUrl=n.url,n.url=r??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:Ep.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:Ep.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:Ep.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},aD={w:un,h:un,name:qe},lD={sequence:[]},em=Un.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),tm=Un.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),rs=Un.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),cD={geo:rs,labelColor:Z1,color:ii,fill:Ll,dash:Rl,size:zs,font:Ns,align:em,verticalAlign:tm,url:ri,w:un,h:un,growY:Vg,text:qe,scale:un},bo=cs("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),uD={sequence:[{id:bo.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:bo.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:bo.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:bo.AddCheckBox,up:n=>{},down:"retired"},{id:bo.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:bo.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:bo.AddCloud,up:n=>{},down:"retired"},{id:bo.MakeUrlsValid,up:n=>{ri.isValid(n.url)||(n.url="")},down:n=>{}},{id:bo.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},dD={},hD={sequence:[]},fD={color:ii,size:zs,segments:Ln(nD),isComplete:et,isPen:et,scale:un},X$=cs("highlight",{AddScale:1}),pD={sequence:[{id:X$.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},W$=nt({topLeft:Dl,bottomRight:Dl}),gD={w:un,h:un,playing:et,url:ri,assetId:Rm.nullable(),crop:W$.nullable(),flipX:et,flipY:et},Pp=cs("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),mD={sequence:[{id:Pp.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Pp.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:Pp.MakeUrlsValid,up:n=>{ri.isValid(n.url)||(n.url="")},down:n=>{}},{id:Pp.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},nm=Un.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),Z$=nt({id:qe,index:X1,x:Fe,y:Fe}),yD={color:ii,dash:Rl,size:zs,spline:nm,points:Xg(qe,Z$),scale:un},Kd=cs("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),SD={sequence:[{id:Kd.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:Kd.RemoveExtraHandleProps,up:n=>{n.handles=b1(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,r])=>({index:t,...r})).sort(Jn);n.handles=Object.fromEntries(e.map((t,r)=>{const i=r===0?"start":r===e.length-1?"end":`handle:${t.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:Kd.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:r,y:i}])=>({x:r,y:i,index:t})).sort(Jn);n.points=e.map(({x:t,y:r})=>({x:t,y:r})),delete n.handles},down:n=>{const e=_h(n.points.length);n.handles=Object.fromEntries(n.points.map((t,r)=>[e[r],{x:t.x,y:t.y}])),delete n.points}},{id:Kd.PointIndexIds,up:n=>{const e=_h(n.points.length);n.points=Object.fromEntries(n.points.map((t,r)=>{const i=e[r];return[i,{id:i,index:i,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(Jn);n.points=e.map(({x:t,y:r})=>({x:t,y:r}))}},{id:Kd.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},vD={color:ii,labelColor:Z1,size:zs,font:Ns,fontSizeAdjustment:Vg,align:em,verticalAlign:tm,growY:Vg,url:ri,text:qe,scale:un},ya=cs("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),bD={sequence:[{id:ya.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:ya.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ya.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:ya.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:ya.MakeUrlsValid,up:n=>{ri.isValid(n.url)||(n.url="")},down:n=>{}},{id:ya.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:ya.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}},{id:ya.AddLabelColor,up:n=>{n.labelColor="black"},down:n=>{delete n.labelColor}}]},pw=Un.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),xD={color:ii,size:zs,font:Ns,textAlign:pw,w:un,text:qe,scale:un,autoSize:et},tA=cs("text",{RemoveJustify:1,AddTextAlign:2}),wD={sequence:[{id:tA.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:tA.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},_D={w:un,h:un,time:Fe,playing:et,url:ri,assetId:Rm.nullable()},nA=cs("video",{AddUrlProp:1,MakeUrlsValid:2}),CD={sequence:[{id:nA.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:nA.MakeUrlsValid,up:n=>{ri.isValid(n.url)||(n.url="")},down:n=>{}}]},Tp=Fr("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),Q$=tu({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Tp.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of Nr(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:Tp.AddInstancePresenceType,scope:"store",up(n){}},{id:Tp.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of Nr(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:Tp.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of Nr(n))t.typeName.match("user_document")&&delete n[e]}}]}),J$={arrow:{migrations:VO,props:YO},bookmark:{migrations:tD,props:eD},draw:{migrations:iD,props:rD},embed:{migrations:oD,props:sD},frame:{migrations:lD,props:aD},geo:{migrations:uD,props:cD},group:{migrations:hD,props:dD},highlight:{migrations:pD,props:fD},image:{migrations:mD,props:gD},line:{migrations:SD,props:yD},note:{migrations:bD,props:vD},text:{migrations:wD,props:xD},video:{migrations:CD,props:_D}},eH={arrow:{migrations:WO,props:XO}};function tH({shapes:n=J$,bindings:e=eH,migrations:t}={}){const r=new Map;for(const l of Zt(n))for(const u of $O(l.props??{}).keys()){if(r.has(u.id)&&r.get(u.id)!==u)throw new Error(`Multiple StyleProp instances with the same id: ${u.id}`);r.set(u.id,u)}const i=c$(n),s=o$(e),a=w$(r);return q1.create({asset:ja,binding:s,camera:Ms,document:J1,instance:a,instance_page_state:ns,page:si,instance_presence:k$,pointer:Q1,shape:i},{migrations:[Q$,G$,h$,O$,_$,E$,b$,A$,I$,l$,F$,U$,H$,...XM("shape",n),...XM("binding",e),...t??[]],onValidationFailure:R$,createIntegrityChecker:N$})}const Eh=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"sl",label:"Slovenina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"el",label:""},{locale:"ru",label:""},{locale:"uk",label:""},{locale:"he",label:""},{locale:"ur",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ne",label:""},{locale:"mr",label:""},{locale:"hi-in",label:""},{locale:"bn",label:""},{locale:"pa",label:""},{locale:"gu-in",label:""},{locale:"ta",label:""},{locale:"te",label:""},{locale:"kn",label:""},{locale:"ml",label:""},{locale:"th",label:""},{locale:"km-kh",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function nH(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return rH(n)}function rH(n){for(const e of n){const t=iH(e);if(t)return t}return"en"}const rA={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function iH(n){const e=Eh.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=Eh.find(s=>s.locale===t);if(i)return i.locale}return t in rA?rA[t]:null}Fa("@tldraw/tlschema","3.8.1","esm");var Hb={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var iA;function sH(){return iA||(iA=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",a=0;a<arguments.length;a++){var l=arguments[a];l&&(s=i(s,r(l)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var l in s)e.call(s,l)&&s[l]&&(a=i(a,l));return a}function i(s,a){return a?s?s+" "+a:s+a:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(Hb)),Hb.exports}var oH=sH();const Oe=za(oH),ED="3.8.1",sA={major:"2024-09-13T14:36:29.063Z",minor:"2025-02-12T15:48:24.555Z"},aH={error:null};class e_ extends T.Component{constructor(){super(...arguments);O(this,"state",aH)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return p.jsx(r,{error:t})}return this.props.children}}function Ph({children:n,fallback:e,...t}){return e===null?n:p.jsx(e_,{fallback:e,...t,children:n})}function t_(n,e){return Lm(`${n}_${e}`)}function wu(n){return Lm(`${T.useId()}${n??""}`)}function is(n){const e=jr(T.useContext(PD));return Lm(`${e}_${n}`)}function Lm(n){return n.replace(/:/g,"_")}const PD=T.createContext(null);function lH({children:n}){const e=wu();return p.jsx(PD.Provider,{value:e,children:n})}const n_=T.createContext(null);function te(){const n=ct.useContext(n_);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function Ha(){return ct.useContext(n_)}function r_({editor:n,children:e}){return p.jsx(n_.Provider,{value:n,children:p.jsx(lH,{children:e})})}function cH(){return p.jsx("div",{className:"tl-background"})}function _u(n,e,t,r,i,s){T.useLayoutEffect(()=>{const a=n.current;if(!a||e===void 0)return;let l=`translate(${e}px, ${t}px)`;r!==void 0&&(l+=` scale(${r})`),i!==void 0&&(l+=` rotate(${i}rad)`),s&&(l+=` translate(${s.x}px, ${s.y}px)`),a.style.transform=l})}const Kb=({brush:n,color:e,opacity:t,className:r})=>{const i=T.useRef(null);_u(i,n.x,n.y);const s=ee(Math.max(1,n.w)),a=ee(Math.max(1,n.h));return p.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?p.jsxs("g",{className:"tl-brush",opacity:t,children:[p.jsx("rect",{width:s,height:a,fill:e,opacity:.75}),p.jsx("rect",{width:s,height:a,fill:"none",stroke:e,opacity:.1})]}):p.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:a})})},kt={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(kt.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),kt.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),kt.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),kt.isFirefox=/firefox/i.test(navigator.userAgent),kt.isAndroid=/android/i.test(navigator.userAgent),kt.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const oA={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},qb={duration:0,easing:Tn.easeInOutCubic},aA={CAMERA_MOVE:-10},uH=["top","right","bottom","left"],lA=0,i_=2,Ip=1,cA=5,dH=128;var Gb={};const hH={},TD=Tr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),ln={logPreventDefaults:Tr("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Tr("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Tr("logElementRemoves",{defaults:{all:!1}}),debugSvg:Tr("debugSvg",{defaults:{all:!1}}),showFps:Tr("showFps",{defaults:{all:!1}}),measurePerformance:Tr("measurePerformance",{defaults:{all:!1}}),throwToBlob:Tr("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Tr("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Tr("debugCursors",{defaults:{all:!1}}),forceSrgb:Tr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Tr("debugGeometry",{defaults:{all:!1}}),hideShapes:Tr("hideShapes",{defaults:{all:!1}}),editOnType:Tr("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;js("element removal logging",()=>{ln.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Tr(n,{defaults:e,shouldStoreForSession:t=!0}){return fH({name:n,defaults:e,shouldStoreForSession:t})}function fH(n){const e=gH(n),t=n.shouldStoreForSession?pH(n.name):null,r=yn(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&js(`debug:${n.name}`,()=>{const i=r.get();i===e?Bj(`tldraw_debug:${n.name}`):P1(`tldraw_debug:${n.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function pH(n){try{return JSON.parse(Fj(`tldraw_debug:${n}`)??"null")}catch{return null}}function Yb(n){try{return n()}catch{return null}}function gH(n){switch(Yb(()=>Gb.TLDRAW_ENV)??Yb(()=>Gb.VERCEL_PUBLIC_TLDRAW_ENV)??Yb(()=>Gb.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function rm(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return rm(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ze(n){n.preventDefault(),ln.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function qh(n,e){if(n.setPointerCapture(e.pointerId),ln.logPointerCaptures.get()){const t=TD.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function Gh(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),ln.logPointerCaptures.get())){const t=TD.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const dn=n=>n.stopPropagation(),Xn=(n,e,t)=>{n&&n.style.setProperty(e,t)},mH=["input","select","button","textarea"];function ID(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||mH.indexOf(n.tagName.toLowerCase())>-1))}const er=n=>kt.isDarwin?n.metaKey:n.ctrlKey||n.metaKey;function Qr(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,metaKey:n.metaKey,accelKey:er(n),pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function s_(){const n=te();return T.useMemo(function(){let r,i;function s(x){if(!x.isKilled){if(x.button===i_){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Qr(x)});return}x.button!==0&&x.button!==1&&x.button!==5||(qh(x.currentTarget,x),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Qr(x)}))}}function a(x){x.isKilled||x.clientX===r&&x.clientY===i||(r=x.clientX,i=x.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Qr(x)}))}function l(x){x.isKilled||x.button!==0&&x.button!==1&&x.button!==2&&x.button!==5||(r=x.clientX,i=x.clientY,Gh(x.currentTarget,x),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Qr(x)}))}function u(x){if(x.isKilled||n.getInstanceState().isPenMode&&x.pointerType!=="pen")return;const w=x.pointerType==="mouse"||x.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:w?!0:null})}function d(x){if(x.isKilled||n.getInstanceState().isPenMode&&x.pointerType!=="pen")return;const w=x.pointerType==="mouse"||x.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:w?!1:null})}function f(x){x.isKilled=!0,Ze(x)}function g(x){x.isKilled=!0,x.target instanceof HTMLElement&&x.target.tagName!=="A"&&x.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&x.target.className.includes("tl-text-content"))&&Ze(x)}function m(x){Ze(x)}async function S(x){var _,E;if(Ze(x),dn(x),(E=(_=x.dataTransfer)==null?void 0:_.files)!=null&&E.length){const M=Array.from(x.dataTransfer.files);await n.putExternalContent({type:"files",files:M,point:n.screenToPage({x:x.clientX,y:x.clientY}),ignoreParent:!1});return}const w=x.dataTransfer.getData("url");if(w){await n.putExternalContent({type:"url",url:w,point:n.screenToPage({x:x.clientX,y:x.clientY})});return}}function b(x){dn(x)}return{onPointerDown:s,onPointerMove:a,onPointerUp:l,onPointerEnter:u,onPointerLeave:d,onDragOver:m,onDrop:S,onTouchStart:f,onTouchEnd:g,onClick:b}},[n])}function yH(){const n=te();T.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=a=>{const l=a.pointerType!=="mouse";e!==l&&(e=l,n.updateInstanceState({isCoarsePointer:l}))};window.addEventListener("pointerdown",t,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=kt.isFirefox&&!kt.isAndroid&&!kt.isIos,s=()=>{const a=i?!1:r.matches;e===a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};return r&&(r.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),r&&r.removeEventListener("change",s)}},[n])}const MD=T.createContext(null);function AD({container:n,children:e}){return p.jsx(MD.Provider,{value:n,children:e})}function bn(){return jr(T.useContext(MD),"useContainer used outside of <Tldraw />")}function SH(){const n=te(),e=bn(),t=oe("isFocused",()=>n.getIsFocused(),[n]);T.useEffect(()=>{if(!e)return;function r(i){if(i.isSpecialRedispatchedEvent)return;Ze(i),dn(i);const s=e.querySelector(".tl-canvas");if(!s)return;const a=new DragEvent(i.type,i);a.isSpecialRedispatchedEvent=!0,s.dispatchEvent(a)}return e.addEventListener("dragover",r),e.addEventListener("drop",r),()=>{e.removeEventListener("dragover",r),e.removeEventListener("drop",r)}},[e]),T.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const i=()=>{r!=null&&r();const s=`(resolution: ${window.devicePixelRatio}dppx)`,a=matchMedia(s),l=u=>{u.type==="change"&&i()};a.addEventListener?a.addEventListener("change",i):a.addListener&&a.addListener(l),r=()=>{a.removeEventListener?a.removeEventListener("change",i):a.removeListener&&a.removeListener(l)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),T.useEffect(()=>{if(!t)return;const r=l=>{if(l.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!Mp(n)&&Ze(l),l.isKilled)return;switch(l.isKilled=!0,l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){Ze(l);return}break}case"Tab":{if(Mp(n))return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&Ze(l),n.menus.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(Mp(n))return}const u={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:er(l)};n.dispatch(u)},i=l=>{if(l.isKilled||(l.isKilled=!0,Mp(n))||l.key===",")return;const u={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:er(l)};n.dispatch(u)};function s(l){var u,d;if(e.contains(l.target)){const f=l.touches[0].pageX,g=l.touches[0].radiusX||0;(f-g<10||f+g>n.getViewportScreenBounds().width-10)&&(((u=l.target)==null?void 0:u.tagName)==="BUTTON"&&((d=l.target)==null||d.click()),Ze(l))}}const a=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&Ze(l)};return e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("wheel",a,{passive:!1}),document.addEventListener("gesturestart",Ze),document.addEventListener("gesturechange",Ze),document.addEventListener("gestureend",Ze),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("wheel",a),document.removeEventListener("gesturestart",Ze),document.removeEventListener("gesturechange",Ze),document.removeEventListener("gestureend",Ze),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}function Mp(n){return n.menus.hasOpenMenus()||ID()}const vH=["textarea","input"];function bH(n){const e=te();T.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var s;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:a}=i;if(vH.includes((s=a.tagName)==null?void 0:s.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Ze(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function xH(n,e,t){return Math.max(e,Math.min(n,t))}const zn={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function uA(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function dA(n,e,t,r=.15){return r===0?xH(n,e,t):n<e?-uA(e-n,t-e,r)+e:n>t?+uA(n-t,t-e,r)+t:n}function wH(n,[e,t],[r,i]){const[[s,a],[l,u]]=n;return[dA(e,s,a,r),dA(t,l,u,i)]}function _H(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function CH(n){var e=_H(n,"string");return typeof e=="symbol"?e:String(e)}function Zn(n,e,t){return e=CH(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function hA(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Qt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?hA(Object(t),!0).forEach(function(r){Zn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):hA(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const kD={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function fA(n){return n?n[0].toUpperCase()+n.slice(1):""}const EH=["enter","leave"];function PH(n=!1,e){return n&&!EH.includes(e)}function TH(n,e="",t=!1){const r=kD[n],i=r&&r[e]||e;return"on"+fA(n)+fA(i)+(PH(t,i)?"Capture":"")}const IH=["gotpointercapture","lostpointercapture"];function MH(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=IH.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function AH(n,e=""){const t=kD[n],r=t&&t[e]||e;return n+r}function jD(n){return"touches"in n}function kH(n){return jD(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function jH(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function gw(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,s=(e.clientY+n.clientY)/2,a=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:a,origin:[i,s]}}catch{}return null}function OH(n){return jH(n).map(e=>e.identifier)}function pA(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return gw(t,r)}const gA=40,mA=800;function OD(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=gA,t*=gA):r===2&&(e*=mA,t*=mA),[e,t]}function DH(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s})}return e}function im(n,...e){return typeof n=="function"?n(...e):n}function RH(){}function LH(...n){return n.length===0?RH:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function yA(n,e){return Object.assign({},e,n||{})}const NH=32;class DD{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?im(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,DH(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const j=t._delta.map(Math.abs);zn.addTo(t._distance,j)}this.axisIntent&&this.axisIntent(e);const[a,l]=t._movement,[u,d]=r.threshold,{_step:f,values:g}=t;if(r.hasCustomTransform?(f[0]===!1&&(f[0]=Math.abs(a)>=u&&g[0]),f[1]===!1&&(f[1]=Math.abs(l)>=d&&g[1])):(f[0]===!1&&(f[0]=Math.abs(a)>=u&&Math.sign(a)*u),f[1]===!1&&(f[1]=Math.abs(l)>=d&&Math.sign(l)*d)),t.intentional=f[0]!==!1||f[1]!==!1,!t.intentional)return;const m=[0,0];if(r.hasCustomTransform){const[j,D]=g;m[0]=f[0]!==!1?j-f[0]:0,m[1]=f[1]!==!1?D-f[1]:0}else m[0]=f[0]!==!1?a-f[0]:0,m[1]=f[1]!==!1?l-f[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(m);const S=t.offset,b=t._active&&!t._blocked||t.active;b&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=im(r.bounds,t)),this.setup&&this.setup()),t.movement=m,this.computeOffset()));const[x,w]=t.offset,[[_,E],[M,I]]=t._bounds;t.overflow=[x<_?-1:x>E?1:0,w<M?-1:w>I?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const A=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=wH(t._bounds,t.offset,A),t.delta=zn.sub(t.offset,S),this.computeMovement(),b&&(!t.last||s>NH)){t.delta=zn.sub(t.offset,S);const j=t.delta.map(Math.abs);zn.addTo(t.distance,j),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[j[0]/s,j[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(Qt(Qt(Qt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function zH([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class FH extends DD{constructor(...e){super(...e),Zn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=zn.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=zn.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[kH(e)]:r.axisThreshold;t.axis=zH(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const BH=n=>n,SA=.15,RD={enabled(n=!0){return n},eventOptions(n,e,t){return Qt(Qt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[SA,SA];case!1:return[0,0];default:return zn.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return zn.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||BH},threshold(n){return zn.toVector(n,0)}},UH=0,Yh=Qt(Qt({},RD),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=UH){return n},bounds(n={}){if(typeof n=="function")return s=>Yh.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),Vh=typeof window<"u"&&window.document&&window.document.createElement;function LD(){return Vh&&"ontouchstart"in window}function $H(){return LD()||Vh&&window.navigator.maxTouchPoints>1}function HH(){return Vh&&"onpointerdown"in window}function KH(){return Vh&&"exitPointerLock"in window.document}function qH(){try{return"constructor"in GestureEvent}catch{return!1}}const Ei={isBrowser:Vh,gesture:qH(),touch:LD(),touchscreen:$H(),pointer:HH(),pointerLock:KH()},GH=250,YH=180,VH=.5,XH=50,WH=250,ZH=10,vA={mouse:0,touch:0,pen:8};Qt(Qt({},Yh),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Ei.pointerLock,Ei.touch&&t?"touch":this.pointerLock?"mouse":Ei.pointer&&!i?"pointer":Ei.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?GH:void 0,!(!Ei.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const s=zn.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,s},swipe({velocity:n=VH,distance:e=XH,duration:t=WH}={}){return{velocity:this.transform(zn.toVector(n)),distance:this.transform(zn.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return YH;case!1:return 0;default:return n}},axisThreshold(n){return n?Qt(Qt({},vA),n):vA},keyboardDisplacement(n=ZH){return n}});function ND(n){const[e,t]=n.overflow,[r,i]=n._delta,[s,a]=n._direction;(e<0&&r>0&&s<0||e>0&&r<0&&s>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&a<0||t>0&&i<0&&a>0)&&(n._movement[1]=n._movementBound[1])}const QH=30,JH=100;class eK extends DD{constructor(...e){super(...e),Zn(this,"ingKey","pinching"),Zn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=zn.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*QH-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=pA(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(a=>i.has(a))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=gw(...Array.from(r.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=pA(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=gw(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],s=t.angle-i;let a=0;Math.abs(s)>270&&(a+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*a]),r.origin=t.origin,r.turns=a,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=zn.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(r=>e[r]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-OD(e)[1]/JH*r.offset[0],0],zn.addTo(r._movement,r._delta),ND(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const tK=Qt(Qt({},RD),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Ei.touch&&Ei.gesture)return"gesture";if(Ei.touch&&r)return"touch";if(Ei.touchscreen){if(Ei.pointer)return"pointer";if(Ei.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=a=>{const l=yA(im(t,a),{min:-1/0,max:1/0});return[l.min,l.max]},s=a=>{const l=yA(im(r,a),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof t!="function"&&typeof r!="function"?[i(),s()]:a=>[i(a),s(a)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",zn.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Qt(Qt({},Yh),{},{mouseOnly:(n=!0)=>n});class nK extends FH{constructor(...e){super(...e),Zn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=OD(e),zn.addTo(t._movement,t._delta),ND(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const rK=Yh;Qt(Qt({},Yh),{},{mouseOnly:(n=!0)=>n});const o_=new Map,mw=new Map;function iK(n){o_.set(n.key,n.engine),mw.set(n.key,n.resolver)}const sK={key:"pinch",engine:eK,resolver:tK},oK={key:"wheel",engine:nK,resolver:rK};function aK(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function lK(n,e){if(n==null)return{};var t=aK(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const cK={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Ei.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},uK=["target","eventOptions","window","enabled","transform"];function lg(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=lg(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function dK(n,e,t={}){const r=n,{target:i,eventOptions:s,window:a,enabled:l,transform:u}=r,d=lK(r,uK);if(t.shared=lg({target:i,eventOptions:s,window:a,enabled:l,transform:u},cK),e){const f=mw.get(e);t[e]=lg(Qt({shared:t.shared},d),f)}else for(const f in d){const g=mw.get(f);g&&(t[f]=lg(Qt({shared:t.shared},d[f]),g))}return t}class zD{constructor(e,t){Zn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,s){const a=this._listeners,l=AH(t,r),u=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},d=Qt(Qt({},u),s);e.addEventListener(l,i,d);const f=()=>{e.removeEventListener(l,i,d),a.delete(f)};return a.add(f),f}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class hK{constructor(){Zn(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class fK{constructor(e){Zn(this,"gestures",new Set),Zn(this,"_targetEventStore",new zD(this)),Zn(this,"gestureEventStores",{}),Zn(this,"gestureTimeoutStores",{}),Zn(this,"handlers",{}),Zn(this,"config",{}),Zn(this,"pointerIds",new Set),Zn(this,"touchIds",new Set),Zn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),pK(this,e)}setEventIds(e){if(jD(e))return this.touchIds=new Set(OH(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=dK(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const a of this.gestures){const l=this.config[a],u=bA(r,l.eventOptions,!!i);if(l.enabled){const d=o_.get(a);new d(this,e,a).bind(u)}}const s=bA(r,t.eventOptions,!!i);for(const a in this.nativeHandlers)s(a,"",l=>this.nativeHandlers[a](Qt(Qt({},this.state.shared),{},{event:l,args:e})),void 0,!0)}for(const s in r)r[s]=LH(...r[s]);if(!i)return r;for(const s in r){const{device:a,capture:l,passive:u}=MH(s);this._targetEventStore.add(i,a,"",r[s],{capture:l,passive:u})}}}}function Nc(n,e){n.gestures.add(e),n.gestureEventStores[e]=new zD(n,e),n.gestureTimeoutStores[e]=new hK}function pK(n,e){e.drag&&Nc(n,"drag"),e.wheel&&Nc(n,"wheel"),e.scroll&&Nc(n,"scroll"),e.move&&Nc(n,"move"),e.pinch&&Nc(n,"pinch"),e.hover&&Nc(n,"hover")}const bA=(n,e,t)=>(r,i,s,a={},l=!1)=>{var u,d;const f=(u=a.capture)!==null&&u!==void 0?u:e.capture,g=(d=a.passive)!==null&&d!==void 0?d:e.passive;let m=l?r:TH(r,i,f);t&&g&&(m+="Passive"),n[m]=n[m]||[],n[m].push(s)},gK=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function mK(n){const e={},t={},r=new Set;for(let i in n)gK.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function zc(n,e,t,r,i,s){if(!n.has(t)||!o_.has(r))return;const a=t+"Start",l=t+"End",u=d=>{let f;return d.first&&a in e&&e[a](d),t in e&&(f=e[t](d)),d.last&&l in e&&e[l](d),f};i[r]=u,s[r]=s[r]||{}}function yK(n,e){const[t,r,i]=mK(n),s={};return zc(i,t,"onDrag","drag",s,e),zc(i,t,"onWheel","wheel",s,e),zc(i,t,"onScroll","scroll",s,e),zc(i,t,"onPinch","pinch",s,e),zc(i,t,"onMove","move",s,e),zc(i,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:r}}function SK(n,e={},t,r){const i=ct.useMemo(()=>new fK(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),ct.useEffect(i.effect.bind(i)),ct.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function vK(n){return n.forEach(iK),function(t,r){const{handlers:i,nativeHandlers:s,config:a}=yK(t,r||{});return SK(i,a,void 0,s)}}const xA=10,bK=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function FD(n){let{deltaY:e,deltaX:t}=n,r=0;return n.ctrlKey||n.altKey||n.metaKey?r=(Math.abs(e)>xA?xA*Math.sign(e):e)/100:n.shiftKey&&!bK&&(t=e,e=0),{x:-t,y:-e,z:-r}}const xK=vK([oK,sK]);let Fc;const wK=n=>Fc===void 0?(Fc=n,!1):n-Fc>120&&n-Fc<160?(Fc=n,!0):(Fc=n,!1);function _K(n){const e=te(),t=T.useMemo(()=>{let r="not sure";const i=({event:x})=>{if(!e.getInstanceState().isFocused||(r="not sure",wK(Date.now())))return;const w=e.getEditingShapeId();if(w){const M=e.getShape(w);if(M&&e.getShapeUtil(M).canScroll(M)){const A=e.getShapePageBounds(w);if(A!=null&&A.containsPoint(e.inputs.currentPagePoint))return}}Ze(x),dn(x);const _=FD(x);if(_.x===0&&_.y===0)return;const E={type:"wheel",name:"wheel",delta:_,point:new P(x.clientX,x.clientY),shiftKey:x.shiftKey,altKey:x.altKey,ctrlKey:x.metaKey||x.ctrlKey,metaKey:x.metaKey,accelKey:er(x)};e.dispatch(E)};let s=1,a=1,l=1,u=0;const d=new P,f=new P,g=x=>{const w=n.current;r="not sure";const{event:_,origin:E,da:M}=x;_ instanceof WheelEvent||(_.target===w||w!=null&&w.contains(_.target))&&(f.x=E[0],f.y=E[1],d.x=E[0],d.y=E[1],s=M[0],a=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:E[0],y:E[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:_.shiftKey,altKey:_.altKey,ctrlKey:_.metaKey||_.ctrlKey,metaKey:_.metaKey,accelKey:er(_)}))},m=x=>{if(x&&(r="zooming"),r==="zooming")return;const w=Math.abs(u-s),_=P.Dist(d,f);switch(r){case"not sure":{w>24?r="zooming":_>16&&(r="panning");break}case"panning":{w>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:g,onPinchEnd:x=>{const w=n.current,{event:_,origin:E,offset:M}=x;if(_ instanceof WheelEvent||!(_.target===w||w!=null&&w.contains(_.target)))return;const I=M[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:E[0],y:E[1],z:I},delta:{x:E[0],y:E[1]},shiftKey:_.shiftKey,altKey:_.altKey,ctrlKey:_.metaKey||_.ctrlKey,metaKey:_.metaKey,accelKey:er(_)})})},onPinch:x=>{const w=n.current,{event:_,origin:E,offset:M,da:I}=x;if(_ instanceof WheelEvent||!(_.target===w||w!=null&&w.contains(_.target)))return;const A=x.type==="gesturechange"||x.type==="gestureend";u=I[0];const j=E[0]-f.x,D=E[1]-f.y;switch(f.x=E[0],f.y=E[1],m(A),r){case"zooming":{l=M[0],e.dispatch({type:"pinch",name:"pinch",point:{x:E[0],y:E[1],z:l},delta:{x:j,y:D},shiftKey:_.shiftKey,altKey:_.altKey,ctrlKey:_.metaKey||_.ctrlKey,metaKey:_.metaKey,accelKey:er(_)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:E[0],y:E[1],z:a},delta:{x:j,y:D},shiftKey:_.shiftKey,altKey:_.altKey,ctrlKey:_.metaKey||_.ctrlKey,metaKey:_.metaKey,accelKey:er(_)});break}}}}},[e,n]);xK(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const r=e.getBaseZoom(),i=e.getCameraOptions().zoomSteps,s=i[0]*r,a=i[i.length-1]*r;return{from:e.getZoomLevel(),max:a,min:s}}}})}function Vb(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(s=>s.id===t)}}function CK(n,e){const t=te();return T.useMemo(()=>{const r=u=>{if(u.isKilled)return;const d=rm(u.currentTarget);qh(d,u);const{shape:f,handle:g}=Vb(t,n,e);g&&t.dispatch({type:"pointer",target:"handle",handle:g,shape:f,name:"pointer_down",...Qr(u)})};let i,s;return{onPointerDown:r,onPointerMove:u=>{if(u.isKilled||u.clientX===i&&u.clientY===s)return;i=u.clientX,s=u.clientY;const{shape:d,handle:f}=Vb(t,n,e);f&&t.dispatch({type:"pointer",target:"handle",handle:f,shape:d,name:"pointer_move",...Qr(u)})},onPointerUp:u=>{if(u.isKilled)return;const d=rm(u.currentTarget);Gh(d,u);const{shape:f,handle:g}=Vb(t,n,e);g&&t.dispatch({type:"pointer",target:"handle",handle:g,shape:f,name:"pointer_up",...Qr(u)})}}},[t,n,e])}function EK(n){const e=te();T.useLayoutEffect(()=>{const t=Sj(()=>{n.current&&e.updateViewportScreenBounds(n.current)},200,{trailing:!0}),r=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const i=new ResizeObserver(l=>{l[0].contentRect&&t()}),s=n.current;let a=null;return s&&(i.observe(s),a=PK(s),a.addEventListener("scroll",t)),()=>{clearInterval(r),window.removeEventListener("resize",t),i.disconnect(),a==null||a.removeEventListener("scroll",t),t.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const PK=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};class be{constructor(e=0,t=0,r=0,i=0){O(this,"x",0);O(this,"y",0);O(this,"w",0);O(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new P(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new P(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY)]}get cornersAndCenter(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new P(this.w,this.h)}toFixed(){return this.x=wp(this.x),this.y=wp(this.y),this.w=wp(this.w),this.h=wp(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=s-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new be(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,s=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,s-r)}collides(e){return be.Collides(this,e)}contains(e){return be.Contains(this,e)}includes(e){return be.Includes(this,e)}containsPoint(e,t=0){return be.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new P(this.minX,this.minY);case"top_right":return new P(this.maxX,this.minY);case"bottom_left":return new P(this.minX,this.maxY);case"bottom_right":return new P(this.maxX,this.maxY);case"top":return new P(this.midX,this.minY);case"right":return new P(this.maxX,this.midY);case"bottom":return new P(this.midX,this.maxY);case"left":return new P(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:s,maxX:a,maxY:l}=this;let{minX:u,minY:d,maxX:f,maxY:g}=this;switch(e){case"left":case"top_left":case"bottom_left":{u+=t;break}case"right":case"top_right":case"bottom_right":{f+=t;break}}switch(e){case"top":case"top_left":case"top_right":{d+=r;break}case"bottom":case"bottom_left":case"bottom_right":{g+=r;break}}const m=(f-u)/(a-i),S=(g-d)/(l-s),b=m<0,x=S<0;if(b){const w=f;f=u,u=w}if(x){const w=g;g=d,d=w}this.minX=u,this.minY=d,this.width=Math.abs(f-u),this.height=Math.abs(g-d)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),s=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=s-r,this}static From(e){return new be(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new be(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new be;let t=1/0,r=1/0,i=-1/0,s=-1/0,a;for(let l=0,u=e.length;l<u;l++)a=e[l],t=Math.min(a.x,t),r=Math.min(a.y,r),i=Math.max(a.x,i),s=Math.max(a.y,s);return new be(t,r,i-t,s-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),s=Math.max(t.maxX,e.maxX),a=Math.max(t.maxY,e.maxY);return new be(r,i,s-r,a-i)}static ExpandBy(e,t){return new be(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return be.Collides(e,t)||be.Contains(e,t)}static ContainsPoint(e,t,r=0){return!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)}static Common(e){let t=1/0,r=1/0,i=-1/0,s=-1/0;for(let a=0;a<e.length;a++){const l=e[a];t=Math.min(t,l.minX),r=Math.min(r,l.minY),i=Math.max(i,l.maxX),s=Math.max(s,l.maxY)}return new be(t,r,i-t,s-r)}static Sides(e,t=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,t,r,i,s=!1){const{minX:a,minY:l,maxX:u,maxY:d}=e;let{minX:f,minY:g,maxX:m,maxY:S}=e;switch(t){case"left":case"top_left":case"bottom_left":{f+=r;break}case"right":case"top_right":case"bottom_right":{m+=r;break}}switch(t){case"top":case"top_left":case"top_right":{g+=i;break}case"bottom":case"bottom_left":case"bottom_right":{S+=i;break}}const b=(m-f)/(u-a),x=(S-g)/(d-l),w=b<0,_=x<0;if(s){const M=(u-a)/(d-l),I=Math.abs(m-f),A=Math.abs(S-g),j=I*(x<0?1:-1)*(1/M),D=A*(b<0?1:-1)*M,R=M<I/A;switch(t){case"top_left":{R?g=S+j:f=m+D;break}case"top_right":{R?g=S+j:m=f-D;break}case"bottom_right":{R?S=g-j:m=f-D;break}case"bottom_left":{R?S=g-j:f=m+D;break}case"bottom":case"top":{const q=(f+m)/2,L=A*M;f=q-L/2,m=q+L/2;break}case"left":case"right":{const q=(g+S)/2,L=I/M;g=q-L/2,S=q+L/2;break}}}if(w){const M=m;m=f,f=M}if(_){const M=S;S=g,g=M}const E=new be(f,g,Math.abs(m-f),Math.abs(S-g));return{box:E,scaleX:+(E.width/e.width*(b>0?1:-1)).toFixed(5),scaleY:+(E.height/e.height*(x>0?1:-1)).toFixed(5)}}equals(e){return be.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new be(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function TK(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function IK(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function MK(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}class ve{constructor(e,t,r,i,s,a){O(this,"a",1);O(this,"b",0);O(this,"c",0);O(this,"d",1);O(this,"e",0);O(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=a}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:s,d:a,e:l,f:u}=this;return this.a=r*t.a+s*t.b,this.c=r*t.c+s*t.d,this.e=r*t.e+s*t.f+l,this.b=i*t.a+a*t.b,this.d=i*t.c+a*t.d,this.f=i*t.e+a*t.f+u,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(ve.Rotate(e)):this.translate(t,r).multiply(ve.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(ve.Translate(e,t))}scale(e,t){return this.multiply(ve.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:s,f:a}=this,l=e*i-t*r;return this.a=i/l,this.b=t/-l,this.c=r/-l,this.d=e/l,this.e=(i*s-r*a)/-l,this.f=(t*s-e*a)/l,this}applyToPoint(e){return ve.applyToPoint(this,e)}applyToPoints(e){return ve.applyToPoints(this,e)}rotation(){return ve.Rotation(this)}point(){return ve.Point(this)}decomposed(){return ve.Decompose(this)}toCssString(){return ve.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return ve.Decompose(this)}clone(){return new ve(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ve(1,0,0,1,0,0)}static Translate(e,t){return new ve(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return ve.Identity();const i=Math.cos(e),s=Math.sin(e),a=new ve(i,s,-s,i,0,0);return t===void 0?a:ve.Compose(ve.Translate(t,r),a,ve.Translate(-t,-r))}static Scale(e,t,r,i){const s=new ve(e,0,0,t,0,0);return r===void 0?s:ve.Compose(ve.Translate(r,i),s,ve.Translate(-r,-i))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=ve.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new P(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=Nt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return ow(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=s,r=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,r=s,i=Nt+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:ow(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${ee(e.a)}, ${ee(e.b)}, ${ee(e.c)}, ${ee(e.d)}, ${ee(e.e)}, ${ee(e.f)})`}static applyToPoint(e,t){return new P(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new P(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new be(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new ve(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof ve?e:ve.From(e)}}class Ka{constructor(e){O(this,"isFilled",!1);O(this,"isClosed",!0);O(this,"isLabel",!1);O(this,"debugColor");O(this,"ignore");O(this,"_vertices");O(this,"_bounds");O(this,"_area");O(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,r=!1){return this.isClosed&&(this.isFilled||r)&&ei(e,this.vertices)?!0:P.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&ei(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:r}=this;let i,s=1/0,a,l,u;for(let d=0;d<r.length;d++)l=r[d],u=P.NearestPointOnLineSegment(e,t,l,!0),a=P.Dist2(l,u),a<s&&(s=a,i=u);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&ei(i,this.vertices)?-s:s}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){const{vertices:r}=this;let i,s=1/0,a,l,u;for(let d=0;d<r.length;d++)l=r[d],u=P.NearestPointOnLineSegment(e,t,l,!0),a=P.Dist2(l,u),a<s&&(s=a,i=u);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return be.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const s=e[r],a=e[(r+1)%i];t+=s.x*a.y-a.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,r=e[0],i=0;for(let s=1;s<e.length;s++)t=e[s],i+=P.Dist2(r,t),r=t;return Math.sqrt(i)}}class ki extends Ka{constructor(t){super({...t,isClosed:!0,isFilled:!1});O(this,"children",[]);O(this,"ignoredChildren",[]);for(const r of t.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:s}=this;if(s.length===0)throw Error("no children");let a,l;for(const u of s)a=u.nearestPoint(t),l=P.Dist2(a,t),l<r&&(r=l,i=a);if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,s)=>i.distanceToPoint(t,r||s>0)))}hitTestPoint(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=be.FromPoints(this.vertices).corners;for(let i=0,s=r.length;i<s;i++){const a=r[i],l=r[(i-1+s)%s],u=a.dist(l),d=r[(i+1)%s],f=a.dist(d),g=a.clone().lrp(l,4/u),m=a,S=a.clone().lrp(d,4/f);t+=`M${g.x},${g.y} L${m.x},${m.y} L${S.x},${S.y} `}return t}getLength(){return this.children.reduce((t,r)=>r.isLabel?t:t+r.length,0)}getSvgPathData(){return this.children.map((t,r)=>t.isLabel?"":t.getSvgPathData(r===0)).join(" ")}}function AK(n=!0){const[e,t]=T.useState(0),r=te();T.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const kK=Bn(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){const i=te();AK(r);const s=i.getZoomLevel(),a=i.getRenderingShapes(),{inputs:{currentPagePoint:l}}=i;return p.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:a.map(u=>{const d=i.getShape(u.id);if(d.type==="group")return null;const f=i.getShapeGeometry(d),g=i.getShapePageTransform(d),m=i.getPointInShapeSpace(d,l),S=f.nearestPoint(m),b=f.distanceToPoint(m,!0),x=Math.abs(b)*s,w=b<0,{vertices:_}=f;return p.jsxs("g",{transform:g.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&p.jsx("g",{stroke:f.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:p.jsx(BD,{geometry:f})}),t&&_.map((E,M)=>p.jsx("circle",{cx:E.x,cy:E.y,r:2/s,fill:`hsl(${lu(M,[0,_.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${M}`)),r&&x<150&&p.jsx("line",{x1:S.x,y1:S.y,x2:m.x,y2:m.y,opacity:1-x/150,stroke:w?"goldenrod":"dodgerblue",strokeWidth:2/s})]},u.id+"_outline")})})});function BD({geometry:n}){return n instanceof ki?p.jsx(p.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>p.jsx(BD,{geometry:e},t))}):p.jsx("path",{d:n.toSimpleSvgPath()})}function UD(n){return sF(n)}function $D(){const n=te(),e=pU("userIds",()=>UD(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,r)=>{var i;return t.join(",")===((i=r.join)==null?void 0:i.call(r,","))}},[n]);return oe(e)}function Nm(n){const e=te();return oe(`latestPresence:${n}`,()=>e.getCollaborators().find(r=>r.userId===n),[e,n])??null}const jK=Bn(function(){return $D().map(t=>p.jsx(OK,{collaboratorId:t},t))}),OK=Bn(function({collaboratorId:e}){const t=te(),r=Nm(e),i=RK(t,r);if(!(r&&r.currentPageId===t.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:s,highlightedUserIds:a}=t.getInstanceState();if(!(s===r.userId||a.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=t.getInstanceState();if(r.followingUserId===t.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return p.jsx(DK,{latestPresence:r})}),DK=Bn(function({latestPresence:e}){const t=te(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:a,CollaboratorShapeIndicator:l}=Ht(),u=t.getZoomLevel(),d=t.getViewportPageBounds(),{userId:f,chatMessage:g,brush:m,scribbles:S,selectedShapeIds:b,userName:x,cursor:w,color:_}=e;if(!w)return null;const E=!(w.x<d.minX-12/u||w.y<d.minY-16/u||w.x>d.maxX-12/u||w.y>d.maxY-16/u);return p.jsxs(p.Fragment,{children:[m&&r?p.jsx(r,{className:"tl-collaborator__brush",brush:m,color:_,opacity:.1},f+"_brush"):null,E&&s?p.jsx(s,{className:"tl-collaborator__cursor",point:w,color:_,zoom:u,name:x!=="New User"?x:null,chatMessage:g??""},f+"_cursor"):a?p.jsx(a,{className:"tl-collaborator__cursor-hint",point:w,color:_,zoom:u,viewport:d},f+"_cursor_hint"):null,i&&S.length?p.jsx(p.Fragment,{children:S.map(M=>p.jsx(i,{className:"tl-collaborator__scribble",scribble:M,color:_,zoom:u,opacity:M.color==="laser"?.5:.1},f+"_scribble_"+M.id))}):null,l&&b.filter(M=>!t.isShapeHidden(M)).map(M=>p.jsx(l,{className:"tl-collaborator__shape-indicator",shapeId:M,color:_,opacity:.5},f+"_"+M))]})});function wA(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function RK(n,e){const t=T.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,i]=T.useState(()=>wA(n,Date.now()-t.current));return T.useEffect(()=>{const s=n.timers.setInterval(()=>{i(wA(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[n]),e&&(t.current=e.lastActivityTimestamp??1/0),r}function LK(){const n=te(),e=oe("is menu open",()=>n.menus.hasAnyOpenMenus(),[n]),[t,r]=T.useState(!1),i=e||t,s=s_(),a=T.useRef({isDown:!1,isDragging:!1,start:new P}),l=T.useCallback(f=>{f.button===0&&(r(!0),a.current={isDown:!0,isDragging:!1,start:new P(f.clientX,f.clientY)}),n.menus.clearOpenMenus()},[n]),u=T.useCallback(f=>{var g,m,S;if(a.current.isDown){if(a.current.isDragging){(g=s.onPointerMove)==null||g.call(s,f);return}if(P.Dist2(a.current.start,new P(f.clientX,f.clientY))>n.options.dragDistanceSquared){a.current={...a.current,isDown:!0,isDragging:!0};const{x:b,y:x}=a.current.start;(m=s.onPointerDown)==null||m.call(s,{...f,clientX:b,clientY:x,button:0}),(S=s.onPointerMove)==null||S.call(s,f)}}},[s,n]),d=T.useCallback(f=>{var g;(g=s.onPointerUp)==null||g.call(s,f),r(!1),a.current={isDown:!1,isDragging:!1,start:new P(f.clientX,f.clientY)}},[s]);return i&&p.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...s,onPointerDown:l,onPointerMove:u,onPointerUp:d})}const HD=T.memo(function({id:e,shape:t,util:r,index:i,backgroundIndex:s,opacity:a}){const l=te(),{ShapeErrorFallback:u}=Ht(),d=T.useRef(null),f=T.useRef(null),g=T.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Ma("set shape stuff",()=>{const b=l.getShape(e);if(!b)return;const x=g.current,w=l.getShapeClipPath(e)??"none";w!==x.clipPath&&(Xn(d.current,"clip-path",w),Xn(f.current,"clip-path",w),x.clipPath=w);const _=l.getShapePageTransform(e),E=ve.toCssString(_),M=l.getShapeGeometry(b).bounds;E!==x.transform&&(Xn(d.current,"transform",E),Xn(f.current,"transform",E),x.transform=E);const I=Math.max(M.width,1),A=Math.max(M.height,1);(I!==x.width||A!==x.height)&&(Xn(d.current,"width",I+"px"),Xn(d.current,"height",A+"px"),Xn(f.current,"width",I+"px"),Xn(f.current,"height",A+"px"),x.width=I,x.height=A)},[l]),Ma("set opacity and z-index",()=>{const b=d.current,x=f.current;Xn(b,"opacity",a),Xn(x,"opacity",a),Xn(b,"z-index",i),Xn(x,"z-index",s)},[a,i,s]),Ma("set display",()=>{if(!l.getShape(e))return;const w=l.getCulledShapes().has(e);w!==g.current.isCulled&&(Xn(d.current,"display",w?"none":"block"),Xn(f.current,"display",w?"none":"block"),g.current.isCulled=w)},[l]);const m=T.useCallback(b=>l.annotateError(b,{origin:"shape",willCrashApp:!1}),[l]);if(!t)return null;const S="fill"in t.props&&t.props.fill!=="none";return p.jsxs(p.Fragment,{children:[r.backgroundComponent&&p.jsx("div",{ref:f,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:p.jsx(Ph,{fallback:u,onError:m,children:p.jsx(qD,{shape:t,util:r})})}),p.jsx("div",{ref:d,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":S,"data-shape-id":t.id,draggable:!1,children:p.jsx(Ph,{fallback:u,onError:m,children:p.jsx(KD,{shape:t,util:r})})})]})}),KD=T.memo(function({shape:e,util:t}){return Am("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta&&n.util===e.util),qD=T.memo(function({shape:e,util:t}){return Am("InnerShape:"+e.type,()=>{var r;return(r=t.backgroundComponent)==null?void 0:r.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))},[t,e.id])},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta&&n.util===e.util);function NK({className:n}){const e=te(),{Background:t,SvgDefs:r,ShapeIndicators:i}=Ht(),s=T.useRef(null),a=T.useRef(null),l=T.useRef(null),u=bn();EK(s),SH(),yH(),_K(s),bH(s);const d=T.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Ma("position layers",function(){const{x:E,y:M,z:I}=e.getCamera();if(d.current.allowTextOutline&&kt.isSafari&&(u.style.setProperty("--tl-text-outline","none"),d.current.allowTextOutline=!1),d.current.allowTextOutline&&I<e.options.textShadowLod!==d.current.lodDisableTextOutline){const D=I<e.options.textShadowLod;u.style.setProperty("--tl-text-outline",D?"none":"var(--tl-text-outline-reference)"),d.current.lodDisableTextOutline=D}const A=I>=1?lu(I,[1,8],[.125,.5],!0):lu(I,[.1,1],[-2,.125],!0),j=`scale(${ee(I)}) translate(${ee(E+A)}px,${ee(M+A)}px)`;Xn(a.current,"transform",j),Xn(l.current,"transform",j)},[e,u]);const f=s_(),g=oe("shapeSvgDefs",()=>{const _=new Map;for(const E of Zt(e.shapeUtils)){if(!E)return;const M=E.getCanvasSvgDefs();for(const{key:I,component:A}of M)_.has(I)||_.set(I,p.jsx(A,{},I))}return[..._.values()]},[e]),m=oe("debug_shapes",()=>ln.hideShapes.get(),[ln]),S=oe("debug_svg",()=>ln.debugSvg.get(),[ln]),b=oe("debug_geometry",()=>ln.debugGeometry.get(),[ln]),x=oe("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),w=oe("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return p.jsxs(p.Fragment,{children:[p.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":x,"data-isselectinganything":w,className:Oe("tl-canvas",n),"data-testid":"canvas",...f,children:[p.jsx("svg",{className:"tl-svg-context",children:p.jsxs("defs",{children:[g,p.jsx(ZK,{}),p.jsx(QK,{}),r&&p.jsx(r,{})]})}),t&&p.jsx("div",{className:"tl-background__wrapper",children:p.jsx(t,{})}),p.jsx(FK,{}),p.jsxs("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[p.jsx(nq,{}),p.jsx(tq,{}),m?null:S?p.jsx(YK,{}):p.jsx(XK,{})]}),p.jsx("div",{className:"tl-overlays",children:p.jsxs("div",{ref:l,className:"tl-html-layer",children:[b?p.jsx(kK,{}):null,p.jsx(UK,{}),p.jsx(BK,{}),p.jsx($K,{}),i&&p.jsx(i,{}),p.jsx(WK,{}),p.jsx(HK,{}),p.jsx(eq,{}),p.jsx(KK,{}),p.jsx(jK,{})]})}),p.jsx(rq,{})]}),p.jsx(LK,{}),p.jsx(zK,{})]})}function zK(){const{InFrontOfTheCanvas:n}=Ht();return n?p.jsx(n,{}):null}function FK(){const n=te(),e=oe("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=oe("camera",()=>n.getCamera(),[n]),s=oe("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:a}=Ht();return a&&s?p.jsx(a,{x:t,y:r,z:i,size:e}):null}function BK(){const n=te(),e=oe("scribbles",()=>n.getInstanceState().scribbles,[n]),t=oe("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=Ht();return r&&e.length?e.map(i=>p.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id)):null}function UK(){const n=te(),e=oe("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=Ht();return t&&e?p.jsx(t,{className:"tl-user-brush",brush:e}):null}function $K(){const n=te(),e=oe("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=Ht();return t&&e?p.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function HK(){const n=te(),e=oe("snapLines",()=>n.snaps.getIndicators(),[n]),t=oe("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:r}=Ht();return r&&e.length>0?e.map(i=>p.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id)):null}function KK(){const n=te(),e=oe("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:r}=n.getInstanceState();if(t||r)return!1;const i=n.getOnlySelectedShape();return!i||!n.getShapeHandles(i)?!1:i.id},[n]);return e?p.jsx(qK,{shapeId:e}):null}function qK({shapeId:n}){const e=te(),{Handles:t}=Ht(),r=oe("zoomLevel",()=>e.getZoomLevel(),[e]),i=oe("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=oe("handles transform",()=>e.getShapePageTransform(n),[e,n]),a=oe("handles",()=>{const u=e.getShapeHandles(n);if(!u)return null;const d=(i?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return u.filter(f=>f.type!=="virtual"||!u.some(g=>g!==f&&g.type==="vertex"&&P.Dist(f,g)<d)).sort(f=>f.type==="vertex"?1:-1)},[e,r,i,n]),l=oe("isHidden",()=>e.isShapeHidden(n),[e,n]);return!t||!a||!s||l?null:p.jsx(t,{children:p.jsx("g",{transform:ve.toCssString(s),children:a.map(u=>p.jsx(GK,{shapeId:n,handle:u,zoom:r,isCoarse:i},u.id))})})}function GK({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=CK(n,e.id),{Handle:s}=Ht();return s?p.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:p.jsx(s,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function YK(){const n=te();return oe("rendering shapes",()=>n.getRenderingShapes(),[n]).map(t=>p.jsxs(T.Fragment,{children:[p.jsx(HD,{...t}),p.jsx(JK,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function VK(){const n=te(),e=T.useRef(new Set);return Ma("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(i=>e.current.has(i)))return;e.current=t;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[n]),null}function XK(){const n=te(),e=oe("rendering shapes",()=>n.getRenderingShapes(),[n]);return p.jsxs(p.Fragment,{children:[e.map(t=>p.jsx(HD,{...t},t.id+"_shape")),kt.isSafari&&p.jsx(VK,{})]})}function WK(){const n=te(),{ShapeIndicator:e}=Ht(),t=oe("hinting shape ids",()=>m1(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(r=>p.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function ZK(){return p.jsxs("g",{id:is("cursor"),children:[p.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),p.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function QK(){const n=is("cursor_hint");return p.jsx("path",{id:n,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function JK({id:n,mode:e}){const t=te(),[r,i]=T.useState(null),s=oe("is in root",()=>{const a=t.getShape(n);return(a==null?void 0:a.parentId)===t.getCurrentPageId()},[t,n]);return T.useEffect(()=>{if(!s)return;let a=null;const l=js("shape to svg",async()=>{const u=Math.random();a=u;const f=t.isShapeOfType(n,"frame")?0:10;let g=t.getShapePageBounds(n);if(!g)return;g=g.clone().expandBy(f);const m=await t.getSvgString([n],{padding:f});if(a!==u||!m)return;const S=`data:image/svg+xml;utf8,${encodeURIComponent(m.svg)}`;i({src:S,bounds:g})});return()=>{a=null,l()}},[t,n,s]),!s||!r?null:e==="iframe"?p.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):p.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function eq(){const n=te(),e=oe("selection rotation",()=>n.getSelectionRotation(),[n]),t=oe("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=Ht();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function tq(){const n=te(),e=oe("selection rotation",()=>n.getSelectionRotation(),[n]),t=oe("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=Ht();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function nq(){const{OnTheCanvas:n}=Ht();return n?p.jsx(n,{}):null}function rq(){const n=te(),e=oe("camera state",()=>n.getCameraState(),[n]);return p.jsx("div",{className:Oe("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function iq({className:n,zoom:e,point:t,color:r,viewport:i,opacity:s=1}){const a=T.useRef(null);_u(a,On(t.x,i.minX+5/e,i.maxX-5/e),On(t.y,i.minY+5/e,i.maxY-5/e),1/e,P.Angle(i.center,t));const l=is("cursor_hint");return p.jsxs("svg",{ref:a,className:Oe("tl-overlays__item",n),children:[p.jsx("use",{href:`#${l}`,color:r,strokeWidth:3,stroke:"var(--color-background)"}),p.jsx("use",{href:`#${l}`,color:r,opacity:s})]})}const _A=T.memo(function({className:e,zoom:t,point:r,color:i,name:s,chatMessage:a}){const l=T.useRef(null);_u(l,r==null?void 0:r.x,r==null?void 0:r.y,1/t);const u=is("cursor");return r?p.jsxs("div",{ref:l,className:Oe("tl-overlays__item",e),children:[p.jsx("svg",{className:"tl-cursor",children:p.jsx("use",{href:`#${u}`,color:i})}),a?p.jsxs(p.Fragment,{children:[s&&p.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),p.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:a})]}):s&&p.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null});function sq({x:n,y:e,z:t,size:r}){const i=wu("grid"),s=te(),{gridSteps:a}=s.options;return p.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[p.jsx("defs",{children:a.map(({min:l,mid:u,step:d},f)=>{const g=d*r*t,m=.5+n*t,S=.5+e*t,b=m>0?m%g:g+m%g,x=S>0?S%g:g+S%g,w=t<u?lu(t,[l,u],[0,1]):1;return p.jsx("pattern",{id:t_(i,`${d}`),width:g,height:g,patternUnits:"userSpaceOnUse",children:p.jsx("circle",{className:"tl-grid-dot",cx:b,cy:x,r:1,opacity:w})},f)})}),a.map(({step:l},u)=>p.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${l})`},u))]})}function oq({handle:n,isCoarse:e,className:t,zoom:r}){const i=te(),s=(e?i.options.coarseHandleRadius:i.options.handleRadius)/r;if(n.type==="clone"){const l=3/r,u=`M0,${-l} A${l},${l} 0 0,1 0,${l}`,d=uH.indexOf(n.id);return p.jsxs("g",{className:Oe(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("path",{className:"tl-handle__fg",d:u,transform:`rotate(${-90+90*d})`})]})}const a=(n.type==="create"&&e?3:4)/Math.max(r,.25);return p.jsxs("g",{className:Oe(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("circle",{className:"tl-handle__fg",r:a})]})}const aq=({children:n})=>p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),lq=()=>{const{Spinner:n}=Ht();return p.jsx(__,{children:n?p.jsx(n,{}):null})};function a_(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${ft(r)}L${ft(i)}`;let s="";for(let a=2,l=t-1;a<l;a++)r=n[a],i=n[a+1],s+=Or(r,i);return e?`M${Or(n[0],n[1])}Q${ft(n[1])}${Or(n[1],n[2])}T${s}${Or(n[t-1],n[0])}${Or(n[0],n[1])}Z`:`M${ft(n[0])}Q${ft(n[1])}${Or(n[1],n[2])}${n.length>3?"T":""}${s}L${ft(n[t-1])}`}function CA({scribble:n,zoom:e,color:t,opacity:r,className:i}){return n.points.length?p.jsx("svg",{className:i&&Oe("tl-overlays__item",i),children:p.jsx("path",{className:"tl-scribble",d:a_(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null}function GD({bounds:n,rotation:e}){const t=T.useRef(null);return _u(t,n.x,n.y,1,e),T.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=ee(Math.max(1,n.width))+"px",r.style.height=ee(Math.max(1,n.height))+"px")},[n.width,n.height]),p.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function cq({bounds:n,rotation:e}){const t=te(),r=T.useRef(null),i=oe("only selected shape",()=>t.getOnlySelectedShape(),[t]),s=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return _u(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-s,y:-s}),n=s instanceof be?n.clone().expand(s).zeroFix():n.clone().expandBy(s).zeroFix(),p.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsx("rect",{className:Oe("tl-selection__fg__outline"),width:ee(n.width),height:ee(n.height)})})}const uq=()=>p.jsx("div",{className:"tl-shape-error-boundary"}),dq=({shape:n,util:e})=>Am("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),hq=({editor:n,id:e})=>{const t=oe("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:r}=Ht();return!t||t.isLocked?null:p.jsx(Ph,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:p.jsx(dq,{shape:t,util:n.getShapeUtil(t)},t.id)})},EA=T.memo(function({shapeId:e,className:t,color:r,hidden:i,opacity:s}){const a=te(),l=T.useRef(null);return Ma("indicator transform",()=>{const u=l.current;if(!u)return;const d=a.getShapePageTransform(e);d&&u.style.setProperty("transform",d.toCssString())},[a,e]),T.useLayoutEffect(()=>{const u=l.current;u&&u.style.setProperty("display",i?"none":"block")},[i]),p.jsx("svg",{ref:l,className:Oe("tl-overlays__item",t),children:p.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:s,children:p.jsx(hq,{editor:a,id:e})})})}),fq=()=>p.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),YD=T.memo(function(){const e=te(),t=T.useRef(new Set),r=oe("should display selected ids",()=>{const a=t.current,l=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const u=e.getSelectedShapeIds();for(const d of u)l.add(d);if(e.isInAny("select.idle","select.editing_shape")){const d=e.getInstanceState();if(d.isHoveringCanvas&&!d.isCoarsePointer){const f=e.getHoveredShapeId();f&&l.add(f)}}}if(a.size!==l.size)return t.current=l,l;for(const u of l)if(!a.has(u))return t.current=l,l;return a},[e]),i=oe("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:s}=Ht();return s?i.map(({id:a})=>p.jsx(s,{shapeId:a,hidden:!r.has(a)},a+"_indicator")):null});function pq({points:n,zoom:e}){const t=2.5/e,r=n.reduce((m,S)=>Math.min(m,S.x),1/0),i=n.reduce((m,S)=>Math.max(m,S.x),-1/0),s=n.reduce((m,S)=>Math.min(m,S.y),1/0),a=n.reduce((m,S)=>Math.max(m,S.y),-1/0),l=n.some(m=>m.x===r&&m.y===s);let u,d,f,g;return l?(u=r,d=s,f=i,g=a):(u=r,d=a,f=i,g=s),p.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[p.jsx("line",{x1:u,y1:d,x2:f,y2:g}),n.map((m,S)=>p.jsx("g",{transform:`translate(${m.x},${m.y})`,children:p.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},S))]})}function gq({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],s=null;const a=e==="horizontal";for(const u of n){if(s=Qi(i[0],i[1],a?u.startEdge[0].y:u.startEdge[0].x,a?u.startEdge[1].y:u.startEdge[1].x),s)i=s;else continue;if(s=Qi(i[0],i[1],a?u.endEdge[0].y:u.endEdge[0].x,a?u.endEdge[1].y:u.endEdge[1].x),s)i=s;else continue}if(i===null)return null;const l=(i[0]+i[1])/2;return p.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:u,endEdge:d},f)=>p.jsx(T.Fragment,{children:a?p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:u[0].x,y1:l-2*r,x2:u[1].x,y2:l+2*r}),p.jsx("line",{x1:d[0].x,y1:l-2*r,x2:d[1].x,y2:l+2*r}),p.jsx("line",{x1:u[0].x,y1:l,x2:d[0].x,y2:l}),p.jsx("line",{x1:(u[0].x+d[0].x)/2,y1:l-r,x2:(u[0].x+d[0].x)/2,y2:l+r})]}):p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:l-2*r,y1:u[0].y,x2:l+2*r,y2:u[1].y}),p.jsx("line",{x1:l-2*r,y1:d[0].y,x2:l+2*r,y2:d[1].y}),p.jsx("line",{x1:l,y1:u[0].y,x2:l,y2:d[0].y}),p.jsx("line",{x1:l-r,y1:(u[0].y+d[0].y)/2,x2:l+r,y2:(u[0].y+d[0].y)/2})]})},f))})}function mq({className:n,line:e,zoom:t}){return p.jsx("svg",{className:Oe("tl-overlays__item",n),children:e.type==="points"?p.jsx(pq,{...e,zoom:t}):e.type==="gaps"?p.jsx(gq,{...e,zoom:t}):null})}function l_(){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const yq=()=>null;function VD(n,e){const t=T.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}const Sq=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:xj(n,e));function Ca(n){return VD(n,Sq)}const vq=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:Pj(n,e));function Cu(n){return VD(n,vq)}const XD=T.createContext(null);function bq({overrides:n={},children:e}){const t=Cu(n),r=T.useMemo(()=>({Background:cH,SvgDefs:yq,Brush:Kb,ZoomBrush:Kb,CollaboratorBrush:Kb,Cursor:_A,CollaboratorCursor:_A,CollaboratorHint:iq,CollaboratorShapeIndicator:EA,Grid:sq,Scribble:CA,SnapIndicator:mq,Handles:aq,Handle:oq,CollaboratorScribble:CA,ErrorFallback:ZD,ShapeErrorFallback:uq,ShapeIndicatorErrorFallback:fq,Spinner:l_,SelectionBackground:GD,SelectionForeground:cq,ShapeIndicators:YD,ShapeIndicator:EA,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:NK,LoadingScreen:lq,...t}),[t]);return p.jsx(XD.Provider,{value:r,children:e})}function Ht(){const n=T.useContext(XD);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const zm={openWindow(n,e){window.open(n,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function WD(){zm.hardReset()}function xq(){zm.refreshPage()}const wq="https://github.com/tldraw/tldraw/issues/new",ZD=({error:n,editor:e})=>{const t=T.useRef(null),[r,i]=T.useState(!1),[s,a]=T.useState(!1),[l,u]=T.useState(!1);let d=null;try{d=Ht().Canvas??null}catch{}const f=n instanceof Error?n.message:String(n),g=n instanceof Error?n.stack:null,m=oe("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[S,b]=T.useState(null);T.useLayoutEffect(()=>{var A;m!==null&&b(m);let M=(A=t.current)==null?void 0:A.parentElement,I=!1;for(;M;){if(M.classList.contains("tl-theme__dark")||M.classList.contains("tl-theme__light")){I=!0;break}M=M.parentElement}if(I){b(null);return}typeof window<"u"&&"matchMedia"in window&&b(window.matchMedia("(prefers-color-scheme: dark)").matches)},[m]),T.useEffect(()=>{if(s){const M=e==null?void 0:e.timers.setTimeout(()=>{a(!1)},2e3);return()=>clearTimeout(M)}},[s,e]);const x=()=>{const M=document.createElement("textarea");M.value=g??f,document.body.appendChild(M),M.select(),document.execCommand("copy"),M.remove(),a(!0)},w=()=>{xq()},_=async()=>{WD()},E=new URL(wq);return E.searchParams.set("title",f),E.searchParams.set("labels","bug"),E.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${g??f}
\`\`\`

My browser: ${navigator.userAgent}`),p.jsxs("div",{ref:t,className:Oe("tl-container tl-error-boundary",S===null?"":S?"tl-theme__dark":"tl-theme__light"),children:[p.jsx("div",{className:"tl-error-boundary__overlay"}),e&&p.jsx(e_,{onError:bh,fallback:()=>null,children:p.jsx(r_,{editor:e,children:p.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:d?p.jsx(d,{}):null})})}),p.jsx("div",{className:Oe("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!l}),children:l?p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Are you sure?"}),p.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>u(!1),children:"Cancel"}),p.jsx("button",{className:"tl-error-boundary__reset",onClick:_,children:"Reset data"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Something went wrong"}),p.jsx("p",{children:"Please refresh the page to continue."}),p.jsxs("p",{children:["If you keep seeing this screen, you can create a"," ",p.jsx("a",{href:E.toString(),children:"GitHub issue"})," or ask for help on"," ",p.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),r&&p.jsxs(p.Fragment,{children:["Message:",p.jsx("h4",{children:p.jsx("code",{children:f})}),"Stack trace:",p.jsxs("div",{className:"tl-error-boundary__content__error",children:[p.jsx("pre",{children:p.jsx("code",{children:g??f})}),p.jsx("button",{onClick:x,children:s?"Copied!":"Copy"})]})]}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),p.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[p.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>u(!0),children:"Reset data"}),p.jsx("button",{className:"tl-error-boundary__refresh",onClick:w,children:"Refresh Page"})]})]})]})})]})},QD="TLDRAW_USER_DATA_v3",JD=nt({id:qe,name:qe.nullable().optional(),color:qe.nullable().optional(),locale:qe.nullable().optional(),animationSpeed:Fe.nullable().optional(),edgeScrollSpeed:Fe.nullable().optional(),colorScheme:Dm("light","dark","system").optional(),isSnapMode:et.nullable().optional(),isWrapMode:et.nullable().optional(),isDynamicSizeMode:et.nullable().optional(),isPasteAtCursorMode:et.nullable().optional()}),wo={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},c_=Math.max(...Object.values(wo));function _q(n){n.version<wo.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<wo.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<wo.MakeFieldsNullable,n.version<wo.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<wo.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<wo.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<wo.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<wo.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=c_}const yw=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function eR(){return yw[Math.floor(Math.random()*yw.length)]}function Cq(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const Cs=Object.freeze({name:"New User",locale:nH(),color:eR(),edgeScrollSpeed:1,animationSpeed:Cq()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function Xb(){return{id:Ct(),color:eR()}}function tR(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return Xb();const e=$t(n);_q(e);try{return JD.validate(e.user)}catch{return Xb()}}function Eq(){const n=JSON.parse(C1(QD)||"null")??null;return tR(n)}const Fm=yn("globalUserData",null);function Pq(){E1(QD,JSON.stringify({version:c_,user:Fm.get()}))}function nR(n){JD.validate(n),Fm.set(n),Pq(),Tq()}const nu=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;nu==null||nu.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===iR&&(e==null?void 0:e.origin)!==rR()&&Fm.set(tR(e.data))});let Wb=null;function rR(){return Wb===null&&(Wb=Ct()),Wb}const iR="tldraw-user-preferences-change";function Tq(){nu==null||nu.postMessage({type:iR,origin:rR(),data:{user:sR(),version:c_}})}function sR(){let n=Fm.get();return n||(n=Eq(),nR(n)),n}const Iq=ue("defaultLocalStorageUserPrefs",()=>sR());function oR(n={}){return{userPreferences:n.userPreferences??Iq,setUserPreferences:n.setUserPreferences??nR}}var Zb={exports:{}},PA;function Mq(){return PA||(PA=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,d,f){this.fn=u,this.context=d,this.once=f||!1}function s(u,d,f,g,m){if(typeof f!="function")throw new TypeError("The listener must be a function");var S=new i(f,g||u,m),b=t?t+d:d;return u._events[b]?u._events[b].fn?u._events[b]=[u._events[b],S]:u._events[b].push(S):(u._events[b]=S,u._eventsCount++),u}function a(u,d){--u._eventsCount===0?u._events=new r:delete u._events[d]}function l(){this._events=new r,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],f,g;if(this._eventsCount===0)return d;for(g in f=this._events)e.call(f,g)&&d.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},l.prototype.listeners=function(d){var f=t?t+d:d,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,S=g.length,b=new Array(S);m<S;m++)b[m]=g[m].fn;return b},l.prototype.listenerCount=function(d){var f=t?t+d:d,g=this._events[f];return g?g.fn?1:g.length:0},l.prototype.emit=function(d,f,g,m,S,b){var x=t?t+d:d;if(!this._events[x])return!1;var w=this._events[x],_=arguments.length,E,M;if(w.fn){switch(w.once&&this.removeListener(d,w.fn,void 0,!0),_){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,f),!0;case 3:return w.fn.call(w.context,f,g),!0;case 4:return w.fn.call(w.context,f,g,m),!0;case 5:return w.fn.call(w.context,f,g,m,S),!0;case 6:return w.fn.call(w.context,f,g,m,S,b),!0}for(M=1,E=new Array(_-1);M<_;M++)E[M-1]=arguments[M];w.fn.apply(w.context,E)}else{var I=w.length,A;for(M=0;M<I;M++)switch(w[M].once&&this.removeListener(d,w[M].fn,void 0,!0),_){case 1:w[M].fn.call(w[M].context);break;case 2:w[M].fn.call(w[M].context,f);break;case 3:w[M].fn.call(w[M].context,f,g);break;case 4:w[M].fn.call(w[M].context,f,g,m);break;default:if(!E)for(A=1,E=new Array(_-1);A<_;A++)E[A-1]=arguments[A];w[M].fn.apply(w[M].context,E)}}return!0},l.prototype.on=function(d,f,g){return s(this,d,f,g,!1)},l.prototype.once=function(d,f,g){return s(this,d,f,g,!0)},l.prototype.removeListener=function(d,f,g,m){var S=t?t+d:d;if(!this._events[S])return this;if(!f)return a(this,S),this;var b=this._events[S];if(b.fn)b.fn===f&&(!m||b.once)&&(!g||b.context===g)&&a(this,S);else{for(var x=0,w=[],_=b.length;x<_;x++)(b[x].fn!==f||m&&!b[x].once||g&&b[x].context!==g)&&w.push(b[x]);w.length?this._events[S]=w.length===1?w[0]:w:a(this,S)}return this},l.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&a(this,f)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l}(Zb)),Zb.exports}var Aq=Mq();const kq=za(Aq),ru="TLDRAW_TAB_ID_v2",ko=globalThis.window;function jq(){return ko?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(ko.navigator.platform)||kt.isDarwin&&"ontouchend"in document:!1}const sm=ko?ko[ru]??Fj(ru)??"TLDRAW_INSTANCE_STATE_V1_"+Ct():"<error>";ko&&(ko[ru]=sm,jq()?P1(ru,sm):Bj(ru));ko==null||ko.addEventListener("beforeunload",()=>{P1(ru,sm)});const aR={Initial:0},Bm=Math.max(...Object.values(aR));function Oq(n){n.version<aR.Initial,n.version=Bm}const lR=nt({version:Fe,currentPageId:Ch.optional(),isFocusMode:et.optional(),exportBackground:et.optional(),isDebugMode:et.optional(),isToolLocked:et.optional(),isGridMode:et.optional(),pageStates:Ln(nt({pageId:Ch,camera:nt({x:Fe,y:Fe,z:Fe}).optional(),selectedShapeIds:Ln(_i).optional(),focusedGroupId:_i.nullable().optional()})).optional()});function Dq(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==Bm&&(n=$t(n),Oq(n));try{return lR.validate(n)}catch(e){return console.warn(e),null}}function u_(n){const e=n.query.ids("page");return ue("sessionStateSnapshot",()=>{const t=n.get(ur);if(!t)return null;const r=[...e.get()];return{version:Bm,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const s=n.get(ns.createId(i)),a=n.get(Ms.createId(i));return{pageId:i,camera:{x:(a==null?void 0:a.x)??0,y:(a==null?void 0:a.y)??0,z:(a==null?void 0:a.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}},{isEqual:NO})}function Sw(n,e,t){const r=Dq(e);if(!r)return;const i=JO(n.get(ur)),s=t!=null&&t.forceOverwrite?r:i,a=t!=null&&t.forceOverwrite?i:r,l=n.schema.types.instance.create({id:ur,...i,currentPageId:r.currentPageId,isDebugMode:(s==null?void 0:s.isDebugMode)??(a==null?void 0:a.isDebugMode),isFocusMode:(s==null?void 0:s.isFocusMode)??(a==null?void 0:a.isFocusMode),isToolLocked:(s==null?void 0:s.isToolLocked)??(a==null?void 0:a.isToolLocked),isGridMode:(s==null?void 0:s.isGridMode)??(a==null?void 0:a.isGridMode),exportBackground:(s==null?void 0:s.exportBackground)??(a==null?void 0:a.exportBackground)});n.atomic(()=>{var u,d,f;for(const g of r.pageStates??[]){if(!n.has(g.pageId))continue;const m=Ms.createId(g.pageId),S=ns.createId(g.pageId),b=n.get(m),x=n.get(S);n.put([Ms.create({id:m,x:((u=g.camera)==null?void 0:u.x)??(b==null?void 0:b.x),y:((d=g.camera)==null?void 0:d.y)??(b==null?void 0:b.y),z:((f=g.camera)==null?void 0:f.z)??(b==null?void 0:b.z)}),ns.create({id:S,pageId:g.pageId,selectedShapeIds:g.selectedShapeIds??(x==null?void 0:x.selectedShapeIds),focusedGroupId:g.focusedGroupId??(x==null?void 0:x.focusedGroupId)})])}n.put([l]),n.ensureStoreIsUsable()})}function Rq(n){var i;const e=[];for(const s of Object.values(n))(i=s.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const t=e.filter(s=>s.typeName==="instance"&&s.id!==ur)[0];if(!t)return null;const r={version:Bm,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===t.id).map(s=>{const a=n[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:a.x,y:a.y,z:a.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return lR.validate(r),r}catch{return null}}function cR(n,e,t){let r={};if("store"in e){const a=n.schema.migrateStoreSnapshot(e);if(a.type!=="success")throw new Error("Failed to migrate store snapshot: "+a.reason);r.document={schema:n.schema.serialize(),store:uh(a.value,(l,{typeName:u})=>n.scopedTypes.document.has(u))}}else r=e;const i=JO(n.get(ur)),s=uR.get(n,u_).get();n.atomic(()=>{r.document&&n.loadStoreSnapshot(r.document),i&&n.update(ur,a=>({...a,...i})),s&&Sw(n,s),r.session&&Sw(n,r.session,{forceOverwrite:t==null?void 0:t.forceOverwriteSessionState})})}const uR=new Rs;function Lq(n){const t=uR.get(n,u_).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function dR(n){const e=[],t=new Set;for(const r of n){if(t.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function Oa({children:n,className:e="",...t}){return p.jsx("svg",{...t,className:Oe("tl-svg-container",e),children:n})}function d_(n,e,t,r){const i=n.x-t.x,s=n.y-t.y,a=r.x-t.x,l=r.y-t.y,u=e.x-n.x,d=e.y-n.y,f=a*s-l*i,g=u*s-d*i,m=l*u-a*d;if(f===0||g===0||m===0)return null;if(m!==0){const S=f/m,b=g/m;if(0<=S&&S<=1&&0<=b&&b<=1)return P.AddXY(n,S*u,S*d)}return null}function Xh(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),s=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),a=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,l=s*s-4*i*a;if(l<0||l===0)return null;const u=Math.sqrt(l),d=(-s+u)/(2*i),f=(-s-u)/(2*i);if((d<0||d>1)&&(f<0||f>1))return null;const g=[];return 0<=d&&d<=1&&g.push(P.Lrp(n,e,d)),0<=f&&f<=1&&g.push(P.Lrp(n,e,f)),g.length===0?null:g}function Nq(n,e,t){const r=[];let i;for(let s=0,a=t.length-1;s<a;s++)i=d_(n,e,t[s],t[s+1]),i&&r.push(i);return r.length===0?null:r}function h_(n,e,t){const r=[];let i;for(let s=1,a=t.length;s<a+1;s++)i=d_(n,e,t[s-1],t[s%t.length]),i&&r.push(i);return r.length===0?null:r}function zq(n,e,t,r){let i=t.x-n.x,s=t.y-n.y;const a=Math.sqrt(i*i+s*s),l=(a*a-r*r+e*e)/(2*a),u=Math.sqrt(e*e-l*l);return i/=a,s/=a,[new P(n.x+i*l-s*u,n.y+s*l+i*u),new P(n.x+i*l+s*u,n.y+s*l-i*u)]}function vw(n,e,t){const r=[];let i,s,a;for(let l=0,u=t.length;l<u;l++)i=t[l],s=t[(l+1)%t.length],a=Xh(i,s,n,e),a&&r.push(...a);return r.length===0?null:r}function TA(n,e,t){const r=[];let i,s,a;for(let l=1,u=t.length;l<u;l++)i=t[l-1],s=t[l],a=Xh(i,s,n,e),a&&r.push(...a);return r.length===0?null:r}function Ap(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function f_(n,e,t,r){return Ap(n,t,r)!==Ap(e,t,r)&&Ap(n,e,t)!==Ap(n,e,r)}function IA(n,e){const t=new Map;let r,i,s,a;for(let l=0,u=n.length;l<u;l++)if(r=n[l],ei(r,e)){const d=Qb(r);t.has(d)||t.set(d,r)}for(let l=0,u=e.length;l<u;l++)if(r=e[l],ei(r,n)){const d=Qb(r);t.has(d)||t.set(d,r)}for(let l=0,u=n.length;l<u;l++){r=n[l],i=n[(l+1)%n.length];for(let d=0,f=e.length;d<f;d++){s=e[d],a=e[(d+1)%e.length];const g=d_(r,i,s,a);if(g!==null){const m=Qb(g);t.has(m)||t.set(m,g)}}}return t.size===0?null:Fq([...t.values()])}function Qb(n){return`${n.x},${n.y}`}function Fq(n){const e=P.Average(n);return n.sort((t,r)=>P.Angle(e,t)-P.Angle(e,r))}function p_(n,e){let t,r,i,s;for(let a=0,l=n.length;a<l;a++){t=n[a],r=n[(a+1)%l];for(let u=0,d=e.length;u<d;u++)if(i=e[u],s=e[(u+1)%d],f_(t,r,i,s))return!0}return!1}function Bq(n,e){let t,r,i,s;for(let a=0,l=n.length;a<l;a++){t=n[a],r=n[(a+1)%l];for(let u=1,d=e.length;u<d;u++)if(i=e[u-1],s=e[u],f_(t,r,i,s))return!0}return!1}class To extends Ka{constructor(t){super({...t,isClosed:!1,isFilled:!1});O(this,"start");O(this,"end");O(this,"d");O(this,"u");O(this,"ul");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,d:s,u:a,ul:l}=this;if(s.len()===0||l===0)return r;const u=P.Sub(t,r).dpr(a)/l,d=r.x+a.x*u;if(d<Math.min(r.x,i.x))return r.x<i.x?r:i;if(d>Math.max(r.x,i.x))return r.x>i.x?r:i;const f=r.y+a.y*u;return f<Math.min(r.y,i.y)?r.y<i.y?r:i:f>Math.max(r.y,i.y)?r.y>i.y?r:i:new P(d,f)}hitTestLineSegment(t,r,i=0){return f_(t,r,this.start,this.end)||this.distanceToLineSegment(t,r)<=i}getSvgPathData(t=!0){const{start:r,end:i}=this;return`${t?`M${r.toFixed()}`:""} L${i.toFixed()}`}}class Eu extends Ka{constructor(t){super({isClosed:!1,isFilled:!1,...t});O(this,"points");O(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const s=t[r],a=t[r+1];this._segments.push(new To({start:s,end:a}))}this.isClosed&&this._segments.push(new To({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],s=1/0,a,l;for(let u=0;u<r.length;u++)a=r[u].nearestPoint(t),l=P.Dist2(a,t),l<s&&(i=a,s=l);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(t,r,i=0){const{segments:s}=this;for(let a=0,l=s.length;a<l;a++)if(s[a].hitTestLineSegment(t,r,i))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((r,i,s)=>s===0?`M ${i.x} ${i.y}`:`${r} L ${i.x} ${i.y}`,"")}}class an extends Eu{constructor(e){super({...e}),this.isClosed=!0}}class ji extends an{constructor(t){const{x:r=0,y:i=0,width:s,height:a}=t;super({...t,points:[new P(r,i),new P(r+s,i),new P(r+s,i+a),new P(r,i+a)]});O(this,"x");O(this,"y");O(this,"w");O(this,"h");this.x=r,this.y=i,this.w=s,this.h=a}getBounds(){return new be(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:r,w:i,h:s}=this;return`M${t},${r} h${i} v${s} h-${i}z`}}class Mi{constructor(e){O(this,"options",{});this.editor=e}static configure(e){return class extends this{constructor(){super(...arguments);O(this,"options",{...this.options,...e})}}}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}O(Mi,"props"),O(Mi,"migrations"),O(Mi,"type");function es(n,e,t={}){const{closed:r=!1,snap:i=1,start:s="outset",end:a="outset",lengthRatio:l=2,style:u="dashed",forceSolid:d=!1}=t;let f=0,g=0,m=1,S=0,b=0;if(d)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(u){case"dashed":{m=1,f=Math.min(e*l,n/4);break}case"dotted":{m=100,f=e/m;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(n+=f/2,b+=f/2):s==="skip"&&(n-=f,b-=f),a==="outset"?n+=f/2:a==="skip"&&(n-=f)),g=Math.floor(n/f/(2*m)),g-=g%i,g<3&&u==="dashed"?n/e<4?(f=n,g=1,S=0):(f=n*(1/3),S=n*(1/3)):(f=n/g/(2*m),r?(b=f/2,S=(n-g*f)/g):S=(n-g*f)/Math.max(1,g-1)),{strokeDasharray:[f,S].join(" "),strokeDashoffset:b.toString()}}function MA({bounds:n,className:e}){const t=te(),r=oe("zoom level",()=>t.getZoomLevel(),[t]);return p.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,s)=>{const{strokeDasharray:a,strokeDashoffset:l}=es(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return p.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:a,strokeDashoffset:l},s)})})}class cg extends Mi{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new ji({width:1,height:1,isFilled:!1}):new ki({children:t.map(r=>{const i=this.editor.getShape(r),s=this.editor.getShapeGeometry(r),a=this.editor.getShapeLocalTransform(i).applyToPoints(s.vertices);return s.isClosed?new an({points:a,isFilled:!0}):new Eu({points:a})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),i=r.length>0&&r.some(l=>l!==e.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||i))return null;const a=this.editor.getShapeGeometry(e).bounds;return p.jsx(Oa,{children:p.jsx(MA,{className:"tl-group",bounds:a})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return p.jsx(MA,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}O(cg,"type","group"),O(cg,"props",dD),O(cg,"migrations",hD);const hR=[cg],Uq=new Set(hR.map(n=>n.type));function fR(n){const e=[...hR],t=new Set;for(const r of n){if(Uq.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}var Pu=mj();const $q=za(Pu);function pR(n,e){const t=new Map;return async function(i){const s=t.get(i);if(s)return s;const a=(async()=>{try{const l=await Ls(i,e);return vt(l.ok),await n(l)}catch(l){return console.error(l),null}})();return t.set(i,a),a}}const Um=pR(async n=>await ts.blobToDataUrl(await n.blob())),Hq=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,Kq=/@font-face\s*{([^}]+)}/gi,gR=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,qq=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function Gq(n){return Array.from(n.matchAll(Hq),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function mR(n,e){return Array.from(n.matchAll(Kq),t=>{const r=t[1],i=Array.from(r.matchAll(gR),a=>{var u;const l=a[1]||a[2]||a[3];return{original:l,resolved:((u=Ke(l,e))==null?void 0:u.href)??null}}),s=new Set(Array.from(r.matchAll(qq),a=>(a[1]||a[2]||a[3]).toLowerCase()));return{fontFace:r,urls:i,fontFamilies:s}})}function Yq(n){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,r=new Set;for(;;){const i=e.exec(n);if(!i)break;const s=i[1]||i[2]||i[3];if(r.add(s.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(n))break;e.lastIndex=t.lastIndex}return r}function yR(n){return!(n.startsWith("-")||n.startsWith("animation")||n.startsWith("transition")||n==="cursor"||n==="pointer-events"||n==="user-select"||n==="touch-action")}function Vq(n,e){return{imports:Gq(n),fontFaces:mR(n,e)}}function Xq(n){return Array.from(n.matchAll(gR),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const Wq=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function SR(n){return Wq.has(n)}var Zq=Object.create,vR=Object.defineProperty,Qq=Object.getOwnPropertyDescriptor,Jq=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),bR=n=>{throw TypeError(n)},xR=(n,e,t)=>e in n?vR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,eG=n=>[,,,Zq(null)],wR=["class","method","getter","setter","accessor","field","value","get","set"],_R=n=>n!==void 0&&typeof n!="function"?bR("Function expected"):n,tG=(n,e,t,r,i)=>({kind:wR[n],name:e,metadata:r,addInitializer:s=>t._?bR("Already initialized"):i.push(_R(s||null))}),nG=(n,e)=>xR(e,Jq("metadata"),n[3]),rG=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},iG=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=wR[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,Qq(i,t)),_=r.length-1;_>=0;_--)u=tG(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,_R(a)&&(w[b]=a);return w&&vR(i,t,w),i},kp=(n,e,t)=>xR(n,typeof e!="symbol"?e+"":e,t),CR,$m;CR=[Lr];class g_{constructor(){rG($m,5,this),kp(this,"fontFacesPromise",null),kp(this,"foundFontNames",new Set),kp(this,"fontFacesToEmbed",new Set),kp(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){vt(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=sG()}onFontFamilyValue(e){vt(this.fontFacesPromise,"FontEmbedder not started");const t=Yq(e);for(const r of t){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(i=>{const s=i.filter(a=>a.fontFamilies.has(r));for(const a of s)if(!this.fontFacesToEmbed.has(a)){this.fontFacesToEmbed.add(a);for(const l of a.urls)!l.resolved||l.embedded||(l.embedded=Um(l.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let r=`@font-face {${t.fontFace}}`;for(const i of t.urls){if(!i.embedded)continue;const s=await i.embedded;s&&(r=r.replace(i.original,s))}e+=r}return e}}$m=eG();iG($m,1,"onFontFamilyValue",CR,g_);nG($m,g_);async function sG(){var e;const n=[];for(const t of document.styleSheets){let r;try{r=t.cssRules}catch{}if(r){for(const i of t.cssRules)if(i instanceof CSSFontFaceRule)n.push(mR(i.cssText,t.href??document.baseURI));else if(i instanceof CSSImportRule){const s=new URL(i.href,((e=i.parentStyleSheet)==null?void 0:e.href)??document.baseURI);n.push(bw(s.href))}}else t.href&&n.push(bw(t.href))}return Ye(await Promise.all(n)).flat()}const bw=pR(async n=>{const e=Vq(await n.text(),n.url),t=await Promise.all(e.imports.map(({url:r})=>bw(new URL(r,n.url).href)));return[...e.fontFaces,...Ye(t).flat()]});function ER(n){if(n.shadowRoot)return n.shadowRoot.childNodes;if(cG(n)){const e=n.assignedNodes();if(e!=null&&e.length)return e}return n.childNodes}function*xw(n){for(const e of ER(n))oG(e)&&(yield e)}function Hm(n){var e;return((e=n.ownerDocument)==null?void 0:e.defaultView)??globalThis}function oG(n){return n instanceof Hm(n).Element}function aG(n){return n instanceof Hm(n).ShadowRoot}function lG(n){return"getRootNode"in n&&aG(n.getRootNode())}function cG(n){return lG(n)&&n instanceof Hm(n).HTMLSlotElement}function uG(n){return n.style}function m_(n,e){return Hm(n).getComputedStyle(n,e)}const kl={};class dG{constructor(e){O(this,"styles",new Map);O(this,"fonts",new g_);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(xw(e));for(;t.length;){const r=t.pop();t.push(...xw(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:r=!0}){var l;const i=t?gG(e.tagName.toLowerCase()):kl,s=r?((l=this.styles.get(e.parentElement))==null?void 0:l.self)??kl:kl,a={self:hG(e,{defaultStyles:i,parentStyles:s}),before:AA(e,"::before"),after:AA(e,"::after")};this.styles.set(e,a)}fetchResources(){const e=[];for(const t of this.styles.values())for(const r of Zt(t))if(r)for(const[i,s]of Object.entries(r)){if(!s)continue;i==="font-family"&&this.fonts.onFontFamilyValue(s);const a=Xq(s);a.length!==0&&e.push(...a.map(async({url:l,original:u})=>{const d=await Um(l)??"data:";r[i]=s.replace(u,`url("${d}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(r,i)=>{if(e.has(r))return;e.add(r);const s=r.shadowRoot;if(s){const a=document.createElement("div");this.styles.set(a,this.styles.get(r)),a.setAttribute("data-tl-custom-element",r.tagName),(i??r.parentElement).appendChild(a);for(const l of s.childNodes)l instanceof Element?t(l,a):a.appendChild(l.cloneNode(!0));r.remove()}else if(i){if(r.tagName.toLowerCase()==="style")return;const a=r.cloneNode(!1);this.styles.set(a,this.styles.get(r)),i.appendChild(a);for(const l of ER(r))l instanceof Element?t(l,a):a.appendChild(l.cloneNode(!0))}};for(const r of this.styles.keys())t(r,null)}embedStyles(){let e="";for(const[t,r]of this.styles){if(r.after||r.before){const s=`pseudo-${Ct()}`;t.classList.add(s),r.before&&(e+=`.${s}::before {${kA(r.before)}}
`),r.after&&(e+=`.${s}::after {${kA(r.after)}}
`)}const i=uG(t);for(const[s,a]of Object.entries(r.self))a&&i.setProperty(s,a);i.fontKerning==="auto"&&(i.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){pG()}}function hG(n,{defaultStyles:e,parentStyles:t}){return n.computedStyleMap?PR(n.computedStyleMap(),{defaultStyles:e,parentStyles:t}):y_(m_(n),{defaultStyles:e,parentStyles:t})}function AA(n,e){const t=m_(n,e),r=t.getPropertyValue("content");if(!(r===""||r==="none"))return y_(t,{defaultStyles:kl,parentStyles:kl})}function PR(n,{defaultStyles:e,parentStyles:t}){const r={};for(const i of n.keys()){if(!yR(i))continue;const s=n.get(i).toString();e[i]!==s&&(t[i]===s&&SR(i)||(r[i]=s))}return r}function y_(n,{defaultStyles:e,parentStyles:t}){const r={};for(const i of n){if(!yR(i))continue;const s=n.getPropertyValue(i);e[i]!==s&&(t[i]===s&&SR(i)||(r[i]=s))}return r}function kA(n){let e="";for(const[t,r]of Object.entries(n))e+=`${t}: ${r};`;return e}let iu;const jA={};function fG(){if(!iu){const n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n);const e=jr(n.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(r),e.body.appendChild(t),iu={iframe:n,foreignObject:r,document:e}}return iu}function pG(){iu&&(document.body.removeChild(iu.iframe),iu=void 0)}const OA={defaultStyles:kl,parentStyles:kl};function gG(n){let e=jA[n];if(!e){const{foreignObject:t,document:r}=fG(),i=r.createElement(n);t.appendChild(i),e=i.computedStyleMap?PR(i.computedStyleMap(),OA):y_(m_(i),OA),t.removeChild(i),jA[n]=e}return e}function mG(n,e){Array.from(n.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function DA(n,e){return n.replaceWith(e),e}async function fh(n,e){const t=document.createElement("img");e&&mG(e,t),t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function yG(n){try{const e=n.toDataURL();return await fh(e,n)}catch{return await fh(null,n)}}async function SG(n){try{const e=await Zr.getVideoFrameAsDataUrl(n);return fh(e,n)}catch(e){console.error("Could not get video frame",e)}if(n.poster){const e=await Um(n.poster);return fh(e,n)}return fh(null,n)}async function TR(n){if(n instanceof HTMLCanvasElement)return DA(n,await yG(n));if(n instanceof HTMLVideoElement)return DA(n,await SG(n));if(n instanceof HTMLImageElement){const e=n.currentSrc||n.src,t=await Um(e);n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}else n instanceof HTMLInputElement?n.setAttribute("value",n.value):n instanceof HTMLTextAreaElement&&(n.textContent=n.value);await Promise.all(Array.from(xw(n),e=>TR(e)))}function Km(n){const e=T.useRef();return T.useLayoutEffect(()=>{e.current=n}),T.useDebugValue(n),T.useCallback((...t)=>{const r=e.current;return vt(r,"fn does not exist"),r(...t)},[])}const S_=T.createContext(null);function vG({context:n,editor:e,children:t}){const r=e.options.exportProvider;return p.jsx(r_,{editor:e,children:p.jsx(AD,{container:e.getContainer(),children:p.jsx(S_.Provider,{value:n,children:p.jsx(r,{children:t})})})})}function Wh(){return T.useContext(S_)}function bG(){const n=T.useContext(S_),[e]=T.useState(g1);return T.useEffect(()=>(n==null||n.waitUntil(e),()=>{e.resolve()}),[e,n]),Km(()=>{e.resolve()})}var xG=Object.create,IR=Object.defineProperty,wG=Object.getOwnPropertyDescriptor,_G=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),MR=n=>{throw TypeError(n)},AR=(n,e,t)=>e in n?IR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,CG=n=>[,,,xG(null)],kR=["class","method","getter","setter","accessor","field","value","get","set"],jR=n=>n!==void 0&&typeof n!="function"?MR("Function expected"):n,EG=(n,e,t,r,i)=>({kind:kR[n],name:e,metadata:r,addInitializer:s=>t._?MR("Already initialized"):i.push(jR(s||null))}),PG=(n,e)=>AR(e,_G("metadata"),n[3]),TG=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},IG=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=kR[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,wG(i,t)),_=r.length-1;_>=0;_--)u=EG(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,jR(a)&&(w[b]=a);return w&&IR(i,t,w),i},RA=(n,e,t)=>AR(n,typeof e!="symbol"?e+"":e,t),OR,qm;OR=[Lr];class v_{constructor(e){this.maxDelayTimeMs=e,TG(qm,5,this),RA(this,"isResolved",!1),RA(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error whilst waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await ew(0)}async resolve(){const e=ew(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}qm=CG();IG(qm,1,"waitUntil",OR,v_);PG(qm,v_);function MG(n,e,t={}){var _,E;if(!window.document)throw Error("No document");const{scale:r=1,background:i=n.getInstanceState().exportBackground,padding:s=n.options.defaultSvgPadding,preserveAspectRatio:a}=t,l=t.darkMode??n.user.getIsDarkMode(),u=n.getShapeAndDescendantIds(e),d=n.getUnorderedRenderingShapes(!1).filter(({id:M})=>u.has(M));let f=null;if(t.bounds)f=t.bounds;else for(const{id:M}of d){const I=n.getShapeMaskedPageBounds(M);I&&(f?f.union(I):f=I.clone())}if(!f)return;const g=e.length===1&&n.isShapeOfType(n.getShape(e[0]),"frame")?e[0]:null;g||f.expandBy(s);const m=f.width*r,S=f.height*r;try{(E=(_=document.body).focus)==null||E.call(_)}catch{}const b=new v_(n.options.maxExportDelayMs),x=g1();return b.waitUntil(x),{jsx:p.jsx(AG,{editor:n,preserveAspectRatio:a,scale:r,pixelRatio:t.pixelRatio??null,bbox:f,background:i,singleFrameShapeId:g,isDarkMode:l,renderingShapes:d,onMount:x.resolve,waitUntil:b.waitUntil}),width:m,height:S,exportDelay:b}}function AG({editor:n,preserveAspectRatio:e,scale:t,pixelRatio:r,bbox:i,background:s,singleFrameShapeId:a,isDarkMode:l,renderingShapes:u,onMount:d,waitUntil:f}){const g=wu(),m=Bo({isDarkMode:l}),S=F1("export state",{defsById:{},shapeElements:null}),{defsById:b,shapeElements:x}=oe(S),w=Km(M=>{S.update(I=>{if(Ii(I.defsById,M.key))return I;const A=Promise.resolve(M.getElement());return f(A.then(j=>{S.update(D=>({...D,defsById:{...D.defsById,[M.key]:{pending:!1,element:j}}}))})),{...I,defsById:{...I.defsById,[M.key]:{pending:!0,element:A}}}})}),_=T.useMemo(()=>({isDarkMode:l,waitUntil:f,addExportDef:w,scale:t,pixelRatio:r,async resolveAssetUrl(M,I){const A=n.getAsset(M);return!A||A.type!=="image"&&A.type!=="video"?null:await n.resolveAssetUrl(M,{screenScale:t*(I/A.props.w),shouldResolveToOriginal:r===null,dpr:r??void 0})}}),[l,f,w,t,r,n]),E=T.useRef(!1);return T.useLayoutEffect(()=>{if(E.current)throw new Error("SvgExport should only render once - do not use with react strict mode");E.current=!0,(async()=>{const M={},I=u.map(async({id:j,opacity:D,index:R,backgroundIndex:q})=>{var z,U;if(j===a)return[];const L=n.getShape(j);if(n.isShapeOfType(L,"group"))return[];const K=[],G=n.getShapeUtil(L);if(G.toSvg||G.toBackgroundSvg){const[Y,H]=await Promise.all([(z=G.toSvg)==null?void 0:z.call(G,L,_),(U=G.toBackgroundSvg)==null?void 0:U.call(G,L,_)]),X=n.getShapePageTransform(L);let V=X.toCssString(),ie=1;"scale"in L.props&&L.props.scale!==1&&(ie=L.props.scale,V=`${V} scale(${L.props.scale}, ${L.props.scale})`);const B=n.getShapeMask(L.id),re=B?ve.From(ve.Inverse(X)).applyToPoints(B):null,me=t_(g,L.id);re&&(M[me]={pending:!1,element:p.jsx("clipPath",{id:me,children:p.jsx("path",{d:`M${re.map(({x:de,y:ye})=>`${de/ie},${ye/ie}`).join("L")}Z`})})}),Y&&K.push({zIndex:R,element:p.jsx("g",{transform:V,opacity:D,clipPath:B?`url(#${me})`:void 0,children:Y},`fg_${L.id}`)}),H&&K.push({zIndex:q,element:p.jsx("g",{transform:V,opacity:D,clipPath:B?`url(#${me})`:void 0,children:H},`bg_${L.id}`)})}else K.push({zIndex:R,element:p.jsx(LA,{shape:L,util:G,component:KD,className:"tl-shape",bbox:i,opacity:D},`fg_${L.id}`)}),G.backgroundComponent&&K.push({zIndex:q,element:p.jsx(LA,{shape:L,util:G,component:qD,className:"tl-shape tl-shape-background",bbox:i,opacity:D},`bg_${L.id}`)});return K}),A=(await Promise.all(I)).flat();Pu.flushSync(()=>{S.update(j=>({...j,shapeElements:A.sort((D,R)=>D.zIndex-R.zIndex).map(({element:D})=>D),defsById:{...j.defsById,...M}}))})})()},[i,n,_,g,u,a,S]),T.useEffect(()=>{x!==null&&d()},[d,x]),p.jsx(vG,{editor:n,context:_,children:p.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:i.width*t,height:i.height*t,viewBox:`${i.minX} ${i.minY} ${i.width} ${i.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:s?a?m.solid:m.background:"transparent"},"data-color-mode":l?"dark":"light",className:`tl-container tl-theme__force-sRGB ${l?"tl-theme__dark":"tl-theme__light"}`,children:[p.jsx("defs",{children:Object.entries(b).map(([M,I])=>I.pending?null:p.jsx(T.Fragment,{children:I.element},M))}),x]})})}function LA({shape:n,util:e,className:t,component:r,bbox:i,opacity:s}){const a=te(),l=ve.Translate(-i.minX,-i.minY).multiply(a.getShapePageTransform(n.id)),u=a.getShapeGeometry(n.id).bounds,d=Math.max(u.width,1),f=Math.max(u.height,1);return p.jsx(e_,{fallback:()=>null,children:p.jsx("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object",children:p.jsx("div",{className:t,"data-shape-type":n.type,style:{clipPath:a.getShapeClipPath(n.id),transform:l.toCssString(),width:d,height:f,opacity:s},children:p.jsx(r,{shape:n,util:e})})})})}let kG=1;async function jG(n,e,t={}){const r=MG(n,e,t);if(!r)return;const i=n.getContainer(),s=document.createElement("div");s.className="tldraw-svg-export",s.inert=!0,s.tabIndex=-1,Object.assign(s.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(s);const a=yj.createRoot(s,{identifierPrefix:`export_${kG++}_`});try{await Promise.resolve(),Pu.flushSync(()=>{a.render(r.jsx)}),await r.exportDelay.resolve();const l=s.firstElementChild;return vt(l instanceof SVGSVGElement,"Expected an SVG element"),await OG(l),{svg:l,width:r.width,height:r.height}}finally{setTimeout(()=>{a.unmount(),i.removeChild(s)},0)}}async function OG(n){const e=[...n.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const t=new dG(n);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(s=>TR(s)));for(const s of e)t.readRootElementStyles(s);await t.fetchResources();const r=await t.getFontFaceCss();t.unwrapCustomElements();const i=t.embedStyles();if(r||i){const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent=`${r}
${i}`,n.prepend(s)}}finally{t.dispose()}}/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function ph(n){const e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],s=performance.now(),a=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let l,u;a?(l=new OffscreenCanvas(1,1),u=new OffscreenCanvas(t,r)):(l=document.createElement("canvas"),l.width=1,l.height=1,u=document.createElement("canvas"),u.width=t,u.height=r);const d=l.getContext("2d"),f=u.getContext("2d");f&&(f.fillRect.apply(f,i),d.drawImage(u,t-1,r-1,1,1,0,0,1,1));const g=d&&d.getImageData(0,0,1,1).data[3]!==0,m=parseInt(performance.now()-s);return[l,u].forEach(S=>{S.height=0,S.width=0}),a?(postMessage({width:t,height:r,testTime:m,isTestPass:g}),!g&&n.sizes.length&&setTimeout(()=>{ph(n)},0)):g?n.onSuccess({width:t,height:r,testTime:m}):(n.onError({width:t,height:r,testTime:m}),n.sizes.length&&setTimeout(()=>{ph(n)},0)),g}const Jb={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Zc={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},qd={};function ex(n){const e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(s=>{const a=e||t?s:1,l=e||r?s:1;i.push([a,l])});else{const s=n.min||Zc.min,a=n.step||Zc.step;let l=Math.max(n.width,n.height);for(;l>=s;){const u=e||t?l:1,d=e||r?l:1;i.push([u,d]),l-=a}}return i}function jp(n){const e=typeof window<"u",t=e&&"Promise"in window,r=e&&"HTMLCanvasElement"in window,i=e&&"OffscreenCanvas"in window,s=URL.createObjectURL(new Blob([])).slice(-36),a=performance.now(),{onError:l,onSuccess:u,...d}=n,f=()=>parseInt(performance.now()-a);let g=null;if(!r)return!1;if(n.useWorker&&i){const m=`
            var canvasTest = ${ph.toString()};
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `,S=new Blob([m],{type:"application/javascript"}),b=URL.createObjectURL(S);g=new Worker(b),URL.revokeObjectURL(b),g.onmessage=function(x){const{width:w,height:_,testTime:E,isTestPass:M}=x.data,I={width:w,height:_,testTime:E,totalTime:f()};M?(qd[s].onSuccess(I),delete qd[s]):qd[s].onError(I)}}if(t)return new Promise(m=>{const S={...n,onError(b){let{width:x,height:w,testTime:_}=b;const E={width:x,height:w,testTime:_,totalTime:f()};let M;if(n.sizes.length===0)M=!0;else{const[[I,A]]=n.sizes.slice(-1);M=x===I&&w===A}l(E),M&&m({...E,success:!1})},onSuccess(b){let{width:x,height:w,testTime:_}=b;const E={width:x,height:w,testTime:_,totalTime:f()};u(E),m({...E,success:!0})}};if(g){const{onError:b,onSuccess:x}=S;qd[s]={onError:b,onSuccess:x},g.postMessage(d)}else ph(S)});if(g)qd[s]={onError:l,onSuccess:u},g.postMessage(d);else return ph(n)}const tx={maxArea(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=ex({width:n.max,height:n.max,min:n.min,step:n.step,sizes:[...Jb.area]}),t={...Zc,...n,sizes:e};return jp(t)},maxHeight(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=ex({width:1,height:n.max,min:n.min,step:n.step,sizes:[...Jb.height]}),t={...Zc,...n,sizes:e};return jp(t)},maxWidth(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=ex({width:n.max,height:1,min:n.min,step:n.step,sizes:[...Jb.width]}),t={...Zc,...n,sizes:e};return jp(t)},test(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={...Zc,...n};return e.sizes=[...e.sizes],e.width&&e.height&&(e.sizes=[[e.width,e.height]]),jp(e)}};let nx=null;function DG(){return nx||(nx=RG()),nx}async function RG(){const n=await tx.maxWidth({usePromise:!0}),e=await tx.maxHeight({usePromise:!0}),t=await tx.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const NA=8192,LG=4096*4096;async function NG(n,e){if(n<=NA&&e<=NA&&n*e<=LG)return[n,e];const{maxWidth:t,maxHeight:r,maxArea:i}=await DG(),s=n/e;if(n>t&&(n=t,e=n/s),e>r&&(e=r,n=e*s),n*e>i){const a=Math.sqrt(i/(n*e));n*=a,e*=a}return[n,e]}async function zG(n,e){const{type:t,width:r,height:i,quality:s=1,pixelRatio:a=2}=e;let[l,u]=await NG(r*a,i*a);l=Math.floor(l),u=Math.floor(u);const d=l/r,f=await ts.blobToDataUrl(new Blob([n],{type:"image/svg+xml"})),g=await new Promise(S=>{const b=xh();b.crossOrigin="anonymous",b.onload=async()=>{kt.isSafari&&await ew(250);const x=document.createElement("canvas"),w=x.getContext("2d");x.width=l,x.height=u,w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.drawImage(b,0,0,l,u),URL.revokeObjectURL(f),S(x)},b.onerror=()=>{S(null)},b.src=f});if(!g)return null;const m=await new Promise(S=>g.toBlob(b=>{(!b||ln.throwToBlob.get())&&S(null),S(b)},"image/"+t,s));if(!m)return null;if(t==="png"){const S=new DataView(await m.arrayBuffer());return Ps.setPhysChunk(S,d,{type:"image/"+t})}else return m}const Ji={menus:yn("open menus",[]),getOpenMenus(n){return n?this.menus.get().filter(e=>e.endsWith("-"+n)):this.menus.get()},addOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)||(r.add(t),this.menus.set([...r]))},deleteOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)&&(r.delete(t),this.menus.set([...r]))},clearOpenMenus(n){this.menus.set(n?this.menus.get().filter(e=>!e.endsWith("-"+n)):[])},_hiddenMenus:[],hideOpenMenus(n){if(this._hiddenMenus=[...this.getOpenMenus(n)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,n)},showOpenMenus(n){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,n);this._hiddenMenus=[]}},isMenuOpen(n,e){return this.getOpenMenus(e).includes(n)},hasOpenMenus(n){return this.getOpenMenus(n).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(n){return{getOpenMenus:()=>this.getOpenMenus(n),addOpenMenu:e=>this.addOpenMenu(e,n),deleteOpenMenu:e=>this.deleteOpenMenu(e,n),clearOpenMenus:()=>this.clearOpenMenus(n),isMenuOpen:e=>this.isMenuOpen(e,n),hasOpenMenus:()=>this.hasOpenMenus(n),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},ww=new KF,FG={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:T.Fragment,enableToolbarKeyboardShortcuts:!0};function zA(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw mn(n)}}class BG{constructor(e){O(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!zA(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!zA(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class _w extends BG{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:mn(r,"type")}}}function UG(n,e,t){return Ls(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}const $G="https://cdn.tldraw.com";function Ta(){return`${$G}/${ED}`}function HG(n){switch(n.type){case"shapes":return`s${n.shapeIds.map(t=>rx(t.slice(6))).join(".")}`;case"page":return"p"+rx(si.parseId(n.pageId));case"viewport":{const{bounds:e,pageId:t}=n;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(r+="."+rx(si.parseId(t))),r}default:mn(n)}}function KG(n){switch(n[0]){case"s":return{type:"shapes",shapeIds:n.slice(1).split(".").filter(Boolean).map(r=>Mt(decodeURIComponent(r)))};case"p":return{type:"page",pageId:si.createId(decodeURIComponent(n.slice(1)))};case"v":{const[t,r,i,s,a]=n.slice(1).split(".");return{type:"viewport",bounds:new be(Number(t),Number(r),Number(i),Number(s)),pageId:a?si.createId(decodeURIComponent(a)):void 0}}default:throw Error("Invalid deep link string")}}function rx(n){return encodeURIComponent(n).replace(/\./g,"%2E")}function qG(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function Op(n,e,t,r){if(t.length===0)return[];const i=new Map;for(const a of Ye(t.map(l=>n.getShape(l)))){const{parentId:l}=a;i.has(l)||i.set(l,{children:Ye(n.getSortedChildIdsForParent(l).map(u=>n.getShape(u))),moving:new Set}),i.get(l).moving.add(a)}const s=[];switch(e){case"toBack":{i.forEach(({moving:a,children:l})=>GG(a,l,s));break}case"toFront":{i.forEach(({moving:a,children:l})=>YG(a,l,s));break}case"forward":{i.forEach(({moving:a,children:l})=>VG(n,a,l,s,r));break}case"backward":{i.forEach(({moving:a,children:l})=>XG(n,a,l,s,r));break}}return s}function GG(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let a=0;a<r;a++){const l=e[a];if(n.has(l))i=l.index,n.delete(l);else{s=l.index;break}}if(n.size!==0){const a=cu(i,s,n.size);t.push(...Array.from(n.values()).sort(Jn).map((l,u)=>({...l,index:a[u]})))}}function YG(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let a=r-1;a>-1;a--){const l=e[a];if(n.has(l))s=l.index,n.delete(l);else{i=l.index;break}}if(n.size!==0){const a=cu(i,s,n.size);t.push(...Array.from(n.values()).sort(Jn).map((l,u)=>({...l,index:a[u]})))}}function FA(n,e){const t=n.getShapeGeometry(e),r=n.getShapePageTransform(e);return!t||!r?null:r.applyToPoints(t.vertices)}function DR(n,e){const t=Array.from(e).map(i=>{const s=FA(n,i);return s?{shape:i,vertices:s}:null}).filter(Boolean);return i=>{const s=FA(n,i);return s?t.some(a=>p_(a.vertices,s)):!1}}function VG(n,e,t,r,i){var u;const s=DR(n,e),a=t.length;if(e.size===a)return;let l={name:"skipping"};for(let d=0;d<a;d++){const f=e.has(t[d]);switch(l.name){case"skipping":{if(!f)continue;l={name:"selecting",selectIndex:d};break}case"selecting":{if(f||!(i!=null&&i.considerAllShapes)&&!s(t[d]))continue;const{selectIndex:g}=l;cu(t[d].index,(u=t[d+1])==null?void 0:u.index,d-g).forEach((m,S)=>{const b=t[g+S];e.has(b)&&r.push({...b,index:m})}),l={name:"skipping"};break}}}}function XG(n,e,t,r,i){var u;const s=DR(n,e),a=t.length;if(e.size===a)return;let l={name:"skipping"};for(let d=a-1;d>-1;d--){const f=e.has(t[d]);switch(l.name){case"skipping":{if(!f)continue;l={name:"selecting",selectIndex:d};break}case"selecting":{if(f||!(i!=null&&i.considerAllShapes)&&!s(t[d]))continue;cu((u=t[d-1])==null?void 0:u.index,t[d].index,l.selectIndex-d).forEach((g,m)=>{const S=t[d+m+1];e.has(S)&&r.push({...S,index:g})}),l={name:"skipping"};break}}}}function RR({editor:n,ids:e}){const t=Ye(e.map(a=>n.getShape(a))),r=n.getShapesSharedRotation(e),i=n.getShapesRotatedPageBounds(e);if(!i)return null;const s=i.center.clone().rotWith(i.point,r);return{pageCenter:s,initialCursorAngle:s.angle(n.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:t.map(a=>({shape:a,initialPagePoint:n.getShapePageTransform(a.id).point()}))}}function ug({delta:n,editor:e,snapshot:t,stage:r,centerOverride:i}){const{pageCenter:s,shapeSnapshots:a}=t;e.updateShapes(a.map(({shape:u,initialPagePoint:d})=>{const f=kr(u.parentId)?e.getShapePageTransform(u.parentId):ve.Identity(),g=P.RotWith(d,i??s,n),m=ve.applyToPoint(ve.Inverse(f),g),S=Ml(u.rotation+n);return{id:u.id,type:u.type,x:m.x,y:m.y,rotation:S}}));const l=[];a.forEach(({shape:u})=>{var m,S,b;const d=e.getShape(u.id);if(!d)return;const f=e.getShapeUtil(u);if(r==="start"||r==="one-off"){const x=(m=f.onRotateStart)==null?void 0:m.call(f,u);x&&l.push(x)}const g=(S=f.onRotate)==null?void 0:S.call(f,u,d);if(g&&l.push(g),r==="end"||r==="one-off"){const x=(b=f.onRotateEnd)==null?void 0:b.call(f,u,d);x&&l.push(x)}}),l.length>0&&e.updateShapes(l)}const WG=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),r=e.query.records("binding");function i(){const s=r.get(),a=new Map;for(const l of s){const{fromId:u,toId:d}=l,f=a.get(u);f?f.push(l):a.set(u,[l]);const g=a.get(d);g?g.push(l):a.set(d,[l])}return a}return ue("arrowBindingsIndex",(s,a)=>{if(Il(s))return i();const l=s,u=t.getDiffSince(a);if(u===Jr)return i();let d;function f(S){d??(d=new Map(l));const b=d.get(S.fromId),x=b==null?void 0:b.filter(E=>E.id!==S.id);x!=null&&x.length?d.set(S.fromId,x):d.delete(S.fromId);const w=d.get(S.toId),_=w==null?void 0:w.filter(E=>E.id!==S.id);_!=null&&_.length?d.set(S.toId,_):d.delete(S.toId)}function g(S){d??(d=new Map(l));let b=d.get(S);return b?b===l.get(S)&&(b=b.slice(0),d.set(S,b)):(b=[],d.set(S,b)),b}function m(S){g(S.fromId).push(S),g(S.toId).push(S)}for(const S of u){for(const b of Zt(S.added))m(b);for(const[b,x]of Zt(S.updated))f(b),m(x);for(const b of Zt(S.removed))f(b)}return d??l})};function ZG(n,e,t){const r=n.getShapeMaskedPageBounds(e);return r===void 0?!0:!t.includes(r)}const QG=n=>{function e(t){const r=t.getCurrentPageShapeIds(),i=t.getViewportPageBounds(),s=new Set;return r.forEach(a=>{ZG(t,a,i)&&s.add(a)}),s}return ue("getCulledShapes",t=>{if(Il(t))return e(n);const r=e(n);if(t.size!==r.size)return r;for(const i of t)if(!r.has(i))return r;return t})},JG=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function r(){const i={},s=e.get(),a=Array(s.size);return s.forEach(l=>a.push(n.get(l))),a.sort(Jn),a.forEach(l=>{i[l.parentId]||(i[l.parentId]=[]),i[l.parentId].push(l.id)}),i}return ue("parentsToChildrenWithIndexes",(i,s)=>{if(Il(i))return r();const a=t.getDiffSince(s);if(a===Jr)return r();if(a.length===0)return i;let l=null;const u=g=>{l||(l={...i}),l[g]?l[g]===i[g]&&(l[g]=[...l[g]]):l[g]=[]},d=new Set;let f;for(let g=0,m=a.length;g<m;g++){f=a[g];for(const S of Object.values(f.added))Wc(S)&&(u(S.parentId),l[S.parentId].push(S.id),d.add(l[S.parentId]));for(const[S,b]of Object.values(f.updated))if(Wc(b)&&Wc(S)){if(S.parentId!==b.parentId)u(S.parentId),u(b.parentId),l[S.parentId].splice(l[S.parentId].indexOf(b.id),1),l[b.parentId].push(b.id),d.add(l[b.parentId]);else if(S.index!==b.index){u(b.parentId);const x=l[b.parentId].indexOf(b.id);l[b.parentId][x]=b.id,d.add(l[b.parentId])}}for(const S of Object.values(f.removed))Wc(S)&&(u(S.parentId),l[S.parentId].splice(l[S.parentId].indexOf(S.id),1))}for(const g of d){const m=Ye(g.map(S=>n.get(S)));m.sort(Jn),g.splice(0,g.length,...m.map(S=>S.id))}return l??i})},ix=(n,e,t)=>{for(;!Ir(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},eY=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const s=e();return r=s,new Set([...t.get()].filter(a=>ix(n,s,n.get(a))))}return ue("_shapeIdsInCurrentPage",(s,a)=>{if(Il(s))return i();const l=e();if(l!==r)return i();const u=n.history.getDiffSince(a);if(u===Jr)return i();const d=new og(s);for(const g of u){for(const m of Object.values(g.added))Wc(m)&&ix(n,l,m)&&d.add(m.id);for(const[m,S]of Object.values(g.updated))Wc(S)&&(ix(n,l,S)?d.add(S.id):d.remove(S.id));for(const m of Object.keys(g.removed))kr(m)&&d.remove(m)}const f=d.get();return f?th(f.value,f.diff):s})};var tY=Object.create,LR=Object.defineProperty,nY=Object.getOwnPropertyDescriptor,rY=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),NR=n=>{throw TypeError(n)},zR=(n,e,t)=>e in n?LR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,iY=n=>[,,,tY(null)],FR=["class","method","getter","setter","accessor","field","value","get","set"],BR=n=>n!==void 0&&typeof n!="function"?NR("Function expected"):n,sY=(n,e,t,r,i)=>({kind:FR[n],name:e,metadata:r,addInitializer:s=>t._?NR("Already initialized"):i.push(BR(s||null))}),oY=(n,e)=>zR(e,rY("metadata"),n[3]),aY=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},UR=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=FR[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,nY(i,t)),_=r.length-1;_>=0;_--)u=sY(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,BR(a)&&(w[b]=a);return w&&LR(i,t,w),i},Bc=(n,e,t)=>zR(n,typeof e!="symbol"?e+"":e,t),$R,HR,Zh;const lY=40;HR=[Lr],$R=[Lr];class Gm{constructor(e){this.editor=e,aY(Zh,5,this),Bc(this,"_clickId",""),Bc(this,"_clickTimeout"),Bc(this,"_clickScreenPoint"),Bc(this,"_previousScreenPoint"),Bc(this,"_clickState","idle"),Bc(this,"lastPointerInfo",{})}_getClickTimeout(e,t=Ct()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._previousScreenPoint&&P.Dist2(this._previousScreenPoint,this._clickScreenPoint)>lY**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&P.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}Zh=iY();UR(Zh,1,"_getClickTimeout",HR,Gm);UR(Zh,1,"cancelDoubleClickTimeout",$R,Gm);oY(Zh,Gm);class cY{constructor(e){O(this,"_isEdgeScrolling",!1);O(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const i=t.options.edgeScrollEaseDuration>0?Tn.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*i,y:r.y*i})}}getEdgeProximityFactors(e,t,r,i,s){const{editor:a}=this,l=a.options.edgeScrollDistance,u=r?a.options.coarsePointerWidth:0,d=e-u,f=e+u,g=i?0:l,m=s?t:t-l;return d<g?Math.min(1,(g-d)/l):f>m?-Math.min(1,(f-m)/l):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:r}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[a,l,u,d]}=e.getInstanceState(),f=this.getEdgeProximityFactors(t,i.w,s,d,l),g=this.getEdgeProximityFactors(r,i.h,s,a,u);return{x:f,y:g}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=t.getViewportScreenBounds(),i=r.w<1e3?.612:1,s=r.h<1e3?.612:1,a=t.getZoomLevel(),l=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,u=l*e.x*i/a,d=l*e.y*s/a,{x:f,y:g,z:m}=t.getCamera();t.setCamera(new P(f+u,g+d,m))}}class uY{constructor(e,t){O(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,s)=>{i.isFocused!==s.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;t!==r&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function Gd(n){return hY}class dY{constructor(){O(this,"length",0);O(this,"head",null);O(this,"tail",this)}push(e){return new b_(e,this)}toArray(){return Mo}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const hY=new dY;class b_{constructor(e,t){O(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new b_(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class fY{constructor(e){O(this,"store");O(this,"dispose");O(this,"state","recording");O(this,"pendingDiff",new gY);O(this,"stacks",yn("HistoryManager.stacks",{undos:Gd(),redos:Gd()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));O(this,"annotateError");O(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??bh,this.dispose=this.store.addHistoryInterceptor((t,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Gd()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:mn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const r=this.state;r!=="paused"&&(t!=null&&t.history)&&(this.state=pY[t.history]);try{if(this._isInBatch)return Os(e),this;this._isInBatch=!0;try{Os(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:t=void 0}){var i;const r=this.state;this.state="paused";try{let{undos:s,redos:a}=this.stacks.get();const l=this.pendingDiff.clear(),u=LO(l),d=uw(l);e&&!u&&(a=a.push({type:"diff",diff:l}));let f=!1;if(u)for(;((i=s.head)==null?void 0:i.type)==="stop";){const g=s.head;if(s=s.tail,e&&(a=a.push(g)),g.id===t){f=!0;break}}if(!f)e:for(;s.head;){const g=s.head;switch(s=s.tail,e&&(a=a.push(g)),g.type){case"diff":dh(d,[uw(g.diff)]);break;case"stop":if(!t)break e;if(g.id===t){f=!0;break e}break;default:mn(g)}}if(!f&&t)return this;this.store.applyDiff(d,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:a})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((t=i.head)==null?void 0:t.type)==="stop";)r=r.push(i.head),i=i.tail;const s=qg();for(;i.head;){const a=i.head;if(r=r.push(a),i=i.tail,a.type==="diff")dh(s,[a.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:i})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var s;let t=this.stacks.get().undos;const r=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&r.push(t.head.diff),t=t.tail;if(!t.head||((s=t.head)==null?void 0:s.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const i=qg();return dh(i,r.reverse()),this.stacks.update(({redos:a})=>({undos:t.push({type:"diff",diff:i}),redos:a})),this}_mark(e){Os(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:Gd(),redos:Gd()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const pY={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class gY{constructor(){O(this,"diff",qg());O(this,"isEmptyAtom",yn("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=qg(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){dh(this.diff,[e]),this.isEmptyAtom.set(LO(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class mY{constructor(e){O(this,"scribbleItems",new Map);O(this,"state","paused");this.editor=e}addScribble(e,t=Ct()){const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,r,i=.5){const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:a}=s,l={x:t,y:r,z:i};return(!a||P.Dist(a,l)>=1)&&(s.next=l),s}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:u,prev:d}=t;u&&u!==d&&(t.prev=u,t.scribble.points.push(u)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:s,next:a,scribble:l}=t;switch(l.state){case"active":{a&&a!==s?(t.prev=a,l.points.push(a),r===0&&l.points.length>8&&l.points.shift()):i===0&&(l.points.length>1?l.points.shift():t.delayRemaining=l.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(l.points.length===1){this.scribbleItems.delete(t.id);return}l.shrink&&(l.size=Math.max(1,l.size*(1-l.shrink))),l.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var yY=Object.create,KR=Object.defineProperty,SY=Object.getOwnPropertyDescriptor,vY=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),qR=n=>{throw TypeError(n)},GR=(n,e,t)=>e in n?KR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,bY=n=>[,,,yY(null)],YR=["class","method","getter","setter","accessor","field","value","get","set"],VR=n=>n!==void 0&&typeof n!="function"?qR("Function expected"):n,xY=(n,e,t,r,i)=>({kind:YR[n],name:e,metadata:r,addInitializer:s=>t._?qR("Already initialized"):i.push(VR(s||null))}),wY=(n,e)=>GR(e,vY("metadata"),n[3]),_Y=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Ym=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=YR[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,SY(i,t)),_=r.length-1;_>=0;_--)u=xY(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,VR(a)&&(w[b]=a);return w&&KR(i,t,w),i},CY=(n,e,t)=>GR(n,e+"",t),XR,WR,ZR,QR,Yl;const Be=n=>Math.round(n*10**8)/10**8;function _o(n,e,t,r,i){const s=n.filter(l=>(r==="forward"?l.startNode.id===e:l.endNode.id===e)&&Be(l.length)===Be(t)&&Qi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));if(s.length===0)return[];const a=new Set;return s.forEach(l=>{const u=r==="forward"?l.endNode.id:l.startNode.id;if(!a.has(u)){a.add(u);const d=_o(n,u,t,r,Qi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));s.push(...d)}}),s}function EY(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(s=>i.gaps.some(a=>Be(s.startEdge[0].x)===Be(a.startEdge[0].x)&&Be(s.startEdge[0].y)===Be(a.startEdge[0].y)&&Be(s.startEdge[1].x)===Be(a.startEdge[1].x)&&Be(s.startEdge[1].y)===Be(a.startEdge[1].y))&&i.gaps.some(a=>Be(s.endEdge[0].x)===Be(a.endEdge[0].x)&&Be(s.endEdge[0].y)===Be(a.endEdge[0].y)&&Be(s.endEdge[1].x)===Be(a.endEdge[1].x)&&Be(s.endEdge[1].y)===Be(a.endEdge[1].y)))){n.splice(e,1);break}}}}QR=[ue],ZR=[ue],WR=[ue],XR=[ue];class Tu{constructor(e){this.manager=e,_Y(Yl,5,this),CY(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);if(!r)return;const s=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!r||!s))return s.map((a,l)=>{const{x:u,y:d}=ve.applyToPoint(r,a);return{x:u,y:d,id:`${t.id}:${l}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),r=[];for(const i of t){const s=e.get(i);s&&r.push(...s)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:jr(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let r,i;const s=this.getSnappableGapNodes().sort((l,u)=>l.pageBounds.minX-u.pageBounds.minX);for(let l=0;l<s.length;l++){r=s[l];for(let u=l+1;u<s.length;u++)i=s[u],r.pageBounds.maxX<i.pageBounds.minX&&Bd(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new P(r.pageBounds.maxX,r.pageBounds.minY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(i.pageBounds.minX,i.pageBounds.minY),new P(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Qi(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const a=s.sort((l,u)=>l.pageBounds.minY-u.pageBounds.minY);for(let l=0;l<a.length;l++){r=a[l];for(let u=l+1;u<a.length;u++)i=a[u],r.pageBounds.maxY<i.pageBounds.minY&&Bd(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new P(r.pageBounds.minX,r.pageBounds.maxY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(i.pageBounds.minX,i.pageBounds.minY),new P(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Qi(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var w,_;const s=this.manager.getSnapThreshold(),a=this.getSnappablePoints(),l=t.clone().translate(i),u=r.map(({x:E,y:M},I)=>({id:"selection:"+I,x:E+i.x,y:M+i.y})),d=a,f=[],g=[],m=new P(s,s);this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:d,selectionSnapPoints:u}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const S=new P(e==="x"?0:((w=f[0])==null?void 0:w.nudge)??0,e==="y"?0:((_=g[0])==null?void 0:_.nudge)??0);m.x=0,m.y=0,f.length=0,g.length=0,u.forEach(E=>{E.x+=S.x,E.y+=S.y}),l.translate(S),this.collectPointSnaps({minOffset:m,nearestSnapsX:f,nearestSnapsY:g,otherNodeSnapPoints:d,selectionSnapPoints:u}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:f,nearestSnapsY:g,minOffset:m});const b=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:g}),x=this.getGapSnapLines({selectionPageBounds:l,nearestSnapsX:f,nearestSnapsY:g});return this.manager.setIndicators([...x,...b]),{nudge:S}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:s}){var D,R;const a=this.manager.getSnapThreshold(),{box:l,scaleX:u,scaleY:d}=be.Resize(e,r,s?t.x*2:t.x,s?t.y*2:t.y,i);let f=r;u<0&&(f=IK(f)),d<0&&(f=TK(f)),s&&(l.center=e.center);const g=f==="top"||f==="bottom",m=f==="left"||f==="right",S=BA(f,l),b=this.getSnappablePoints(),x=[],w=[],_=new P(a,a);this.collectPointSnaps({minOffset:_,nearestSnapsX:x,nearestSnapsY:w,otherNodeSnapPoints:b,selectionSnapPoints:S});const E=new P(g?0:((D=x[0])==null?void 0:D.nudge)??0,m?0:((R=w[0])==null?void 0:R.nudge)??0);if(i&&MK(f)&&E.len()!==0){const q=x.length&&w.length?Math.abs(E.x)<Math.abs(E.y)?"x":"y":x.length?"x":"y",L=e.aspectRatio;q==="x"?(w.length=0,E.y=E.x/L,(f==="bottom_left"||f==="top_right")&&(E.y=-E.y)):(x.length=0,E.x=E.y*L,(f==="bottom_left"||f==="top_right")&&(E.x=-E.x))}const M=P.Add(t,E),{box:I}=be.Resize(e,r,s?M.x*2:M.x,s?M.y*2:M.y,i);s&&(I.center=e.center);const A=BA("any",I);x.length=0,w.length=0,_.x=0,_.y=0,this.collectPointSnaps({minOffset:_,nearestSnapsX:x,nearestSnapsY:w,otherNodeSnapPoints:b,selectionSnapPoints:A});const j=this.getPointSnapLines({nearestSnapsX:x,nearestSnapsY:w});return this.manager.setIndicators([...j]),{nudge:E}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:s}){for(const a of e)for(const l of t){const u=P.Sub(a,l),d=Math.abs(u.x),f=Math.abs(u.y);Be(d)<=Be(r.x)&&(Be(d)<Be(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:a,otherPoint:l},nudge:l.x-a.x}),r.x=d),Be(f)<=Be(r.y)&&(Be(f)<Be(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:a,otherPoint:l},nudge:l.y-a.y}),r.y=f)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:s,vertical:a}=this.getVisibleGaps();for(const l of s){if(!Bd(l.breadthIntersection[0],l.breadthIntersection[1],e.minY,e.maxY))continue;const d=l.startEdge[0].x+l.length/2-e.center.x;if(l.length>e.width&&Be(Math.abs(d))<=Be(t.x)){Be(Math.abs(d))<Be(t.x)&&(r.length=0),t.x=Math.abs(d);const _={type:"gap_center",gap:l,nudge:d},E=r.find(({type:I})=>I==="gap_center"),M=E&&Qi(l.breadthIntersection[0],l.breadthIntersection[1],E.gap.breadthIntersection[0],E.gap.breadthIntersection[1]);E&&E.gap.length>l.length&&M?r[r.indexOf(E)]=_:(!E||!M)&&r.push(_)}const g=l.startNode.pageBounds.minX-l.length,m=e.maxX,S=g-m;Be(Math.abs(S))<=Be(t.x)&&(Be(Math.abs(S))<Be(t.x)&&(r.length=0),t.x=Math.abs(S),r.push({type:"gap_duplicate",gap:l,protrusionDirection:"left",nudge:S}));const b=l.endNode.pageBounds.maxX+l.length,x=e.minX,w=b-x;Be(Math.abs(w))<=Be(t.x)&&(Be(Math.abs(w))<Be(t.x)&&(r.length=0),t.x=Math.abs(w),r.push({type:"gap_duplicate",gap:l,protrusionDirection:"right",nudge:w}))}for(const l of a){if(!Bd(l.breadthIntersection[0],l.breadthIntersection[1],e.minX,e.maxX))continue;const d=l.startEdge[0].y+l.length/2-e.center.y;if(l.length>e.height&&Be(Math.abs(d))<=Be(t.y)){Be(Math.abs(d))<Be(t.y)&&(i.length=0),t.y=Math.abs(d);const _={type:"gap_center",gap:l,nudge:d},E=i.find(({type:I})=>I==="gap_center"),M=E&&Bd(E.gap.breadthIntersection[0],E.gap.breadthIntersection[1],l.breadthIntersection[0],l.breadthIntersection[1]);E&&E.gap.length>l.length&&M?i[i.indexOf(E)]=_:(!E||!M)&&i.push(_);continue}const g=l.startNode.pageBounds.minY-l.length,m=e.maxY,S=g-m;Be(Math.abs(S))<=Be(t.y)&&(Be(Math.abs(S))<Be(t.y)&&(i.length=0),t.y=Math.abs(S),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"top",nudge:S}));const b=l.endNode.pageBounds.maxY+l.length,x=e.minY,w=b-x;Be(Math.abs(w))<=Be(t.y)&&(Be(Math.abs(w))<Be(t.y)&&(i.length=0),t.y=Math.abs(w),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"bottom",nudge:w}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const s of e)if(s.type==="points"){const a=Be(s.points.otherPoint.x);r[a]||(r[a]=[]),r[a].push(s.points)}}if(t.length>0){for(const s of t)if(s.type==="points"){const a=Be(s.points.otherPoint.y);i[a]||(i[a]=[]),i[a].push(s.points)}}return Object.values(r).concat(Object.values(i)).map(s=>({id:Ct(),type:"points",points:m1(s.map(a=>P.From(a.otherPoint)).concat(s.map(a=>P.From(a.thisPoint))),(a,l)=>a.equals(l))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),a={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},l=[];if(t.length>0)for(const u of t){if(u.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:f,startNode:g,endNode:m,length:S,endEdge:b}}=u;switch(u.type){case"gap_center":{const x=(S-e.width)/2,w=Qi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Ct(),gaps:[..._o(s,g.id,x,"backward",w),{startEdge:f,endEdge:a.left},{startEdge:a.right,endEdge:b},..._o(s,m.id,x,"forward",w)]});break}case"gap_duplicate":{const x=Qi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Ct(),gaps:u.protrusionDirection==="left"?[{startEdge:a.right,endEdge:f.map(w=>w.clone().addXY(-g.pageBounds.width,0))},{startEdge:f,endEdge:b},..._o(s,m.id,S,"forward",x)]:[..._o(s,g.id,S,"backward",x),{startEdge:f,endEdge:b},{startEdge:b.map(w=>w.clone().addXY(u.gap.endNode.pageBounds.width,0)),endEdge:a.left}]});break}}}if(r.length>0)for(const u of r){if(u.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:f,startNode:g,endNode:m,length:S,endEdge:b}}=u;switch(u.type){case"gap_center":{const x=(S-e.height)/2,w=Qi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Ct(),gaps:[..._o(i,g.id,x,"backward",w),{startEdge:f,endEdge:a.top},{startEdge:a.bottom,endEdge:b},..._o(i,u.gap.endNode.id,x,"forward",w)]});break}case"gap_duplicate":{const x=Qi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Ct(),gaps:u.protrusionDirection==="top"?[{startEdge:a.bottom,endEdge:f.map(w=>w.clone().addXY(0,-g.pageBounds.height))},{startEdge:f,endEdge:b},..._o(i,m.id,S,"forward",x)]:[..._o(i,g.id,S,"backward",x),{startEdge:f,endEdge:b},{startEdge:b.map(w=>w.clone().addXY(0,m.pageBounds.height)),endEdge:a.top}]})}break}}return EY(l),l}}Yl=bY();Ym(Yl,1,"getSnapPointsCache",QR,Tu);Ym(Yl,1,"getSnappablePoints",ZR,Tu);Ym(Yl,1,"getSnappableGapNodes",WR,Tu);Ym(Yl,1,"getVisibleGaps",XR,Tu);wY(Yl,Tu);function BA(n,e){const{minX:t,maxX:r,minY:i,maxY:s}=e,a=[];switch(n){case"top":case"left":case"top_left":case"any":a.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":a.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":a.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(n){case"bottom":case"left":case"bottom_left":case"any":a.push({id:"bottom_left",handle:"bottom_left",x:t,y:s})}return a}var PY=Object.create,JR=Object.defineProperty,TY=Object.getOwnPropertyDescriptor,IY=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),e3=n=>{throw TypeError(n)},t3=(n,e,t)=>e in n?JR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,MY=n=>[,,,PY(null)],n3=["class","method","getter","setter","accessor","field","value","get","set"],r3=n=>n!==void 0&&typeof n!="function"?e3("Function expected"):n,AY=(n,e,t,r,i)=>({kind:n3[n],name:e,metadata:r,addInitializer:s=>t._?e3("Already initialized"):i.push(r3(s||null))}),kY=(n,e)=>t3(e,IY("metadata"),n[3]),jY=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},OY=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=n3[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,TY(i,t)),_=r.length-1;_>=0;_--)u=AY(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,r3(a)&&(w[b]=a);return w&&JR(i,t,w),i},DY=(n,e,t)=>t3(n,e+"",t),i3,Vm;const RY=()=>null,LY=()=>[];i3=[ue];class x_{constructor(e){this.manager=e,jY(Vm,5,this),DY(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const r=e.getShapeUtil(t).getHandleSnapGeometry(t),i=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):RY,s=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):LY;return{outline:r.outline===void 0?e.getShapeGeometry(t):r.outline,points:r.points??[],getSelfSnapOutline:i,getSelfSnapPoints:s}})}*iterateSnapPointsInPageSpace(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(t);if(r&&r.length){const a=jr(this.editor.getShapePageTransform(e));for(const l of r)yield a.applyToPoint(l)}for(const a of this.manager.getSnappableShapes()){if(a===e)continue;const l=(s=this.getSnapGeometryCache().get(a))==null?void 0:s.points;if(!l||!l.length)continue;const u=jr(this.editor.getShapePageTransform(a));for(const d of l)yield u.applyToPoint(d)}}*iterateSnapOutlines(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(t);r&&(yield{shapeId:e,outline:r});for(const a of this.manager.getSnappableShapes()){if(a===e)continue;const l=(s=this.getSnapGeometryCache().get(a))==null?void 0:s.outline;l&&(yield{shapeId:a,outline:l})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r}){const i=this.manager.getSnapThreshold();let s=i,a=null;for(const d of this.iterateSnapPointsInPageSpace(e,t))P.DistMin(r,d,s)&&(s=P.Dist(r,d),a=d);if(a)return a;let l=i,u=null;for(const{shapeId:d,outline:f}of this.iterateSnapOutlines(e,t)){const g=jr(this.editor.getShapePageTransform(d)),m=this.editor.getPointInShapeSpace(d,r),S=f.nearestPoint(m),b=g.applyToPoint(S);P.DistMin(r,b,l)&&(l=P.Dist(r,b),u=b)}return u||null}snapHandle({currentShapeId:e,handle:t}){const i=jr(this.editor.getShapePageTransform(e)).applyToPoint(t),s=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:i});return s?(this.manager.setIndicators([{id:Ct(),type:"points",points:[s]}]),{nudge:P.Sub(s,i)}):null}}Vm=MY();OY(Vm,1,"getSnapGeometryCache",i3,x_);kY(Vm,x_);var NY=Object.create,s3=Object.defineProperty,zY=Object.getOwnPropertyDescriptor,FY=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),o3=n=>{throw TypeError(n)},a3=(n,e,t)=>e in n?s3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,BY=n=>[,,,NY(null)],l3=["class","method","getter","setter","accessor","field","value","get","set"],c3=n=>n!==void 0&&typeof n!="function"?o3("Function expected"):n,UY=(n,e,t,r,i)=>({kind:l3[n],name:e,metadata:r,addInitializer:s=>t._?o3("Already initialized"):i.push(c3(s||null))}),$Y=(n,e)=>a3(e,FY("metadata"),n[3]),HY=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},w_=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=l3[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,zY(i,t)),_=r.length-1;_>=0;_--)u=UY(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,c3(a)&&(w[b]=a);return w&&s3(i,t,w),i},sx=(n,e,t)=>a3(n,typeof e!="symbol"?e+"":e,t),u3,d3,h3,Iu;h3=[ue],d3=[ue],u3=[ue];class Qh{constructor(e){this.editor=e,HY(Iu,5,this),sx(this,"shapeBounds"),sx(this,"handles"),sx(this,"_snapIndicators",yn("snapLines",void 0)),this.shapeBounds=new Tu(this),this.handles=new x_(this)}getIndicators(){return this._snapIndicators.get()??Mo}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),i=new Set,s=a=>{if(kr(a)){const u=e.getShape(a);u&&e.isShapeOfType(u,"frame")&&i.add(a)}const l=e.getSortedChildIdsForParent(a);for(const u of l){if(r.includes(u))continue;const d=e.getShape(u);if(!d||!e.getShapeUtil(d).canSnap(d))continue;const g=e.getShapePageBounds(u);if(g&&t.includes(g)){if(e.isShapeOfType(d,"group")){s(u);continue}i.add(u)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Iu=BY();w_(Iu,1,"getSnapThreshold",h3,Qh);w_(Iu,1,"getSnappableShapes",d3,Qh);w_(Iu,1,"getCurrentCommonAncestor",u3,Qh);$Y(Iu,Qh);const KY=/\r?\n|\r/g;function UA(n){return n.replace(KY,`
`).split(`
`).map(e=>e||" ").join(`
`)}const qY={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},GY=/\s/;class YY{constructor(e){O(this,"baseElem");this.editor=e,this.baseElem=document.createElement("div"),this.baseElem.classList.add("tl-text"),this.baseElem.classList.add("tl-text-measure"),this.baseElem.tabIndex=-1}measureText(e,t){const r=this.baseElem.cloneNode();this.editor.getContainer().appendChild(r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),r.style.setProperty("padding",t.padding),r.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=UA(e);const i=r.scrollWidth,s=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:s.width,h:s.height,scrollWidth:i}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),s=-i.left,a=-i.top,l=new Range,u=e.childNodes[0];let d=0,f=null,g=null,m=0,S=0,b=!1;for(const x of e.childNodes)if(x.nodeType===Node.TEXT_NODE)for(const w of x.textContent??""){l.setStart(u,d),l.setEnd(u,d+w.length);const _=l.getClientRects(),E=_[_.length-1],M=E.top+a,I=E.left+s,A=E.right+s,j=I<S,D=GY.test(w);if(D!==g||M!==m||!f){if(f){if(t&&M!==m){b=!0;break}r.push(f)}f={box:{x:I,y:M,w:E.width,h:E.height},text:w},S=I}else j&&(f.box.x=I),f.box.w=j?f.box.w+E.width:A-f.box.x,f.text+=w;w===`
`&&(S=0),g=D,m=M,d+=w.length}return f&&r.push(f),{spans:r,didTruncate:b}}measureTextSpans(e,t){if(e==="")return[];const r=this.baseElem.cloneNode();this.editor.getContainer().appendChild(r);const i=Math.ceil(t.width-t.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${i}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${t.fontSize}px`),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),r.style.setProperty("text-align",qY[t.textAlign]),r.style.setProperty("font-style",t.fontStyle);const s=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";s&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const a=UA(e);r.textContent=a;const{spans:l,didTruncate:u}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:s});if(t.overflow==="truncate-ellipsis"&&u){r.textContent="";const d=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${i-d}px`),r.textContent=a;const f=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,g=f[f.length-1];return f.push({text:"",box:{x:Math.min(g.box.x+g.box.w,t.width-t.padding-d),y:g.box.y,w:d,h:g.box.h}}),f}return r.remove(),l}}var VY=Object.create,f3=Object.defineProperty,XY=Object.getOwnPropertyDescriptor,WY=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),p3=n=>{throw TypeError(n)},g3=(n,e,t)=>e in n?f3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ZY=n=>[,,,VY(null)],m3=["class","method","getter","setter","accessor","field","value","get","set"],y3=n=>n!==void 0&&typeof n!="function"?p3("Function expected"):n,QY=(n,e,t,r,i)=>({kind:m3[n],name:e,metadata:r,addInitializer:s=>t._?p3("Already initialized"):i.push(y3(s||null))}),JY=(n,e)=>g3(e,WY("metadata"),n[3]),eV=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},S3=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=m3[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,XY(i,t)),_=r.length-1;_>=0;_--)u=QY(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,y3(a)&&(w[b]=a);return w&&f3(i,t,w),i},Dp=(n,e,t)=>g3(n,typeof e!="symbol"?e+"":e,t),v3,b3,Jh;const $A=$j;b3=[Lr],v3=[Lr];class Xm{constructor(e){this.editor=e,eV(Jh,5,this),Dp(this,"cancelRaf"),Dp(this,"isPaused",!0),Dp(this,"now",0),Dp(this,"prevPoint",new P),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=$A(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=$A(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const s=P.Sub(r,t);this.prevPoint=r.clone();const a=s.len(),l=a?s.div(a):new P(0,0),u=i.clone().lrp(l.mul(a/e),.5);Math.abs(u.x)<.01&&(u.x=0),Math.abs(u.y)<.01&&(u.y=0),i.equals(u)||(this.editor.inputs.pointerVelocity=u)}}Jh=ZY();S3(Jh,1,"tick",b3,Xm);S3(Jh,1,"dispose",v3,Xm);JY(Jh,Xm);var tV=Object.create,x3=Object.defineProperty,nV=Object.getOwnPropertyDescriptor,rV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),w3=n=>{throw TypeError(n)},_3=(n,e,t)=>e in n?x3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,iV=n=>[,,,tV(null)],C3=["class","method","getter","setter","accessor","field","value","get","set"],E3=n=>n!==void 0&&typeof n!="function"?w3("Function expected"):n,sV=(n,e,t,r,i)=>({kind:C3[n],name:e,metadata:r,addInitializer:s=>t._?w3("Already initialized"):i.push(E3(s||null))}),oV=(n,e)=>_3(e,rV("metadata"),n[3]),aV=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Di=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=C3[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,nV(i,t)),_=r.length-1;_>=0;_--)u=sV(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,E3(a)&&(w[b]=a);return w&&x3(i,t,w),i},HA=(n,e,t)=>_3(n,typeof e!="symbol"?e+"":e,t),P3,T3,I3,M3,A3,k3,j3,O3,D3,R3,L3,N3,gr;N3=[ue],L3=[ue],R3=[ue],D3=[ue],O3=[ue],j3=[ue],k3=[ue],A3=[ue],M3=[ue],I3=[ue],T3=[ue],P3=[ue];class Br{constructor(e,t){if(this.user=e,this.inferDarkMode=t,aV(gr,5,this),HA(this,"systemColorScheme",yn("systemColorScheme","light")),HA(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark");const i=s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r==null||r.addEventListener("change",i),this.disposables.add(()=>r==null?void 0:r.removeEventListener("change",i))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Cs.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Cs.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Cs.name}getLocale(){return this.user.userPreferences.get().locale??Cs.locale}getColor(){return this.user.userPreferences.get().color??Cs.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Cs.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Cs.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Cs.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Cs.isPasteAtCursorMode}}gr=iV();Di(gr,1,"getUserPreferences",N3,Br);Di(gr,1,"getIsDarkMode",L3,Br);Di(gr,1,"getEdgeScrollSpeed",R3,Br);Di(gr,1,"getAnimationSpeed",D3,Br);Di(gr,1,"getId",O3,Br);Di(gr,1,"getName",j3,Br);Di(gr,1,"getLocale",k3,Br);Di(gr,1,"getColor",A3,Br);Di(gr,1,"getIsSnapMode",M3,Br);Di(gr,1,"getIsWrapMode",I3,Br);Di(gr,1,"getIsDynamicResizeMode",T3,Br);Di(gr,1,"getIsPasteAtCursorMode",P3,Br);oV(gr,Br);const lV={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},cV=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Ae{constructor(e,t){O(this,"performanceTracker");O(this,"id");O(this,"type");O(this,"shapeType");O(this,"initial");O(this,"children");O(this,"isLockable");O(this,"parent");O(this,"_path");O(this,"_current");O(this,"_isActive");O(this,"_currentToolIdMask",yn("curent tool id mask",void 0));this.editor=e;const{id:r,children:i,initial:s,isLockable:a}=this.constructor;this.id=r,this._isActive=yn("toolIsActive"+this.id,!1),this._current=yn("toolState"+this.id,void 0),this._path=ue("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=t??{},this.parent?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=a,this.performanceTracker=new bj}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,t={}){var s;const r=e.split(".");let i=this;for(let a=0;a<r.length;a++){const l=r[a],u=i.getCurrent(),d=(s=i.children)==null?void 0:s[l];if(!d)throw Error(`${i.id} - no child state exists with the id ${l}.`);if((u==null?void 0:u.id)!==d.id&&(u==null||u.exit(t,l),i._current.set(d),d.enter(t,(u==null?void 0:u.id)||"initial"),!d.getIsActive()))break;i=d}return this}handleEvent(e){var i;const t=lV[e.name],r=this._current.__unsafe__getWithoutCapture();(i=this[t])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,t){var r;if(ln.measurePerformance.get()&&cV.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}}exit(e,t){var r,i;ln.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,t)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}O(Ae,"id"),O(Ae,"initial"),O(Ae,"children"),O(Ae,"isLockable",!0);class Cw extends Ae{static children(){return[]}onKeyDown(e){var t;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((t=r.getCurrent())==null?void 0:t.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}O(Cw,"id","root"),O(Cw,"initial","");var uV=Object.create,z3=Object.defineProperty,dV=Object.getOwnPropertyDescriptor,F3=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),B3=n=>{throw TypeError(n)},U3=(n,e,t)=>e in n?z3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,hV=n=>[,,,uV((n==null?void 0:n[F3("metadata")])??null)],$3=["class","method","getter","setter","accessor","field","value","get","set"],H3=n=>n!==void 0&&typeof n!="function"?B3("Function expected"):n,fV=(n,e,t,r,i)=>({kind:$3[n],name:e,metadata:r,addInitializer:s=>t._?B3("Already initialized"):i.push(H3(s||null))}),pV=(n,e)=>U3(e,F3("metadata"),n[3]),gV=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Ee=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=$3[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,dV(i,t)),_=r.length-1;_>=0;_--)u=fV(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,H3(a)&&(w[b]=a);return w&&z3(i,t,w),i},ze=(n,e,t)=>U3(n,typeof e!="symbol"?e+"":e,t),K3,q3,G3,Y3,V3,X3,W3,Z3,Q3,J3,e5,t5,n5,r5,i5,s5,o5,a5,l5,c5,u5,d5,h5,f5,p5,g5,m5,y5,S5,v5,b5,x5,w5,_5,C5,E5,P5,T5,I5,M5,A5,k5,j5,O5,D5,R5,L5,N5,z5,F5,B5,U5,$5,H5,K5,q5,G5,Y5,V5,X5,W5,Z5,Q5,J5,eL,tL,nL,rL,iL,sL,oL,aL,Ew,Ce;class _e extends(Ew=kq,aL=[ue],oL=[ue],sL=[ue],iL=[ue],rL=[ue],nL=[ue],tL=[ue],eL=[ue],J5=[ue],Q5=[ue],Z5=[ue],W5=[ue],X5=[ue],V5=[ue],Y5=[ue],G5=[ue],q5=[ue],K5=[ue],H5=[ue],$5=[ue],U5=[ue],B5=[ue],F5=[ue],z5=[ue],N5=[ue],L5=[ue],R5=[ue],D5=[ue],O5=[ue],j5=[ue],k5=[ue],A5=[ue],M5=[ue],I5=[ue],T5=[ue],P5=[ue],E5=[ue],C5=[ue],_5=[ue],w5=[ue],x5=[ue],b5=[ue],v5=[ue],S5=[ue],y5=[ue],m5=[ue],g5=[ue],p5=[ue],f5=[ue],h5=[ue],d5=[ue],u5=[ue],c5=[ue],l5=[ue],a5=[ue],o5=[ue],s5=[ue],i5=[ue],r5=[ue],n5=[ue],t5=[ue],e5=[ue],J3=[ue],Q3=[ue],Z3=[ue({isEqual:(e,t)=>e.equals(t)})],W3=[ue],X3=[ue],V3=[ue],Y3=[Lr],G3=[Lr],q3=[Lr],K3=[Lr],Ew){constructor({store:e,user:t,shapeUtils:r,bindingUtils:i,tools:s,getContainer:a,cameraOptions:l,initialState:u,autoFocus:d,inferDarkMode:f,options:g,isShapeHidden:m}){var q;super(),gV(Ce,5,this),ze(this,"_isShapeHiddenPredicate"),ze(this,"options"),ze(this,"contextId",Ct()),ze(this,"store"),ze(this,"root"),ze(this,"disposables",new Set),ze(this,"isDisposed",!1),ze(this,"_tickManager"),ze(this,"snaps"),ze(this,"timers",ww.forContext(this.contextId)),ze(this,"user"),ze(this,"textMeasure"),ze(this,"environment",kt),ze(this,"scribbles"),ze(this,"sideEffects"),ze(this,"edgeScrollManager"),ze(this,"focusManager"),ze(this,"getContainer"),ze(this,"shapeUtils"),ze(this,"styleProps"),ze(this,"bindingUtils"),ze(this,"history"),ze(this,"_shouldIgnoreShapeLock",!1),ze(this,"_crashingError",null),ze(this,"_isChangingStyleTimeout",-1),ze(this,"menus",Ji.forContext(this.contextId)),ze(this,"_cameraOptions",yn("camera options",oA)),ze(this,"_viewportAnimation",null),ze(this,"_willSetInitialBounds",!0),ze(this,"_isLockedOnFollowingUser",yn("isLockedOnFollowingUser",!1)),ze(this,"_cameraState",yn("camera state","idle")),ze(this,"_cameraStateTimeoutRemaining",0),ze(this,"_currentPageShapeIds"),ze(this,"_parentIdsToChildIds"),ze(this,"animatingShapes",new Map),ze(this,"externalAssetContentHandlers",{file:null,url:null}),ze(this,"temporaryAssetPreview",new Map),ze(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),ze(this,"inputs",{originPagePoint:new P,originScreenPoint:new P,previousPagePoint:new P,previousScreenPoint:new P,currentPagePoint:new P,currentScreenPoint:new P,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new P}),ze(this,"_clickManager",new Gm(this)),ze(this,"_prevCursor","default"),ze(this,"_shiftKeyTimeout",-1),ze(this,"_altKeyTimeout",-1),ze(this,"_ctrlKeyTimeout",-1),ze(this,"_metaKeyTimeout",-1),ze(this,"_restoreToolId","select"),ze(this,"_pinchStart",1),ze(this,"_didPinch",!1),ze(this,"_selectedShapeIdsAtPointerDown",[]),ze(this,"_longPressTimeout",-1),ze(this,"capturedPointerId",null),ze(this,"performanceTracker"),ze(this,"performanceTrackerTimeout",-1),ze(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=m,this.options={...FG,...g},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new fY({store:e,annotateError:L=>{this.annotateError(L,{origin:"history.batch",willCrashApp:!0}),this.crash(L)}}),this.snaps=new Qh(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...oA,...l}),this.user=new Br(t??oR(),f??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=a,this.textMeasure=new YY(this),this._tickManager=new Xm(this);class S extends Cw{}O(S,"initial",u??""),this.root=new S(this),this.root.children={};const b=fR(r),x={},w={},_=new Map;for(const L of b){const K=new L(this);x[L.type]=K;const G=$O(L.props??{});w[L.type]=G;for(const z of G.keys())if(!_.has(z.id))_.set(z.id,z);else if(_.get(z.id)!==z)throw Error(`Multiple style props with id "${z.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=x,this.styleProps=w;const E=dR(i),M={};for(const L of E){const K=new L(this);M[L.type]=K}this.bindingUtils=M;for(const L of[...s]){if(Ii(this.root.children,L.id))throw Error(`Can't override tool with id "${L.id}"`);this.root.children[L.id]=new L(this,this.root)}this.scribbles=new mY(this);const I=(L,K)=>{let G=null;const z=L.selectedShapeIds.filter(H=>!K.has(H));z.length!==L.selectedShapeIds.length&&(G||(G={...L}),G.selectedShapeIds=z);const U=L.erasingShapeIds.filter(H=>!K.has(H));U.length!==L.erasingShapeIds.length&&(G||(G={...L}),G.erasingShapeIds=U),L.hoveredShapeId&&K.has(L.hoveredShapeId)&&(G||(G={...L}),G.hoveredShapeId=null),L.editingShapeId&&K.has(L.editingShapeId)&&(G||(G={...L}),G.editingShapeId=null);const Y=L.hintingShapeIds.filter(H=>!K.has(H));return Y.length!==L.hintingShapeIds.length&&(G||(G={...L}),G.hintingShapeIds=Y),L.focusedGroupId&&K.has(L.focusedGroupId)&&(G||(G={...L}),G.focusedGroupId=null),G};this.sideEffects=this.store.sideEffects;let A=new Map;const j=new Set,D=new Set;let R=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var L,K,G,z;j.clear();for(const U of D){D.delete(U);const Y=this.getShape(U);if(!Y)continue;const H=this.getShapeUtil(Y),X=(L=H.onChildrenChange)==null?void 0:L.call(H,Y);X!=null&&X.length&&this.updateShapes(X)}if(R.size){const U=R;R=new Set;for(const Y of U){const H=this.getBindingUtil(Y);(K=H.onOperationComplete)==null||K.call(H)}}if(A.size){const U=A;A=new Map;for(const Y of U.values())(z=(G=this.getBindingUtil(Y.binding)).onAfterDelete)==null||z.call(G,Y)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(L,K)=>{var G,z,U,Y;for(const H of this.getBindingsInvolvingShape(K))R.add(H.type),H.fromId===K.id&&((z=(G=this.getBindingUtil(H)).onAfterChangeFromShape)==null||z.call(G,{binding:H,shapeBefore:L,shapeAfter:K})),H.toId===K.id&&((Y=(U=this.getBindingUtil(H)).onAfterChangeToShape)==null||Y.call(U,{binding:H,shapeBefore:L,shapeAfter:K}));if(L.parentId!==K.parentId){const H=X=>{var ie,B,re,me;const V=this.getShape(X);if(V)for(const de of this.getBindingsInvolvingShape(V))R.add(de.type),de.fromId===V.id&&((B=(ie=this.getBindingUtil(de)).onAfterChangeFromShape)==null||B.call(ie,{binding:de,shapeBefore:V,shapeAfter:V})),de.toId===V.id&&((me=(re=this.getBindingUtil(de)).onAfterChangeToShape)==null||me.call(re,{binding:de,shapeBefore:V,shapeAfter:V}))};H(K.id),this.visitDescendants(K.id,H)}if(L.parentId!==K.parentId&&Ir(K.parentId)){const H=new Set([L.id]);this.visitDescendants(L.id,X=>{H.add(X)});for(const X of this.getPageStates()){if(X.pageId===K.parentId)continue;const V=I(X,H);V&&this.store.put([V])}}L.parentId&&kr(L.parentId)&&D.add(L.parentId),K.parentId!==L.parentId&&kr(K.parentId)&&D.add(K.parentId)},beforeDelete:L=>{var U,Y,H,X;if(j.has(L.id))return;L.parentId&&kr(L.parentId)&&D.add(L.parentId),j.add(L.id);const K=[];for(const V of this.getBindingsInvolvingShape(L)){R.add(V.type),K.push(V.id);const ie=this.getBindingUtil(V);V.fromId===L.id?((U=ie.onBeforeIsolateToShape)==null||U.call(ie,{binding:V,removedShape:L}),(Y=ie.onBeforeDeleteFromShape)==null||Y.call(ie,{binding:V,shape:L})):((H=ie.onBeforeIsolateFromShape)==null||H.call(ie,{binding:V,removedShape:L}),(X=ie.onBeforeDeleteToShape)==null||X.call(ie,{binding:V,shape:L}))}K.length&&this.deleteBindings(K);const G=new Set([L.id]),z=Ye(this.getPageStates().map(V=>I(V,G)));z.length&&this.store.put(z)}},binding:{beforeCreate:L=>{var G,z;const K=(z=(G=this.getBindingUtil(L)).onBeforeCreate)==null?void 0:z.call(G,{binding:L});return K||L},afterCreate:L=>{var K,G;R.add(L.type),(G=(K=this.getBindingUtil(L)).onAfterCreate)==null||G.call(K,{binding:L})},beforeChange:(L,K)=>{var z,U;const G=(U=(z=this.getBindingUtil(K)).onBeforeChange)==null?void 0:U.call(z,{bindingBefore:L,bindingAfter:K});return G||K},afterChange:(L,K)=>{var G,z;R.add(K.type),(z=(G=this.getBindingUtil(K)).onAfterChange)==null||z.call(G,{bindingBefore:L,bindingAfter:K})},beforeDelete:L=>{var K,G;(G=(K=this.getBindingUtil(L)).onBeforeDelete)==null||G.call(K,{binding:L})},afterDelete:L=>{var K,G;(G=(K=this.getBindingUtil(L)).onAfterDelete)==null||G.call(K,{binding:L}),R.add(L.type)}},page:{afterCreate:L=>{const K=Ms.createId(L.id),G=ns.createId(L.id);this.store.has(K)||this.store.put([Ms.create({id:K})]),this.store.has(G)||this.store.put([ns.create({id:G,pageId:L.id})])},afterDelete:(L,K)=>{var U,Y;if(((U=this.getInstanceState())==null?void 0:U.currentPageId)===L.id){const H=(Y=this.getPages().find(X=>X.id!==L.id))==null?void 0:Y.id;H?this.store.put([{...this.getInstanceState(),currentPageId:H}]):K==="user"&&this.store.ensureStoreIsUsable()}const G=Ms.createId(L.id),z=ns.createId(L.id);this.store.remove([G,z])}},instance:{afterChange:(L,K,G)=>{var z;if(!this.store.has(K.currentPageId)){const U=this.store.has(L.currentPageId)?L.currentPageId:(z=this.getPages()[0])==null?void 0:z.id;U?this.store.update(K.id,Y=>({...Y,currentPageId:U})):G==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(L,K)=>{if((L==null?void 0:L.selectedShapeIds)!==(K==null?void 0:K.selectedShapeIds)){const G=K.selectedShapeIds.filter(U=>{var H,X;let Y=(H=this.getShape(U))==null?void 0:H.parentId;for(;kr(Y);){if(K.selectedShapeIds.includes(Y))return!1;Y=(X=this.getShape(Y))==null?void 0:X.parentId}return!0});let z=null;if(G.length>0){const U=this.findCommonAncestor(Ye(G.map(Y=>this.getShape(Y))),Y=>this.isShapeOfType(Y,"group"));U&&(z=U)}else K!=null&&K.focusedGroupId&&(z=K.focusedGroupId);(G.length!==K.selectedShapeIds.length||z!==K.focusedGroupId)&&this.store.put([{...K,selectedShapeIds:G,focusedGroupId:z??null}])}}}})),this._currentPageShapeIds=eY(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=JG(this.store),this.disposables.add(this.store.listen(L=>{this.emit("change",L)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),u&&this.root.children[u]===void 0)throw Error(`No state found for initialState "${u}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new cY(this),this.focusManager=new uY(this,d),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new bj,(q=this.store.props.collaboration)!=null&&q.mode){const L=this.store.props.collaboration.mode;this.disposables.add(js("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:L.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,r=>this.isShapeHidden(r))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,r=tr(this.shapeUtils,t);return vt(r,`No shape util found for type "${t}"`),r}hasShapeUtil(e){const t=typeof e=="string"?e:e.type;return Ii(this.shapeUtils,t)}getBindingUtil(e){const t=typeof e=="string"?e:e.type,r=tr(this.bindingUtils,t);return vt(r,`No binding util found for type "${t}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??Ct()),this}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${Ct()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(t==null?void 0:t.ignoreShapeLock)??r;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:r,tags:i,extras:s}){const a=this.createErrorAnnotations(t,r);return S1(e,{tags:{...a.tags,...i},extras:{...a.extras,...s}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(i=>{const{props:s,...a}=i,{text:l,richText:u,...d}=s;return{...a,props:d}}),selectionCount:this.getSelectedShapes().length,editingShape:r?this.getShape(r):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const i=t.pop();if(!i)return!0;const s=r.getCurrent();if((s==null?void 0:s.id)===i){if(t.length===0)return!0;r=s;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var i;const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const s=t.pop();if(!s)return r;const a=(i=r.children)==null?void 0:i[s];if(!a)return;r=a}return r}getDocumentSettings(){return this.store.get(fw)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ur)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return ns.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return Ye(e.map(t=>this.store.get(t)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(s=>typeof s=="string"?s:s.id),{selectedShapeIds:r}=this.getCurrentPageState(),i=new Set(r);if(t.length===i.size&&t.every(s=>i.has(s)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(t);if(!r)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,s=>i.includes(s.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=this.getSelectedShapeIds();return r.length>0&&t.length>0&&this.setSelectedShapes(r.filter(i=>!t.includes(i))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=Ye(e.map(r=>this.getShapePageBounds(r)));return t.length===0?null:be.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,r=0;for(let i=0,s=e.length;i<s;i++){const a=this.getShapePageTransform(e[i]);if(a)if(t){if(a.rotation()!==r)return 0}else t=!0,r=a.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),s=this.getShapePageTransform(e[0]);return i.point=s.applyToPoint(i.point),i}const r=be.FromPoints(e.flatMap(i=>{const s=this.getShapePageTransform(i);return s?s.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-t)));return r.point=r.point.rot(t),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new be(t,r,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==null){const r=this.getShape(t);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((t==null?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const r=this.getShape(t);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return Ye(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:m1(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return Ye(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);t.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(t.length===r.length){for(let i=0;i<t.length;i++)if(t[i]!==r[i]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(t),i=this.getShapeUtil(r);r&&i.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Ms.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find(g=>g.userId===e);if(!t||!t.camera||!t.screenBounds)return null;const{w:r,h:i}=t.screenBounds,{x:s,y:a,z:l}=t.camera,u=new be(-s,-a,r/l,i/l),d=this.getViewportScreenBounds().clone(),f=d.width/d.height;return d.width=u.width,d.height=d.width/f,d.height<u.height&&(d.height=u.height,d.width=d.height*f),d.center=u.center,d}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:r}=qA(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw mn(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:r}=qA(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw mn(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const t=$t({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=t.zoomSteps)==null?void 0:r.length)<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const r=this.getCamera();let{x:i,y:s,z:a=r.z}=e;if(!(t!=null&&t.force)){const l=this.getCameraOptions(),u=l.zoomSteps[0],d=Rn(l.zoomSteps),f=this.getViewportScreenBounds();if(l.constraints){const{constraints:g}=l,m=Math.min(g.padding.y,f.w/2),S=Math.min(g.padding.x,f.h/2),b=be.From(l.constraints.bounds),x=(f.w-S*2)/b.w,w=(f.h-m*2)/b.h,_=this.getBaseZoom(),E=d*_,M=u*_;if(t!=null&&t.reset&&(a=this.getInitialZoom()),a<M||a>E){const{x:G,y:z,z:U}=r,Y=-G+f.w/U/2,H=-z+f.h/U/2;a=On(a,M,E);const X=-G+f.w/a/2,V=-z+f.h/a/2;i=G+X-Y,s=z+V-H}const I=S/a-b.x,A=m/a-b.y,j=(f.w-S*2)/a-b.w,D=(f.h-m*2)/a-b.h,R=I+j*g.origin.x,q=A+D*g.origin.y,L=typeof g.behavior=="string"?g.behavior:g.behavior.x,K=typeof g.behavior=="string"?g.behavior:g.behavior.y;if(t!=null&&t.reset)i=R,s=q;else{switch(L){case"fixed":{i=R;break}case"contain":{a<x?i=R:i=On(i,I+j,I);break}case"inside":{a<x?i=On(i,I,(f.w-S)/a-b.w):i=On(i,I+j,I);break}case"outside":{i=On(i,S/a-b.w,(f.w-S)/a);break}case"free":break;default:throw mn(L)}switch(K){case"fixed":{s=q;break}case"contain":{a<w?s=q:s=On(s,A+D,A);break}case"inside":{a<w?s=On(s,A,(f.h-m)/a-b.h):s=On(s,A+D,A);break}case"outside":{s=On(s,m/a-b.h,(f.h-m)/a);break}case"free":break;default:throw mn(K)}}}else if(a>d||a<u){const{x:g,y:m,z:S}=r;a=On(a,u,d),i=g+(-g+f.w/a/2)-(-g+f.w/S/2),s=m+(-m+f.h/a/2)-(-m+f.h/S/2)}}return{x:i,y:s,z:a}}_setCamera(e,t){const r=this.getCamera(),{x:i,y:s,z:a}=this.getConstrainedCamera(e,t);return r.x===i&&r.y===s&&r.z===a?this:(Os(()=>{const l={...r,x:i,y:s,z:a};this.run(()=>{this.store.put([l])},{history:"ignore"});const{currentScreenPoint:u,currentPagePoint:d}=this.inputs,{screenBounds:f}=this.store.unsafeGetWithoutCapture(ur);if(u.x/a-i!==d.x||u.y/a-s!==d.y){const g={type:"pointer",target:"canvas",name:"pointer_move",point:P.AddXY(u,f.x,f.y),pointerId:aA.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:er(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};t!=null&&t.immediate?this._flushEventForTick(g):this.dispatch(g)}this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(t!=null&&t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=P.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(i,t);if(t!=null&&t.animation){const{width:a,height:l}=this.getViewportScreenBounds();this._animateToViewport(new be(-s.x,-s.y,a/s.z,l/s.z),t)}else this._setCamera(s,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{width:i,height:s}=this.getViewportPageBounds();return this.setCamera(new P(-(e.x-i/2),-(e.y-s/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const r=be.Common(Ye(t.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:r,constraints:i}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const s=this.getCamera(),{x:a,y:l,z:u}=s,{x:d,y:f}=e;let g=1;if(i){const m=this.getInitialZoom();u!==m&&(g=m)}return this.setCamera(new P(a+(d/g-d)-(d/u-d),l+(f/g-f)-(f/u-f),g),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{x:i,y:s,z:a}=this.getCamera(),{zoomSteps:l}=this.getCameraOptions();if(l!==null&&l.length>1){const u=this.getBaseZoom();let d=Rn(l)*u;for(let f=1;f<l.length;f++){const g=l[f-1]*u,m=l[f]*u;if(!(m-a<=(m-g)/2)){d=m;break}}this.setCamera(new P(i+(e.x/d-e.x)-(e.x/a-e.x),s+(e.y/d-e.y)-(e.y/a-e.y),d),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{zoomSteps:i}=this.getCameraOptions();if(i!==null&&i.length>1){const s=this.getBaseZoom(),{x:a,y:l,z:u}=this.getCamera();let d=i[0]*s;for(let f=i.length-1;f>0;f--){const g=i[f-1]*s,m=i[f]*s;if(!(m-u>=(m-g)/2)){d=g;break}}this.setCamera(new P(a+(e.x/d-e.x)-(e.x/u-e.x),l+(e.y/d-e.y)-(e.y/u-e.y),d),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(t!=null&&t.force))return this;const i=this.getViewportScreenBounds(),s=(t==null?void 0:t.inset)??Math.min(dH,i.width*.28),a=this.getBaseZoom(),l=r.zoomSteps[0],u=Rn(r.zoomSteps);let d=On(Math.min((i.width-s)/e.w,(i.height-s)/e.h),l*a,u*a);return(t==null?void 0:t.targetZoom)!==void 0&&(d=Math.min(t.targetZoom,d)),this.setCamera(new P(-e.x+(i.width-e.w*d)/2/d,-e.y+(i.height-e.h*d)/2/d,d),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:r,duration:i,start:s,end:a}=this._viewportAnimation;if(t>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new P(-a.x,-a.y,this.getViewportScreenBounds().width/a.width));return}const l=i-t,u=r(1-l/i),d=s.minX+(a.minX-s.minX)*u,f=s.minY+(a.minY-s.minY)*u,g=s.maxX+(a.maxX-s.maxX)*u;this._setCamera(new P(-d,-f,this.getViewportScreenBounds().width/(g-d)),{force:!0})}_animateToViewport(e,t={animation:qb}){const{animation:r,...i}=t;if(!r)return;const{duration:s=0,easing:a=Tn.easeInOutCubic}=r,l=this.user.getAnimationSpeed(),u=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),s===0||l===0?this._setCamera(new P(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:s/l,easing:a,start:u.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:i,friction:s=this.options.cameraSlideFriction,direction:a,speedThreshold:l=.01}=e;let u=Math.min(i,1);const d=()=>{this.off("tick",f),this.off("stop-camera-animation",d)};this.once("stop-camera-animation",d);const f=g=>{const{x:m,y:S,z:b}=this.getCamera(),x=P.Mul(a,u*g/b);u*=1-s,u<l?d():this._setCamera(new P(m+x.x,S+x.y,b))};return this.on("tick",f),this}zoomToUser(e,t={animation:{duration:500}}){const r=this.getCollaborators().find(s=>s.userId===e);if(!r)return this;const i=r.cursor;return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=r.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(r.currentPageId),t&&t.animation&&!s&&(t.animation=void 0),this.centerOnPoint(i,t);const{highlightedUserIds:a}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...a,e]}),this.timers.setTimeout(()=>{const l=[...this.getInstanceState().highlightedUserIds],u=l.indexOf(e);u<0||(l.splice(u,1),this.updateInstanceState({highlightedUserIds:l}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof HTMLElement){const l=e.getBoundingClientRect();e=new be(l.left||l.x,l.top||l.y,Math.max(l.width,1),Math.max(l.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!Aa(document.body.scrollWidth,e.maxX,1),!Aa(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:i}=this;this._willSetInitialBounds=!1;const{screenBounds:s,insets:a}=this.getInstanceState();if(e.equals(s)&&r.every((l,u)=>l===a[u]))return this;if(i)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const l=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(P.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:r,h:i}=this.getInstanceState().screenBounds;return new be(e,t,r,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new P(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:r,y:i,z:s}=this.getCamera();return new be(-r,-i,e/s,t/s)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ur),{x:r,y:i,z:s=1}=this.getCamera();return new P((e.x-t.x)/s-r,(e.y-t.y)/s-i,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ur),{x:r,y:i,z:s=1}=this.getCamera();return new P((e.x+r)*s+t.x,(e.y+i)*s+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:r,z:i=1}=this.getCamera();return new P((e.x+t)*i,(e.y+r)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>lF(e.filter(s=>s.userId===r),s=>s.lastActivityTimestamp??0)):Mo}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter(s=>s.userId===e);if(!t.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),t.some(s=>s.followingUserId===r))return this;const i=ue("latestLeaderPresence",()=>this.getCollaborators().find(s=>s.userId===e));return Os(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const s=js("update current page",()=>{const u=i.get();if(!u){this.stopFollowingUser();return}u.currentPageId!==this.getCurrentPageId()&&this.getPage(u.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:u.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),a=()=>{s(),this._isLockedOnFollowingUser.set(!1),this.off("frame",l),this.off("stop-following",a)},l=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const d=this.user.getAnimationSpeed();if(d===0){this._isLockedOnFollowingUser.set(!0);return}const f=this.getViewportPageBoundsForFollowing();if(!f){this.stopFollowingUser();return}const g=this.getViewportPageBounds(),m=Math.abs(f.minX-g.minX)+Math.abs(f.maxX-g.maxX),S=Math.abs(f.minY-g.minY)+Math.abs(f.maxY-g.maxY);if(m<this.options.followChaseViewportSnap&&S<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const b=On(d*.5,.1,.8),x=new be(st(g.minX,f.minX,b),st(g.minY,f.minY,b),st(g.width,f.width,b),st(g.height,f.height,b)),w=new P(-x.x,-x.y,this.getViewportScreenBounds().width/x.width);this.stopCameraAnimation(),this._setCamera(w)};this.once("stop-following",a),this.addListener("frame",l),l()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let r=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),a=(u,d,f)=>{const g=this.getShape(u);if(!g||this.isShapeHidden(g))return;d*=g.opacity;let m=!1;const S=this.getShapeUtil(g);e&&(m=!f&&s.includes(u),m&&(d*=.32)),t.push({id:u,shape:g,util:S,index:r,backgroundIndex:i,opacity:d}),r+=1,i+=1;const b=this.getSortedChildIdsForParent(u);if(!b.length)return;let x=null;S.providesBackgroundForChildren(g)&&(x=i,i=r,r+=this.options.maxShapesPerPage);for(const w of b)a(w,d,f||m);x!==null&&(i=x)},l=e?[this.getCurrentPage()]:this.getPages();for(const u of l)for(const d of this.getSortedChildIdsForParent(u.id))a(d,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(FF)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(Jn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(r.map(i=>i.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),r=qG(e.name??"Page 1",t.map(a=>a.name));let i=e.index;(!i||t.some(a=>a.index===i))&&(i=Is(t[t.length-1].index));const s=si.create({meta:{},...e,name:r,index:i});this.store.put([s])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const i=this.getPage(t);if(i){if(t===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===t),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}this.store.remove([i.id])}}),this}duplicatePage(e,t=si.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,i=this.getPage(r);if(!i)return this;const s={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.run(()=>{var d;const l=this.getPages(),u=wh(i.index,(d=l[l.indexOf(i)+1])==null?void 0:d.index);if(this.createPage({name:i.name+" Copy",id:t,index:u}),this.setCurrentPage(t),this.setCamera(s),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(e,t){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(r=>r.id);return t.length<=0?this:(this.run(()=>this.store.remove(t),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:i=1,shouldResolveToOriginal:s=!1,dpr:a=this.getInstanceState().devicePixelRatio}=t,u=(f=>Math.pow(2,Math.ceil(Math.log2(f))))(i),d="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(r,{screenScale:i||1,steppedScreenScale:u,dpr:a,networkEffectiveType:d,shouldResolveToOriginal:s})}async uploadAsset(e,t,r){return await this.store.props.assets.upload(e,t,r)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var t,r;return(r=(t=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(t,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);if(!r)throw Error("Editor.getTransform: shape not found");return ve.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Ir(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??ve.Identity();return ve.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);return!r||Ir(r.parentId)?ve.Identity():this._getShapePageTransformCache().get(r.parentId)??ve.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??ve.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this._getShapePageTransformCache().get(e.id);return t?be.FromPoints(ve.applyToPoints(t,this.getShapeGeometry(e).vertices)):new be})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${ve.applyToPoints(ve.Inverse(r),t).map(s=>`${s.x}px ${s.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Ir(e.parentId))return;const t=this.getShapeAncestors(e.id).filter(i=>this.isShapeOfType(i,"frame"));return t.length===0?void 0:t.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,s)=>{if(!(s&&i))return;const a=IA(i,s);return a?a.map(P.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:i}=t;if(i.every((a,l)=>a&&P.Equals(a,r[l])))return t.clone();const s=IA(r,i);return s?be.FromPoints(s):void 0}return t})}getShapeAncestors(e,t=[]){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return t;const s=i.parentId;if(Ir(s))return t.reverse(),t;const a=this.store.get(s);return a?(t.push(a),this.getShapeAncestors(a,t)):t}findShapeAncestor(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return;const s=i.parentId;if(Ir(s))return;const a=this.getShape(s);if(a)return t(a)?a:this.findShapeAncestor(a,t)}hasAncestor(e,t){const r=typeof e=="string"?e:e==null?void 0:e.id,i=r&&this.getShape(r);return i?i.parentId===t?!0:this.hasAncestor(this.getShapeParent(i),t):!1}findCommonAncestor(e,t){var u;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(d=>d.id),i=Ye(r.map(d=>this.getShape(d)));if(i.length===1){const d=i[0].parentId;return Ir(d)?void 0:t?(u=this.findShapeAncestor(i[0],t))==null?void 0:u.id:d}const[s,...a]=i;let l=this.getShapeParent(s);for(;l;){if(t&&!t(l)){l=this.getShapeParent(l);continue}if(a.every(d=>this.hasAncestor(d,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(e){const t=typeof e=="string"?this.getShape(e):e;return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}_notVisibleShapes(){return QG(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),r=this.getEditingShapeId(),i=new Set(e);return r&&i.delete(r),t.forEach(s=>{i.delete(s)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const r=this.getShapeMaskedPageBounds(t);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&t.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const r=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:s,margin:a=0,hitLocked:l=!1,hitLabels:u=!1,hitInside:d=!1,hitFrameInside:f=!1}=t;let g=1/0,m=null,S=1/0,b=null;const x=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(w.isLocked&&!l||this.isShapeHidden(w)||this.isShapeOfType(w,"group"))return!1;const _=this.getShapeMask(w);return _&&!ei(e,_)?!1:s?s(w):!0});for(let w=x.length-1;w>=0;w--){const _=x[w],E=this.getShapeGeometry(_),M=E instanceof ki,I=this.getPointInShapeSpace(_,e);if(this.isShapeOfType(_,"frame")||(this.isShapeOfType(_,"arrow")||this.isShapeOfType(_,"geo")&&_.props.fill==="none")&&_.props.text.trim()){for(const j of E.children)if(j.isLabel&&j.isPointInBounds(I))return _}if(this.isShapeOfType(_,"frame")){const j=E.distanceToPoint(I,d);if(Math.abs(j)<=a)return b||_;if(E.hitTestPoint(I,0,!0))return b||m||(f?_:void 0);continue}let A;if(M){let j=1/0;for(const D of E.children){if(D.isLabel&&!u)continue;const R=D.distanceToPoint(I,d);R<j&&(j=R)}A=j}else a===0&&(E.bounds.w<1||E.bounds.h<1)||E.bounds.containsPoint(I,a)?A=E.distanceToPoint(I,d):A=1/0;if(E.isClosed){if(A<=a){if(E.isFilled||M&&E.children[0].isFilled)return b||_;if(this.getShapePageBounds(_).contains(i))continue;if(Math.abs(A)<a)Math.abs(A)<S&&(S=Math.abs(A),b=_);else if(!b){const{area:j}=E;j<g&&(g=j,m=_)}}}else if(A<this.options.hitTestMargin/r)return _}return b||m||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,t))}isPointInShape(e,t,r={}){const{hitInside:i=!1,margin:s=0}=r,a=typeof e=="string"?e:e.id,l=this.getShapeMask(a);return l&&!ei(t,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(e,t),s,i)}getPointInShapeSpace(e,t){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return new P(0,0);if(Ir(i.parentId))return P.From(t);const s=this.getShapePageTransform(i.parentId);return s?s.clone().invert().applyToPoint(t):P.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,i=t.length;r<i;r++)lL(this,t[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(kr(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e==null?void 0:e.id;if(!t)return;const r=this.getShape(t);if(!(r===void 0||!kr(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return!1;let s=!1;if(i.parentId===t)s=!0;else{let a=this.getShape(i.parentId);e:for(;a;){if(a.parentId===t){s=!0;break e}a=this.getShape(a.parentId)}}return s}getAncestorPageId(e){const t=typeof e=="string"?e:e==null?void 0:e.id,r=t&&this.getShape(t);if(r)return Ir(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,t,r){const i=typeof e[0]=="string"?e:e.map(m=>m.id);if(i.length===0)return this;const s=[],a=Ir(t)?ve.Identity():this.getShapePageTransform(t),l=a.rotation();let u=[];const d=Ye(this.getSortedChildIdsForParent(t).map(m=>this.getShape(m)));if(r){const m=d.find(S=>S.index===r);if(m){const S=d[d.indexOf(m)+1];S?u=cu(r,S.index,i.length):u=Uv(r,i.length)}else{const S=d.sort(Jn).find(b=>b.index>r);S?u=cu(r,S.index,i.length):u=Uv(r,i.length)}}else{const m=d.length&&d[d.length-1];u=m?Uv(m.index,i.length):_h(i.length)}const f=a.clone().invert(),g=Ye(i.map(m=>this.getShape(m)));return this.run(()=>{for(let m=0;m<g.length;m++){const S=g[m],b=this.getShapePageTransform(S);if(!b)continue;const x=b.point();if(!x)continue;const w=f.applyToPoint(x),_=b.rotation()-l;s.push({id:S.id,type:S.type,parentId:t,x:w.x,y:w.y,rotation:_,index:u[m]})}this.updateShapes(s)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];if(!r||r.length===0)return"a1";const i=this.getShape(r[r.length-1]);return Is(i.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];return r||Mo}visitDescendants(e,t){const r=typeof e=="string"?e:e.id,i=this.getSortedChildIdsForParent(r);for(const s of i)t(s)!==!1&&this.visitDescendants(s,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const r of e.map(i=>this.getShape(i)).sort(Jn))t.add(r.id),this.visitDescendants(r,i=>{t.add(i)});return t}getDroppingOverShape(e,t=[]){const r=this.getCurrentPageShapesSorted();for(let i=r.length-1;i>=0;i--){const s=r[i];if(this.isShapeHidden(s)||this.getSelectedShapeIds().includes(s.id)||!this.getShapeUtil(s).canDropShapes(s,t)||t.find(l=>l.id===s.id||this.hasAncestor(s,l.id)))continue;const a=this.getShapeMaskedPageBounds(s.id);if(a&&a.containsPoint(e)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,e),0,!0))return s}}getOutermostSelectableShape(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);let s=i,a=i;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((t==null?void 0:t(a))??!0))s=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return s}_getBindingsIndexCache(){const e=WG(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.fromId===r&&i.type===t)}getBindingsToShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.toId===r&&i.type===t)}getBindingsInvolvingShape(e,t){const r=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(r)??Mo;return t?i.filter(s=>s.type===t):i}createBindings(e){const t=[];for(const r of e){const i=this.getShape(r.fromId),s=this.getShape(r.toId);if(!i||!s||!this.canBindShapes({fromShape:i,toShape:s,binding:r}))continue;const l=this.getBindingUtil(r.type).getDefaultProps(),u=this.store.schema.types.binding.create({...r,id:r.id??Al(),props:{...l,...r.props}});t.push(u)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const r of e){if(!r)continue;const i=this.getBinding(r.id);if(!i)continue;const s=ws(i,r);if(s===i)continue;const a=this.getShape(s.fromId),l=this.getShape(s.toId);!a||!l||this.canBindShapes({fromShape:a,toShape:l,binding:s})&&t.push(s)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const r=e.map(i=>typeof i=="string"?i:i.id);return t?this.store.atomic(()=>{var i,s;for(const a of r){const l=this.getBinding(a);if(!l)continue;const u=this.getBindingUtil(l);(i=u.onBeforeIsolateFromShape)==null||i.call(u,{binding:l,removedShape:this.getShape(l.toId)}),(s=u.onBeforeIsolateToShape)==null||s.call(u,{binding:l,removedShape:this.getShape(l.fromId)}),this.store.remove([a])}}):this.store.remove(r),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:r}){const i=typeof e=="string"?e:e.type,s=typeof t=="string"?t:t.type,a=typeof r=="string"?r:r.type,l={fromShapeType:i,toShapeType:s,bindingType:a};return i===s?this.getShapeUtil(i).canBind(l):this.getShapeUtil(i).canBind(l)&&this.getShapeUtil(s).canBind(l)}rotateShapesBy(e,t,r){const i=typeof e[0]=="string"?e:e.map(a=>a.id);if(i.length<=0)return this;const s=RR({editor:this,ids:i});return s?(ug({delta:t,snapshot:s,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,t){var s,a,l;let r=e;const i=this.getShapeUtil(e);return r=ws(r,((s=i.onTranslateStart)==null?void 0:s.call(i,r))??void 0),r=ws(r,{id:e.id,type:e.type,x:t.x,y:t.y}),r=ws(r,((a=i.onTranslate)==null?void 0:a.call(i,e,r))??void 0),r=ws(r,((l=i.onTranslateEnd)==null?void 0:l.call(i,e,r))??void 0),r}nudgeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(r.length<=0)return this;const i=[];for(const s of r){const a=this.getShape(s),l=P.From(t),u=this.getShapeParentTransform(a);u&&l.rot(-u.rotation()),i.push(this.getChangesToTranslateShape(a,l.add(a)))}return this.updateShapes(i),this}duplicateShapes(e,t){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(m=>m.id);if(r.length<=0)return this;const i=new Set(r),s=this.getShapeAndDescendantIds(r),a=[...s].reverse(),l=new Map;for(const m of s)l.set(m,Mt());const{shapesToCreateWithOriginals:u,bindingsToCreate:d}=KA(this,s,m=>{const S=[];for(const x of m){const w=this.getBinding(x);if(!w)continue;const _=Al();S.push({...w,id:_,fromId:jr(l.get(w.fromId)),toId:jr(l.get(w.toId))})}const b=[];for(const x of a){const w=jr(l.get(x)),_=this.getShape(x);if(!_)continue;let E=0,M=0;if(t&&i.has(x)){const I=this.getShapeParentTransform(_),A=new P(t.x,t.y).rot(-I.rotation());E=A.x,M=A.y}b.push({shape:{..._,id:w,x:_.x+E,y:_.y+M,index:"a1",parentId:l.get(_.parentId)??_.parentId},originalShape:_})}return{shapesToCreateWithOriginals:b,bindingsToCreate:S}});u.forEach(({shape:m,originalShape:S})=>{const b=S.parentId,x=this.getSortedChildIdsForParent(b),w=x.indexOf(S.id),_=x[w+1],E=_?this.getShape(_):void 0,M=wh(S.index,E==null?void 0:E.index);m.index=M});const f=u.map(({shape:m})=>m);if(f.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Rp(this);return}if(this.createShapes(f),this.createBindings(d),this.setSelectedShapes(Ye(r.map(m=>l.get(m)))),t!==void 0){const m=this.getSelectionPageBounds(),S=this.getViewportPageBounds();m&&!S.contains(m)&&this.centerOnPoint(m.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const r=typeof e[0]=="string"?e:e.map(l=>l.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const i=this.getCurrentPageId();if(t===i)return this;if(!this.store.has(t))return this;const s=this.getContentFromCurrentPage(r);if(!s)return this;if(this.getPageShapeIds(t).size+s.shapes.length>this.options.maxShapesPerPage)return Rp(this,t),this;const a=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getIsReadonly()||t.length===0)return this;let r=!0,i=!0;const s=[];for(const a of t){const l=this.getShape(a);l&&(s.push(l),l.isLocked?i=!1:r=!1)}return this.run(()=>{i?(this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=Op(this,"toBack",t,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Op(this,"backward",r,t);return i&&this.updateShapes(i),this}bringForward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Op(this,"forward",r,t);return i&&this.updateShapes(i),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=Op(this,"toFront",t);return r&&this.updateShapes(r),this}flipShapes(e,t){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(this.getIsReadonly())return this;let i=Ye(r.map(a=>this.getShape(a)));if(!i.length)return this;i=Ye(i.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const s=be.Common(Ye(i.map(a=>this.getShapePageBounds(a)))).center;return this.run(()=>{for(const a of i){const l=this.getShapeGeometry(a).bounds,u=this.getShapePageTransform(a.id);u&&this.resizeShape(a.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:l,initialPageTransform:u,initialShape:a,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(a).isAspectRatioLocked(a),scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(e,t,r){const i=typeof e[0]=="string"?e:e.map(x=>x.id);if(this.getIsReadonly())return this;const s=i.map(x=>this.getShape(x)).filter(x=>x?this.getShapeUtil(x).canBeLaidOut(x):!1),a=s.length;if(r===0&&a<3||a<2)return this;const l=Object.fromEntries(s.map(x=>[x.id,this.getShapePageBounds(x)]));let u,d,f,g;t==="horizontal"?(u="x",d="minX",f="maxX",g="width"):(u="y",d="minY",f="maxY",g="height");let m;if(r===0){const x=[];s.sort((_,E)=>l[_.id][d]-l[E.id][d]);for(let _=0;_<a-1;_++){const E=s[_],M=s[_+1],I=l[E.id],j=l[M.id][d]-I[f],D=x.find(R=>R.gap===j);D?D.count++:x.push({gap:j,count:1})}let w=0;x.forEach(_=>{_.count>w&&(w=_.count,m=_.gap)}),w===1&&(m=Math.max(0,x.reduce((_,E)=>_+E.gap*E.count,0)/(a-1)))}else m=r;const S=[];let b=l[s[0].id][f];return s.forEach((x,w)=>{var A,j;if(w===0)return;const _={x:0,y:0};_[u]=b+m-l[x.id][u];const E=this.getShapeParent(x),M=E?P.Rot(_,-this.getShapePageTransform(E).decompose().rotation):_,I=(j=(A=this.getShapeUtil(x)).onTranslateStart)==null?void 0:j.call(A,x);S.push(I?{...I,[u]:x[u]+M[u]}:{id:x.id,type:x.type,[u]:x[u]+M[u]}),b+=l[x.id][g]+m}),this.updateShapes(S),this}packShapes(e,t){var j,D;const r=typeof e[0]=="string"?e:e.map(R=>R.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=r.map(R=>this.getShape(R)).filter(R=>R?this.getShapeUtil(R).canBeLaidOut(R):!1),s={},a={};let l,u,d=0;for(let R=0;R<i.length;R++)l=i[R],u=this.getShapePageBounds(l),s[l.id]=u,a[l.id]=u.clone(),d+=u.width*u.height;const f=be.Common(Ye(Object.values(s))),g=f.width;i.sort((R,q)=>s[q.id].height-s[R.id].height);const m=Math.max(Math.ceil(Math.sqrt(d/.95)),g),S=[new be(f.x,f.y,m,1/0)];let b=0,x=0,w,_;for(let R=0;R<i.length;R++){l=i[R],u=a[l.id];for(let q=S.length-1;q>=0;q--)if(w=S[q],!(u.width>w.width||u.height>w.height)){u.x=w.x,u.y=w.y,x=Math.max(x,u.maxY),b=Math.max(b,u.maxX),u.width===w.width&&u.height===w.height?(_=S.pop(),q<S.length&&(S[q]=_)):u.height===w.height?(w.x+=u.width+t,w.width-=u.width+t):u.width===w.width?(w.y+=u.height+t,w.height-=u.height+t):(S.push(new be(w.x+(u.width+t),w.y,w.width-(u.width+t),u.height)),w.y+=u.height+t,w.height-=u.height+t);break}}const E=be.Common(Object.values(a)),M=P.Sub(f.center,E.center);let I;const A=[];for(let R=0;R<i.length;R++){l=i[R],u=s[l.id],I=a[l.id];const q=P.Sub(I.point,u.point).add(M),L=this.getShapeParentTransform(l);L&&q.rot(-L.rotation());const K={id:l.id,type:l.type,x:l.x+q.x,y:l.y+q.y},G=(D=(j=this.getShapeUtil(l)).onTranslateStart)==null?void 0:D.call(j,{...l,...K});G?A.push({...K,...G}):A.push(K)}return A.length&&this.updateShapes(A),this}alignShapes(e,t){const r=typeof e[0]=="string"?e:e.map(u=>u.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=Ye(r.map(u=>this.getShape(u))),s=Object.fromEntries(i.map(u=>[u.id,this.getShapePageBounds(u)])),a=be.Common(Ye(Object.values(s))),l=[];return i.forEach(u=>{const d=s[u.id];if(!d)return;const f={x:0,y:0};switch(t){case"top":{f.y=a.minY-d.minY;break}case"center-vertical":{f.y=a.midY-d.minY-d.height/2;break}case"bottom":{f.y=a.maxY-d.minY-d.height;break}case"left":{f.x=a.minX-d.minX;break}case"center-horizontal":{f.x=a.midX-d.minX-d.width/2;break}case"right":{f.x=a.maxX-d.minX-d.width;break}}const g=this.getShapeParent(u),m=g?P.Rot(f,-this.getShapePageTransform(g).decompose().rotation):f;l.push(this.getChangesToTranslateShape(u,P.Add(u,m)))}),this.updateShapes(l),this}distributeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(E=>E.id);if(this.getIsReadonly())return this;if(r.length<3)return this;const i=r.length,s=Ye(r.map(E=>this.getShape(E))),a=Object.fromEntries(s.map(E=>[E.id,this.getShapePageBounds(E)]));let l,u,d,f,g;t==="horizontal"?(l="x",u="minX",d="maxX",f="midX",g="width"):(l="y",u="minY",d="maxY",f="midY",g="height");const m=[],S=s.sort((E,M)=>a[E.id][u]-a[M.id][u])[0],b=s.sort((E,M)=>a[M.id][d]-a[E.id][d])[0],x=a[S.id][f],w=(a[b.id][f]-x)/(i-1),_=x+w;return s.filter(E=>E!==S&&E!==b).sort((E,M)=>a[E.id][f]-a[M.id][f]).forEach((E,M)=>{const I={x:0,y:0};I[l]=_+w*M-a[E.id][g]/2-a[E.id][l];const A=this.getShapeParent(E),j=A?P.Rot(I,-this.getShapePageTransform(A).rotation()):I;m.push(this.getChangesToTranslateShape(E,P.Add(E,j)))}),this.updateShapes(m),this}stretchShapes(e,t){const r=typeof e[0]=="string"?e:e.map(u=>u.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=Ye(r.map(u=>this.getShape(u))),s=Object.fromEntries(r.map(u=>[u,this.getShapeGeometry(u).bounds])),a=Object.fromEntries(r.map(u=>[u,this.getShapePageBounds(u)])),l=be.Common(Ye(Object.values(a)));switch(t){case"vertical":{this.run(()=>{for(const u of i){if(this.getShapePageTransform(u).rotation()%wt)continue;const f=s[u.id],g=a[u.id],m=new P(0,l.minY-g.minY),S=this.getShapeParentTransform(u);S&&m.rot(-S.rotation());const{x:b,y:x}=P.Add(m,u);this.updateShapes([{id:u.id,type:u.type,x:b,y:x}]);const w=new P(1,l.height/g.height);this.resizeShape(u.id,w,{initialBounds:f,scaleOrigin:new P(g.center.x,l.minY),isAspectRatioLocked:this.getShapeUtil(u).isAspectRatioLocked(u),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const u of i){const d=s[u.id],f=a[u.id];if(this.getShapePageTransform(u).rotation()%wt)continue;const m=new P(l.minX-f.minX,0),S=this.getShapeParentTransform(u);S&&m.rot(-S.rotation());const{x:b,y:x}=P.Add(m,u);this.updateShapes([{id:u.id,type:u.type,x:b,y:x}]);const w=new P(l.width/f.width,1);this.resizeShape(u.id,w,{initialBounds:d,scaleOrigin:new P(l.minX,f.center.y),isAspectRatioLocked:this.getShapeUtil(u).isAspectRatioLocked(u),scaleAxisRotation:0})}});break}}return this}resizeShape(e,t,r={}){var b,x,w;const i=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new P(1,t.y)),Number.isFinite(t.y)||(t=new P(t.x,1));const s=r.initialShape??this.getShape(i);if(!s)return this;const a=r.scaleOrigin??((b=this.getShapePageBounds(i))==null?void 0:b.center);if(!a)return this;const l=r.initialPageTransform?ve.Cast(r.initialPageTransform):this.getShapePageTransform(i);if(!l)return this;const u=l.rotation();if(u==null)return this;const d=r.scaleAxisRotation??u,f=r.initialBounds??this.getShapeGeometry(i).bounds;if(!f)return this;const g=r.isAspectRatioLocked??this.getShapeUtil(s).isAspectRatioLocked(s);if(!IO(u,d))return this._resizeUnalignedShape(i,t,{...r,initialBounds:f,scaleOrigin:a,scaleAxisRotation:d,initialPageTransform:l,isAspectRatioLocked:g,initialShape:s});const m=this.getShapeUtil(s);g&&(Math.abs(t.x)>Math.abs(t.y)?t=new P(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new P(Math.sign(t.x)*Math.abs(t.y),t.y));let S=!1;if(m.onResize&&m.canResize(s)){const _=this._scalePagePoint(ve.applyToPoint(l,new P(0,0)),a,t,d),E=this.getPointInParentSpace(s.id,_),M=new P(t.x,t.y),I=Aa((u-d)%Math.PI,0);M.x=I?t.x:t.y,M.y=I?t.y:t.x;const A=ve.applyToPoint(l,new P),{x:j,y:D}=this.getPointInParentSpace(s.id,A);let R=s;r.skipStartAndEndCallbacks||(R=ws(s,((x=m.onResizeStart)==null?void 0:x.call(m,s))??void 0));const q=m.onResize({...s,x:j,y:D},{newPoint:E,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:M.x,scaleY:M.y,initialBounds:f,initialShape:s});q&&(S=!0),R=ws(R,{id:i,type:s.type,x:E.x,y:E.y,...q}),r.skipStartAndEndCallbacks||(R=ws(R,((w=m.onResizeEnd)==null?void 0:w.call(m,s,R))??void 0)),this.updateShapes([R])}if(!S){const _=ve.applyToPoint(l,f.center),E=this._scalePagePoint(_,a,t,d),M=this.getPointInParentSpace(s.id,_),I=this.getPointInParentSpace(s.id,E),A=P.Sub(I,M);this.updateShapes([{id:i,type:s.type,x:s.x+A.x,y:s.y+A.y}])}return this}_scalePagePoint(e,t,r,i){const s=P.RotWith(e,t,-i).sub(t),a=P.MulV(s,r);return P.Add(a,t).rotWith(t,i)}_resizeUnalignedShape(e,t,r){const{type:i}=r.initialShape,s=new P(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?s.x=Math.sign(t.x)*Math.abs(t.y):s.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,s,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:w}=ve.Decompose(r.initialPageTransform);w-=2*w,this.updateShapes([{id:e,type:i,rotation:w}])}const a=ve.applyToPoint(r.initialPageTransform,r.initialBounds.center),l=this._scalePagePoint(a,r.scaleOrigin,t,r.scaleAxisRotation),u=this.getShapePageBounds(e),d=this.getShapePageTransform(e),f=u.center,g=d.point();if(!f||!g)return this;const m=P.Sub(l,f),S=P.Add(g,m),{x:b,y:x}=this.getPointInParentSpace(e,S);return this.updateShapes([{id:e,type:i,x:b,y:x}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return Rp(this),this;const i=this.getFocusedGroupId();return this.run(()=>{var f,g;const s=this.getCurrentPageShapesSorted(),a=e.map(m=>{if(m.id||(m={id:Mt(),...m}),!m.parentId||!(this.store.has(m.parentId)||e.some(S=>S.id===m.parentId))){let S=this.getFocusedGroupId();for(let x=s.length-1;x>=0;x--){const w=s[x];if(!this.isShapeHidden(w)&&this.getShapeUtil(w).canReceiveNewChildrenOfType(w,m.type)&&this.isPointInShape(w,{x:m.x??0,y:m.y??0},{margin:0,hitInside:!0})){S=w.id;break}}const b=m.parentId;if(S===m.id&&(S=i),S!==b&&(m={...m},m.parentId=S,kr(S))){const x=this.getPointInShapeSpace(this.getShape(S),{x:m.x??0,y:m.y??0});m.x=x.x,m.y=x.y,m.rotation=-this.getShapePageTransform(S).rotation()+(m.rotation??0)}}return m}),l=new Map,u=[],{opacityForNextShape:d}=this.getInstanceState();for(const m of a){const S=this.getShapeUtil(m);let b=m.index;if(!b){const E=m.parentId??i;l.has(E)||l.set(E,this.getHighestIndexForParent(E)),b=l.get(E),l.set(E,Is(b))}const x=S.getDefaultProps();for(const[E,M]of this.styleProps[m.type])x[M]=this.getStyleForNextShape(E);let w=this.store.schema.types.shape.create({...m,index:b,opacity:m.opacity??d,parentId:m.parentId??i,props:"props"in m?{...x,...m.props}:x});if(w.index===void 0)throw Error("no index!");const _=(g=(f=this.getShapeUtil(w)).onBeforeCreate)==null?void 0:g.call(f,w);_&&(w=_),u.push(w)}u.forEach(m=>{m.meta={...this.getInitialMetaForShape(m),...m.meta}}),this.store.put(u)}),this}animateShape(e,t={animation:qb}){return this.animateShapes([e],t)}animateShapes(e,t={animation:qb}){if(!t.animation)return this;const{duration:r=500,easing:i=Tn.linear}=t.animation,s=Ct();let a=r,l;const u=[];let d,f;for(let m=0,S=e.length;m<S;m++){if(d=e[m],!d)continue;const b=this.getShape(d.id);b&&(f={start:$t(b),end:ws($t(b),d)},u.push(f),this.animatingShapes.set(b.id,s))}const g=m=>{var w,_;if(a-=m,a<0){const{animatingShapes:E}=this,M=e.filter(I=>I&&E.get(I.id)===s);M.length&&this.updateShapes(M),this.off("tick",g);return}l=i(1-a/r);const{animatingShapes:S}=this,b=[];let x;for(let E=0,M=u.length;E<M;E++){const{start:I,end:A}=u[E];x=S.get(I.id),x===s&&b.push({...A,x:I.x+(A.x-I.x)*l,y:I.y+(A.y-I.y)*l,opacity:I.opacity+(A.opacity-I.opacity)*l,rotation:I.rotation+(A.rotation-I.rotation)*l,props:((_=(w=this.getShapeUtil(A)).getInterpolatedProps)==null?void 0:_.call(w,I,A,l))??A.props})}this._updateShapes(b)};return this.on("tick",g),this}groupShapes(e,t={}){var b;const{groupId:r=Mt(),select:i=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s=typeof e[0]=="string"?e:e.map(x=>x.id);if(s.length<=1)return this;const a=Ye((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(x=>this.getShape(x))),l=a.sort(Jn).map(x=>x.id),u=be.Common(Ye(a.map(x=>this.getShapePageBounds(x)))),{x:d,y:f}=u.point,g=this.findCommonAncestor(a)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const m=a.filter(x=>x.parentId===g).sort(Jn),S=(b=m[m.length-1])==null?void 0:b.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:g,index:S,x:d,y:f,opacity:1,props:{}}]),this.reparentShapes(l,r),i&&this.select(r)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:r=!0}=t,i=typeof e[0]=="string"?e:e.map(u=>u.id),s=Ye((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(u=>this.getShape(u)));if(s.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const a=new Set,l=[];return s.forEach(u=>{this.isShapeOfType(u,"group")?l.push(u):a.add(u.id)}),l.length===0?this:(this.run(()=>{let u;for(let d=0,f=l.length;d<f;d++){u=l[d];const g=this.getSortedChildIdsForParent(u.id);for(let m=0,S=g.length;m<S;m++)a.add(g[m]);this.reparentShapes(g,u.parentId,u.index)}this.deleteShapes(l.map(d=>d.id)),r&&this.select(...a)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let r=0,i=e.length;r<i;r++){const s=e[r];if(!s)continue;const a=this.getShape(s.id);if(a){if(!this._shouldIgnoreShapeLock){if(a.isLocked){if(!(Object.hasOwn(s,"isLocked")&&!s.isLocked))continue}else if(this.isShapeOrAncestorLocked(a))continue}this.animatingShapes.delete(s.id),t.push(s)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var s,a;const t=[];let r,i;for(let l=0,u=e.length;l<u;l++){const d=e[l];d&&(r=this.getShape(d.id),r&&(i=ws(r,d),i!==r&&(i=((a=(s=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:a.call(s,r,i))??i,t.push(i))))}this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>{var r;return!((r=this.getShape(t))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(r.length===0)return this;const i=new Set(r);for(const s of r)this.visitDescendants(s,a=>{i.add(a)});return this.run(()=>this.store.remove([...i]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let i=0,s=r.length;i<s;i++)this._extractSharedStyles(this.getShape(r[i]),t)}else for(const[r,i]of this.styleProps[e.type])t.applyValue(r,tr(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new _w;for(const r of e)this._extractSharedStyles(r,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const r=this.styleProps[e.type].get(t);if(r!==void 0)return tr(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new _w;if(!e)return t;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())t.applyValue(r,this.getStyleForNextShape(r));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=i=>{const s=this.getShape(i);if(s)if(this.isShapeOfType(s,"group"))for(const a of this.getSortedChildIdsForParent(s.id))t(a);else e.push(s)};for(const i of this.getSelectedShapeIds())t(i);let r=null;for(const i of e)if(r===null)r=i.opacity;else if(r!==i.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const r=[],i=s=>{if(this.isShapeOfType(s,"group")){const a=this.getSortedChildIdsForParent(s);for(const l of a)i(this.getShape(l))}else r.push(s)};for(const s of t)i(s);this.updateShapes(r.map(s=>({id:s.id,type:s.type,opacity:e})))}return this}setStyleForNextShapes(e,t,r){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:t}},r),this}setStyleForSelectedShapes(e,t){const r=this.getSelectedShapes();if(r.length>0){const i=[],s=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a.id);for(const u of l)s(this.getShape(u))}else{const l=this.getShapeUtil(a),u=this.styleProps[a.type].get(e);if(u){const d={id:a.id,type:a.type,props:{[u]:t}};i.push({util:l,originalShape:a,updatePartial:d})}}};for(const a of r)s(a);this.updateShapes(i.map(({updatePartial:a})=>a))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,r;return await((r=(t=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,r;return(r=(t=this.externalContentHandlers)[e.type])==null?void 0:r.call(t,e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);if(!t||t.length===0)return;const r=this.getShapeAndDescendantIds(t);return KA(this,r,i=>{const s=[];for(const f of i){const g=this.getBinding(f);g&&s.push(g)}const a=[],l=[];for(const f of r){const g=this.getShape(f);if(!g)continue;if(!r.has(g.parentId)){const S=this.getShapePageTransform(g.id),b=S.point();l.push({...g,x:b.x,y:b.y,rotation:S.rotation(),parentId:this.getCurrentPageId()}),a.push(g.id)}else l.push(g)}const u=[],d=new Set;for(const f of l){if(!("assetId"in f.props))continue;const g=f.props.assetId;if(!g||d.has(g))continue;d.add(g);const m=this.getAsset(g);m&&u.push(m)}return{schema:this.store.schema.serialize(),shapes:l,rootShapeIds:a,bindings:s,assets:u}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async r=>{var i,s,a;if((r.type==="image"||r.type==="video")&&!((i=r.props.src)!=null&&i.startsWith("data:image"))&&!((s=r.props.src)!=null&&s.startsWith("data:video"))&&!((a=r.props.src)!=null&&a.startsWith("http"))){const l=$t(r),u=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});l.props.src=await ts.blobToDataUrl(await Ls(u).then(d=>d.blob())),t.push(l)}else t.push(r)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var L,K,G;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:i=!1,preservePosition:s=!1}=t;let{point:a=void 0}=t;const l=this.getCurrentPageId(),{rootShapeIds:u}=e,d=[],f=[],g=[],m={store:{...Object.fromEntries(e.assets.map(z=>[z.id,z])),...Object.fromEntries(e.shapes.map(z=>[z.id,z])),...Object.fromEntries(((L=e.bindings)==null?void 0:L.map(z=>[z.id,z]))??[])},schema:e.schema},S=this.store.schema.migrateStoreSnapshot(m);if(S.type==="error")throw Error("Could not put content: could not migrate content");for(const z of Object.values(S.value))switch(z.typeName){case"asset":{d.push(z);break}case"shape":{f.push(z);break}case"binding":{g.push(z);break}}const b=new Map(i?f.map(z=>[z.id,z.id]):f.map(z=>[z.id,Mt()])),x=new Map(i?g.map(z=>[z.id,z.id]):g.map(z=>[z.id,Al()]));let w=this.getCurrentPageId(),_=1/0,E=[];for(const z of this.getSelectedShapes()){if(_===0)break;const U=this.isShapeOfType(z,"frame"),Y=this.getShapeAncestors(z);U&&Y.push(z);const H=U?Y.length+1:Y.length;if(H<_)_=H,E=Y,w=U?z.id:z.parentId;else if(H===_){if(E.length!==Y.length)throw Error(`Ancestors: ${E.length} !== ${Y.length}`);if(E.length===0){w=l;break}else{w=l;for(let X=0;X<E.length&&Y[X]===E[X];X++)w=Y[X].id}}}let M=!1;if(!Ir(w)){const z=this.getShape(w);if(z){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(z)))w=l;else if(u.length===1){const U=f.find(Y=>Y.id===u[0]);this.isShapeOfType(z,"frame")&&this.isShapeOfType(U,"frame")&&U.props.w===(z==null?void 0:z.props.w)&&U.props.h===(z==null?void 0:z.props.h)&&(M=!0)}}else w=l}M||(M=b.has(w)),M&&(w=this.getShape(w).parentId);let I=this.getHighestIndexForParent(w);const A=[],j=f.map(z=>{const U=b.get(z.id),Y={...z,id:U};return u.includes(z.id)&&(Y.parentId=l,A.push(Y)),b.has(Y.parentId)?Y.parentId=b.get(z.parentId):(u.push(Y.id),Y.index=I,I=Is(I)),Y});if(j.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Rp(this),this;const D=g.map(z=>({...z,id:jr(x.get(z.id)),fromId:jr(b.get(z.fromId)),toId:jr(b.get(z.toId))})),R=[],q=[];for(const z of d)this.store.has(z.id)||((z.type==="image"&&((K=z.props.src)!=null&&K.startsWith("data:image"))||z.type==="video"&&((G=z.props.src)!=null&&G.startsWith("data:video")))&&(q.push($t(z)),z.props.src=null),R.push(z));return Promise.allSettled(q.map(async z=>{const U=await UG(z.props.src,z.props.name,z.props.mimeType??"image/png"),Y=await this.getAssetForExternalContent({type:"file",file:U,assetId:z.id});if(!Y){this.deleteAssets([z.id]);return}this.updateAssets([{...Y,id:z.id}])})),this.run(()=>{R.length>0&&this.createAssets(R),this.createShapes(j),this.createBindings(D),r&&this.select(...A.map(X=>X.id)),w!==l&&this.reparentShapes(A.map(X=>X.id),w);const z=j.map(X=>this.getShape(X.id)),U=be.Common(z.map(X=>this.getShapePageBounds(X)));if(a===void 0)if(Ir(w)){const X=this.getViewportPageBounds();s||X.includes(be.From(U))?a=U.center:a=X.center}else{const X=this.getShape(w);a=ve.applyToPoint(this.getShapePageTransform(X),this.getShapeGeometry(X).bounds.center)}if(A.length===1){const X=A[0];if(this.isShapeOfType(X,"frame"))for(;this.getShapesAtPoint(a).some(V=>this.isShapeOfType(V,"frame")&&V.props.w===X.props.w&&V.props.h===X.props.h);)a.x+=U.w+16}const Y=be.Common(Ye(A.map(({id:X})=>this.getShapePageBounds(X)))).center,H=P.Sub(a,Y);this.updateShapes(A.map(({id:X})=>{const V=this.getShape(X),ie=this.getShapeParentTransform(X).decompose().rotation,B=P.Rot(H,-ie);return{id:V.id,type:V.type,x:V.x+B.x,y:V.y+B.y}}))}),this}async getSvgElement(e,t={}){const r=e.length===0?this.getCurrentPageShapeIdsSorted():typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length!==0)return jG(this,r,t)}async getSvgString(e,t={}){const r=await this.getSvgElement(e,t);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,t={}){const r=await this.getSvgElement(e,t);if(r)return r.svg}async toImage(e,t={}){const r={format:"png",scale:1,pixelRatio:t.format==="svg"?void 0:2,...t},i=await this.getSvgString(e,r);if(!i)throw new Error("Could not create SVG");switch(r.format){case"svg":return{blob:new Blob([i.svg],{type:"image/svg+xml"}),width:i.width,height:i.height};case"jpeg":case"png":case"webp":{const s=await zG(i.svg,{type:r.format,quality:r.quality,pixelRatio:r.pixelRatio,width:i.width,height:i.height});if(!s)throw new Error("Could not construct image.");return{blob:s,width:i.width,height:i.height}}default:mn(r.format)}}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:s,currentPagePoint:a}=this.inputs,{screenBounds:l}=this.store.unsafeGetWithoutCapture(ur),{x:u,y:d,z:f}=xp(()=>this.getCamera()),g=e.point.x-l.x,m=e.point.y-l.y,S=e.point.z??.5;r.setTo(s),i.setTo(a),s.set(g,m);const b=g/f-u,x=m/f-d;isFinite(b)&&isFinite(x)&&a.set(b,x,S),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(s),this.inputs.originPagePoint.setTo(a)),this.run(()=>{var w;this.store.put([{id:Jg,typeName:"pointer",x:a.x,y:a.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===aA.CAMERA_MOVE?((w=this.store.unsafeGetWithoutCapture(Jg))==null?void 0:w.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return Lq(this.store)}loadSnapshot(e,t){return cR(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=Ye(e.shapeIds.map(a=>this.getShape(a))),r={};for(const a of t){const l=this.getAncestorPageId(a);l&&(r[l]??(r[l]=[]),r[l].push(a))}const[i,s]=Object.entries(r).sort(([a,l],[u,d])=>d.length-l.length)[0]??["",[]];if(!i||!s.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(i);const a=be.Common(s.map(l=>this.getShapePageBounds(l)));this.zoomToBounds(a,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:mn(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(KG(r))}catch(i){console.warn(i),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL((e==null?void 0:e.url)??window.location.href);return t.searchParams.set((e==null?void 0:e.param)??"d",HG((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=ue("url with state",()=>{var u,d;const a=((u=e==null?void 0:e.getUrl)==null?void 0:u.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:a,to:(d=e==null?void 0:e.getTarget)==null?void 0:d.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var l;const a=this.createDeepLink({param:e==null?void 0:e.param,to:(l=e==null?void 0:e.getTarget)==null?void 0:l.call(e,this)});window.history.replaceState({},document.title,a.toString())}),i=y1(a=>a(),(e==null?void 0:e.debounceMs)??500),s=js("update url on state change",()=>r(new URL(t.get()),this),{scheduleEffect:i});return()=>{s(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:er(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:er(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:er(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:er(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of t)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;this.emit("before-event",e);const{inputs:t}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:i,currentPagePoint:s}=t;t.isPointing||(t.isDragging=!1);const a=this.store.unsafeGetWithoutCapture(ur),l=this.store.get(this._getCurrentPageStateId()),u=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(u.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...l.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:d=1},delta:{x:f,y:g}}=e,{x:m,y:S}=P.SubXY(e.point,a.screenBounds.x,a.screenBounds.y);this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:b,y:x,z:w}=xp(()=>this.getCamera()),{panSpeed:_,zoomSpeed:E}=u;this._setCamera(new P(b+f*_/w-m/w+m/(d*E),x+g*_/w-S/w+S/(d*E),d*E),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:d}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,d.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(d)}));return}}}case"wheel":{if(u.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:d,zoomSpeed:f,wheelBehavior:g}=u;if(g!=="none"){this.stopCameraAnimation(),a.followingUserId&&this.stopFollowingUser();const{x:m,y:S,z:b}=xp(()=>this.getCamera()),{x,y:w,z:_=0}=e.delta;let E=g;switch(t.ctrlKey&&(E=g==="pan"?"zoom":"pan"),E){case"zoom":{const{x:M,y:I}=this.inputs.currentScreenPoint;let A=_;g==="zoom"&&(Math.abs(w)>10?A=10*Math.sign(w)/100:A=w/100);const j=b+(A??0)*f*b;this._setCamera(new P(m+(M/j-M)-(M/b-M),S+(I/j-I)-(I/b-I),j),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new P(m+x*d/b,S+w*d/b,b),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:d}=e,{isPenMode:f}=a;switch(e.name){case"pointer_down":{if(f&&!d)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const g=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(g.x,g.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===lA&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!f&&d&&this.updateInstanceState({isPenMode:!0}),e.button===cA?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===Ip&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!d&&f)return;const{x:g,y:m,z:S}=xp(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:b,previousScreenPoint:x}=this.inputs,{panSpeed:w}=u,_=P.Sub(b,x);this.setCamera(new P(g+_.x*w/S,m+_.y*w/S,S),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&P.Dist2(i,s)*this.getZoomLevel()>(a.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/S&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),a.isPenMode&&!d)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const g=this.inputs.pointerVelocity,m=Math.min(2,g.len());switch(e.button){case lA:{this.setCursor({type:"grab",rotation:0});break}case Ip:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}m>0&&this.slideCamera({speed:m,direction:g})}else e.button===cA&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=a.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let d;switch(e.code){case"ArrowUp":{d=new P(0,-1);break}case"ArrowRight":{d=new P(1,0);break}case"ArrowDown":{d=new P(0,1);break}case"ArrowLeft":{d=new P(-1,0);break}}if(d){const f=this.getViewportPageBounds(),g=f.clone().translate(d.mulV({x:f.w,y:f.h}));this._animateToViewport(g,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(Ip)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===Ip?e.name="middle_click":e.button===i_&&(e.name="right_click");const{isPenMode:d}=this.store.unsafeGetWithoutCapture(ur);if(e.isPen===d){const f=this._clickManager.handlePointerEvent(e);if(e.name!==f.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(f),this.emit("event",f);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){ln.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}Ce=hV(Ew);Ee(Ce,1,"getIsShapeHiddenCache",aL,_e);Ee(Ce,1,"getCanUndo",oL,_e);Ee(Ce,1,"getCanRedo",sL,_e);Ee(Ce,1,"getPath",iL,_e);Ee(Ce,1,"getCurrentTool",rL,_e);Ee(Ce,1,"getCurrentToolId",nL,_e);Ee(Ce,1,"getDocumentSettings",tL,_e);Ee(Ce,1,"getInstanceState",eL,_e);Ee(Ce,1,"getOpenMenus",J5,_e);Ee(Ce,1,"getIsMenuOpen",Q5,_e);Ee(Ce,1,"getPageStates",Z5,_e);Ee(Ce,1,"_getPageStatesQuery",W5,_e);Ee(Ce,1,"getCurrentPageState",X5,_e);Ee(Ce,1,"_getCurrentPageStateId",V5,_e);Ee(Ce,1,"getSelectedShapeIds",Y5,_e);Ee(Ce,1,"getSelectedShapes",G5,_e);Ee(Ce,1,"getOnlySelectedShapeId",q5,_e);Ee(Ce,1,"getOnlySelectedShape",K5,_e);Ee(Ce,1,"getSelectionPageBounds",H5,_e);Ee(Ce,1,"getSelectionRotation",$5,_e);Ee(Ce,1,"getSelectionRotatedPageBounds",U5,_e);Ee(Ce,1,"getSelectionRotatedScreenBounds",B5,_e);Ee(Ce,1,"getFocusedGroupId",F5,_e);Ee(Ce,1,"getFocusedGroup",z5,_e);Ee(Ce,1,"getEditingShapeId",N5,_e);Ee(Ce,1,"getEditingShape",L5,_e);Ee(Ce,1,"getHoveredShapeId",R5,_e);Ee(Ce,1,"getHoveredShape",D5,_e);Ee(Ce,1,"getHintingShapeIds",O5,_e);Ee(Ce,1,"getHintingShape",j5,_e);Ee(Ce,1,"getErasingShapeIds",k5,_e);Ee(Ce,1,"getErasingShapes",A5,_e);Ee(Ce,1,"_unsafe_getCameraId",M5,_e);Ee(Ce,1,"getCamera",I5,_e);Ee(Ce,1,"getViewportPageBoundsForFollowing",T5,_e);Ee(Ce,1,"getCameraForFollowing",P5,_e);Ee(Ce,1,"getZoomLevel",E5,_e);Ee(Ce,1,"getViewportScreenBounds",C5,_e);Ee(Ce,1,"getViewportScreenCenter",_5,_e);Ee(Ce,1,"getViewportPageBounds",w5,_e);Ee(Ce,1,"_getCollaboratorsQuery",x5,_e);Ee(Ce,1,"getCollaborators",b5,_e);Ee(Ce,1,"getCollaboratorsOnCurrentPage",v5,_e);Ee(Ce,1,"getRenderingShapes",S5,_e);Ee(Ce,1,"_getAllPagesQuery",y5,_e);Ee(Ce,1,"getPages",m5,_e);Ee(Ce,1,"getCurrentPageId",g5,_e);Ee(Ce,1,"getCurrentPageShapeIdsSorted",p5,_e);Ee(Ce,1,"_getAllAssetsQuery",f5,_e);Ee(Ce,1,"_getShapeGeometryCache",h5,_e);Ee(Ce,1,"_getShapeHandlesCache",d5,_e);Ee(Ce,1,"_getShapePageTransformCache",u5,_e);Ee(Ce,1,"_getShapePageBoundsCache",c5,_e);Ee(Ce,1,"_getShapeClipPathCache",l5,_e);Ee(Ce,1,"_getShapeMaskCache",a5,_e);Ee(Ce,1,"_getShapeMaskedPageBoundsCache",o5,_e);Ee(Ce,1,"_notVisibleShapes",s5,_e);Ee(Ce,1,"getCulledShapes",i5,_e);Ee(Ce,1,"getCurrentPageBounds",r5,_e);Ee(Ce,1,"getCurrentPageShapes",n5,_e);Ee(Ce,1,"getCurrentPageShapesSorted",t5,_e);Ee(Ce,1,"getCurrentPageRenderingShapesSorted",e5,_e);Ee(Ce,1,"_getBindingsIndexCache",J3,_e);Ee(Ce,1,"_getSelectionSharedStyles",Q3,_e);Ee(Ce,1,"getSharedStyles",Z3,_e);Ee(Ce,1,"getSharedOpacity",W3,_e);Ee(Ce,1,"getIsFocused",X3,_e);Ee(Ce,1,"getIsReadonly",V3,_e);Ee(Ce,1,"_setShiftKeyTimeout",Y3,_e);Ee(Ce,1,"_setAltKeyTimeout",G3,_e);Ee(Ce,1,"_setCtrlKeyTimeout",q3,_e);Ee(Ce,1,"_setMetaKeyTimeout",K3,_e);pV(Ce,_e);function Rp(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function ws(n,e){if(!e)return n;let t=null;const r=Object.entries(e);for(let i=0,s=r.length;i<s;i++){const[a,l]=r[i];if(l!==void 0&&!(a==="id"||a==="type"||a==="typeName")&&l!==n[a]){if(t||(t={...n}),a==="props"||a==="meta"){t[a]={...n[a]};for(const[u,d]of Object.entries(l))t[a][u]=d;continue}t[a]=l}}return t||n}function lL(n,e,t){const r=n.getShape(e);if(!r)return;t.push(r);const i=n.getSortedChildIdsForParent(e);for(let s=0,a=i.length;s<a;s++)lL(n,i[s],t)}function KA(n,e,t){let r;if(n.run(()=>{const i=n.store.extractingChanges(()=>{const s=new Set,a=new Set;for(const l of e)if(n.getShape(l))for(const d of n.getBindingsInvolvingShape(l)){const f=e.has(d.fromId),g=e.has(d.toId);if(f&&g){s.add(d.id);continue}(!f||!g)&&a.add(d.id)}n.deleteBindings([...a],{isolateShapes:!0});try{r=Ia.ok(t(s))}catch(l){r=Ia.err(l)}});n.store.applyDiff(uw(i))},{history:"ignore"}),r.ok)return r.value;throw r.error}function qA(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:r}}=e.constraints,i=n.getViewportScreenBounds(),s=be.From(e.constraints.bounds),a=(i.w-t*2)/s.w,l=(i.h-r*2)/s.h;return{zx:a,zy:l}}function ef(){const n=te(),e=Wh();return oe("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const GA="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",YA="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Lp='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Sa(n,e,t,r,i,s=16,a=16){const l=(-t-e)*(pt/180),u=Math.sin(l),d=Math.cos(l),f=1*d-1*u,g=1*u+1*d;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${f}' dy='${g}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${s} ${a}, pointer`}const mV=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],yV={none:()=>"none","ew-resize":(n,e,t)=>Sa(YA,n,0,e,t),"ns-resize":(n,e,t)=>Sa(YA,n,90,e,t),"nesw-resize":(n,e,t)=>Sa(GA,n,0,e,t),"nwse-resize":(n,e,t)=>Sa(GA,n,90,e,t),"nwse-rotate":(n,e,t)=>Sa(Lp,n,0,e,t),"nesw-rotate":(n,e,t)=>Sa(Lp,n,90,e,t),"senw-rotate":(n,e,t)=>Sa(Lp,n,180,e,t),"swne-rotate":(n,e,t)=>Sa(Lp,n,270,e,t)};function Xr(n,e=0,t="black"){return yV[n](yU(e),!1,t)}function SV(){const n=te(),e=bn(),t=ef();Ma("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(mV.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",Xr(r,i,t?"white":"black"))},[n,e,t])}function vV(){const n=te(),e=bn(),t=ef(),r=oe(ln.forceSrgb);ct.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function bV(){const[n,e]=T.useState(0);T.useEffect(()=>e(t=>t+1),[])}const xV=n=>n.props.src,wV={upload:async(n,e)=>({src:await ts.blobToDataUrl(e)})};function _V(n){return"schema"in n&&n.schema?n.schema:tH({shapes:"shapeUtils"in n&&n.shapeUtils?VA(fR(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?VA(dR(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function om({initialData:n,defaultName:e="",id:t,assets:r=wV,onMount:i,collaboration:s,...a}={}){const l=_V(a),u=new K1({id:t,schema:l,initialData:n,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??xV},onMount:d=>{vt(d instanceof _e),i==null||i(d)},collaboration:s}});if(a.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");cR(u,a.snapshot,{forceOverwriteSessionState:!0})}return u}function VA(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function CV(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function EV(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const PV=350,TV=1e4,XA=Symbol("UPDATE_INSTANCE_STATE"),IV=n=>n;class MV{constructor(e){O(this,"onmessage")}postMessage(e){}close(){}}const AV=typeof BroadcastChannel>"u"?MV:BroadcastChannel;class kV{constructor(e,{persistenceKey:t,sessionId:r=sm,onLoad:i,onLoadError:s},a=new AV(`tldraw-tab-sync-${t}`)){O(this,"disposables",new Set);O(this,"diffQueue",[]);O(this,"didDispose",!1);O(this,"shouldDoFullDBWrite",!0);O(this,"isReloading",!1);O(this,"persistenceKey");O(this,"sessionId");O(this,"serializedSchema");O(this,"isDebugging",!1);O(this,"documentTypes");O(this,"$sessionStateSnapshot");O(this,"db");O(this,"initTime",Date.now());O(this,"isPersisting",!1);O(this,"didLastWriteError",!1);O(this,"scheduledPersistTimeout",null);this.store=e,this.channel=a,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.db=new Kg(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=u_(this.store),this.disposables.add(e.listen(({changes:l})=>{this.diffQueue.push(l),this.channel.postMessage(IV({type:"diff",storeId:this.store.id,changes:l,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(XA),this.schedulePersist()},{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(l=>l.scope==="document").map(l=>l.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(i){t(i),EV();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(u=>[u.id,u])),s=r.sessionStateSnapshot??Rq(i),a=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(a.type==="error"){console.error("failed to migrate store",a),t(new Error(`Failed to migrate store: ${a.reason}`));return}const l=Object.values(a.value).filter(u=>this.documentTypes.has(u.typeName));l.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(l,"initialize")}),s&&Sw(this.store,s,{forceOverwrite:!0})}this.channel.onmessage=({data:i})=>{var l,u;this.debug("got message",i);const s=i,a=this.store.schema.getMigrationsSince(s.schema);if(a.ok){if(a.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(u=(l=window==null?void 0:window.location)==null?void 0:l.reload)==null||u.call(l);return}s.type==="diff"&&(this.debug("applying diff"),Os(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?TV:PV))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(vt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=H1(e.filter(r=>r!==XA));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),CV(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function cL(n){const e=T.useRef(n),[t,r]=T.useState(n);t!==e.current&&r(e.current);const i=T.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,r(e.current)},[]);return[t,i]}function jV(n){const[e,t]=cL({status:"loading"});return n=Cu(n),T.useEffect(()=>{const{persistenceKey:r,sessionId:i,...s}=n;if(!r){t({status:"not-synced",store:om(s)});return}t({status:"loading"});const a=new Rs,l={upload:async(g,m)=>(await f.db.storeAsset(g.id,m),{src:g.id}),resolve:async g=>g.props.src?g.props.src.startsWith("asset:")?await a.get(g,async()=>{const m=await f.db.getAsset(g.id);return m?URL.createObjectURL(m):null}):g.props.src:null,...s.assets},u=om({...s,assets:l});let d=!1;const f=new kV(u,{sessionId:i,persistenceKey:r,onLoad(){d||t({store:u,status:"synced-local"})},onLoadError(g){d||t({status:"error",error:g})}});return()=>{d=!0,f.close()}},[n,t]),e}function OV(){const n=te(),e=bn();T.useEffect(()=>{const t=s=>e.style.setProperty("--tl-zoom",s.toString()),r=y1(t,100),i=new xu("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[n,e])}function Pw(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0,i=n.length;r<i;r++)t[r]=n.charCodeAt(r);return e}function DV(n){const e=atob(n),t=Pw(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const RV=5,rh={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},LV=Math.max(...Object.values(rh)),ih={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},NV=Object.keys(ih).length,ox="sales@tldraw.com",zV=`${Ta()}/watermarks/watermark-track.svg`;class Wm{constructor(e,t,r){O(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");O(this,"isDevelopment");O(this,"isTest");O(this,"isCryptoAvailable");O(this,"state",yn("license state","pending"));O(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(i=>{const s=FV(i);!this.isDevelopment&&s&&Ls(zV),s?this.state.set("unlicensed"):i.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,r]=e.split("."),[i,s]=t.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const a=await DV(this.publicKey);let l;try{l=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},a,new Uint8Array(Pw(atob(r))),new Uint8Array(Pw(atob(s))))}catch(d){throw console.error(d),new Error("Could not perform signature validation")}if(!l)throw new Error("Invalid signature");let u;try{u=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return u.length>NV&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:u[ih.ID],hosts:u[ih.HOSTS],flags:u[ih.FLAGS],expiryDate:u[ih.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(t),i=new Date(r.expiryDate),s=this.isFlagEnabled(r.flags,rh.ANNUAL_LICENSE),a=this.isFlagEnabled(r.flags,rh.PERPETUAL_LICENSE),l={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:i,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(i),isPerpetualLicense:a,isPerpetualLicenseExpired:a&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(r.flags,rh.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,rh.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(l),l}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const i=r.toLowerCase().trim();if(i===t||`www.${i}`===t||i===`www.${t}`||r==="*")return!0;if(r.includes("*")){const s=new RegExp(r.replace(/\*/g,".*?"));return s.test(t)||s.test(`www.${t}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+RV+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r=new Date>=t;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${ox} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r={major:new Date(sA.major),minor:new Date(sA.minor)};return r.major>=t||r.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${ox} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${ox} if you would like to use tldraw on other domains.`]),e.license.flags>=LV*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}O(Wm,"className","tl-watermark_SEE-LICENSE");function FV(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const uL=T.createContext({}),BV=()=>T.useContext(uL);function UV({licenseKey:n,children:e}){const[t]=T.useState(()=>new Wm(n));return p.jsx(uL.Provider,{value:t,children:e})}function qa(n){if(!n)throw Error("usePassThroughWheelEvents must be passed a ref");const e=bn();T.useEffect(()=>{function t(i){if(i.isSpecialRedispatchedEvent)return;const s=n.current;if(s&&s.scrollHeight>s.clientHeight)return;Ze(i);const a=e.querySelector(".tl-canvas");if(!a)return;const l=new WheelEvent("wheel",i);l.isSpecialRedispatchedEvent=!0,a.dispatchEvent(l)}const r=n.current;if(r)return r.addEventListener("wheel",t,{passive:!1}),()=>{r.removeEventListener("wheel",t)}},[e,n])}const $V='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',HV='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function KV(n){return oe("watermarkState",()=>n.state.get(),[n])}const qV=`data:image/svg+xml;utf8,${encodeURIComponent($V)}`,GV=`data:image/svg+xml;utf8,${encodeURIComponent(HV)}`,YV=T.memo(function(){const e=BV(),t=te(),r=oe("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),i=KV(e);return["licensed-with-watermark","unlicensed"].includes(i)?p.jsxs(p.Fragment,{children:[p.jsx(XV,{}),p.jsx(VV,{src:r?GV:qV})]}):null}),VV=T.memo(function({src:e}){const t=te(),r=oe("debug mode",()=>t.getInstanceState().isDebugMode,[t]),i=oe("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),s=s_(),a=T.useRef(null);qa(a);const l=`url('${e}') center 100% / 100% no-repeat`,u="https://tldraw.dev";return p.jsx("div",{ref:a,className:Wm.className,"data-debug":r,"data-mobile":i,draggable:!1,...s,children:kt.isWebview?p.jsx("a",{draggable:!1,role:"button",onPointerDown:d=>{dn(d),Ze(d)},onClick:()=>zm.openWindow(u,"_blank"),style:{mask:l,WebkitMask:l}}):p.jsx("a",{href:u,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:d=>{dn(d)},style:{mask:l,WebkitMask:l}})})}),XV=T.memo(function(){const e=Wm.className,t=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}

	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return p.jsx("style",{children:t})}),WV=[],ZV=[],QV=[],JV="tl-container",eX=T.memo(function({store:e,components:t,className:r,user:i,options:s,...a}){const[l,u]=T.useState(null),d=T.useMemo(()=>i??oR(),[i]),f=(t==null?void 0:t.ErrorFallback)===void 0?ZD:t==null?void 0:t.ErrorFallback,g={...a,shapeUtils:a.shapeUtils??WV,bindingUtils:a.bindingUtils??ZV,tools:a.tools??QV,components:t,options:Cu(s)};return p.jsx("div",{ref:u,"data-tldraw":ED,draggable:!1,className:Oe(`${JV} tl-theme__light`,r),onPointerDown:dn,tabIndex:-1,children:p.jsx(Ph,{fallback:f,onError:m=>S1(m,{tags:{origin:"react.tldraw-before-app"}}),children:l&&p.jsx(UV,{licenseKey:a.licenseKey,children:p.jsx(AD,{container:l,children:p.jsx(bq,{overrides:t,children:e?e instanceof K1?p.jsx(hL,{...g,store:e,user:d}):p.jsx(dL,{...g,store:e,user:d}):p.jsx(tX,{...g,store:e,user:d})})})})})})});function tX(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,bindingUtils:s,persistenceKey:a,sessionId:l,user:u,assets:d,migrations:f}=n,g=jV({shapeUtils:i,bindingUtils:s,initialData:r,persistenceKey:a,sessionId:l,defaultName:e,snapshot:t,assets:d,migrations:f});return p.jsx(dL,{...n,store:g,user:u})}const dL=T.memo(function({store:e,user:t,...r}){const i=bn();T.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);const{LoadingScreen:s}=Ht();switch(e.status){case"error":throw e.error;case"loading":return s?p.jsx(s,{}):null}return p.jsx(hL,{...r,store:e.store,user:t})}),ax=()=>document.location.search.includes("tldraw_preserve_focus");function hL({onMount:n,children:e,store:t,tools:r,shapeUtils:i,bindingUtils:s,user:a,initialState:l,autoFocus:u=!0,inferDarkMode:d,cameraOptions:f,options:g,licenseKey:m,deepLinks:S,isShapeHidden:b}){const{ErrorFallback:x}=Ht(),w=bn(),[_,E]=cL(null),M=T.useRef(null),I=Cu(S===!0?{}:S),A=T.useRef({autoFocus:u&&!ax(),inferDarkMode:d,initialState:l,cameraOptions:f,deepLinks:I});T.useLayoutEffect(()=>{A.current={autoFocus:u&&!ax(),inferDarkMode:d,initialState:l,cameraOptions:f,deepLinks:I}},[u,d,l,f,I]),T.useLayoutEffect(()=>{const{autoFocus:R,inferDarkMode:q,initialState:L,cameraOptions:K,deepLinks:G}=A.current,z=new _e({store:t,shapeUtils:i,bindingUtils:s,tools:r,getContainer:()=>w,user:a,initialState:L,autoFocus:R,inferDarkMode:q,cameraOptions:K,options:g,licenseKey:m,isShapeHidden:b});return z.updateViewportScreenBounds(M.current??w),G&&(G!=null&&G.getUrl?z.navigateToDeepLink({...G,url:G.getUrl(z)}):z.navigateToDeepLink(G)),E(z),()=>{z.dispose()}},[s,w,g,i,t,r,a,E,m,b]),T.useLayoutEffect(()=>{if(_&&I)return _.registerDeepLinkListener(I)},[_,I]),T.useLayoutEffect(()=>{_&&f&&_.setCameraOptions(f)},[_,f]);const j=T.useSyncExternalStore(T.useCallback(R=>_?(_.on("crash",R),()=>_.off("crash",R)):()=>{},[_]),()=>(_==null?void 0:_.getCrashingError())??null);T.useEffect(function(){if(!_)return;function q(){_&&_.focus()}function L(){_&&_.blur()}if(u&&ax())return _.getContainer().addEventListener("pointerdown",q),document.body.addEventListener("pointerdown",L),()=>{var K;(K=_.getContainer())==null||K.removeEventListener("pointerdown",q),document.body.removeEventListener("pointerdown",L)}},[_,u]);const{Canvas:D}=Ht();return _?p.jsx(Ph,{fallback:x,onError:R=>_.annotateError(R,{origin:"react.tldraw",willCrashApp:!0}),children:j?p.jsx(rX,{crashingError:j}):p.jsx(r_,{editor:_,children:p.jsxs(nX,{onMount:n,children:[e??(D?p.jsx(D,{},_.contextId):null),p.jsx(YV,{})]})})}):p.jsx("div",{className:"tl-canvas",ref:M})}function nX({children:n,onMount:e}){return OV(),SV(),vV(),bV(),pL(t=>{const r=t.store.props.onMount(t),i=e==null?void 0:e(t);return()=>{r==null||r(),i==null||i()}}),n}function rX({crashingError:n}){throw n}function __({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function fL({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function pL(n){const e=te(),t=Km(r=>{let i;return r.run(()=>{i=n==null?void 0:n(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});ct.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function jo({children:n,className:e="",...t}){return p.jsx("div",{...t,className:Oe("tl-html-container",e),children:n})}class dg{constructor(e){this.editor=e}}O(dg,"props"),O(dg,"migrations"),O(dg,"type");function tf(n,e,t={}){const{newPoint:r,handle:i,scaleX:s,scaleY:a}=e,{minWidth:l=1,maxWidth:u=1/0,minHeight:d=1,maxHeight:f=1/0}=t;let g=n.props.w*s,m=n.props.h*a;const S=new P(0,0);if(g>0){if(g<l){switch(i){case"top_left":case"left":case"bottom_left":{S.x=g-l;break}case"top":case"bottom":{S.x=(g-l)/2;break}default:S.x=0}g=l}}else if(S.x=g,g=-g,g<l){switch(i){case"top_left":case"left":case"bottom_left":{S.x=-g;break}default:S.x=-l}g=l}if(m>0){if(m<d){switch(i){case"top_left":case"top":case"top_right":{S.y=m-d;break}case"right":case"left":{S.y=(m-d)/2;break}default:S.y=0}m=d}}else if(S.y=m,m=-m,m<d){switch(i){case"top_left":case"top":case"top_right":{S.y=-m;break}default:S.y=-d}m=d}const{x:b,y:x}=S.rot(n.rotation).add(r);return{...n,x:b,y:x,props:{w:Math.min(u,g),h:Math.min(f,m)}}}class Mu extends Mi{getGeometry(e){return new ji({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return tf(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,r){return{...t.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r)}}}var Dx;let iX=(Dx=class extends Ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},O(Dx,"id","idle"),Dx);var Rx;let sX=(Rx=class extends Ae{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,i=Mt(),s=this.editor.markHistoryStoppingPoint(`creating_box:${i}`),a=ss(t,this.editor);this.editor.createShapes([{id:i,type:r,x:a.x,y:a.y,props:{w:1,h:1}}]).select(i);const l=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:l.onCreate?u=>{var d;return(d=l.onCreate)==null?void 0:d.call(l,u)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,r=Mt();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(r);if(!i){this.cancel();return}let{w:s,h:a}=i.props;const l=new P(s/2,a/2),u=this.editor.getShapeParentTransform(i);u&&l.rot(-u.rotation());let d=1;this.editor.user.getIsDynamicResizeMode()&&(d=1/this.editor.getZoomLevel(),s*=d,a*=d,l.mul(d));const f=$t(i),g=ss(new P(i.x-l.x,i.y-l.y),this.editor);f.x=g.x,f.y=g.y,f.props.w=s,f.props.h=a,"scale"in i.props&&(f.props.scale=d),this.editor.updateShape(f),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},O(Rx,"id","pointing"),Rx);function ss(n,e){const t=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return t?n.clone().snapToGrid(r):n.clone()}class Tw extends Ae{static children(){return[iX,sX]}}O(Tw,"id","box"),O(Tw,"initial","idle");function oX(n,e,t){const r=T.useRef(!1),i=T.useCallback(a=>{r.current=a,a?Ji.addOpenMenu(n):Ji.deleteOpenMenu(n),e==null||e(a)},[n,e]),s=oe("is menu open",()=>Ji.getOpenMenus().includes(n),[n]);return T.useEffect(()=>(r.current&&(t==null||t("open-menu"),Ji.addOpenMenu(n)),()=>{r.current&&(Ji.deleteOpenMenu(n),Ji.getOpenMenus().forEach(a=>{a.startsWith(n)&&(t==null||t("close-menu"),Ji.deleteOpenMenu(a))}),r.current=!1)}),[n,t]),[s,i]}function Zm(n){const e=te();return oe("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function Es(n){const e=te();return T.useMemo(function(){const i=d=>{if(d.isKilled)return;if(d.button===i_){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Qr(d)});return}if(d.button!==0)return;const f=rm(d.currentTarget);function g(){f.removeEventListener("pointerup",g),Gh(f,d)}qh(f,d),f.addEventListener("pointerup",g),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Qr(d)}),dn(d)};let s,a;function l(d){d.isKilled||d.button===0&&(d.clientX===s&&d.clientY===a||(s=d.clientX,a=d.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Qr(d)})))}return{onPointerDown:i,onPointerMove:l,onPointerUp:d=>{d.isKilled||d.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Qr(d)})}}},[e,n])}function aX(n){const[e,t]=T.useState(()=>({store:om(n),opts:n}));if(!Pj(e.opts,n)){const r={store:om(n),opts:n};return t(r),r.store}return e.store}const lX=20,cX=8;function C_(n,e=lX){return Math.max(cX,Math.ceil(n/e))}class Qc extends Ka{constructor(t){super({...t,isFilled:!1,isClosed:!1});O(this,"_center");O(this,"radius");O(this,"start");O(this,"end");O(this,"largeArcFlag");O(this,"sweepFlag");O(this,"measure");O(this,"angleStart");O(this,"angleEnd");const{center:r,sweepFlag:i,largeArcFlag:s,start:a,end:l}=t;if(a.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=P.Angle(r,a),this.angleEnd=P.Angle(r,l),this.radius=P.Dist(r,a),this.measure=SU(this.angleStart,this.angleEnd,i,s),this.start=a,this.end=l,this.sweepFlag=i,this.largeArcFlag=s,this._center=r}nearestPoint(t){const{_center:r,measure:i,radius:s,angleEnd:a,angleStart:l,start:u,end:d}=this,f=aw(i,l,a,r.angle(t));if(f<=0)return u;if(f>=1)return d;const g=r.clone().add(t.clone().sub(r).uni().mul(s));let m,S=1/0,b;for(const x of[u,d,g])b=P.Dist2(t,x),b<S&&(m=x,S=b);if(!m)throw Error("nearest point not found");return m}hitTestLineSegment(t,r){const{_center:i,radius:s,measure:a,angleStart:l,angleEnd:u}=this,d=Xh(t,r,i,s);return d===null?!1:d.some(f=>{const g=aw(a,l,u,i.angle(f));return g>=0&&g<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:s,angleStart:a}=this,l=[];for(let u=0,d=C_(Math.abs(i));u<d+1;u++){const f=u/d*r,g=a+f;l.push(jl(t,s,g))}return l}getSvgPathData(t=!0){const{start:r,end:i,radius:s,largeArcFlag:a,sweepFlag:l}=this;return`${t?`M${r.toFixed()}`:""} A${s} ${s} 0 ${a} ${l} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class E_ extends Ka{constructor(t){super({isClosed:!0,...t});O(this,"_center");O(this,"radius");O(this,"x");O(this,"y");this.config=t;const{x:r=0,y:i=0,radius:s}=t;this.x=r,this.y=i,this._center=new P(s+r,s+i),this.radius=s}getBounds(){return new be(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=wt*r,s=[];for(let a=0,l=C_(i);a<l;a++){const u=a/l*wt;s.push(jl(t,r,u))}return s}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?P.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i=0){const{_center:s,radius:a}=this;return Xh(t,r,s,a+i)!==null}getSvgPathData(){const{_center:t,radius:r}=this;return`M${t.x+r},${t.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class Qn extends Eu{constructor(t){const{start:r,cp1:i,cp2:s,end:a}=t;super({...t,points:[r,a]});O(this,"a");O(this,"b");O(this,"c");O(this,"d");this.a=r,this.b=i,this.c=s,this.d=a}getVertices(){const t=[],{a:r,b:i,c:s,d:a}=this;for(let l=0,u=10;l<=u;l++){const d=l/u;t.push(new P((1-d)*(1-d)*(1-d)*r.x+3*((1-d)*(1-d))*d*i.x+3*(1-d)*(d*d)*s.x+d*d*d*a.x,(1-d)*(1-d)*(1-d)*r.y+3*((1-d)*(1-d))*d*i.y+3*(1-d)*(d*d)*s.y+d*d*d*a.y))}return t}midPoint(){return Qn.GetAtT(this,.5)}nearestPoint(t){let r,i=1/0,s,a;for(const l of this.segments)a=l.nearestPoint(t),s=P.Dist2(a,t),s<i&&(r=a,i=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(t=!0){const{a:r,b:i,c:s,d:a}=this;return`${t?`M ${r.toFixed()} `:""} C${i.toFixed()} ${s.toFixed()} ${a.toFixed()}`}static GetAtT(t,r){const{a:i,b:s,c:a,d:l}=t;return new P((1-r)*(1-r)*(1-r)*i.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*a.x+r*r*r*l.x,(1-r)*(1-r)*(1-r)*i.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*a.y+r*r*r*l.y)}getLength(t=32){let r,i=this.a,s=0;for(let a=1;a<=t;a++)r=Qn.GetAtT(this,a/t),s+=P.Dist(i,r),i=r;return s}}class uX extends Ka{constructor(t){super({...t,isClosed:!1,isFilled:!1});O(this,"points");O(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,s=1.25;for(let a=0;a<r-1;a++){const l=a===0?t[0]:t[a-1],u=t[a],d=t[a+1],f=a===i?d:t[a+2],g=u,m=a===0?l:new P(u.x+(d.x-l.x)/6*s,u.y+(d.y-l.y)/6*s),S=a===i?d:new P(d.x-(f.x-u.x)/6*s,d.y-(f.y-u.y)/6*s),b=d;this._segments.push(new Qn({start:g,cp1:m,cp2:S,end:b}))}}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0,s,a;for(const l of this.segments)a=l.nearestPoint(t),s=P.Dist2(a,t),s<i&&(r=a,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.segments.some(i=>i.hitTestLineSegment(t,r))}getSvgPathData(){let t=this.segments.reduce((r,i,s)=>r+i.getSvgPathData(s===0),"");return this.isClosed&&(t+="Z"),t}}class dX extends Ka{constructor(t){super({...t,isClosed:!0});O(this,"w");O(this,"h");O(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const s=t[r],a=t[(r+1)%i];this._edges.push(new To({start:s,end:a}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,s=r/2,a=Math.pow(i-s,2)/Math.pow(i+s,2),l=pt*(i+s)*(1+3*a/(10+Math.sqrt(4-3*a))),u=C_(l),d=wt/u,f=Math.cos(d),g=Math.sin(d);let m=0,S=1,b=0,x=1;const w=Array(u);for(let _=0;_<u;_++)w[_]=new P(i+i*S,s+s*m),b=g*S+f*m,x=f*S-g*m,m=b,S=x;return w}nearestPoint(t){let r,i=1/0,s,a;for(const l of this.edges)a=l.nearestPoint(t),s=P.Dist2(a,t),s<i&&(r=a,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.edges.some(i=>i.hitTestLineSegment(t,r))}getBounds(){return new be(0,0,this.w,this.h)}getLength(){const{w:t,h:r}=this,i=t/2,s=r/2,a=Math.max(0,i),l=Math.max(0,s);return PO(a,l)}getSvgPathData(t=!1){const{w:r,h:i}=this,s=r/2,a=i/2,l=Math.max(0,s),u=Math.max(0,a);return`${t?`M${s-l},${a}`:""} a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`}}class hX extends Ka{constructor(t){super({...t,isClosed:!0});O(this,"w");O(this,"h");O(this,"a");O(this,"b");O(this,"c");O(this,"d");this.config=t;const{width:r,height:i}=t;if(this.w=r,this.h=i,i>r){const s=r/2;this.a=new Qc({start:new P(0,s),end:new P(r,s),center:new P(r/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new To({start:new P(r,s),end:new P(r,i-s)}),this.c=new Qc({start:new P(r,i-s),end:new P(0,i-s),center:new P(r/2,i-s),sweepFlag:1,largeArcFlag:1}),this.d=new To({start:new P(0,i-s),end:new P(0,s)})}else{const s=i/2;this.a=new Qc({start:new P(s,i),end:new P(s,0),center:new P(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new To({start:new P(s,0),end:new P(r-s,0)}),this.c=new Qc({start:new P(r-s,0),end:new P(r-s,i),center:new P(r-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new To({start:new P(r-s,i),end:new P(s,i)})}}nearestPoint(t){let r,i=1/0,s,a;const{a:l,b:u,c:d,d:f}=this;for(const g of[l,u,d,f])a=g.nearestPoint(t),s=P.Dist2(a,t),s<i&&(r=a,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){const{a:i,b:s,c:a,d:l}=this;return[i,s,a,l].some(u=>u.hitTestLineSegment(t,r))}getVertices(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].reduce((a,l)=>(a.push(...l.vertices),a),[])}getBounds(){return new be(0,0,this.w,this.h)}getLength(){const{h:t,w:r}=this;return t>r?(pt*(r/2)+(t-r))*2:(pt*(t/2)+(r-t))*2}getSvgPathData(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].map((a,l)=>a.getSvgPathData(l===0)).join(" ")+" Z"}}async function fX({shouldReload:n=!0}={}){UF();for(const e of Kg.connectedInstances)await e.close();await Promise.all($1().map(e=>OO(e))),BF(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=fX);function pX(n,e="_blank"){zm.openWindow(n,e)}Fa("@tldraw/editor","3.8.1","esm");function gL(){const[n,e]=T.useState(!1);return T.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}const mL=()=>{},yL=T.createContext(null);function gX({onEvent:n,children:e}){return p.jsx(yL.Provider,{value:n??mL,children:e})}function $n(){return T.useContext(yL)??mL}function Me(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function mX(n,e){const t=T.createContext(e),r=s=>{const{children:a,...l}=s,u=T.useMemo(()=>l,Object.values(l));return p.jsx(t.Provider,{value:u,children:a})};r.displayName=n+"Provider";function i(s){const a=T.useContext(t);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return[r,i]}function qs(n,e=[]){let t=[];function r(s,a){const l=T.createContext(a),u=t.length;t=[...t,a];const d=g=>{var _;const{scope:m,children:S,...b}=g,x=((_=m==null?void 0:m[n])==null?void 0:_[u])||l,w=T.useMemo(()=>b,Object.values(b));return p.jsx(x.Provider,{value:w,children:S})};d.displayName=s+"Provider";function f(g,m){var x;const S=((x=m==null?void 0:m[n])==null?void 0:x[u])||l,b=T.useContext(S);if(b)return b;if(a!==void 0)return a;throw new Error(`\`${g}\` must be used within \`${s}\``)}return[d,f]}const i=()=>{const s=t.map(a=>T.createContext(a));return function(l){const u=(l==null?void 0:l[n])||s;return T.useMemo(()=>({[`__scope${n}`]:{...l,[n]:u}}),[l,u])}};return i.scopeName=n,[r,yX(i,...e)]}function yX(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const a=r.reduce((l,{useScope:u,scopeName:d})=>{const g=u(s)[`__scope${d}`];return{...l,...g}},{});return T.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function WA(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Qm(...n){return e=>{let t=!1;const r=n.map(i=>{const s=WA(i,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():WA(n[i],null)}}}}function zt(...n){return T.useCallback(Qm(...n),n)}var Nl=T.forwardRef((n,e)=>{const{children:t,...r}=n,i=T.Children.toArray(t),s=i.find(vX);if(s){const a=s.props.children,l=i.map(u=>u===s?T.Children.count(a)>1?T.Children.only(null):T.isValidElement(a)?a.props.children:null:u);return p.jsx(Iw,{...r,ref:e,children:T.isValidElement(a)?T.cloneElement(a,void 0,l):null})}return p.jsx(Iw,{...r,ref:e,children:t})});Nl.displayName="Slot";var Iw=T.forwardRef((n,e)=>{const{children:t,...r}=n;if(T.isValidElement(t)){const i=xX(t),s=bX(r,t.props);return t.type!==T.Fragment&&(s.ref=e?Qm(e,i):i),T.cloneElement(t,s)}return T.Children.count(t)>1?T.Children.only(null):null});Iw.displayName="SlotClone";var SX=({children:n})=>p.jsx(p.Fragment,{children:n});function vX(n){return T.isValidElement(n)&&n.type===SX}function bX(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...l)=>{s(...l),i(...l)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function xX(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var wX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ht=wX.reduce((n,e)=>{const t=T.forwardRef((r,i)=>{const{asChild:s,...a}=r,l=s?Nl:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),p.jsx(l,{...a,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function P_(n,e){n&&Pu.flushSync(()=>n.dispatchEvent(e))}function Jm(n){const e=n+"CollectionProvider",[t,r]=qs(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),a=S=>{const{scope:b,children:x}=S,w=ct.useRef(null),_=ct.useRef(new Map).current;return p.jsx(i,{scope:b,itemMap:_,collectionRef:w,children:x})};a.displayName=e;const l=n+"CollectionSlot",u=ct.forwardRef((S,b)=>{const{scope:x,children:w}=S,_=s(l,x),E=zt(b,_.collectionRef);return p.jsx(Nl,{ref:E,children:w})});u.displayName=l;const d=n+"CollectionItemSlot",f="data-radix-collection-item",g=ct.forwardRef((S,b)=>{const{scope:x,children:w,..._}=S,E=ct.useRef(null),M=zt(b,E),I=s(d,x);return ct.useEffect(()=>(I.itemMap.set(E,{ref:E,..._}),()=>void I.itemMap.delete(E))),p.jsx(Nl,{[f]:"",ref:M,children:w})});g.displayName=d;function m(S){const b=s(n+"CollectionConsumer",S);return ct.useCallback(()=>{const w=b.collectionRef.current;if(!w)return[];const _=Array.from(w.querySelectorAll(`[${f}]`));return Array.from(b.itemMap.values()).sort((I,A)=>_.indexOf(I.ref.current)-_.indexOf(A.ref.current))},[b.collectionRef,b.itemMap])}return[{Provider:a,Slot:u,ItemSlot:g},m,r]}var _X=T.createContext(void 0);function T_(n){const e=T.useContext(_X);return n||e||"ltr"}function Fn(n){const e=T.useRef(n);return T.useEffect(()=>{e.current=n}),T.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function CX(n,e=globalThis==null?void 0:globalThis.document){const t=Fn(n);T.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var EX="DismissableLayer",Mw="dismissableLayer.update",PX="dismissableLayer.pointerDownOutside",TX="dismissableLayer.focusOutside",ZA,SL=T.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),nf=T.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...u}=n,d=T.useContext(SL),[f,g]=T.useState(null),m=(f==null?void 0:f.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,S]=T.useState({}),b=zt(e,D=>g(D)),x=Array.from(d.layers),[w]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),_=x.indexOf(w),E=f?x.indexOf(f):-1,M=d.layersWithOutsidePointerEventsDisabled.size>0,I=E>=_,A=MX(D=>{const R=D.target,q=[...d.branches].some(L=>L.contains(R));!I||q||(i==null||i(D),a==null||a(D),D.defaultPrevented||l==null||l())},m),j=AX(D=>{const R=D.target;[...d.branches].some(L=>L.contains(R))||(s==null||s(D),a==null||a(D),D.defaultPrevented||l==null||l())},m);return CX(D=>{E===d.layers.size-1&&(r==null||r(D),!D.defaultPrevented&&l&&(D.preventDefault(),l()))},m),T.useEffect(()=>{if(f)return t&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(ZA=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(f)),d.layers.add(f),QA(),()=>{t&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=ZA)}},[f,m,t,d]),T.useEffect(()=>()=>{f&&(d.layers.delete(f),d.layersWithOutsidePointerEventsDisabled.delete(f),QA())},[f,d]),T.useEffect(()=>{const D=()=>S({});return document.addEventListener(Mw,D),()=>document.removeEventListener(Mw,D)},[]),p.jsx(ht.div,{...u,ref:b,style:{pointerEvents:M?I?"auto":"none":void 0,...n.style},onFocusCapture:Me(n.onFocusCapture,j.onFocusCapture),onBlurCapture:Me(n.onBlurCapture,j.onBlurCapture),onPointerDownCapture:Me(n.onPointerDownCapture,A.onPointerDownCapture)})});nf.displayName=EX;var IX="DismissableLayerBranch",vL=T.forwardRef((n,e)=>{const t=T.useContext(SL),r=T.useRef(null),i=zt(e,r);return T.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),p.jsx(ht.div,{...n,ref:i})});vL.displayName=IX;function MX(n,e=globalThis==null?void 0:globalThis.document){const t=Fn(n),r=T.useRef(!1),i=T.useRef(()=>{});return T.useEffect(()=>{const s=l=>{if(l.target&&!r.current){let u=function(){bL(PX,t,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=u,e.addEventListener("click",i.current,{once:!0})):u()}else e.removeEventListener("click",i.current);r.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function AX(n,e=globalThis==null?void 0:globalThis.document){const t=Fn(n),r=T.useRef(!1);return T.useEffect(()=>{const i=s=>{s.target&&!r.current&&bL(TX,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function QA(){const n=new CustomEvent(Mw);document.dispatchEvent(n)}function bL(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?P_(i,s):i.dispatchEvent(s)}var kX=nf,jX=vL,lx=0;function I_(){T.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??JA()),document.body.insertAdjacentElement("beforeend",n[1]??JA()),lx++,()=>{lx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),lx--}},[])}function JA(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var cx="focusScope.autoFocusOnMount",ux="focusScope.autoFocusOnUnmount",ek={bubbles:!1,cancelable:!0},OX="FocusScope",ey=T.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...a}=n,[l,u]=T.useState(null),d=Fn(i),f=Fn(s),g=T.useRef(null),m=zt(e,x=>u(x)),S=T.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;T.useEffect(()=>{if(r){let x=function(M){if(S.paused||!l)return;const I=M.target;l.contains(I)?g.current=I:xa(g.current,{select:!0})},w=function(M){if(S.paused||!l)return;const I=M.relatedTarget;I!==null&&(l.contains(I)||xa(g.current,{select:!0}))},_=function(M){if(document.activeElement===document.body)for(const A of M)A.removedNodes.length>0&&xa(l)};document.addEventListener("focusin",x),document.addEventListener("focusout",w);const E=new MutationObserver(_);return l&&E.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",w),E.disconnect()}}},[r,l,S.paused]),T.useEffect(()=>{if(l){nk.add(S);const x=document.activeElement;if(!l.contains(x)){const _=new CustomEvent(cx,ek);l.addEventListener(cx,d),l.dispatchEvent(_),_.defaultPrevented||(DX(FX(xL(l)),{select:!0}),document.activeElement===x&&xa(l))}return()=>{l.removeEventListener(cx,d),setTimeout(()=>{const _=new CustomEvent(ux,ek);l.addEventListener(ux,f),l.dispatchEvent(_),_.defaultPrevented||xa(x??document.body,{select:!0}),l.removeEventListener(ux,f),nk.remove(S)},0)}}},[l,d,f,S]);const b=T.useCallback(x=>{if(!t&&!r||S.paused)return;const w=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,_=document.activeElement;if(w&&_){const E=x.currentTarget,[M,I]=RX(E);M&&I?!x.shiftKey&&_===I?(x.preventDefault(),t&&xa(M,{select:!0})):x.shiftKey&&_===M&&(x.preventDefault(),t&&xa(I,{select:!0})):_===E&&x.preventDefault()}},[t,r,S.paused]);return p.jsx(ht.div,{tabIndex:-1,...a,ref:m,onKeyDown:b})});ey.displayName=OX;function DX(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(xa(r,{select:e}),document.activeElement!==t)return}function RX(n){const e=xL(n),t=tk(e,n),r=tk(e.reverse(),n);return[t,r]}function xL(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function tk(n,e){for(const t of n)if(!LX(t,{upTo:e}))return t}function LX(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function NX(n){return n instanceof HTMLInputElement&&"select"in n}function xa(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&NX(n)&&e&&n.select()}}var nk=zX();function zX(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=rk(n,e),n.unshift(e)},remove(e){var t;n=rk(n,e),(t=n[0])==null||t.resume()}}}function rk(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function FX(n){return n.filter(e=>e.tagName!=="A")}var Da=globalThis!=null&&globalThis.document?T.useLayoutEffect:()=>{},BX=Y9.useId||(()=>{}),UX=0;function Oo(n){const[e,t]=T.useState(BX());return Da(()=>{t(r=>r??String(UX++))},[n]),n||(e?`radix-${e}`:"")}const $X=["top","right","bottom","left"],Ra=Math.min,Wr=Math.max,am=Math.round,Np=Math.floor,Ds=n=>({x:n,y:n}),HX={left:"right",right:"left",bottom:"top",top:"bottom"},KX={start:"end",end:"start"};function Aw(n,e,t){return Wr(n,Ra(e,t))}function Ro(n,e){return typeof n=="function"?n(e):n}function Lo(n){return n.split("-")[0]}function Au(n){return n.split("-")[1]}function M_(n){return n==="x"?"y":"x"}function A_(n){return n==="y"?"height":"width"}function La(n){return["top","bottom"].includes(Lo(n))?"y":"x"}function k_(n){return M_(La(n))}function qX(n,e,t){t===void 0&&(t=!1);const r=Au(n),i=k_(n),s=A_(i);let a=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=lm(a)),[a,lm(a)]}function GX(n){const e=lm(n);return[kw(n),e,kw(e)]}function kw(n){return n.replace(/start|end/g,e=>KX[e])}function YX(n,e,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],a=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?s:a;default:return[]}}function VX(n,e,t,r){const i=Au(n);let s=YX(Lo(n),t==="start",r);return i&&(s=s.map(a=>a+"-"+i),e&&(s=s.concat(s.map(kw)))),s}function lm(n){return n.replace(/left|right|bottom|top/g,e=>HX[e])}function XX(n){return{top:0,right:0,bottom:0,left:0,...n}}function wL(n){return typeof n!="number"?XX(n):{top:n,right:n,bottom:n,left:n}}function cm(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function ik(n,e,t){let{reference:r,floating:i}=n;const s=La(e),a=k_(e),l=A_(a),u=Lo(e),d=s==="y",f=r.x+r.width/2-i.width/2,g=r.y+r.height/2-i.height/2,m=r[l]/2-i[l]/2;let S;switch(u){case"top":S={x:f,y:r.y-i.height};break;case"bottom":S={x:f,y:r.y+r.height};break;case"right":S={x:r.x+r.width,y:g};break;case"left":S={x:r.x-i.width,y:g};break;default:S={x:r.x,y:r.y}}switch(Au(e)){case"start":S[a]-=m*(t&&d?-1:1);break;case"end":S[a]+=m*(t&&d?-1:1);break}return S}const WX=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:a}=t,l=s.filter(Boolean),u=await(a.isRTL==null?void 0:a.isRTL(e));let d=await a.getElementRects({reference:n,floating:e,strategy:i}),{x:f,y:g}=ik(d,r,u),m=r,S={},b=0;for(let x=0;x<l.length;x++){const{name:w,fn:_}=l[x],{x:E,y:M,data:I,reset:A}=await _({x:f,y:g,initialPlacement:r,placement:m,strategy:i,middlewareData:S,rects:d,platform:a,elements:{reference:n,floating:e}});f=E??f,g=M??g,S={...S,[w]:{...S[w],...I}},A&&b<=50&&(b++,typeof A=="object"&&(A.placement&&(m=A.placement),A.rects&&(d=A.rects===!0?await a.getElementRects({reference:n,floating:e,strategy:i}):A.rects),{x:f,y:g}=ik(d,m,u)),x=-1)}return{x:f,y:g,placement:m,strategy:i,middlewareData:S}};async function Th(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:a,elements:l,strategy:u}=n,{boundary:d="clippingAncestors",rootBoundary:f="viewport",elementContext:g="floating",altBoundary:m=!1,padding:S=0}=Ro(e,n),b=wL(S),w=l[m?g==="floating"?"reference":"floating":g],_=cm(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(w)))==null||t?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(l.floating)),boundary:d,rootBoundary:f,strategy:u})),E=g==="floating"?{x:r,y:i,width:a.floating.width,height:a.floating.height}:a.reference,M=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l.floating)),I=await(s.isElement==null?void 0:s.isElement(M))?await(s.getScale==null?void 0:s.getScale(M))||{x:1,y:1}:{x:1,y:1},A=cm(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:E,offsetParent:M,strategy:u}):E);return{top:(_.top-A.top+b.top)/I.y,bottom:(A.bottom-_.bottom+b.bottom)/I.y,left:(_.left-A.left+b.left)/I.x,right:(A.right-_.right+b.right)/I.x}}const ZX=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:a,elements:l,middlewareData:u}=e,{element:d,padding:f=0}=Ro(n,e)||{};if(d==null)return{};const g=wL(f),m={x:t,y:r},S=k_(i),b=A_(S),x=await a.getDimensions(d),w=S==="y",_=w?"top":"left",E=w?"bottom":"right",M=w?"clientHeight":"clientWidth",I=s.reference[b]+s.reference[S]-m[S]-s.floating[b],A=m[S]-s.reference[S],j=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d));let D=j?j[M]:0;(!D||!await(a.isElement==null?void 0:a.isElement(j)))&&(D=l.floating[M]||s.floating[b]);const R=I/2-A/2,q=D/2-x[b]/2-1,L=Ra(g[_],q),K=Ra(g[E],q),G=L,z=D-x[b]-K,U=D/2-x[b]/2+R,Y=Aw(G,U,z),H=!u.arrow&&Au(i)!=null&&U!==Y&&s.reference[b]/2-(U<G?L:K)-x[b]/2<0,X=H?U<G?U-G:U-z:0;return{[S]:m[S]+X,data:{[S]:Y,centerOffset:U-Y-X,...H&&{alignmentOffset:X}},reset:H}}}),QX=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:a,initialPlacement:l,platform:u,elements:d}=e,{mainAxis:f=!0,crossAxis:g=!0,fallbackPlacements:m,fallbackStrategy:S="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:x=!0,...w}=Ro(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const _=Lo(i),E=La(l),M=Lo(l)===l,I=await(u.isRTL==null?void 0:u.isRTL(d.floating)),A=m||(M||!x?[lm(l)]:GX(l)),j=b!=="none";!m&&j&&A.push(...VX(l,x,b,I));const D=[l,...A],R=await Th(e,w),q=[];let L=((r=s.flip)==null?void 0:r.overflows)||[];if(f&&q.push(R[_]),g){const U=qX(i,a,I);q.push(R[U[0]],R[U[1]])}if(L=[...L,{placement:i,overflows:q}],!q.every(U=>U<=0)){var K,G;const U=(((K=s.flip)==null?void 0:K.index)||0)+1,Y=D[U];if(Y)return{data:{index:U,overflows:L},reset:{placement:Y}};let H=(G=L.filter(X=>X.overflows[0]<=0).sort((X,V)=>X.overflows[1]-V.overflows[1])[0])==null?void 0:G.placement;if(!H)switch(S){case"bestFit":{var z;const X=(z=L.filter(V=>{if(j){const ie=La(V.placement);return ie===E||ie==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(ie=>ie>0).reduce((ie,B)=>ie+B,0)]).sort((V,ie)=>V[1]-ie[1])[0])==null?void 0:z[0];X&&(H=X);break}case"initialPlacement":H=l;break}if(i!==H)return{reset:{placement:H}}}return{}}}};function sk(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function ok(n){return $X.some(e=>n[e]>=0)}const JX=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=Ro(n,e);switch(r){case"referenceHidden":{const s=await Th(e,{...i,elementContext:"reference"}),a=sk(s,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:ok(a)}}}case"escaped":{const s=await Th(e,{...i,altBoundary:!0}),a=sk(s,t.floating);return{data:{escapedOffsets:a,escaped:ok(a)}}}default:return{}}}}};async function eW(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),a=Lo(t),l=Au(t),u=La(t)==="y",d=["left","top"].includes(a)?-1:1,f=s&&u?-1:1,g=Ro(e,n);let{mainAxis:m,crossAxis:S,alignmentAxis:b}=typeof g=="number"?{mainAxis:g,crossAxis:0,alignmentAxis:null}:{mainAxis:g.mainAxis||0,crossAxis:g.crossAxis||0,alignmentAxis:g.alignmentAxis};return l&&typeof b=="number"&&(S=l==="end"?b*-1:b),u?{x:S*f,y:m*d}:{x:m*d,y:S*f}}const tW=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:a,middlewareData:l}=e,u=await eW(e,n);return a===((t=l.offset)==null?void 0:t.placement)&&(r=l.arrow)!=null&&r.alignmentOffset?{}:{x:i+u.x,y:s+u.y,data:{...u,placement:a}}}}},nW=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:a=!1,limiter:l={fn:w=>{let{x:_,y:E}=w;return{x:_,y:E}}},...u}=Ro(n,e),d={x:t,y:r},f=await Th(e,u),g=La(Lo(i)),m=M_(g);let S=d[m],b=d[g];if(s){const w=m==="y"?"top":"left",_=m==="y"?"bottom":"right",E=S+f[w],M=S-f[_];S=Aw(E,S,M)}if(a){const w=g==="y"?"top":"left",_=g==="y"?"bottom":"right",E=b+f[w],M=b-f[_];b=Aw(E,b,M)}const x=l.fn({...e,[m]:S,[g]:b});return{...x,data:{x:x.x-t,y:x.y-r,enabled:{[m]:s,[g]:a}}}}}},rW=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:a}=e,{offset:l=0,mainAxis:u=!0,crossAxis:d=!0}=Ro(n,e),f={x:t,y:r},g=La(i),m=M_(g);let S=f[m],b=f[g];const x=Ro(l,e),w=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(u){const M=m==="y"?"height":"width",I=s.reference[m]-s.floating[M]+w.mainAxis,A=s.reference[m]+s.reference[M]-w.mainAxis;S<I?S=I:S>A&&(S=A)}if(d){var _,E;const M=m==="y"?"width":"height",I=["top","left"].includes(Lo(i)),A=s.reference[g]-s.floating[M]+(I&&((_=a.offset)==null?void 0:_[g])||0)+(I?0:w.crossAxis),j=s.reference[g]+s.reference[M]+(I?0:((E=a.offset)==null?void 0:E[g])||0)-(I?w.crossAxis:0);b<A?b=A:b>j&&(b=j)}return{[m]:S,[g]:b}}}},iW=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:a,elements:l}=e,{apply:u=()=>{},...d}=Ro(n,e),f=await Th(e,d),g=Lo(i),m=Au(i),S=La(i)==="y",{width:b,height:x}=s.floating;let w,_;g==="top"||g==="bottom"?(w=g,_=m===(await(a.isRTL==null?void 0:a.isRTL(l.floating))?"start":"end")?"left":"right"):(_=g,w=m==="end"?"top":"bottom");const E=x-f.top-f.bottom,M=b-f.left-f.right,I=Ra(x-f[w],E),A=Ra(b-f[_],M),j=!e.middlewareData.shift;let D=I,R=A;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(R=M),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(D=E),j&&!m){const L=Wr(f.left,0),K=Wr(f.right,0),G=Wr(f.top,0),z=Wr(f.bottom,0);S?R=b-2*(L!==0||K!==0?L+K:Wr(f.left,f.right)):D=x-2*(G!==0||z!==0?G+z:Wr(f.top,f.bottom))}await u({...e,availableWidth:R,availableHeight:D});const q=await a.getDimensions(l.floating);return b!==q.width||x!==q.height?{reset:{rects:!0}}:{}}}};function ty(){return typeof window<"u"}function ku(n){return _L(n)?(n.nodeName||"").toLowerCase():"#document"}function ni(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Gs(n){var e;return(e=(_L(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function _L(n){return ty()?n instanceof Node||n instanceof ni(n).Node:!1}function os(n){return ty()?n instanceof Element||n instanceof ni(n).Element:!1}function Fs(n){return ty()?n instanceof HTMLElement||n instanceof ni(n).HTMLElement:!1}function ak(n){return!ty()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof ni(n).ShadowRoot}function rf(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=as(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function sW(n){return["table","td","th"].includes(ku(n))}function ny(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function j_(n){const e=O_(),t=os(n)?as(n):n;return["transform","translate","scale","rotate","perspective"].some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function oW(n){let e=Na(n);for(;Fs(e)&&!uu(e);){if(j_(e))return e;if(ny(e))return null;e=Na(e)}return null}function O_(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function uu(n){return["html","body","#document"].includes(ku(n))}function as(n){return ni(n).getComputedStyle(n)}function ry(n){return os(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Na(n){if(ku(n)==="html")return n;const e=n.assignedSlot||n.parentNode||ak(n)&&n.host||Gs(n);return ak(e)?e.host:e}function CL(n){const e=Na(n);return uu(e)?n.ownerDocument?n.ownerDocument.body:n.body:Fs(e)&&rf(e)?e:CL(e)}function Ih(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=CL(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),a=ni(i);if(s){const l=jw(a);return e.concat(a,a.visualViewport||[],rf(i)?i:[],l&&t?Ih(l):[])}return e.concat(i,Ih(i,[],t))}function jw(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function EL(n){const e=as(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Fs(n),s=i?n.offsetWidth:t,a=i?n.offsetHeight:r,l=am(t)!==s||am(r)!==a;return l&&(t=s,r=a),{width:t,height:r,$:l}}function D_(n){return os(n)?n:n.contextElement}function su(n){const e=D_(n);if(!Fs(e))return Ds(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=EL(e);let a=(s?am(t.width):t.width)/r,l=(s?am(t.height):t.height)/i;return(!a||!Number.isFinite(a))&&(a=1),(!l||!Number.isFinite(l))&&(l=1),{x:a,y:l}}const aW=Ds(0);function PL(n){const e=ni(n);return!O_()||!e.visualViewport?aW:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function lW(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==ni(n)?!1:e}function zl(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=D_(n);let a=Ds(1);e&&(r?os(r)&&(a=su(r)):a=su(n));const l=lW(s,t,r)?PL(s):Ds(0);let u=(i.left+l.x)/a.x,d=(i.top+l.y)/a.y,f=i.width/a.x,g=i.height/a.y;if(s){const m=ni(s),S=r&&os(r)?ni(r):r;let b=m,x=jw(b);for(;x&&r&&S!==b;){const w=su(x),_=x.getBoundingClientRect(),E=as(x),M=_.left+(x.clientLeft+parseFloat(E.paddingLeft))*w.x,I=_.top+(x.clientTop+parseFloat(E.paddingTop))*w.y;u*=w.x,d*=w.y,f*=w.x,g*=w.y,u+=M,d+=I,b=ni(x),x=jw(b)}}return cm({width:f,height:g,x:u,y:d})}function R_(n,e){const t=ry(n).scrollLeft;return e?e.left+t:zl(Gs(n)).left+t}function TL(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),i=r.left+e.scrollLeft-(t?0:R_(n,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function cW(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",a=Gs(r),l=e?ny(e.floating):!1;if(r===a||l&&s)return t;let u={scrollLeft:0,scrollTop:0},d=Ds(1);const f=Ds(0),g=Fs(r);if((g||!g&&!s)&&((ku(r)!=="body"||rf(a))&&(u=ry(r)),Fs(r))){const S=zl(r);d=su(r),f.x=S.x+r.clientLeft,f.y=S.y+r.clientTop}const m=a&&!g&&!s?TL(a,u,!0):Ds(0);return{width:t.width*d.x,height:t.height*d.y,x:t.x*d.x-u.scrollLeft*d.x+f.x+m.x,y:t.y*d.y-u.scrollTop*d.y+f.y+m.y}}function uW(n){return Array.from(n.getClientRects())}function dW(n){const e=Gs(n),t=ry(n),r=n.ownerDocument.body,i=Wr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Wr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-t.scrollLeft+R_(n);const l=-t.scrollTop;return as(r).direction==="rtl"&&(a+=Wr(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:a,y:l}}function hW(n,e){const t=ni(n),r=Gs(n),i=t.visualViewport;let s=r.clientWidth,a=r.clientHeight,l=0,u=0;if(i){s=i.width,a=i.height;const d=O_();(!d||d&&e==="fixed")&&(l=i.offsetLeft,u=i.offsetTop)}return{width:s,height:a,x:l,y:u}}function fW(n,e){const t=zl(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=Fs(n)?su(n):Ds(1),a=n.clientWidth*s.x,l=n.clientHeight*s.y,u=i*s.x,d=r*s.y;return{width:a,height:l,x:u,y:d}}function lk(n,e,t){let r;if(e==="viewport")r=hW(n,t);else if(e==="document")r=dW(Gs(n));else if(os(e))r=fW(e,t);else{const i=PL(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return cm(r)}function IL(n,e){const t=Na(n);return t===e||!os(t)||uu(t)?!1:as(t).position==="fixed"||IL(t,e)}function pW(n,e){const t=e.get(n);if(t)return t;let r=Ih(n,[],!1).filter(l=>os(l)&&ku(l)!=="body"),i=null;const s=as(n).position==="fixed";let a=s?Na(n):n;for(;os(a)&&!uu(a);){const l=as(a),u=j_(a);!u&&l.position==="fixed"&&(i=null),(s?!u&&!i:!u&&l.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||rf(a)&&!u&&IL(n,a))?r=r.filter(f=>f!==a):i=l,a=Na(a)}return e.set(n,r),r}function gW(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const a=[...t==="clippingAncestors"?ny(e)?[]:pW(e,this._c):[].concat(t),r],l=a[0],u=a.reduce((d,f)=>{const g=lk(e,f,i);return d.top=Wr(g.top,d.top),d.right=Ra(g.right,d.right),d.bottom=Ra(g.bottom,d.bottom),d.left=Wr(g.left,d.left),d},lk(e,l,i));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function mW(n){const{width:e,height:t}=EL(n);return{width:e,height:t}}function yW(n,e,t){const r=Fs(e),i=Gs(e),s=t==="fixed",a=zl(n,!0,s,e);let l={scrollLeft:0,scrollTop:0};const u=Ds(0);if(r||!r&&!s)if((ku(e)!=="body"||rf(i))&&(l=ry(e)),r){const m=zl(e,!0,s,e);u.x=m.x+e.clientLeft,u.y=m.y+e.clientTop}else i&&(u.x=R_(i));const d=i&&!r&&!s?TL(i,l):Ds(0),f=a.left+l.scrollLeft-u.x-d.x,g=a.top+l.scrollTop-u.y-d.y;return{x:f,y:g,width:a.width,height:a.height}}function dx(n){return as(n).position==="static"}function ck(n,e){if(!Fs(n)||as(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Gs(n)===t&&(t=t.ownerDocument.body),t}function ML(n,e){const t=ni(n);if(ny(n))return t;if(!Fs(n)){let i=Na(n);for(;i&&!uu(i);){if(os(i)&&!dx(i))return i;i=Na(i)}return t}let r=ck(n,e);for(;r&&sW(r)&&dx(r);)r=ck(r,e);return r&&uu(r)&&dx(r)&&!j_(r)?t:r||oW(n)||t}const SW=async function(n){const e=this.getOffsetParent||ML,t=this.getDimensions,r=await t(n.floating);return{reference:yW(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function vW(n){return as(n).direction==="rtl"}const bW={convertOffsetParentRelativeRectToViewportRelativeRect:cW,getDocumentElement:Gs,getClippingRect:gW,getOffsetParent:ML,getElementRects:SW,getClientRects:uW,getDimensions:mW,getScale:su,isElement:os,isRTL:vW};function AL(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function xW(n,e){let t=null,r;const i=Gs(n);function s(){var l;clearTimeout(r),(l=t)==null||l.disconnect(),t=null}function a(l,u){l===void 0&&(l=!1),u===void 0&&(u=1),s();const d=n.getBoundingClientRect(),{left:f,top:g,width:m,height:S}=d;if(l||e(),!m||!S)return;const b=Np(g),x=Np(i.clientWidth-(f+m)),w=Np(i.clientHeight-(g+S)),_=Np(f),M={rootMargin:-b+"px "+-x+"px "+-w+"px "+-_+"px",threshold:Wr(0,Ra(1,u))||1};let I=!0;function A(j){const D=j[0].intersectionRatio;if(D!==u){if(!I)return a();D?a(!1,D):r=setTimeout(()=>{a(!1,1e-7)},1e3)}D===1&&!AL(d,n.getBoundingClientRect())&&a(),I=!1}try{t=new IntersectionObserver(A,{...M,root:i.ownerDocument})}catch{t=new IntersectionObserver(A,M)}t.observe(n)}return a(!0),s}function wW(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,d=D_(n),f=i||s?[...d?Ih(d):[],...Ih(e)]:[];f.forEach(_=>{i&&_.addEventListener("scroll",t,{passive:!0}),s&&_.addEventListener("resize",t)});const g=d&&l?xW(d,t):null;let m=-1,S=null;a&&(S=new ResizeObserver(_=>{let[E]=_;E&&E.target===d&&S&&(S.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var M;(M=S)==null||M.observe(e)})),t()}),d&&!u&&S.observe(d),S.observe(e));let b,x=u?zl(n):null;u&&w();function w(){const _=zl(n);x&&!AL(x,_)&&t(),x=_,b=requestAnimationFrame(w)}return t(),()=>{var _;f.forEach(E=>{i&&E.removeEventListener("scroll",t),s&&E.removeEventListener("resize",t)}),g==null||g(),(_=S)==null||_.disconnect(),S=null,u&&cancelAnimationFrame(b)}}const _W=tW,CW=nW,EW=QX,PW=iW,TW=JX,uk=ZX,IW=rW,MW=(n,e,t)=>{const r=new Map,i={platform:bW,...t},s={...i.platform,_c:r};return WX(n,e,{...i,platform:s})};var hg=typeof document<"u"?T.useLayoutEffect:T.useEffect;function um(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!um(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!um(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function kL(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function dk(n,e){const t=kL(n);return Math.round(e*t)/t}function hx(n){const e=T.useRef(n);return hg(()=>{e.current=n}),e}function AW(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:a}={},transform:l=!0,whileElementsMounted:u,open:d}=n,[f,g]=T.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[m,S]=T.useState(r);um(m,r)||S(r);const[b,x]=T.useState(null),[w,_]=T.useState(null),E=T.useCallback(V=>{V!==j.current&&(j.current=V,x(V))},[]),M=T.useCallback(V=>{V!==D.current&&(D.current=V,_(V))},[]),I=s||b,A=a||w,j=T.useRef(null),D=T.useRef(null),R=T.useRef(f),q=u!=null,L=hx(u),K=hx(i),G=hx(d),z=T.useCallback(()=>{if(!j.current||!D.current)return;const V={placement:e,strategy:t,middleware:m};K.current&&(V.platform=K.current),MW(j.current,D.current,V).then(ie=>{const B={...ie,isPositioned:G.current!==!1};U.current&&!um(R.current,B)&&(R.current=B,Pu.flushSync(()=>{g(B)}))})},[m,e,t,K,G]);hg(()=>{d===!1&&R.current.isPositioned&&(R.current.isPositioned=!1,g(V=>({...V,isPositioned:!1})))},[d]);const U=T.useRef(!1);hg(()=>(U.current=!0,()=>{U.current=!1}),[]),hg(()=>{if(I&&(j.current=I),A&&(D.current=A),I&&A){if(L.current)return L.current(I,A,z);z()}},[I,A,z,L,q]);const Y=T.useMemo(()=>({reference:j,floating:D,setReference:E,setFloating:M}),[E,M]),H=T.useMemo(()=>({reference:I,floating:A}),[I,A]),X=T.useMemo(()=>{const V={position:t,left:0,top:0};if(!H.floating)return V;const ie=dk(H.floating,f.x),B=dk(H.floating,f.y);return l?{...V,transform:"translate("+ie+"px, "+B+"px)",...kL(H.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:ie,top:B}},[t,l,H.floating,f.x,f.y]);return T.useMemo(()=>({...f,update:z,refs:Y,elements:H,floatingStyles:X}),[f,z,Y,H,X])}const kW=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?uk({element:r.current,padding:i}).fn(t):{}:r?uk({element:r,padding:i}).fn(t):{}}}},jW=(n,e)=>({..._W(n),options:[n,e]}),OW=(n,e)=>({...CW(n),options:[n,e]}),DW=(n,e)=>({...IW(n),options:[n,e]}),RW=(n,e)=>({...EW(n),options:[n,e]}),LW=(n,e)=>({...PW(n),options:[n,e]}),NW=(n,e)=>({...TW(n),options:[n,e]}),zW=(n,e)=>({...kW(n),options:[n,e]});var FW="Arrow",jL=T.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return p.jsx(ht.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:p.jsx("polygon",{points:"0,0 30,0 15,10"})})});jL.displayName=FW;var BW=jL;function OL(n){const[e,t]=T.useState(void 0);return Da(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let a,l;if("borderBoxSize"in s){const u=s.borderBoxSize,d=Array.isArray(u)?u[0]:u;a=d.inlineSize,l=d.blockSize}else a=n.offsetWidth,l=n.offsetHeight;t({width:a,height:l})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var L_="Popper",[DL,iy]=qs(L_),[UW,RL]=DL(L_),LL=n=>{const{__scopePopper:e,children:t}=n,[r,i]=T.useState(null);return p.jsx(UW,{scope:e,anchor:r,onAnchorChange:i,children:t})};LL.displayName=L_;var NL="PopperAnchor",zL=T.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=RL(NL,t),a=T.useRef(null),l=zt(e,a);return T.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||a.current)}),r?null:p.jsx(ht.div,{...i,ref:l})});zL.displayName=NL;var N_="PopperContent",[$W,HW]=DL(N_),FL=T.forwardRef((n,e)=>{var Ne,we,Te,je,He,Ft;const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:a=0,arrowPadding:l=0,avoidCollisions:u=!0,collisionBoundary:d=[],collisionPadding:f=0,sticky:g="partial",hideWhenDetached:m=!1,updatePositionStrategy:S="optimized",onPlaced:b,...x}=n,w=RL(N_,t),[_,E]=T.useState(null),M=zt(e,at=>E(at)),[I,A]=T.useState(null),j=OL(I),D=(j==null?void 0:j.width)??0,R=(j==null?void 0:j.height)??0,q=r+(s!=="center"?"-"+s:""),L=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},K=Array.isArray(d)?d:[d],G=K.length>0,z={padding:L,boundary:K.filter(qW),altBoundary:G},{refs:U,floatingStyles:Y,placement:H,isPositioned:X,middlewareData:V}=AW({strategy:"fixed",placement:q,whileElementsMounted:(...at)=>wW(...at,{animationFrame:S==="always"}),elements:{reference:w.anchor},middleware:[jW({mainAxis:i+R,alignmentAxis:a}),u&&OW({mainAxis:!0,crossAxis:!1,limiter:g==="partial"?DW():void 0,...z}),u&&RW({...z}),LW({...z,apply:({elements:at,rects:Bt,availableWidth:_t,availableHeight:gt})=>{const{width:Sr,height:Hn}=Bt.reference,vr=at.floating.style;vr.setProperty("--radix-popper-available-width",`${_t}px`),vr.setProperty("--radix-popper-available-height",`${gt}px`),vr.setProperty("--radix-popper-anchor-width",`${Sr}px`),vr.setProperty("--radix-popper-anchor-height",`${Hn}px`)}}),I&&zW({element:I,padding:l}),GW({arrowWidth:D,arrowHeight:R}),m&&NW({strategy:"referenceHidden",...z})]}),[ie,B]=$L(H),re=Fn(b);Da(()=>{X&&(re==null||re())},[X,re]);const me=(Ne=V.arrow)==null?void 0:Ne.x,de=(we=V.arrow)==null?void 0:we.y,ye=((Te=V.arrow)==null?void 0:Te.centerOffset)!==0,[ge,Ie]=T.useState();return Da(()=>{_&&Ie(window.getComputedStyle(_).zIndex)},[_]),p.jsx("div",{ref:U.setFloating,"data-radix-popper-content-wrapper":"",style:{...Y,transform:X?Y.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ge,"--radix-popper-transform-origin":[(je=V.transformOrigin)==null?void 0:je.x,(He=V.transformOrigin)==null?void 0:He.y].join(" "),...((Ft=V.hide)==null?void 0:Ft.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:p.jsx($W,{scope:t,placedSide:ie,onArrowChange:A,arrowX:me,arrowY:de,shouldHideArrow:ye,children:p.jsx(ht.div,{"data-side":ie,"data-align":B,...x,ref:M,style:{...x.style,animation:X?void 0:"none"}})})})});FL.displayName=N_;var BL="PopperArrow",KW={top:"bottom",right:"left",bottom:"top",left:"right"},UL=T.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=HW(BL,r),a=KW[s.placedSide];return p.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:p.jsx(BW,{...i,ref:t,style:{...i.style,display:"block"}})})});UL.displayName=BL;function qW(n){return n!==null}var GW=n=>({name:"transformOrigin",options:n,fn(e){var w,_,E;const{placement:t,rects:r,middlewareData:i}=e,a=((w=i.arrow)==null?void 0:w.centerOffset)!==0,l=a?0:n.arrowWidth,u=a?0:n.arrowHeight,[d,f]=$L(t),g={start:"0%",center:"50%",end:"100%"}[f],m=(((_=i.arrow)==null?void 0:_.x)??0)+l/2,S=(((E=i.arrow)==null?void 0:E.y)??0)+u/2;let b="",x="";return d==="bottom"?(b=a?g:`${m}px`,x=`${-u}px`):d==="top"?(b=a?g:`${m}px`,x=`${r.floating.height+u}px`):d==="right"?(b=`${-u}px`,x=a?g:`${S}px`):d==="left"&&(b=`${r.floating.width+u}px`,x=a?g:`${S}px`),{data:{x:b,y:x}}}});function $L(n){const[e,t="center"]=n.split("-");return[e,t]}var z_=LL,F_=zL,HL=FL,KL=UL,YW="Portal",sf=T.forwardRef((n,e)=>{var l;const{container:t,...r}=n,[i,s]=T.useState(!1);Da(()=>s(!0),[]);const a=t||i&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return a?$q.createPortal(p.jsx(ht.div,{...r,ref:e}),a):null});sf.displayName=YW;function VW(n,e){return T.useReducer((t,r)=>e[t][r]??t,n)}var us=n=>{const{present:e,children:t}=n,r=XW(e),i=typeof t=="function"?t({present:r.isPresent}):T.Children.only(t),s=zt(r.ref,WW(i));return typeof t=="function"||r.isPresent?T.cloneElement(i,{ref:s}):null};us.displayName="Presence";function XW(n){const[e,t]=T.useState(),r=T.useRef({}),i=T.useRef(n),s=T.useRef("none"),a=n?"mounted":"unmounted",[l,u]=VW(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return T.useEffect(()=>{const d=zp(r.current);s.current=l==="mounted"?d:"none"},[l]),Da(()=>{const d=r.current,f=i.current;if(f!==n){const m=s.current,S=zp(d);n?u("MOUNT"):S==="none"||(d==null?void 0:d.display)==="none"?u("UNMOUNT"):u(f&&m!==S?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,u]),Da(()=>{if(e){let d;const f=e.ownerDocument.defaultView??window,g=S=>{const x=zp(r.current).includes(S.animationName);if(S.target===e&&x&&(u("ANIMATION_END"),!i.current)){const w=e.style.animationFillMode;e.style.animationFillMode="forwards",d=f.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=w)})}},m=S=>{S.target===e&&(s.current=zp(r.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",g),e.addEventListener("animationend",g),()=>{f.clearTimeout(d),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",g),e.removeEventListener("animationend",g)}}else u("ANIMATION_END")},[e,u]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:T.useCallback(d=>{d&&(r.current=getComputedStyle(d)),t(d)},[])}}function zp(n){return(n==null?void 0:n.animationName)||"none"}function WW(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Ga({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=ZW({defaultProp:e,onChange:t}),s=n!==void 0,a=s?n:r,l=Fn(t),u=T.useCallback(d=>{if(s){const g=typeof d=="function"?d(n):d;g!==n&&l(g)}else i(d)},[s,n,i,l]);return[a,u]}function ZW({defaultProp:n,onChange:e}){const t=T.useState(n),[r]=t,i=T.useRef(r),s=Fn(e);return T.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),t}var fx="rovingFocusGroup.onEntryFocus",QW={bubbles:!1,cancelable:!0},sy="RovingFocusGroup",[Ow,qL,JW]=Jm(sy),[eZ,GL]=qs(sy,[JW]),[tZ,nZ]=eZ(sy),YL=T.forwardRef((n,e)=>p.jsx(Ow.Provider,{scope:n.__scopeRovingFocusGroup,children:p.jsx(Ow.Slot,{scope:n.__scopeRovingFocusGroup,children:p.jsx(rZ,{...n,ref:e})})}));YL.displayName=sy;var rZ=T.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:u,onEntryFocus:d,preventScrollOnEntryFocus:f=!1,...g}=n,m=T.useRef(null),S=zt(e,m),b=T_(s),[x=null,w]=Ga({prop:a,defaultProp:l,onChange:u}),[_,E]=T.useState(!1),M=Fn(d),I=qL(t),A=T.useRef(!1),[j,D]=T.useState(0);return T.useEffect(()=>{const R=m.current;if(R)return R.addEventListener(fx,M),()=>R.removeEventListener(fx,M)},[M]),p.jsx(tZ,{scope:t,orientation:r,dir:b,loop:i,currentTabStopId:x,onItemFocus:T.useCallback(R=>w(R),[w]),onItemShiftTab:T.useCallback(()=>E(!0),[]),onFocusableItemAdd:T.useCallback(()=>D(R=>R+1),[]),onFocusableItemRemove:T.useCallback(()=>D(R=>R-1),[]),children:p.jsx(ht.div,{tabIndex:_||j===0?-1:0,"data-orientation":r,...g,ref:S,style:{outline:"none",...n.style},onMouseDown:Me(n.onMouseDown,()=>{A.current=!0}),onFocus:Me(n.onFocus,R=>{const q=!A.current;if(R.target===R.currentTarget&&q&&!_){const L=new CustomEvent(fx,QW);if(R.currentTarget.dispatchEvent(L),!L.defaultPrevented){const K=I().filter(H=>H.focusable),G=K.find(H=>H.active),z=K.find(H=>H.id===x),Y=[G,z,...K].filter(Boolean).map(H=>H.ref.current);WL(Y,f)}}A.current=!1}),onBlur:Me(n.onBlur,()=>E(!1))})})}),VL="RovingFocusGroupItem",XL=T.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:s,...a}=n,l=Oo(),u=s||l,d=nZ(VL,t),f=d.currentTabStopId===u,g=qL(t),{onFocusableItemAdd:m,onFocusableItemRemove:S}=d;return T.useEffect(()=>{if(r)return m(),()=>S()},[r,m,S]),p.jsx(Ow.ItemSlot,{scope:t,id:u,focusable:r,active:i,children:p.jsx(ht.span,{tabIndex:f?0:-1,"data-orientation":d.orientation,...a,ref:e,onMouseDown:Me(n.onMouseDown,b=>{r?d.onItemFocus(u):b.preventDefault()}),onFocus:Me(n.onFocus,()=>d.onItemFocus(u)),onKeyDown:Me(n.onKeyDown,b=>{if(b.key==="Tab"&&b.shiftKey){d.onItemShiftTab();return}if(b.target!==b.currentTarget)return;const x=oZ(b,d.orientation,d.dir);if(x!==void 0){if(b.metaKey||b.ctrlKey||b.altKey||b.shiftKey)return;b.preventDefault();let _=g().filter(E=>E.focusable).map(E=>E.ref.current);if(x==="last")_.reverse();else if(x==="prev"||x==="next"){x==="prev"&&_.reverse();const E=_.indexOf(b.currentTarget);_=d.loop?aZ(_,E+1):_.slice(E+1)}setTimeout(()=>WL(_))}})})})});XL.displayName=VL;var iZ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function sZ(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function oZ(n,e,t){const r=sZ(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return iZ[r]}function WL(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function aZ(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var lZ=YL,cZ=XL,uZ=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Uc=new WeakMap,Fp=new WeakMap,Bp={},px=0,ZL=function(n){return n&&(n.host||ZL(n.parentNode))},dZ=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=ZL(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},hZ=function(n,e,t,r){var i=dZ(e,Array.isArray(n)?n:[n]);Bp[t]||(Bp[t]=new WeakMap);var s=Bp[t],a=[],l=new Set,u=new Set(i),d=function(g){!g||l.has(g)||(l.add(g),d(g.parentNode))};i.forEach(d);var f=function(g){!g||u.has(g)||Array.prototype.forEach.call(g.children,function(m){if(l.has(m))f(m);else try{var S=m.getAttribute(r),b=S!==null&&S!=="false",x=(Uc.get(m)||0)+1,w=(s.get(m)||0)+1;Uc.set(m,x),s.set(m,w),a.push(m),x===1&&b&&Fp.set(m,!0),w===1&&m.setAttribute(t,"true"),b||m.setAttribute(r,"true")}catch(_){console.error("aria-hidden: cannot operate on ",m,_)}})};return f(e),l.clear(),px++,function(){a.forEach(function(g){var m=Uc.get(g)-1,S=s.get(g)-1;Uc.set(g,m),s.set(g,S),m||(Fp.has(g)||g.removeAttribute(r),Fp.delete(g)),S||g.removeAttribute(t)}),px--,px||(Uc=new WeakMap,Uc=new WeakMap,Fp=new WeakMap,Bp={})}},B_=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=uZ(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),hZ(r,i,t,"aria-hidden")):function(){return null}},Ts=function(){return Ts=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ts.apply(this,arguments)};function QL(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function fZ(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var fg="right-scroll-bar-position",pg="width-before-scroll-bar",pZ="with-scroll-bars-hidden",gZ="--removed-body-scroll-bar-size";function gx(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function mZ(n,e){var t=T.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var yZ=typeof window<"u"?T.useLayoutEffect:T.useEffect,hk=new WeakMap;function SZ(n,e){var t=mZ(null,function(r){return n.forEach(function(i){return gx(i,r)})});return yZ(function(){var r=hk.get(t);if(r){var i=new Set(r),s=new Set(n),a=t.current;i.forEach(function(l){s.has(l)||gx(l,null)}),s.forEach(function(l){i.has(l)||gx(l,a)})}hk.set(t,n)},[n]),t}function vZ(n){return n}function bZ(n,e){e===void 0&&(e=vZ);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var a=e(s,r);return t.push(a),function(){t=t.filter(function(l){return l!==a})}},assignSyncMedium:function(s){for(r=!0;t.length;){var a=t;t=[],a.forEach(s)}t={push:function(l){return s(l)},filter:function(){return t}}},assignMedium:function(s){r=!0;var a=[];if(t.length){var l=t;t=[],l.forEach(s),a=t}var u=function(){var f=a;a=[],f.forEach(s)},d=function(){return Promise.resolve().then(u)};d(),t={push:function(f){a.push(f),d()},filter:function(f){return a=a.filter(f),t}}}};return i}function xZ(n){n===void 0&&(n={});var e=bZ(null);return e.options=Ts({async:!0,ssr:!1},n),e}var JL=function(n){var e=n.sideCar,t=QL(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return T.createElement(r,Ts({},t))};JL.isSideCarExport=!0;function wZ(n,e){return n.useMedium(e),JL}var e4=xZ(),mx=function(){},oy=T.forwardRef(function(n,e){var t=T.useRef(null),r=T.useState({onScrollCapture:mx,onWheelCapture:mx,onTouchMoveCapture:mx}),i=r[0],s=r[1],a=n.forwardProps,l=n.children,u=n.className,d=n.removeScrollBar,f=n.enabled,g=n.shards,m=n.sideCar,S=n.noIsolation,b=n.inert,x=n.allowPinchZoom,w=n.as,_=w===void 0?"div":w,E=n.gapMode,M=QL(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),I=m,A=SZ([t,e]),j=Ts(Ts({},M),i);return T.createElement(T.Fragment,null,f&&T.createElement(I,{sideCar:e4,removeScrollBar:d,shards:g,noIsolation:S,inert:b,setCallbacks:s,allowPinchZoom:!!x,lockRef:t,gapMode:E}),a?T.cloneElement(T.Children.only(l),Ts(Ts({},j),{ref:A})):T.createElement(_,Ts({},j,{className:u,ref:A}),l))});oy.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};oy.classNames={fullWidth:pg,zeroRight:fg};var _Z=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function CZ(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=_Z();return e&&n.setAttribute("nonce",e),n}function EZ(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function PZ(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var TZ=function(){var n=0,e=null;return{add:function(t){n==0&&(e=CZ())&&(EZ(e,t),PZ(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},IZ=function(){var n=TZ();return function(e,t){T.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},t4=function(){var n=IZ(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},MZ={left:0,top:0,right:0,gap:0},yx=function(n){return parseInt(n||"",10)||0},AZ=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[yx(t),yx(r),yx(i)]},kZ=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return MZ;var e=AZ(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},jZ=t4(),ou="data-scroll-locked",OZ=function(n,e,t,r){var i=n.left,s=n.top,a=n.right,l=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(pZ,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(l,"px ").concat(r,`;
  }
  body[`).concat(ou,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(fg,` {
    right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(pg,` {
    margin-right: `).concat(l,"px ").concat(r,`;
  }
  
  .`).concat(fg," .").concat(fg,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(pg," .").concat(pg,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ou,`] {
    `).concat(gZ,": ").concat(l,`px;
  }
`)},fk=function(){var n=parseInt(document.body.getAttribute(ou)||"0",10);return isFinite(n)?n:0},DZ=function(){T.useEffect(function(){return document.body.setAttribute(ou,(fk()+1).toString()),function(){var n=fk()-1;n<=0?document.body.removeAttribute(ou):document.body.setAttribute(ou,n.toString())}},[])},RZ=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;DZ();var s=T.useMemo(function(){return kZ(i)},[i]);return T.createElement(jZ,{styles:OZ(s,!e,i,t?"":"!important")})},Dw=!1;if(typeof window<"u")try{var Up=Object.defineProperty({},"passive",{get:function(){return Dw=!0,!0}});window.addEventListener("test",Up,Up),window.removeEventListener("test",Up,Up)}catch{Dw=!1}var $c=Dw?{passive:!1}:!1,LZ=function(n){return n.tagName==="TEXTAREA"},n4=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!LZ(n)&&t[e]==="visible")},NZ=function(n){return n4(n,"overflowY")},zZ=function(n){return n4(n,"overflowX")},pk=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=r4(n,r);if(i){var s=i4(n,r),a=s[1],l=s[2];if(a>l)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},FZ=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},BZ=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},r4=function(n,e){return n==="v"?NZ(e):zZ(e)},i4=function(n,e){return n==="v"?FZ(e):BZ(e)},UZ=function(n,e){return n==="h"&&e==="rtl"?-1:1},$Z=function(n,e,t,r,i){var s=UZ(n,window.getComputedStyle(e).direction),a=s*r,l=t.target,u=e.contains(l),d=!1,f=a>0,g=0,m=0;do{var S=i4(n,l),b=S[0],x=S[1],w=S[2],_=x-w-s*b;(b||_)&&r4(n,l)&&(g+=_,m+=b),l instanceof ShadowRoot?l=l.host:l=l.parentNode}while(!u&&l!==document.body||u&&(e.contains(l)||e===l));return(f&&Math.abs(g)<1||!f&&Math.abs(m)<1)&&(d=!0),d},$p=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},gk=function(n){return[n.deltaX,n.deltaY]},mk=function(n){return n&&"current"in n?n.current:n},HZ=function(n,e){return n[0]===e[0]&&n[1]===e[1]},KZ=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},qZ=0,Hc=[];function GZ(n){var e=T.useRef([]),t=T.useRef([0,0]),r=T.useRef(),i=T.useState(qZ++)[0],s=T.useState(t4)[0],a=T.useRef(n);T.useEffect(function(){a.current=n},[n]),T.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var x=fZ([n.lockRef.current],(n.shards||[]).map(mk),!0).filter(Boolean);return x.forEach(function(w){return w.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),x.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var l=T.useCallback(function(x,w){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!a.current.allowPinchZoom;var _=$p(x),E=t.current,M="deltaX"in x?x.deltaX:E[0]-_[0],I="deltaY"in x?x.deltaY:E[1]-_[1],A,j=x.target,D=Math.abs(M)>Math.abs(I)?"h":"v";if("touches"in x&&D==="h"&&j.type==="range")return!1;var R=pk(D,j);if(!R)return!0;if(R?A=D:(A=D==="v"?"h":"v",R=pk(D,j)),!R)return!1;if(!r.current&&"changedTouches"in x&&(M||I)&&(r.current=A),!A)return!0;var q=r.current||A;return $Z(q,w,x,q==="h"?M:I)},[]),u=T.useCallback(function(x){var w=x;if(!(!Hc.length||Hc[Hc.length-1]!==s)){var _="deltaY"in w?gk(w):$p(w),E=e.current.filter(function(A){return A.name===w.type&&(A.target===w.target||w.target===A.shadowParent)&&HZ(A.delta,_)})[0];if(E&&E.should){w.cancelable&&w.preventDefault();return}if(!E){var M=(a.current.shards||[]).map(mk).filter(Boolean).filter(function(A){return A.contains(w.target)}),I=M.length>0?l(w,M[0]):!a.current.noIsolation;I&&w.cancelable&&w.preventDefault()}}},[]),d=T.useCallback(function(x,w,_,E){var M={name:x,delta:w,target:_,should:E,shadowParent:YZ(_)};e.current.push(M),setTimeout(function(){e.current=e.current.filter(function(I){return I!==M})},1)},[]),f=T.useCallback(function(x){t.current=$p(x),r.current=void 0},[]),g=T.useCallback(function(x){d(x.type,gk(x),x.target,l(x,n.lockRef.current))},[]),m=T.useCallback(function(x){d(x.type,$p(x),x.target,l(x,n.lockRef.current))},[]);T.useEffect(function(){return Hc.push(s),n.setCallbacks({onScrollCapture:g,onWheelCapture:g,onTouchMoveCapture:m}),document.addEventListener("wheel",u,$c),document.addEventListener("touchmove",u,$c),document.addEventListener("touchstart",f,$c),function(){Hc=Hc.filter(function(x){return x!==s}),document.removeEventListener("wheel",u,$c),document.removeEventListener("touchmove",u,$c),document.removeEventListener("touchstart",f,$c)}},[]);var S=n.removeScrollBar,b=n.inert;return T.createElement(T.Fragment,null,b?T.createElement(s,{styles:KZ(i)}):null,S?T.createElement(RZ,{gapMode:n.gapMode}):null)}function YZ(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const VZ=wZ(e4,GZ);var ay=T.forwardRef(function(n,e){return T.createElement(oy,Ts({},n,{ref:e,sideCar:VZ}))});ay.classNames=oy.classNames;var Rw=["Enter"," "],XZ=["ArrowDown","PageUp","Home"],s4=["ArrowUp","PageDown","End"],WZ=[...XZ,...s4],ZZ={ltr:[...Rw,"ArrowRight"],rtl:[...Rw,"ArrowLeft"]},QZ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},of="Menu",[Mh,JZ,eQ]=Jm(of),[Vl,ly]=qs(of,[eQ,iy,GL]),af=iy(),o4=GL(),[a4,Ya]=Vl(of),[tQ,lf]=Vl(of),l4=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:s,modal:a=!0}=n,l=af(e),[u,d]=T.useState(null),f=T.useRef(!1),g=Fn(s),m=T_(i);return T.useEffect(()=>{const S=()=>{f.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>f.current=!1;return document.addEventListener("keydown",S,{capture:!0}),()=>{document.removeEventListener("keydown",S,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),p.jsx(z_,{...l,children:p.jsx(a4,{scope:e,open:t,onOpenChange:g,content:u,onContentChange:d,children:p.jsx(tQ,{scope:e,onClose:T.useCallback(()=>g(!1),[g]),isUsingKeyboardRef:f,dir:m,modal:a,children:r})})})};l4.displayName=of;var nQ="MenuAnchor",U_=T.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=af(t);return p.jsx(F_,{...i,...r,ref:e})});U_.displayName=nQ;var $_="MenuPortal",[rQ,c4]=Vl($_,{forceMount:void 0}),u4=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,s=Ya($_,e);return p.jsx(rQ,{scope:e,forceMount:t,children:p.jsx(us,{present:t||s.open,children:p.jsx(sf,{asChild:!0,container:i,children:r})})})};u4.displayName=$_;var Ai="MenuContent",[iQ,H_]=Vl(Ai),d4=T.forwardRef((n,e)=>{const t=c4(Ai,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Ya(Ai,n.__scopeMenu),a=lf(Ai,n.__scopeMenu);return p.jsx(Mh.Provider,{scope:n.__scopeMenu,children:p.jsx(us,{present:r||s.open,children:p.jsx(Mh.Slot,{scope:n.__scopeMenu,children:a.modal?p.jsx(sQ,{...i,ref:e}):p.jsx(oQ,{...i,ref:e})})})})}),sQ=T.forwardRef((n,e)=>{const t=Ya(Ai,n.__scopeMenu),r=T.useRef(null),i=zt(e,r);return T.useEffect(()=>{const s=r.current;if(s)return B_(s)},[]),p.jsx(K_,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:Me(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),oQ=T.forwardRef((n,e)=>{const t=Ya(Ai,n.__scopeMenu);return p.jsx(K_,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),K_=T.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:a,disableOutsidePointerEvents:l,onEntryFocus:u,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:g,onInteractOutside:m,onDismiss:S,disableOutsideScroll:b,...x}=n,w=Ya(Ai,t),_=lf(Ai,t),E=af(t),M=o4(t),I=JZ(t),[A,j]=T.useState(null),D=T.useRef(null),R=zt(e,D,w.onContentChange),q=T.useRef(0),L=T.useRef(""),K=T.useRef(0),G=T.useRef(null),z=T.useRef("right"),U=T.useRef(0),Y=b?ay:T.Fragment,H=b?{as:Nl,allowPinchZoom:!0}:void 0,X=ie=>{var Ne,we;const B=L.current+ie,re=I().filter(Te=>!Te.disabled),me=document.activeElement,de=(Ne=re.find(Te=>Te.ref.current===me))==null?void 0:Ne.textValue,ye=re.map(Te=>Te.textValue),ge=SQ(ye,B,de),Ie=(we=re.find(Te=>Te.textValue===ge))==null?void 0:we.ref.current;(function Te(je){L.current=je,window.clearTimeout(q.current),je!==""&&(q.current=window.setTimeout(()=>Te(""),1e3))})(B),Ie&&setTimeout(()=>Ie.focus())};T.useEffect(()=>()=>window.clearTimeout(q.current),[]),I_();const V=T.useCallback(ie=>{var re,me;return z.current===((re=G.current)==null?void 0:re.side)&&bQ(ie,(me=G.current)==null?void 0:me.area)},[]);return p.jsx(iQ,{scope:t,searchRef:L,onItemEnter:T.useCallback(ie=>{V(ie)&&ie.preventDefault()},[V]),onItemLeave:T.useCallback(ie=>{var B;V(ie)||((B=D.current)==null||B.focus(),j(null))},[V]),onTriggerLeave:T.useCallback(ie=>{V(ie)&&ie.preventDefault()},[V]),pointerGraceTimerRef:K,onPointerGraceIntentChange:T.useCallback(ie=>{G.current=ie},[]),children:p.jsx(Y,{...H,children:p.jsx(ey,{asChild:!0,trapped:i,onMountAutoFocus:Me(s,ie=>{var B;ie.preventDefault(),(B=D.current)==null||B.focus({preventScroll:!0})}),onUnmountAutoFocus:a,children:p.jsx(nf,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:g,onInteractOutside:m,onDismiss:S,children:p.jsx(lZ,{asChild:!0,...M,dir:_.dir,orientation:"vertical",loop:r,currentTabStopId:A,onCurrentTabStopIdChange:j,onEntryFocus:Me(u,ie=>{_.isUsingKeyboardRef.current||ie.preventDefault()}),preventScrollOnEntryFocus:!0,children:p.jsx(HL,{role:"menu","aria-orientation":"vertical","data-state":I4(w.open),"data-radix-menu-content":"",dir:_.dir,...E,...x,ref:R,style:{outline:"none",...x.style},onKeyDown:Me(x.onKeyDown,ie=>{const re=ie.target.closest("[data-radix-menu-content]")===ie.currentTarget,me=ie.ctrlKey||ie.altKey||ie.metaKey,de=ie.key.length===1;re&&(ie.key==="Tab"&&ie.preventDefault(),!me&&de&&X(ie.key));const ye=D.current;if(ie.target!==ye||!WZ.includes(ie.key))return;ie.preventDefault();const Ie=I().filter(Ne=>!Ne.disabled).map(Ne=>Ne.ref.current);s4.includes(ie.key)&&Ie.reverse(),mQ(Ie)}),onBlur:Me(n.onBlur,ie=>{ie.currentTarget.contains(ie.target)||(window.clearTimeout(q.current),L.current="")}),onPointerMove:Me(n.onPointerMove,Ah(ie=>{const B=ie.target,re=U.current!==ie.clientX;if(ie.currentTarget.contains(B)&&re){const me=ie.clientX>U.current?"right":"left";z.current=me,U.current=ie.clientX}}))})})})})})})});d4.displayName=Ai;var aQ="MenuGroup",q_=T.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(ht.div,{role:"group",...r,ref:e})});q_.displayName=aQ;var lQ="MenuLabel",h4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(ht.div,{...r,ref:e})});h4.displayName=lQ;var dm="MenuItem",yk="menu.itemSelect",cy=T.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,s=T.useRef(null),a=lf(dm,n.__scopeMenu),l=H_(dm,n.__scopeMenu),u=zt(e,s),d=T.useRef(!1),f=()=>{const g=s.current;if(!t&&g){const m=new CustomEvent(yk,{bubbles:!0,cancelable:!0});g.addEventListener(yk,S=>r==null?void 0:r(S),{once:!0}),P_(g,m),m.defaultPrevented?d.current=!1:a.onClose()}};return p.jsx(f4,{...i,ref:u,disabled:t,onClick:Me(n.onClick,f),onPointerDown:g=>{var m;(m=n.onPointerDown)==null||m.call(n,g),d.current=!0},onPointerUp:Me(n.onPointerUp,g=>{var m;d.current||(m=g.currentTarget)==null||m.click()}),onKeyDown:Me(n.onKeyDown,g=>{const m=l.searchRef.current!=="";t||m&&g.key===" "||Rw.includes(g.key)&&(g.currentTarget.click(),g.preventDefault())})})});cy.displayName=dm;var f4=T.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...s}=n,a=H_(dm,t),l=o4(t),u=T.useRef(null),d=zt(e,u),[f,g]=T.useState(!1),[m,S]=T.useState("");return T.useEffect(()=>{const b=u.current;b&&S((b.textContent??"").trim())},[s.children]),p.jsx(Mh.ItemSlot,{scope:t,disabled:r,textValue:i??m,children:p.jsx(cZ,{asChild:!0,...l,focusable:!r,children:p.jsx(ht.div,{role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:d,onPointerMove:Me(n.onPointerMove,Ah(b=>{r?a.onItemLeave(b):(a.onItemEnter(b),b.defaultPrevented||b.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Me(n.onPointerLeave,Ah(b=>a.onItemLeave(b))),onFocus:Me(n.onFocus,()=>g(!0)),onBlur:Me(n.onBlur,()=>g(!1))})})})}),cQ="MenuCheckboxItem",p4=T.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return p.jsx(v4,{scope:n.__scopeMenu,checked:t,children:p.jsx(cy,{role:"menuitemcheckbox","aria-checked":hm(t)?"mixed":t,...i,ref:e,"data-state":V_(t),onSelect:Me(i.onSelect,()=>r==null?void 0:r(hm(t)?!0:!t),{checkForDefaultPrevented:!1})})})});p4.displayName=cQ;var g4="MenuRadioGroup",[uQ,dQ]=Vl(g4,{value:void 0,onValueChange:()=>{}}),m4=T.forwardRef((n,e)=>{const{value:t,onValueChange:r,...i}=n,s=Fn(r);return p.jsx(uQ,{scope:n.__scopeMenu,value:t,onValueChange:s,children:p.jsx(q_,{...i,ref:e})})});m4.displayName=g4;var y4="MenuRadioItem",S4=T.forwardRef((n,e)=>{const{value:t,...r}=n,i=dQ(y4,n.__scopeMenu),s=t===i.value;return p.jsx(v4,{scope:n.__scopeMenu,checked:s,children:p.jsx(cy,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":V_(s),onSelect:Me(r.onSelect,()=>{var a;return(a=i.onValueChange)==null?void 0:a.call(i,t)},{checkForDefaultPrevented:!1})})})});S4.displayName=y4;var G_="MenuItemIndicator",[v4,hQ]=Vl(G_,{checked:!1}),b4=T.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,s=hQ(G_,t);return p.jsx(us,{present:r||hm(s.checked)||s.checked===!0,children:p.jsx(ht.span,{...i,ref:e,"data-state":V_(s.checked)})})});b4.displayName=G_;var fQ="MenuSeparator",x4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(ht.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});x4.displayName=fQ;var pQ="MenuArrow",w4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=af(t);return p.jsx(KL,{...i,...r,ref:e})});w4.displayName=pQ;var Y_="MenuSub",[gQ,_4]=Vl(Y_),C4=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,s=Ya(Y_,e),a=af(e),[l,u]=T.useState(null),[d,f]=T.useState(null),g=Fn(i);return T.useEffect(()=>(s.open===!1&&g(!1),()=>g(!1)),[s.open,g]),p.jsx(z_,{...a,children:p.jsx(a4,{scope:e,open:r,onOpenChange:g,content:d,onContentChange:f,children:p.jsx(gQ,{scope:e,contentId:Oo(),triggerId:Oo(),trigger:l,onTriggerChange:u,children:t})})})};C4.displayName=Y_;var sh="MenuSubTrigger",E4=T.forwardRef((n,e)=>{const t=Ya(sh,n.__scopeMenu),r=lf(sh,n.__scopeMenu),i=_4(sh,n.__scopeMenu),s=H_(sh,n.__scopeMenu),a=T.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:u}=s,d={__scopeMenu:n.__scopeMenu},f=T.useCallback(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return T.useEffect(()=>f,[f]),T.useEffect(()=>{const g=l.current;return()=>{window.clearTimeout(g),u(null)}},[l,u]),p.jsx(U_,{asChild:!0,...d,children:p.jsx(f4,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":I4(t.open),...n,ref:Qm(e,i.onTriggerChange),onClick:g=>{var m;(m=n.onClick)==null||m.call(n,g),!(n.disabled||g.defaultPrevented)&&(g.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:Me(n.onPointerMove,Ah(g=>{s.onItemEnter(g),!g.defaultPrevented&&!n.disabled&&!t.open&&!a.current&&(s.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{t.onOpenChange(!0),f()},100))})),onPointerLeave:Me(n.onPointerLeave,Ah(g=>{var S,b;f();const m=(S=t.content)==null?void 0:S.getBoundingClientRect();if(m){const x=(b=t.content)==null?void 0:b.dataset.side,w=x==="right",_=w?-5:5,E=m[w?"left":"right"],M=m[w?"right":"left"];s.onPointerGraceIntentChange({area:[{x:g.clientX+_,y:g.clientY},{x:E,y:m.top},{x:M,y:m.top},{x:M,y:m.bottom},{x:E,y:m.bottom}],side:x}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(g),g.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Me(n.onKeyDown,g=>{var S;const m=s.searchRef.current!=="";n.disabled||m&&g.key===" "||ZZ[r.dir].includes(g.key)&&(t.onOpenChange(!0),(S=t.content)==null||S.focus(),g.preventDefault())})})})});E4.displayName=sh;var P4="MenuSubContent",T4=T.forwardRef((n,e)=>{const t=c4(Ai,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=Ya(Ai,n.__scopeMenu),a=lf(Ai,n.__scopeMenu),l=_4(P4,n.__scopeMenu),u=T.useRef(null),d=zt(e,u);return p.jsx(Mh.Provider,{scope:n.__scopeMenu,children:p.jsx(us,{present:r||s.open,children:p.jsx(Mh.Slot,{scope:n.__scopeMenu,children:p.jsx(K_,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:d,align:"start",side:a.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:f=>{var g;a.isUsingKeyboardRef.current&&((g=u.current)==null||g.focus()),f.preventDefault()},onCloseAutoFocus:f=>f.preventDefault(),onFocusOutside:Me(n.onFocusOutside,f=>{f.target!==l.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Me(n.onEscapeKeyDown,f=>{a.onClose(),f.preventDefault()}),onKeyDown:Me(n.onKeyDown,f=>{var S;const g=f.currentTarget.contains(f.target),m=QZ[a.dir].includes(f.key);g&&m&&(s.onOpenChange(!1),(S=l.trigger)==null||S.focus(),f.preventDefault())})})})})})});T4.displayName=P4;function I4(n){return n?"open":"closed"}function hm(n){return n==="indeterminate"}function V_(n){return hm(n)?"indeterminate":n?"checked":"unchecked"}function mQ(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function yQ(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function SQ(n,e,t){const i=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let a=yQ(n,Math.max(s,0));i.length===1&&(a=a.filter(d=>d!==t));const u=a.find(d=>d.toLowerCase().startsWith(i.toLowerCase()));return u!==t?u:void 0}function vQ(n,e){const{x:t,y:r}=n;let i=!1;for(let s=0,a=e.length-1;s<e.length;a=s++){const l=e[s].x,u=e[s].y,d=e[a].x,f=e[a].y;u>r!=f>r&&t<(d-l)*(r-u)/(f-u)+l&&(i=!i)}return i}function bQ(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return vQ(t,e)}function Ah(n){return e=>e.pointerType==="mouse"?n(e):void 0}var M4=l4,A4=U_,k4=u4,j4=d4,O4=q_,D4=h4,R4=cy,L4=p4,N4=m4,z4=S4,F4=b4,B4=x4,U4=w4,$4=C4,H4=E4,K4=T4,X_="ContextMenu",[xQ,rce]=qs(X_,[ly]),sr=ly(),[wQ,q4]=xQ(X_),G4=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:s=!0}=n,[a,l]=T.useState(!1),u=sr(e),d=Fn(r),f=T.useCallback(g=>{l(g),d(g)},[d]);return p.jsx(wQ,{scope:e,open:a,onOpenChange:f,modal:s,children:p.jsx(M4,{...u,dir:i,open:a,onOpenChange:f,modal:s,children:t})})};G4.displayName=X_;var Y4="ContextMenuTrigger",V4=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,s=q4(Y4,t),a=sr(t),l=T.useRef({x:0,y:0}),u=T.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),d=T.useRef(0),f=T.useCallback(()=>window.clearTimeout(d.current),[]),g=m=>{l.current={x:m.clientX,y:m.clientY},s.onOpenChange(!0)};return T.useEffect(()=>f,[f]),T.useEffect(()=>void(r&&f()),[r,f]),p.jsxs(p.Fragment,{children:[p.jsx(A4,{...a,virtualRef:u}),p.jsx(ht.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:Me(n.onContextMenu,m=>{f(),g(m),m.preventDefault()}),onPointerDown:r?n.onPointerDown:Me(n.onPointerDown,Hp(m=>{f(),d.current=window.setTimeout(()=>g(m),700)})),onPointerMove:r?n.onPointerMove:Me(n.onPointerMove,Hp(f)),onPointerCancel:r?n.onPointerCancel:Me(n.onPointerCancel,Hp(f)),onPointerUp:r?n.onPointerUp:Me(n.onPointerUp,Hp(f))})]})});V4.displayName=Y4;var _Q="ContextMenuPortal",W_=n=>{const{__scopeContextMenu:e,...t}=n,r=sr(e);return p.jsx(k4,{...r,...t})};W_.displayName=_Q;var X4="ContextMenuContent",W4=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=q4(X4,t),s=sr(t),a=T.useRef(!1);return p.jsx(j4,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:l=>{var u;(u=n.onCloseAutoFocus)==null||u.call(n,l),!l.defaultPrevented&&a.current&&l.preventDefault(),a.current=!1},onInteractOutside:l=>{var u;(u=n.onInteractOutside)==null||u.call(n,l),!l.defaultPrevented&&!i.modal&&(a.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});W4.displayName=X4;var CQ="ContextMenuGroup",Z4=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(O4,{...i,...r,ref:e})});Z4.displayName=CQ;var EQ="ContextMenuLabel",PQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(D4,{...i,...r,ref:e})});PQ.displayName=EQ;var TQ="ContextMenuItem",Q4=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(R4,{...i,...r,ref:e})});Q4.displayName=TQ;var IQ="ContextMenuCheckboxItem",J4=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(L4,{...i,...r,ref:e})});J4.displayName=IQ;var MQ="ContextMenuRadioGroup",AQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(N4,{...i,...r,ref:e})});AQ.displayName=MQ;var kQ="ContextMenuRadioItem",jQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(z4,{...i,...r,ref:e})});jQ.displayName=kQ;var OQ="ContextMenuItemIndicator",DQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(F4,{...i,...r,ref:e})});DQ.displayName=OQ;var RQ="ContextMenuSeparator",LQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(B4,{...i,...r,ref:e})});LQ.displayName=RQ;var NQ="ContextMenuArrow",zQ=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(U4,{...i,...r,ref:e})});zQ.displayName=NQ;var FQ="ContextMenuSub",e6=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:s}=n,a=sr(e),[l,u]=Ga({prop:i,defaultProp:s,onChange:r});return p.jsx($4,{...a,open:l,onOpenChange:u,children:t})};e6.displayName=FQ;var BQ="ContextMenuSubTrigger",t6=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(H4,{...i,...r,ref:e})});t6.displayName=BQ;var UQ="ContextMenuSubContent",n6=T.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=sr(t);return p.jsx(K4,{...i,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});n6.displayName=UQ;function Hp(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var $Q=G4,HQ=V4,KQ=W_,qQ=W4,GQ=J4,Z_="DropdownMenu",[YQ,ice]=qs(Z_,[ly]),or=ly(),[VQ,r6]=YQ(Z_),i6=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:s,onOpenChange:a,modal:l=!0}=n,u=or(e),d=T.useRef(null),[f=!1,g]=Ga({prop:i,defaultProp:s,onChange:a});return p.jsx(VQ,{scope:e,triggerId:Oo(),triggerRef:d,contentId:Oo(),open:f,onOpenChange:g,onOpenToggle:T.useCallback(()=>g(m=>!m),[g]),modal:l,children:p.jsx(M4,{...u,open:f,onOpenChange:g,dir:r,modal:l,children:t})})};i6.displayName=Z_;var s6="DropdownMenuTrigger",o6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,s=r6(s6,t),a=or(t);return p.jsx(A4,{asChild:!0,...a,children:p.jsx(ht.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Qm(e,s.triggerRef),onPointerDown:Me(n.onPointerDown,l=>{!r&&l.button===0&&l.ctrlKey===!1&&(s.onOpenToggle(),s.open||l.preventDefault())}),onKeyDown:Me(n.onKeyDown,l=>{r||(["Enter"," "].includes(l.key)&&s.onOpenToggle(),l.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});o6.displayName=s6;var XQ="DropdownMenuPortal",a6=n=>{const{__scopeDropdownMenu:e,...t}=n,r=or(e);return p.jsx(k4,{...r,...t})};a6.displayName=XQ;var l6="DropdownMenuContent",c6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=r6(l6,t),s=or(t),a=T.useRef(!1);return p.jsx(j4,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Me(n.onCloseAutoFocus,l=>{var u;a.current||(u=i.triggerRef.current)==null||u.focus(),a.current=!1,l.preventDefault()}),onInteractOutside:Me(n.onInteractOutside,l=>{const u=l.detail.originalEvent,d=u.button===0&&u.ctrlKey===!0,f=u.button===2||d;(!i.modal||f)&&(a.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});c6.displayName=l6;var WQ="DropdownMenuGroup",u6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(O4,{...i,...r,ref:e})});u6.displayName=WQ;var ZQ="DropdownMenuLabel",QQ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(D4,{...i,...r,ref:e})});QQ.displayName=ZQ;var JQ="DropdownMenuItem",d6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(R4,{...i,...r,ref:e})});d6.displayName=JQ;var eJ="DropdownMenuCheckboxItem",h6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(L4,{...i,...r,ref:e})});h6.displayName=eJ;var tJ="DropdownMenuRadioGroup",nJ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(N4,{...i,...r,ref:e})});nJ.displayName=tJ;var rJ="DropdownMenuRadioItem",iJ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(z4,{...i,...r,ref:e})});iJ.displayName=rJ;var sJ="DropdownMenuItemIndicator",oJ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(F4,{...i,...r,ref:e})});oJ.displayName=sJ;var aJ="DropdownMenuSeparator",lJ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(B4,{...i,...r,ref:e})});lJ.displayName=aJ;var cJ="DropdownMenuArrow",uJ=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(U4,{...i,...r,ref:e})});uJ.displayName=cJ;var dJ=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:s}=n,a=or(e),[l=!1,u]=Ga({prop:r,defaultProp:s,onChange:i});return p.jsx($4,{...a,open:l,onOpenChange:u,children:t})},hJ="DropdownMenuSubTrigger",f6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(H4,{...i,...r,ref:e})});f6.displayName=hJ;var fJ="DropdownMenuSubContent",p6=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=or(t);return p.jsx(K4,{...i,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});p6.displayName=fJ;var Q_=i6,J_=o6,uy=a6,eC=c6,pJ=u6,gJ=d6,mJ=h6,yJ=dJ,SJ=f6,vJ=p6;function Lt(n,e){var i;const t=new Set;for(const s of e){const a=n.getShape(s);if(!a)continue;n.getShapeUtil(a).onDragShapesOut&&t.add(a);const l=n.getShape(a.parentId);l&&n.getShapeUtil(l).onDragShapesOut&&t.add(l)}const r=new Map;for(const s of t){const a=g6(n,s);a.length&&r.set(s,a)}for(const[s,a]of r){const l=n.getShapeUtil(s),u=Ye(a.map(d=>n.getShape(d)));(i=l.onDragShapesOut)==null||i.call(l,s,u)}}function g6(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const r=n.getShapePageBounds(e);if(!r)return[];let i,s,a;const l=[];for(const u of t){const d=n.getShapePageBounds(u);if(!d)continue;if(!r.includes(d)){l.push(u);continue}i??(i=n.getShapeGeometry(e)),s??(s=n.getShapePageTransform(e)),a??(a=s.applyToPoints(i.vertices));const f=n.getShapePageTransform(u).clone().invert().applyToPoints(a),{vertices:g,isClosed:m}=n.getShapeGeometry(u);if(!g.some(S=>ei(S,f))){if(m){if(p_(f,g))continue}else if(Bq(f,g))continue;l.push(u)}}return l}function fm(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id})}function bJ(n,e){const t=Ye(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.run(()=>{t.map(i=>{const s=n.getSortedChildIdsForParent(i.id);s.length&&(n.reparentShapes(s,i.parentId,i.index),r.push(...s))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const xJ=50;function wJ(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),s=Ye(i.map(S=>n.getShape(S)));if(!s.length)return;const a=be.FromPoints(s.flatMap(S=>{const b=n.getShapeGeometry(S.id);return n.getShapeLocalTransform(S).applyToPoints(b.vertices)})),{padding:l=xJ}=t,u=a.w+2*l,d=a.h+2*l,f=l-a.minX,g=l-a.minY;if(f===0&&g===0&&r.props.w===u&&r.props.h===d)return;const m=new P(f,g).rot(r.rotation);n.run(()=>{const S=i.map(b=>{const x=n.getShape(b);return{id:x.id,type:x.type,x:x.x+f,y:x.y+g}});S.push({id:r.id,type:r.type,x:r.x-m.x,y:r.y-m.y,props:{w:u,h:d}}),n.updateShapes(S)})}const m6=T.createContext(null);function _J({assetUrls:n,children:e}){return T.useEffect(()=>{for(const t of Object.values(n.icons)){const r=xh();r.src=t,r.decode()}for(const t of Object.values(n.embedIcons)){const r=xh();r.src=t,r.decode()}},[n]),p.jsx(m6.Provider,{value:n,children:e})}function tC(){const n=T.useContext(m6);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const Lw={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldnt load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project cant be shared because its too large. Were working on it!","share-menu.upload-failed":"Sorry, we couldnt upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.import-tldr-file":"Import file","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the sites URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesnt look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Dont ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Dont ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Dont ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"Weve updated this document to work with the current version of tldraw. If youd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Dont ask again","cursor-chat.type-to-chat":"Type to chat"},CJ=new Set(["ar","fa","he","ur","ku"]),Kc={locale:"en",label:"English",messages:Lw,dir:"ltr"};async function EJ(n,e){if(!(await Ls(e.translations.en)).ok)return console.warn("No main translations found."),Kc;if(n==="en")return Kc;const r=Eh.find(a=>a.locale===n);if(!r)return console.warn(`No translation found for locale ${n}`),Kc;const s=await(await Ls(e.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${n}`),Kc;for(const a in Kc.messages)s[a];return{locale:n,label:r.label,dir:CJ.has(r.locale)?"rtl":"ltr",messages:{...Kc.messages,...s}}}const y6=T.createContext(null);function S6(){const n=T.useContext(y6);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}function PJ({overrides:n,locale:e,children:t}){const r=tC(),[i,s]=T.useState(()=>n&&n.en?{locale:"en",label:"English",dir:"ltr",messages:{...Lw,...n.en}}:{locale:"en",label:"English",dir:"ltr",messages:Lw});return T.useEffect(()=>{let a=!1;async function l(){const u=await EJ(e,r);u&&!a&&(n&&n[e]?s({...u,messages:{...u.messages,...n[e]}}):s(u))}return l(),()=>{a=!0}},[r,e,n]),p.jsx(y6.Provider,{value:i,children:t})}function ot(){const n=S6();return T.useCallback(function(t){return n.messages[t]??t},[n])}const Le=T.forwardRef(function({children:e,type:t,...r},i){return p.jsx("button",{ref:i,type:"button",draggable:!1,...r,className:Oe("tlui-button",`tlui-button__${t}`,r.className),children:e})});function cn({children:n}){return p.jsx("span",{className:"tlui-button__label",children:n})}var nC="Dialog",[v6,sce]=qs(nC),[TJ,ds]=v6(nC),b6=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:a=!0}=n,l=T.useRef(null),u=T.useRef(null),[d=!1,f]=Ga({prop:r,defaultProp:i,onChange:s});return p.jsx(TJ,{scope:e,triggerRef:l,contentRef:u,contentId:Oo(),titleId:Oo(),descriptionId:Oo(),open:d,onOpenChange:f,onOpenToggle:T.useCallback(()=>f(g=>!g),[f]),modal:a,children:t})};b6.displayName=nC;var x6="DialogTrigger",IJ=T.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=ds(x6,t),s=zt(e,i.triggerRef);return p.jsx(ht.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":sC(i.open),...r,ref:s,onClick:Me(n.onClick,i.onOpenToggle)})});IJ.displayName=x6;var rC="DialogPortal",[MJ,w6]=v6(rC,{forceMount:void 0}),_6=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,s=ds(rC,e);return p.jsx(MJ,{scope:e,forceMount:t,children:T.Children.map(r,a=>p.jsx(us,{present:t||s.open,children:p.jsx(sf,{asChild:!0,container:i,children:a})}))})};_6.displayName=rC;var pm="DialogOverlay",C6=T.forwardRef((n,e)=>{const t=w6(pm,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=ds(pm,n.__scopeDialog);return s.modal?p.jsx(us,{present:r||s.open,children:p.jsx(AJ,{...i,ref:e})}):null});C6.displayName=pm;var AJ=T.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=ds(pm,t);return p.jsx(ay,{as:Nl,allowPinchZoom:!0,shards:[i.contentRef],children:p.jsx(ht.div,{"data-state":sC(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Fl="DialogContent",E6=T.forwardRef((n,e)=>{const t=w6(Fl,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=ds(Fl,n.__scopeDialog);return p.jsx(us,{present:r||s.open,children:s.modal?p.jsx(kJ,{...i,ref:e}):p.jsx(jJ,{...i,ref:e})})});E6.displayName=Fl;var kJ=T.forwardRef((n,e)=>{const t=ds(Fl,n.__scopeDialog),r=T.useRef(null),i=zt(e,t.contentRef,r);return T.useEffect(()=>{const s=r.current;if(s)return B_(s)},[]),p.jsx(P6,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(n.onCloseAutoFocus,s=>{var a;s.preventDefault(),(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Me(n.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&s.preventDefault()}),onFocusOutside:Me(n.onFocusOutside,s=>s.preventDefault())})}),jJ=T.forwardRef((n,e)=>{const t=ds(Fl,n.__scopeDialog),r=T.useRef(!1),i=T.useRef(!1);return p.jsx(P6,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var a,l;(a=n.onCloseAutoFocus)==null||a.call(n,s),s.defaultPrevented||(r.current||(l=t.triggerRef.current)==null||l.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var u,d;(u=n.onInteractOutside)==null||u.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const a=s.target;((d=t.triggerRef.current)==null?void 0:d.contains(a))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),P6=T.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...a}=n,l=ds(Fl,t),u=T.useRef(null),d=zt(e,u);return I_(),p.jsxs(p.Fragment,{children:[p.jsx(ey,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:p.jsx(nf,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":sC(l.open),...a,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),p.jsxs(p.Fragment,{children:[p.jsx(DJ,{titleId:l.titleId}),p.jsx(LJ,{contentRef:u,descriptionId:l.descriptionId})]})]})}),iC="DialogTitle",T6=T.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=ds(iC,t);return p.jsx(ht.h2,{id:i.titleId,...r,ref:e})});T6.displayName=iC;var I6="DialogDescription",OJ=T.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=ds(I6,t);return p.jsx(ht.p,{id:i.descriptionId,...r,ref:e})});OJ.displayName=I6;var M6="DialogClose",A6=T.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=ds(M6,t);return p.jsx(ht.button,{type:"button",...r,ref:e,onClick:Me(n.onClick,()=>i.onOpenChange(!1))})});A6.displayName=M6;function sC(n){return n?"open":"closed"}var k6="DialogTitleWarning",[oce,j6]=mX(k6,{contentName:Fl,titleName:iC,docsSlug:"dialog"}),DJ=({titleId:n})=>{const e=j6(k6),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return T.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},RJ="DialogDescriptionWarning",LJ=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${j6(RJ).contentName}}.`;return T.useEffect(()=>{var s;const i=(s=n.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},NJ=b6,zJ=_6,FJ=C6,BJ=E6,UJ=T6;const Bs=T.memo(function({small:e,invertIcon:t,icon:r,color:i,className:s,...a}){const l=tC(),u=l.icons[r]??l.icons["question-mark-circle"],d=T.useRef(null);return T.useLayoutEffect(()=>{u||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),d!=null&&d.current&&(d.current.style.webkitMask=`url(${u}) center 100% / 100% no-repeat`)},[d,u,r]),r==="none"?p.jsx("div",{className:Oe("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s)}):p.jsx("div",{...a,ref:d,className:Oe("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${u}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function tt({icon:n,small:e,invertIcon:t}){return p.jsx(Bs,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}function dy({className:n,children:e}){return p.jsx("div",{className:Oe("tlui-dialog__header",n),children:e})}function hy({className:n,children:e,style:t}){return p.jsx(UJ,{dir:"ltr",className:Oe("tlui-dialog__header__title",n),style:t,children:e})}function fy(){return p.jsx("div",{className:"tlui-dialog__header__close",children:p.jsx(A6,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:p.jsx(Le,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:p.jsx(tt,{small:!0,icon:"cross-2"})})})})}function kh({className:n,children:e,style:t}){return p.jsx("div",{className:Oe("tlui-dialog__body",n),style:t,children:e})}function oC({className:n,children:e}){return p.jsx("div",{className:Oe("tlui-dialog__footer",n),children:e})}const py=T.forwardRef(function({className:e,label:t,icon:r,iconLeft:i,autoSelect:s=!1,autoFocus:a=!1,defaultValue:l,placeholder:u,onComplete:d,onValueChange:f,onCancel:g,onFocus:m,onBlur:S,shouldManuallyMaintainScrollPositionWhenFocused:b=!1,children:x,value:w,"data-testid":_},E){const M=Ha(),I=T.useRef(null);T.useImperativeHandle(E,()=>I.current);const A=ot(),j=T.useRef(l??""),D=T.useRef(l??""),[R,q]=T.useState(!1),L=T.useCallback(U=>{q(!0);const Y=U.currentTarget;D.current=Y.value,M?M.timers.requestAnimationFrame(()=>{s&&Y.select()}):ww.requestAnimationFrame("anon",()=>{s&&Y.select()}),m==null||m()},[s,M,m]),K=T.useCallback(U=>{const Y=U.currentTarget.value;D.current=Y,f==null||f(Y)},[f]),G=T.useCallback(U=>{switch(U.key){case"Enter":{U.currentTarget.blur(),dn(U),d==null||d(U.currentTarget.value);break}case"Escape":{U.currentTarget.value=j.current,g==null||g(U.currentTarget.value),U.currentTarget.blur(),dn(U);break}}},[d,g]),z=T.useCallback(U=>{q(!1);const Y=U.currentTarget.value;S==null||S(Y)},[S]);return T.useEffect(()=>{if(!kt.isIos)return;const U=window.visualViewport;if(R&&b&&U){const Y=()=>{var H;(H=I.current)==null||H.scrollIntoView({block:"center"})};return U.addEventListener("resize",Y),U.addEventListener("scroll",Y),M?M.timers.requestAnimationFrame(()=>{var H;(H=I.current)==null||H.scrollIntoView({block:"center"})}):ww.requestAnimationFrame("anon",()=>{var H;(H=I.current)==null||H.scrollIntoView({block:"center"})}),()=>{U.removeEventListener("resize",Y),U.removeEventListener("scroll",Y)}}},[R,M,b]),p.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[x,t&&p.jsx("label",{children:A(t)}),i&&p.jsx(Bs,{icon:i,className:"tlui-icon-left",small:!0}),p.jsx("input",{ref:I,className:Oe("tlui-input",e),type:"text",defaultValue:l,onKeyDownCapture:G,onChange:K,onFocus:L,onBlur:z,autoFocus:a,placeholder:u,value:w,"data-testid":_}),r&&p.jsx(Bs,{icon:r,small:!!t})]})});function Sk(n){return ri.isValid(n)?{isValid:!0,hasProtocol:!0}:ri.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const $J=Bn(function({onClose:e}){const r=te().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?p.jsx(HJ,{onClose:e,selectedShape:r}):null}),HJ=Bn(function({onClose:e,selectedShape:t}){const r=te(),i=ot(),s=T.useRef(null);T.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var b;return(b=s.current)==null?void 0:b.focus()})},[r]);const a=T.useRef(t.props.url),[l,u]=T.useState(()=>{const b=Sk(t.props.url),x=b.isValid===!0?b.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:x,safe:x,valid:!0}}),d=T.useCallback(b=>{const x=b.replace(/https?:\/\/(https?:\/\/)/,(E,M)=>M),w=Sk(x),_=w.isValid===!0?w.hasProtocol?x:"https://"+x:"https://";u({actual:x,safe:_,valid:w.isValid})},[]),f=T.useCallback(()=>{const b=r.getOnlySelectedShape();b&&(r.updateShapes([{id:b.id,type:b.type,props:{url:""}}]),e())},[r,e]),g=T.useCallback(()=>{const b=r.getOnlySelectedShape();b&&(b&&"url"in b.props&&b.props.url!==l.safe&&r.updateShapes([{id:b.id,type:b.type,props:{url:l.safe}}]),e())},[r,e,l]),m=T.useCallback(()=>{e()},[e]);if(!t)return e(),null;const S=a.current&&!l.valid;return p.jsxs(p.Fragment,{children:[p.jsxs(dy,{children:[p.jsx(hy,{children:i("edit-link-dialog.title")}),p.jsx(fy,{})]}),p.jsx(kh,{children:p.jsxs("div",{className:"tlui-edit-link-dialog",children:[p.jsx(py,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:l.actual,onValueChange:d,onComplete:g,onCancel:m}),p.jsx("div",{children:l.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),p.jsxs(oC,{className:"tlui-dialog__footer__actions",children:[p.jsx(Le,{type:"normal",onClick:m,onTouchEnd:m,children:p.jsx(cn,{children:i("edit-link-dialog.cancel")})}),S?p.jsx(Le,{type:"danger",onTouchEnd:f,onClick:f,children:p.jsx(cn,{children:i("edit-link-dialog.clear")})}):p.jsx(Le,{type:"primary",disabled:!l.valid,onTouchEnd:g,onClick:g,children:p.jsx(cn,{children:i("edit-link-dialog.save")})})]})]})});var KJ={};const vk=/(^\/r\/[^/]+\/?$)/,aC=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(vk))return n},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(vk))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/embed?"))return n;if(n.includes("/maps/")){const e=n.match(/@(.*?),(.*?),(.*?)z/);let t;if(e){const[,r,i,s]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${KJ.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${s}`}else t="";return t}},fromEmbedUrl:n=>{const e=Ke(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ke(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ke(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Ke(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ke(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Ke(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ke(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=Ke(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=Ke(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],qJ={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},GJ=aC.map(n=>n.type);function YJ(n){return GJ.includes(n)}function VJ(n){return"icon"in n}function O6(){const n=te();if(n.hasShapeUtil("embed"))return n.getShapeUtil("embed")}function lC(){const n=O6();return e=>n?n.getEmbedDefinition(e):void 0}function XJ(){const n=O6();return n?n.getEmbedDefinitions():[]}const D6=Bn(function({onClose:e}){const t=te(),r=ot(),i=tC(),[s,a]=T.useState(null),[l,u]=T.useState(""),[d,f]=T.useState(null),[g,m]=T.useState(!1),S=T.useRef(-1),b=XJ(),x=lC();return p.jsxs(p.Fragment,{children:[p.jsxs(dy,{children:[p.jsx(hy,{children:s?`${r("embed-dialog.title")}  ${s.title}`:r("embed-dialog.title")}),p.jsx(fy,{})]}),s?p.jsxs(p.Fragment,{children:[p.jsxs(kh,{className:"tlui-embed-dialog__enter",children:[p.jsx(py,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:w=>{u(w);const _=x(w);f(_&&_.definition.type===s.type?_:null),m(!1),clearTimeout(S.current),S.current=t.timers.setTimeout(()=>m(!_),320)}}),l===""?p.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[p.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&p.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",p.jsx(Bs,{icon:"external-link",small:!0})]})]}):p.jsx("div",{className:"tlui-embed-dialog__warning",children:g?r("embed-dialog.invalid-url"):""})]}),p.jsxs(oC,{className:"tlui-dialog__footer__actions",children:[p.jsx(Le,{type:"normal",onClick:()=>{a(null),f(null),u("")},children:p.jsx(cn,{children:r("embed-dialog.back")})}),p.jsx("div",{className:"tlui-embed__spacer"}),p.jsx(Le,{type:"normal",onClick:e,children:p.jsx(cn,{children:r("embed-dialog.cancel")})}),p.jsx(Le,{type:"primary",disabled:!d,onClick:()=>{d&&(t.putExternalContent({type:"embed",url:l,point:t.getViewportPageBounds().center,embed:d.definition}),e())},children:p.jsx(cn,{children:r("embed-dialog.create")})})]})]}):p.jsx(p.Fragment,{children:p.jsx(kh,{className:"tlui-embed-dialog__list",children:b.map(w=>{const _=YJ(w.type)?i.embedIcons[w.type]:VJ(w)?w.icon:void 0;return p.jsxs(Le,{type:"menu",onClick:()=>a(w),children:[p.jsx(cn,{children:w.title}),_&&p.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${_})`}})]},w.type)})})})]})});async function WJ(n,e,t){const r=Ye(e.map(l=>{const u=n.getShape(l);if(!(!u||n.getShapeUtil(u.type).toSvg===void 0))return u}));if(r.length===0)return;if(r.length===1){const l=r[0];if(!l||n.isShapeOfType(l,"image"))return}const i=[];if(t!==void 0){const l=r.map(u=>({shape:u,bounds:n.getShapeMaskedPageBounds(u).clone().expandBy(t)}));for(let u=0;u<l.length;u++){const d=l[u];if(u===0){i[0]={shapes:[d.shape],bounds:d.bounds};continue}let f=!1;for(const g of i)if(g.bounds.includes(d.bounds)){g.shapes.push(d.shape),g.bounds.expand(d.bounds),f=!0;break}f||i.push({shapes:[d.shape],bounds:d.bounds})}}else{const l=be.Common(r.map(u=>n.getShapeMaskedPageBounds(u)));i.push({shapes:r,bounds:l})}const s=n.options.flattenImageBoundsPadding;for(const l of i){t!==void 0&&l.bounds.expandBy(-t);const u=await n.getSvgString(l.shapes,{padding:s});if(!(u!=null&&u.svg))continue;const d=await n.getAssetForExternalContent({type:"file",file:new File([u.svg],"asset.svg",{type:"image/svg+xml"})});d&&(l.asset=d)}const a=[];return Os(()=>{for(const l of i){const{asset:u,bounds:d,shapes:f}=l;if(!u)continue;const g=n.findCommonAncestor(f)??n.getCurrentPageId();if(!g)continue;let m="a1";for(const _ of f)if(_.parentId===g){_.index>m&&(m=_.index);break}let S,b,x;if(kr(g)){const _=n.getShape(g);if(!_)continue;const E=n.getPointInShapeSpace(_,{x:d.x,y:d.y});x=n.getShapePageTransform(g).rotation(),E.sub(new P(s,s).rot(-x)),S=E.x,b=E.y}else S=d.x-s,b=d.y-s,x=0;n.deleteShapes(f),n.createAssets([{...u,id:u.id}]);const w=Mt();n.createShape({id:w,type:"image",index:m,parentId:g,x:S,y:b,rotation:-x,props:{assetId:u.id,w:d.w+s*2,h:d.h+s*2}}),a.push(w)}}),a}function gy(){const n=Ha();return(n==null?void 0:n.store.props.collaboration)!==void 0}function ZJ(){const n=Ha();return oe("sync status",()=>{var e;return(e=n==null?void 0:n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}const Sx=[0,389,436,476,580,640,840,1023];var sn=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(sn||{});const R6=ct.createContext(null);function QJ({forceMobile:n=!1,children:e}){const t=Ha(),r=oe("breakpoint",()=>{const{width:i}=(t==null?void 0:t.getViewportScreenBounds())??{width:window.innerWidth},s=n?sn.MOBILE_SM:Sx.length-1;for(let a=0;a<s;a++)if(i>Sx[a]&&i<=Sx[a+1])return a;return s},[t]);return p.jsx(R6.Provider,{value:r,children:e})}function mr(){const n=T.useContext(R6);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}const Nw=T.createContext(null);function JJ({context:n,children:e}){const t=T.useContext(Nw),r=$n(),i=F1("dialogs",[]),s=T.useMemo(()=>({dialogs:i,addDialog(a){const l=a.id??Ct();return i.update(u=>[...u.filter(d=>d.id!==a.id),{...a,id:l}]),r("open-menu",{source:"dialog",id:l}),Ji.addOpenMenu(l,n),l},removeDialog(a){var u;const l=i.get().find(d=>d.id===a);return l&&((u=l.onClose)==null||u.call(l),r("close-menu",{source:"dialog",id:a}),Ji.deleteOpenMenu(a,n),i.update(d=>d.filter(f=>f!==l))),a},clearDialogs(){const a=i.get();a.length!==0&&(a.forEach(l=>{var u;(u=l.onClose)==null||u.call(l),r("close-menu",{source:"dialog",id:l.id}),Ji.deleteOpenMenu(l.id,n)}),i.set([]))}}),[r,i,n]);return t?p.jsx(p.Fragment,{children:e}):p.jsx(Nw.Provider,{value:s,children:e})}function cf(){const n=T.useContext(Nw);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}var eee="VisuallyHidden",cC=T.forwardRef((n,e)=>p.jsx(ht.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));cC.displayName=eee;var uC="ToastProvider",[dC,tee,nee]=Jm("Toast"),[L6,ace]=qs("Toast",[nee]),[ree,my]=L6(uC),N6=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:a}=n,[l,u]=T.useState(null),[d,f]=T.useState(0),g=T.useRef(!1),m=T.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${uC}\`. Expected non-empty \`string\`.`),p.jsx(dC.Provider,{scope:e,children:p.jsx(ree,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:d,viewport:l,onViewportChange:u,onToastAdd:T.useCallback(()=>f(S=>S+1),[]),onToastRemove:T.useCallback(()=>f(S=>S-1),[]),isFocusedToastEscapeKeyDownRef:g,isClosePausedRef:m,children:a})})};N6.displayName=uC;var z6="ToastViewport",iee=["F8"],zw="toast.viewportPause",Fw="toast.viewportResume",F6=T.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=iee,label:i="Notifications ({hotkey})",...s}=n,a=my(z6,t),l=tee(t),u=T.useRef(null),d=T.useRef(null),f=T.useRef(null),g=T.useRef(null),m=zt(e,g,a.onViewportChange),S=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),b=a.toastCount>0;T.useEffect(()=>{const w=_=>{var M;r.length!==0&&r.every(I=>_[I]||_.code===I)&&((M=g.current)==null||M.focus())};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[r]),T.useEffect(()=>{const w=u.current,_=g.current;if(b&&w&&_){const E=()=>{if(!a.isClosePausedRef.current){const j=new CustomEvent(zw);_.dispatchEvent(j),a.isClosePausedRef.current=!0}},M=()=>{if(a.isClosePausedRef.current){const j=new CustomEvent(Fw);_.dispatchEvent(j),a.isClosePausedRef.current=!1}},I=j=>{!w.contains(j.relatedTarget)&&M()},A=()=>{w.contains(document.activeElement)||M()};return w.addEventListener("focusin",E),w.addEventListener("focusout",I),w.addEventListener("pointermove",E),w.addEventListener("pointerleave",A),window.addEventListener("blur",E),window.addEventListener("focus",M),()=>{w.removeEventListener("focusin",E),w.removeEventListener("focusout",I),w.removeEventListener("pointermove",E),w.removeEventListener("pointerleave",A),window.removeEventListener("blur",E),window.removeEventListener("focus",M)}}},[b,a.isClosePausedRef]);const x=T.useCallback(({tabbingDirection:w})=>{const E=l().map(M=>{const I=M.ref.current,A=[I,...yee(I)];return w==="forwards"?A:A.reverse()});return(w==="forwards"?E.reverse():E).flat()},[l]);return T.useEffect(()=>{const w=g.current;if(w){const _=E=>{var A,j,D;const M=E.altKey||E.ctrlKey||E.metaKey;if(E.key==="Tab"&&!M){const R=document.activeElement,q=E.shiftKey;if(E.target===w&&q){(A=d.current)==null||A.focus();return}const G=x({tabbingDirection:q?"backwards":"forwards"}),z=G.findIndex(U=>U===R);vx(G.slice(z+1))?E.preventDefault():q?(j=d.current)==null||j.focus():(D=f.current)==null||D.focus()}};return w.addEventListener("keydown",_),()=>w.removeEventListener("keydown",_)}},[l,x]),p.jsxs(jX,{ref:u,role:"region","aria-label":i.replace("{hotkey}",S),tabIndex:-1,style:{pointerEvents:b?void 0:"none"},children:[b&&p.jsx(Bw,{ref:d,onFocusFromOutsideViewport:()=>{const w=x({tabbingDirection:"forwards"});vx(w)}}),p.jsx(dC.Slot,{scope:t,children:p.jsx(ht.ol,{tabIndex:-1,...s,ref:m})}),b&&p.jsx(Bw,{ref:f,onFocusFromOutsideViewport:()=>{const w=x({tabbingDirection:"backwards"});vx(w)}})]})});F6.displayName=z6;var B6="ToastFocusProxy",Bw=T.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,s=my(B6,t);return p.jsx(cC,{"aria-hidden":!0,tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:a=>{var d;const l=a.relatedTarget;!((d=s.viewport)!=null&&d.contains(l))&&r()}})});Bw.displayName=B6;var yy="Toast",see="toast.swipeStart",oee="toast.swipeMove",aee="toast.swipeCancel",lee="toast.swipeEnd",U6=T.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:s,...a}=n,[l=!0,u]=Ga({prop:r,defaultProp:i,onChange:s});return p.jsx(us,{present:t||l,children:p.jsx(dee,{open:l,...a,ref:e,onClose:()=>u(!1),onPause:Fn(n.onPause),onResume:Fn(n.onResume),onSwipeStart:Me(n.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Me(n.onSwipeMove,d=>{const{x:f,y:g}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${f}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${g}px`)}),onSwipeCancel:Me(n.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Me(n.onSwipeEnd,d=>{const{x:f,y:g}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${f}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${g}px`),u(!1)})})})});U6.displayName=yy;var[cee,uee]=L6(yy,{onClose(){}}),dee=T.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:s,onClose:a,onEscapeKeyDown:l,onPause:u,onResume:d,onSwipeStart:f,onSwipeMove:g,onSwipeCancel:m,onSwipeEnd:S,...b}=n,x=my(yy,t),[w,_]=T.useState(null),E=zt(e,U=>_(U)),M=T.useRef(null),I=T.useRef(null),A=i||x.duration,j=T.useRef(0),D=T.useRef(A),R=T.useRef(0),{onToastAdd:q,onToastRemove:L}=x,K=Fn(()=>{var Y;(w==null?void 0:w.contains(document.activeElement))&&((Y=x.viewport)==null||Y.focus()),a()}),G=T.useCallback(U=>{!U||U===1/0||(window.clearTimeout(R.current),j.current=new Date().getTime(),R.current=window.setTimeout(K,U))},[K]);T.useEffect(()=>{const U=x.viewport;if(U){const Y=()=>{G(D.current),d==null||d()},H=()=>{const X=new Date().getTime()-j.current;D.current=D.current-X,window.clearTimeout(R.current),u==null||u()};return U.addEventListener(zw,H),U.addEventListener(Fw,Y),()=>{U.removeEventListener(zw,H),U.removeEventListener(Fw,Y)}}},[x.viewport,A,u,d,G]),T.useEffect(()=>{s&&!x.isClosePausedRef.current&&G(A)},[s,A,x.isClosePausedRef,G]),T.useEffect(()=>(q(),()=>L()),[q,L]);const z=T.useMemo(()=>w?V6(w):null,[w]);return x.viewport?p.jsxs(p.Fragment,{children:[z&&p.jsx(hee,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:z}),p.jsx(cee,{scope:t,onClose:K,children:Pu.createPortal(p.jsx(dC.ItemSlot,{scope:t,children:p.jsx(kX,{asChild:!0,onEscapeKeyDown:Me(l,()=>{x.isFocusedToastEscapeKeyDownRef.current||K(),x.isFocusedToastEscapeKeyDownRef.current=!1}),children:p.jsx(ht.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":x.swipeDirection,...b,ref:E,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:Me(n.onKeyDown,U=>{U.key==="Escape"&&(l==null||l(U.nativeEvent),U.nativeEvent.defaultPrevented||(x.isFocusedToastEscapeKeyDownRef.current=!0,K()))}),onPointerDown:Me(n.onPointerDown,U=>{U.button===0&&(M.current={x:U.clientX,y:U.clientY})}),onPointerMove:Me(n.onPointerMove,U=>{if(!M.current)return;const Y=U.clientX-M.current.x,H=U.clientY-M.current.y,X=!!I.current,V=["left","right"].includes(x.swipeDirection),ie=["left","up"].includes(x.swipeDirection)?Math.min:Math.max,B=V?ie(0,Y):0,re=V?0:ie(0,H),me=U.pointerType==="touch"?10:2,de={x:B,y:re},ye={originalEvent:U,delta:de};X?(I.current=de,Kp(oee,g,ye,{discrete:!1})):bk(de,x.swipeDirection,me)?(I.current=de,Kp(see,f,ye,{discrete:!1}),U.target.setPointerCapture(U.pointerId)):(Math.abs(Y)>me||Math.abs(H)>me)&&(M.current=null)}),onPointerUp:Me(n.onPointerUp,U=>{const Y=I.current,H=U.target;if(H.hasPointerCapture(U.pointerId)&&H.releasePointerCapture(U.pointerId),I.current=null,M.current=null,Y){const X=U.currentTarget,V={originalEvent:U,delta:Y};bk(Y,x.swipeDirection,x.swipeThreshold)?Kp(lee,S,V,{discrete:!0}):Kp(aee,m,V,{discrete:!0}),X.addEventListener("click",ie=>ie.preventDefault(),{once:!0})}})})})}),x.viewport)})]}):null}),hee=n=>{const{__scopeToast:e,children:t,...r}=n,i=my(yy,e),[s,a]=T.useState(!1),[l,u]=T.useState(!1);return gee(()=>a(!0)),T.useEffect(()=>{const d=window.setTimeout(()=>u(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:p.jsx(sf,{asChild:!0,children:p.jsx(cC,{...r,children:s&&p.jsxs(p.Fragment,{children:[i.label," ",t]})})})},fee="ToastTitle",$6=T.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(ht.div,{...r,ref:e})});$6.displayName=fee;var pee="ToastDescription",H6=T.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(ht.div,{...r,ref:e})});H6.displayName=pee;var K6="ToastAction",q6=T.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?p.jsx(Y6,{altText:t,asChild:!0,children:p.jsx(hC,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${K6}\`. Expected non-empty \`string\`.`),null)});q6.displayName=K6;var G6="ToastClose",hC=T.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=uee(G6,t);return p.jsx(Y6,{asChild:!0,children:p.jsx(ht.button,{type:"button",...r,ref:e,onClick:Me(n.onClick,i.onClose)})})});hC.displayName=G6;var Y6=T.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return p.jsx(ht.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function V6(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),mee(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const a=r.dataset.radixToastAnnounceAlt;a&&e.push(a)}else e.push(...V6(r))}}),e}function Kp(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,s=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?P_(i,s):i.dispatchEvent(s)}var bk=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),s=r>i;return e==="left"||e==="right"?s&&r>t:!s&&i>t};function gee(n=()=>{}){const e=Fn(n);Da(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function mee(n){return n.nodeType===n.ELEMENT_NODE}function yee(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function vx(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var See=U6,vee=$6,bee=H6,xee=q6,xk=hC;const Uw=T.createContext(null);function wee({children:n}){const e=F1("toasts",[]),t=T.useContext(Uw),r=T.useMemo(()=>({toasts:e,addToast(i){const s=i.id??Ct();return e.update(a=>[...a.filter(l=>l.id!==i.id),{...i,id:s}]),s},removeToast(i){return e.update(s=>s.filter(a=>a.id!==i)),i},clearToasts(){e.set([])}}),[e]);return t?p.jsx(p.Fragment,{children:n}):p.jsx(N6,{children:p.jsx(Uw.Provider,{value:r,children:n})})}function Uo(){const n=T.useContext(Uw);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}var bx={exports:{}},wk;function _ee(){return wk||(wk=1,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(u,d){if(!s[u]){s[u]={};for(var f=0;f<u.length;f++)s[u][u.charAt(f)]=f}return s[u][d]}var l={compressToBase64:function(u){if(u==null)return"";var d=l._compress(u,6,function(f){return r.charAt(f)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(u){return u==null?"":u==""?null:l._decompress(u.length,32,function(d){return a(r,u.charAt(d))})},compressToUTF16:function(u){return u==null?"":l._compress(u,15,function(d){return t(d+32)})+" "},decompressFromUTF16:function(u){return u==null?"":u==""?null:l._decompress(u.length,16384,function(d){return u.charCodeAt(d)-32})},compressToUint8Array:function(u){for(var d=l.compress(u),f=new Uint8Array(d.length*2),g=0,m=d.length;g<m;g++){var S=d.charCodeAt(g);f[g*2]=S>>>8,f[g*2+1]=S%256}return f},decompressFromUint8Array:function(u){if(u==null)return l.decompress(u);for(var d=new Array(u.length/2),f=0,g=d.length;f<g;f++)d[f]=u[f*2]*256+u[f*2+1];var m=[];return d.forEach(function(S){m.push(t(S))}),l.decompress(m.join(""))},compressToEncodedURIComponent:function(u){return u==null?"":l._compress(u,6,function(d){return i.charAt(d)})},decompressFromEncodedURIComponent:function(u){return u==null?"":u==""?null:(u=u.replace(/ /g,"+"),l._decompress(u.length,32,function(d){return a(i,u.charAt(d))}))},compress:function(u){return l._compress(u,16,function(d){return t(d)})},_compress:function(u,d,f){if(u==null)return"";var g,m,S={},b={},x="",w="",_="",E=2,M=3,I=2,A=[],j=0,D=0,R;for(R=0;R<u.length;R+=1)if(x=u.charAt(R),Object.prototype.hasOwnProperty.call(S,x)||(S[x]=M++,b[x]=!0),w=_+x,Object.prototype.hasOwnProperty.call(S,w))_=w;else{if(Object.prototype.hasOwnProperty.call(b,_)){if(_.charCodeAt(0)<256){for(g=0;g<I;g++)j=j<<1,D==d-1?(D=0,A.push(f(j)),j=0):D++;for(m=_.charCodeAt(0),g=0;g<8;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1}else{for(m=1,g=0;g<I;g++)j=j<<1|m,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=0;for(m=_.charCodeAt(0),g=0;g<16;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1}E--,E==0&&(E=Math.pow(2,I),I++),delete b[_]}else for(m=S[_],g=0;g<I;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1;E--,E==0&&(E=Math.pow(2,I),I++),S[w]=M++,_=String(x)}if(_!==""){if(Object.prototype.hasOwnProperty.call(b,_)){if(_.charCodeAt(0)<256){for(g=0;g<I;g++)j=j<<1,D==d-1?(D=0,A.push(f(j)),j=0):D++;for(m=_.charCodeAt(0),g=0;g<8;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1}else{for(m=1,g=0;g<I;g++)j=j<<1|m,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=0;for(m=_.charCodeAt(0),g=0;g<16;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1}E--,E==0&&(E=Math.pow(2,I),I++),delete b[_]}else for(m=S[_],g=0;g<I;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1;E--,E==0&&(E=Math.pow(2,I),I++)}for(m=2,g=0;g<I;g++)j=j<<1|m&1,D==d-1?(D=0,A.push(f(j)),j=0):D++,m=m>>1;for(;;)if(j=j<<1,D==d-1){A.push(f(j));break}else D++;return A.join("")},decompress:function(u){return u==null?"":u==""?null:l._decompress(u.length,32768,function(d){return u.charCodeAt(d)})},_decompress:function(u,d,f){var g=[],m=4,S=4,b=3,x="",w=[],_,E,M,I,A,j,D,R={val:f(0),position:d,index:1};for(_=0;_<3;_+=1)g[_]=_;for(M=0,A=Math.pow(2,2),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;switch(M){case 0:for(M=0,A=Math.pow(2,8),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;D=t(M);break;case 1:for(M=0,A=Math.pow(2,16),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;D=t(M);break;case 2:return""}for(g[3]=D,E=D,w.push(D);;){if(R.index>u)return"";for(M=0,A=Math.pow(2,b),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;switch(D=M){case 0:for(M=0,A=Math.pow(2,8),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;g[S++]=t(M),D=S-1,m--;break;case 1:for(M=0,A=Math.pow(2,16),j=1;j!=A;)I=R.val&R.position,R.position>>=1,R.position==0&&(R.position=d,R.val=f(R.index++)),M|=(I>0?1:0)*j,j<<=1;g[S++]=t(M),D=S-1,m--;break;case 2:return w.join("")}if(m==0&&(m=Math.pow(2,b),b++),g[D])x=g[D];else if(D===S)x=E+E.charAt(0);else return null;w.push(x),g[S++]=E+x.charAt(0),m--,E=x,m==0&&(m=Math.pow(2,b),b++)}}};return l}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(bx)),bx.exports}var Cee=_ee();const X6=za(Cee),fC="web image/vnd.tldraw+png",Eee={"image/png":fC},Pee={[fC]:"image/png"};function Tee(n){return tr(Eee,n)??null}function Iee(n){return tr(Pee,n)??n}function Mee(n){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(n)}function Aee(n){const e=Object.entries(n);for(const[t,r]of e)r.catch(i=>console.error(i));return navigator.clipboard.write([new ClipboardItem(n)]).catch(t=>(console.error(t),Promise.all(e.map(async([r,i])=>[r,await i])).then(r=>{const i=b1(r);return navigator.clipboard.write([new ClipboardItem(i)])})))}async function kee(n,e,t,r){const i=e.map(s=>s instanceof File?s:new File([s],"tldrawFile",{type:s.type}));n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"files",files:i,point:t,ignoreParent:!1,sources:r})}async function $w(n,e,t,r){return n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const jee=[fC,"image/png","image/jpeg","image/webp","image/svg+xml"];function Oee(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const Dee=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Ree=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return UD(e)},Lee=n=>/^<svg/.test(n),Nee=["input","select","textarea"];function xx(n){const{activeElement:e}=document;return n.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||Nee.indexOf(e.tagName.toLowerCase())>-1)}const qp=(n,e,t,r)=>{const i=Ree(e);if(i)for(const s of i)$w(n,s,t);else Dee(e)?$w(n,e,t):Lee(e)?(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},zee=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(s=>i.getAsString(s))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(s=>i.getAsString(s))}):r.push({type:i.type,source:new Promise(s=>i.getAsString(s))});break}}Z6(n,r,t)},W6=async({editor:n,clipboardItems:e,point:t,fallbackFiles:r})=>{const i=[];for(const s of e){for(const a of jee)if(s.types.includes(a)){const l=s.getType(a).then(u=>ts.rewriteMimeType(u,Iee(a)));i.push({type:"blob",source:l});break}s.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const a=await s.getType("text/html");return await ts.blobToText(a)})()}),s.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const a=await s.getType("text/uri-list");return await ts.blobToText(a)})()}),s.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const a=await s.getType("text/plain");return await ts.blobToText(a)})()})}return r!=null&&r.length&&i.length===1&&i[0].type==="text"&&(i.pop(),i.push(...r.map(s=>({type:"file",source:Promise.resolve(s)})))),await Z6(n,i,t)};async function Z6(n,e,t){const r=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){if(r.length>n.options.maxFilesAtOnce)throw Error("Too many files");const s=Ye(await Promise.all(r.map(a=>a.source)));return await kee(n,s,t)}const i=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(a=>{const l=s;if(l.type==="file"){a({type:"error",data:null,reason:"unexpected file"});return}l.source.then(u=>{var f;const d=(f=u.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:f[1];if(d)try{const g=X6.decompressFromBase64(d);if(g===null){a({type:"error",data:g,reason:"found tldraw data comment but could not parse base64"});return}else{const m=JSON.parse(g);if(m.type!=="application/tldraw"&&a({type:"error",data:m,reason:`found tldraw data comment but JSON was of a different type: ${m.type}`}),typeof m.data=="string"){a({type:"error",data:m,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}a({type:"tldraw",data:m.data});return}}catch{a({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(l.type==="html"){a({type:"text",data:u,subtype:"html"});return}if(l.type==="url"){a({type:"text",data:u,subtype:"url"});return}try{const g=JSON.parse(u);if(g.type==="excalidraw/clipboard"){a({type:"excalidraw",data:g});return}else{a({type:"text",data:u,subtype:"json"});return}}catch{a({type:"text",data:u,subtype:"text"});return}}a({type:"error",data:u,reason:"unhandled case"})})})));for(const s of i)if(s.type==="tldraw"){n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"tldraw",content:s.data,point:t});return}for(const s of i)if(s.type==="excalidraw"){n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"excalidraw",content:s.data,point:t});return}for(const s of i){if(s.type==="text"&&s.subtype==="html"){const l=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(l&&Array.from(l.children).filter(d=>d.nodeType===1).length===1&&l.firstElementChild&&l.firstElementChild.tagName==="A"&&l.firstElementChild.hasAttribute("href")&&l.firstElementChild.getAttribute("href")!==""){const d=l.firstElementChild.getAttribute("href");qp(n,d,t,i);return}if(!i.some(d=>d.type==="text"&&d.subtype!=="html")&&s.data.trim()){qp(n,Oee(s.data),t,i);return}}if(s.type==="text"&&s.subtype==="text"&&s.data.startsWith("<iframe ")){const l=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(l&&Array.from(l.children).filter(d=>d.nodeType===1).length===1&&l.firstElementChild&&l.firstElementChild.tagName==="IFRAME"&&l.firstElementChild.hasAttribute("src")&&l.firstElementChild.getAttribute("src")!==""){const d=l.firstElementChild.getAttribute("src");qp(n,d,t,i);return}}}for(const s of i)if(s.type==="text"&&s.subtype==="url"){$w(n,s.data,t,i);return}for(const s of i)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){qp(n,s.data,t,i);return}}const gm=async n=>{var r;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=X6.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(s=>n.getShapeUtil(s).getText(s)).filter(qF);if((r=navigator.clipboard)!=null&&r.write){const s=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let a=i.join(" ");a===""&&(a=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([a],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function Fee(){const n=te(),e=$n(),t=T.useCallback(async function(a){n.getSelectedShapeIds().length!==0&&(await gm(n),e("copy",{source:a}))},[n,e]),r=T.useCallback(async function(a){n.getSelectedShapeIds().length!==0&&(await gm(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:a}))},[n,e]),i=T.useCallback(async function(a,l,u){n.getEditingShapeId()===null&&(Array.isArray(a)&&a[0]instanceof ClipboardItem?(W6({editor:n,clipboardItems:a,point:u}),e("paste",{source:"menu"})):navigator.clipboard.read().then(d=>{i(d,l,u)}))},[n,e]);return{copy:t,cut:r,paste:i}}function Bee(){const n=te(),e=$n(),t=oe("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);T.useEffect(()=>{if(!t)return;const r=async u=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||xx(n)||(Ze(u),await gm(n),e("copy",{source:"kbd"}))};async function i(u){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||xx(n)||(Ze(u),await gm(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let s=!1;const a=u=>{u.button===1&&(s=!0,n.timers.requestAnimationFrame(()=>{s=!1}))},l=u=>{var m,S;if(s){dn(u);return}if(n.getEditingShapeId()!==null||xx(n))return;let d,f=!1;n.inputs.shiftKey&&(f=!0),n.user.getIsPasteAtCursorMode()&&(f=!f),f&&(d=n.inputs.currentPagePoint);const g=()=>{u.clipboardData&&zee(n,u.clipboardData,d)};if((m=navigator.clipboard)!=null&&m.read){const b=Array.from(((S=u.clipboardData)==null?void 0:S.files)||[]);navigator.clipboard.read().then(x=>{Array.isArray(x)&&x[0]instanceof ClipboardItem&&W6({editor:n,clipboardItems:x,point:d,fallbackFiles:b})},()=>{g()})}else g();Ze(u),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",l),document.addEventListener("pointerup",a),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",l),document.removeEventListener("pointerup",a)}},[n,e,t])}const Uee={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function $ee(n,e,t={}){const r=e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],i=t.format??"png";return{blobPromise:n.toImage(r,t).then(s=>s.blob),mimeType:Uee[i]}}function Hee(...n){const[e,t,r]=typeof n[2]=="string"?[n[0],n[1],{...n[3],format:n[2]}]:n;if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:i,mimeType:s}=$ee(e,t,r),a={[s]:i},l=Tee(s);return l&&Mee(l)&&(a[l]=i.then(u=>ts.rewriteMimeType(u,l))),Aee(a)}switch(r.format){case"svg":return Kee(async()=>{const i=await e.getSvgString(t,r);if(!i)throw new Error("Failed to copy");return i.svg});case"png":throw new Error("Copy not supported");default:mn(r.format)}}async function Kee(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}function qee(){const n=te(),{addToast:e}=Uo(),t=ot();return T.useCallback((r,i="svg")=>{Hee(n,r,{format:i}).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function Gee(...n){const[e,t,r]=typeof n[2]=="object"?n:[n[0],n[1],{...n[4],format:n[2]??"png",name:n[3]}];let i=r.name;if(!i&&(i=`shapes at ${_k()}`,t.length===1)){const l=e.getShape(t[0]);e.isShapeOfType(l,"frame")?i=l.props.name||"frame":i=`${Lm(l.id)} at ${_k()}`}i+=`.${r.format}`;const{blob:s}=await e.toImage(t,r),a=new File([s],i,{type:s.type});Yee(a)}function _k(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${s}.${a}`}function Yee(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function Vee(){const n=te(),{addToast:e}=Uo(),t=ot();return T.useCallback((r,i="png",s)=>{Gee(n,r,{format:i,name:s,scale:1}).catch(a=>{console.error(a.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}const Q6=ct.createContext([]);function Xee(){const n=te(),e=T.useRef(),t=Ca(ct.useContext(Q6));return T.useEffect(()=>{const r=window.document.createElement("input");r.type="file",r.accept=(t==null?void 0:t.join(","))??xF,r.multiple=!0,e.current=r;async function i(s){const a=s.target.files;!a||a.length===0||(n.markHistoryStoppingPoint("insert media"),await n.putExternalContent({type:"files",files:Array.from(a),point:n.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",i),()=>{e.current=void 0,r.removeEventListener("change",i)}},[n,t]),T.useCallback(()=>{var r;(r=e.current)==null||r.click()},[e])}function Wee(){const n=te(),e=T.useRef(null),t=T.useRef(null);return T.useCallback(async function(){const i=document.createElement("div"),s=document.createElement("style"),a=(_,E)=>{_&&(_.innerHTML=""),E&&document.head.contains(E)&&document.head.removeChild(E),_&&document.body.contains(_)&&document.body.removeChild(_)};a(e.current,t.current),e.current=i,t.current=s;const l=`tl-print-surface-${Ct()}`;i.className=l,s.innerHTML=`
			.${l} {
				display: none;
			}

			.${l} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${l} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${l}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${l}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${l}__item__header {
					display: none;
				}

				.${l}__item__footer {
					display: none;
					text-align: right;
				}

				.${l}__item__footer__hide {
					display: none;
				}

				
			}

		`;const u=()=>{document.head.appendChild(s),document.body.appendChild(i)},d=()=>{n.once("tick",()=>{a(i,s)})};window.addEventListener("beforeprint",u),window.addEventListener("afterprint",d);function f(_,E,M){try{i.innerHTML+=`<div class="${l}__item">
        <div class="${l}__item__header">
          ${_.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${l}__item__main">
          ${M}
        </div>
        <div class="${l}__item__footer ${l}__item__footer__${E?"":"hide"}">
          ${E??""}
        </div>
      </div>`}catch(I){console.error(I)}}function g(){kt.isChromeForIos?(u(),window.print()):kt.isSafari?(u(),document.execCommand("print",!1)):window.print()}const m=n.getSelectedShapeIds(),S=n.getCurrentPageId(),b=n.getPages(),w={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const _=await n.getSvgString(m,w);if(_){const E=b.find(M=>M.id===S);f(`tldraw  ${E==null?void 0:E.name}`,null,_.svg),g()}}else{const _=n.getCurrentPage(),E=await n.getSvgString(n.getSortedChildIdsForParent(_.id),w);E&&(f(`tldraw  ${_.name}`,null,E.svg),g())}window.removeEventListener("beforeprint",u),window.removeEventListener("afterprint",d)},[n])}function pC(){const{addToast:n,removeToast:e,clearToasts:t}=Uo(),{addDialog:r,clearDialogs:i,removeDialog:s}=cf(),a=ot(),l=Xee(),u=Wee(),{cut:d,copy:f,paste:g}=Fee(),m=qee(),S=Vee(),b=lC(),w=mr()<sn.TABLET_SM;return T.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,removeDialog:s,clearDialogs:i,msg:a,isMobile:w,insertMedia:l,printSelectionOrPages:u,cut:d,copy:f,paste:g,copyAs:m,exportAs:S,getEmbedDefinition:b}),[n,e,t,r,s,i,a,w,l,u,d,f,g,m,S,b])}function Zee(n,e){const t={};for(const r of n)if(r.translations)for(const[i,s]of Nr(r.translations)){let a=t[i];a||(a=t[i]={}),Object.assign(a,s)}return{actions:(r,i,s)=>{for(const a of n)a.actions&&(i=a.actions(r,i,s));return i},tools:(r,i,s)=>{for(const a of n)a.tools&&(i=a.tools(r,i,{...e,...s}));return i},translations:t}}function J6(n){return T.useMemo(()=>n,n)}function Qee(n){const e=J6(n==null?[]:Array.isArray(n)?n:[n]);return T.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,s]of Nr(r.translations)){let a=t[i];a||(a=t[i]={}),Object.assign(a,s)}return t},[e])}function Jee(n){const e=pC(),t=J6(n==null?[]:Array.isArray(n)?n:[n]);return T.useMemo(()=>Zee(t,e),[t,e])}const eN=T.createContext(null);function ete(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function Gp(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function tte({overrides:n,children:e}){const t=te(),r=gy(),i=pC(),s=$n(),a=i.msg("document.default-name"),l=T.useMemo(()=>{function u(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function d(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const f=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(m){d()&&(u()||(s("edit-link",{source:m}),t.markHistoryStoppingPoint("edit-link"),i.addDialog({component:$J})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(m){s("insert-embed",{source:m}),i.addDialog({component:D6})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(m){s("insert-media",{source:m}),i.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(m){s("undo",{source:m}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(m){s("redo",{source:m}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(m){let S=t.getSelectedShapeIds();S.length===0&&(S=Array.from(t.getCurrentPageShapeIds().values())),S.length!==0&&(s("export-as",{format:"svg",source:m}),i.exportAs(S,"svg",Gp(t,a)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(m){let S=t.getSelectedShapeIds();S.length===0&&(S=Array.from(t.getCurrentPageShapeIds().values())),S.length!==0&&(s("export-as",{format:"png",source:m}),i.exportAs(S,"png",Gp(t,a)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(m){let S=t.getSelectedShapeIds();S.length===0&&(S=Array.from(t.getCurrentPageShapeIds().values())),S.length!==0&&(s("export-all-as",{format:"svg",source:m}),i.exportAs(Array.from(t.getCurrentPageShapeIds()),"svg",Gp(t,a)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(m){const S=Array.from(t.getCurrentPageShapeIds().values());S.length!==0&&(s("export-all-as",{format:"png",source:m}),i.exportAs(S,"png",Gp(t,a)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(m){let S=t.getSelectedShapeIds();S.length===0&&(S=Array.from(t.getCurrentPageShapeIds().values())),S.length!==0&&(s("copy-as",{format:"svg",source:m}),i.copyAs(S,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(m){let S=t.getSelectedShapeIds();S.length===0&&(S=Array.from(t.getCurrentPageShapeIds().values())),S.length!==0&&(s("copy-as",{format:"png",source:m}),i.copyAs(S,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(m){if(!d()||u())return;s("toggle-auto-size",{source:m}),t.markHistoryStoppingPoint("toggling auto size");const S=t.getSelectedShapes().filter(b=>t.isShapeOfType(b,"text")&&b.props.autoSize===!1);t.updateShapes(S.map(b=>({id:b.id,type:b.type,props:{...b.props,w:8,autoSize:!0}}))),Lt(t,S.map(b=>b.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(m){s("open-embed-link",{source:m});const S=t.getSelectedShapeIds(),b="No embed shapes selected";if(S.length!==1){console.error(b);return}const x=t.getShape(S[0]);if(!x||!t.isShapeOfType(x,"embed")){console.error(b);return}pX(x.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(m){var S,b;if(((S=t.root.getCurrent())==null?void 0:S.id)!=="zoom"&&(s("zoom-tool",{source:m}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const x=t.root.getCurrent();x&&((b=x.getCurrent())==null?void 0:b.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:x.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(m){d()&&(u()||t.run(()=>{s("convert-to-bookmark",{source:m});const S=t.getSelectedShapes(),b=[],x=[];for(const w of S){if(!w||!t.isShapeOfType(w,"embed")||!w.props.url)continue;const _=new P(w.x,w.y);_.rot(-w.rotation),_.add(new P(w.props.w/2-300/2,w.props.h/2-320/2)),_.rot(w.rotation);const E={id:Mt(),type:"bookmark",rotation:w.rotation,x:_.x,y:_.y,opacity:1,props:{url:w.props.url}};b.push(E),x.push(w.id)}t.markHistoryStoppingPoint("convert shapes to bookmark"),t.deleteShapes(x),t.createShapes(b)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(m){d()&&(u()||(s("convert-to-embed",{source:m}),t.run(()=>{const S=t.getSelectedShapeIds(),b=Ye(S.map(_=>t.getShape(_))),x=[],w=[];for(const _ of b){if(!t.isShapeOfType(_,"bookmark"))continue;const{url:E}=_.props,M=i.getEmbedDefinition(E);if(!M||!M.definition)continue;const{width:I,height:A}=M.definition,j=new P(_.x,_.y);j.rot(-_.rotation),j.add(new P(_.props.w/2-I/2,_.props.h/2-A/2)),j.rot(_.rotation);const D={id:Mt(),type:"embed",x:j.x,y:j.y,rotation:_.rotation,props:{url:E,w:I,h:A}};x.push(D),w.push(_.id)}t.markHistoryStoppingPoint("convert shapes to embed"),t.deleteShapes(w),t.createShapes(x)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(m){if(!d()||u())return;s("duplicate-shapes",{source:m});const S=t.getInstanceState();let b,x;if(S.duplicateProps)b=S.duplicateProps.shapeIds,x=S.duplicateProps.offset;else{b=t.getSelectedShapeIds();const w=be.Common(Ye(b.map(_=>t.getShapePageBounds(_))));x=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:w.width+t.options.adjacentShapeMargin,y:0}}t.markHistoryStoppingPoint("duplicate shapes"),t.duplicateShapes(b,x),S.duplicateProps&&t.updateInstanceState({duplicateProps:{...S.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(m){d()&&(u()||(s("ungroup-shapes",{source:m}),t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(m){if(!d()||u())return;s("group-shapes",{source:m});const S=t.getOnlySelectedShape();S&&t.isShapeOfType(S,"group")?(t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.markHistoryStoppingPoint("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(m){if(!d())return;s("remove-frame",{source:m});const S=t.getSelectedShapes();S.length>0&&S.every(b=>t.isShapeOfType(b,"frame"))&&(t.markHistoryStoppingPoint("remove-frame"),bJ(t,S.map(b=>b.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(m){if(!d())return;s("fit-frame-to-content",{source:m});const S=t.getOnlySelectedShape();S&&t.isShapeOfType(S,"frame")&&(t.markHistoryStoppingPoint("fit-frame-to-content"),wJ(t,S.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"left",source:m}),t.markHistoryStoppingPoint("align left");const S=t.getSelectedShapeIds();t.alignShapes(S,"left"),Lt(t,S)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"center-horizontal",source:m}),t.markHistoryStoppingPoint("align center horizontal");const S=t.getSelectedShapeIds();t.alignShapes(S,"center-horizontal"),Lt(t,S)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"right",source:m}),t.markHistoryStoppingPoint("align right");const S=t.getSelectedShapeIds();t.alignShapes(S,"right"),Lt(t,S)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"center-vertical",source:m}),t.markHistoryStoppingPoint("align center vertical");const S=t.getSelectedShapeIds();t.alignShapes(S,"center-vertical"),Lt(t,S)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"top",source:m}),t.markHistoryStoppingPoint("align top");const S=t.getSelectedShapeIds();t.alignShapes(S,"top"),Lt(t,S)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(m){if(!d()||u())return;s("align-shapes",{operation:"bottom",source:m}),t.markHistoryStoppingPoint("align bottom");const S=t.getSelectedShapeIds();t.alignShapes(S,"bottom"),Lt(t,S)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(m){if(!d()||u())return;s("distribute-shapes",{operation:"horizontal",source:m}),t.markHistoryStoppingPoint("distribute horizontal");const S=t.getSelectedShapeIds();t.distributeShapes(S,"horizontal"),Lt(t,S)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(m){if(!d()||u())return;s("distribute-shapes",{operation:"vertical",source:m}),t.markHistoryStoppingPoint("distribute vertical");const S=t.getSelectedShapeIds();t.distributeShapes(S,"vertical"),Lt(t,S)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(m){if(!d()||u())return;s("stretch-shapes",{operation:"horizontal",source:m}),t.markHistoryStoppingPoint("stretch horizontal");const S=t.getSelectedShapeIds();t.stretchShapes(S,"horizontal"),Lt(t,S)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(m){if(!d()||u())return;s("stretch-shapes",{operation:"vertical",source:m}),t.markHistoryStoppingPoint("stretch vertical");const S=t.getSelectedShapeIds();t.stretchShapes(S,"vertical"),Lt(t,S)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(m){if(!d()||u())return;s("flip-shapes",{operation:"horizontal",source:m}),t.markHistoryStoppingPoint("flip horizontal");const S=t.getSelectedShapeIds();t.flipShapes(S,"horizontal"),Lt(t,S)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(m){if(!d()||u())return;s("flip-shapes",{operation:"vertical",source:m}),t.markHistoryStoppingPoint("flip vertical");const S=t.getSelectedShapeIds();t.flipShapes(S,"vertical"),Lt(t,S)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(m){if(!d()||u())return;s("pack-shapes",{source:m}),t.markHistoryStoppingPoint("pack");const S=t.getSelectedShapeIds();t.packShapes(S,t.options.adjacentShapeMargin),Lt(t,S)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(m){if(!d()||u())return;s("stack-shapes",{operation:"vertical",source:m}),t.markHistoryStoppingPoint("stack-vertical");const S=t.getSelectedShapeIds();t.stackShapes(S,"vertical",16),Lt(t,S)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(m){if(!d()||u())return;s("stack-shapes",{operation:"horizontal",source:m}),t.markHistoryStoppingPoint("stack-horizontal");const S=t.getSelectedShapeIds();t.stackShapes(S,"horizontal",16),Lt(t,S)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(m){d()&&(u()||(s("reorder-shapes",{operation:"toFront",source:m}),t.markHistoryStoppingPoint("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(m){d()&&(u()||(s("reorder-shapes",{operation:"forward",source:m}),t.markHistoryStoppingPoint("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(m){d()&&(u()||(s("reorder-shapes",{operation:"backward",source:m}),t.markHistoryStoppingPoint("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(m){d()&&(u()||(s("reorder-shapes",{operation:"toBack",source:m}),t.markHistoryStoppingPoint("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(m){d()&&(u()||(t.markHistoryStoppingPoint("cut"),i.cut(m)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(m){d()&&(u()||i.copy(m))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(m){var S;(S=navigator.clipboard)==null||S.read().then(b=>{i.paste(b,m,m==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{i.addToast({title:i.msg("action.paste-error-title"),description:i.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(m){t.run(()=>{u()||(s("select-all-shapes",{source:m}),t.markHistoryStoppingPoint("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(m){d()&&(u()||(s("select-none-shapes",{source:m}),t.markHistoryStoppingPoint("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(m){d()&&(u()||(s("delete-shapes",{source:m}),t.markHistoryStoppingPoint("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(m){if(!d()||u())return;s("rotate-cw",{source:m}),t.markHistoryStoppingPoint("rotate-cw");const S=t.getSelectionRotation()%(Nt/2),b=Aa(S,0)||Aa(S,Nt/2),x=t.getSelectedShapeIds();t.rotateShapesBy(x,Nt/2-(b?0:S)),Lt(t,x)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(m){if(!d()||u())return;s("rotate-ccw",{source:m}),t.markHistoryStoppingPoint("rotate-ccw");const S=t.getSelectionRotation()%(Nt/2),b=Aa(S,0),x=t.getSelectedShapeIds();t.rotateShapesBy(x,b?-(Nt/2):-S),Lt(t,x)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(m){s("zoom-in",{source:m}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(m){s("zoom-out",{source:m}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(m){s("reset-zoom",{source:m}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(m){s("zoom-to-fit",{source:m}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(m){d()&&(u()||(s("zoom-to-selection",{source:m}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(m){s("toggle-snap-mode",{source:m}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(m){const S=t.user.getIsDarkMode()?"light":"dark";s("color-scheme",{source:m,value:S}),t.user.updateUserPreferences({colorScheme:S})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(m){s("toggle-wrap-mode",{source:m}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(m){s("toggle-dynamic-size-mode",{source:m}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(m){s("toggle-paste-at-cursor",{source:m}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(m){s("toggle-reduce-motion",{source:m}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(m){s("toggle-edge-scrolling",{source:m}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(m){s("toggle-transparent",{source:m}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(m){s("toggle-tool-lock",{source:m}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(m){s("unlock-all",{source:m});const S=[];for(const b of t.getCurrentPageShapes())b.isLocked&&S.push({id:b.id,type:b.type,isLocked:!1});S.length>0&&t.updateShapes(S)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(m){t.timers.requestAnimationFrame(()=>{t.run(()=>{s("toggle-focus-mode",{source:m}),i.clearDialogs(),i.clearToasts(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(m){s("toggle-grid-mode",{source:m}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(m){s("toggle-debug-mode",{source:m}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(m){s("print",{source:m}),i.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(m){s("exit-pen-mode",{source:m}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(m){s("stop-following",{source:m}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(m){s("zoom-to-content",{source:m});const S=t.getSelectionPageBounds()??t.getCurrentPageBounds();S&&t.zoomToBounds(S,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(m){t.markHistoryStoppingPoint("locking"),s("toggle-lock",{source:m}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(m){const S=si.createId(),b=t.getSelectedShapeIds();t.run(()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.createPage({name:i.msg("page-menu.new-page-initial-name"),id:S}),t.moveShapesToPage(b,S)}),s("move-to-new-page",{source:m})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(m){const S=ii;t.run(()=>{t.markHistoryStoppingPoint("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(S,"white"),t.setStyleForNextShapes(S,"white")}),s("set-style",{source:m,id:S.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(m){const S=Ll;t.run(()=>{t.markHistoryStoppingPoint("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(S,"fill"),t.setStyleForNextShapes(S,"fill")}),s("set-style",{source:m,id:S.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async m=>{const S=t.getSelectedShapeIds();if(S.length===0)return;t.markHistoryStoppingPoint("flattening to image"),s("flatten-to-image",{source:m});const b=await WJ(t,S,t.options.flattenImageBoundsExpand);b!=null&&b.length&&t.setSelectedShapes(b)}},{id:"select-geo-tool",kbd:"g",onSelect:async m=>{s("select-tool",{source:m,id:"geo-previous"}),t.setCurrentTool("geo")}}];r&&f.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(m){s("open-cursor-chat",{source:m}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const g=ete(f);return n?n(t,g,i):g},[i,t,s,n,a,r]);return p.jsx(eN.Provider,{value:l,children:e})}function Xl(){const n=T.useContext(eN);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function jh(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}function ai(){const n=Ha();return oe("isReadonlyMode",()=>!!(n!=null&&n.getIsReadonly()),[n])}const nte=kt.isDarwin?"":"Ctrl",rte=kt.isDarwin?"":"Alt";function tN(n){return n===","?[","]:n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,nte).replace(/\?/g,rte).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function Hw(n){return" "+tN(n).join("")}function gh({children:n,visibleOnMobileLayout:e=!1}){const t=mr();return!e&&t<sn.MOBILE?null:p.jsx("kbd",{className:"tlui-kbd",children:tN(n).map((r,i)=>p.jsx("span",{children:r},i))})}const nN=T.createContext(null);function Sy(){const n=T.useContext(nN);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function Oi({type:n,sourceId:e,children:t}){return p.jsx(nN.Provider,{value:{type:n,sourceId:e},children:t})}function vy({id:n,kbd:e,label:t,readonlyOk:r,onSelect:i,toggle:s=!1,disabled:a=!1,checked:l=!1}){const{type:u,sourceId:d}=Sy(),f=ai(),g=ot();if(f&&!r)return null;const m=jh(t,u),S=m?g(m):void 0;switch(u){case"menu":return p.jsxs(mJ,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:S,onSelect:b=>{i==null||i(d),Ze(b)},disabled:a,checked:l,children:[p.jsx(Bs,{small:!0,icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),S&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:S}),e&&p.jsx(gh,{children:e})]});case"context-menu":return p.jsxs(GQ,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:S,onSelect:b=>{i(d),Ze(b)},disabled:a,checked:l,children:[p.jsx(Bs,{small:!0,icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),S&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:S}),e&&p.jsx(gh,{children:e})]},n);default:return null}}function $o(n,e){const t=Ha(),r=T.useCallback(a=>{a&&(t==null||t.complete()),e==null||e(a)},[t,e]),i=$n(),s=T.useCallback(a=>{i(a,{source:"unknown",id:n})},[n,i]);return oX(t?`${n}-${t.contextId}`:n,r,s)}function Bl({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,s]=$o(n);return p.jsx(Q_,{open:r||i,dir:"ltr",modal:t,onOpenChange:s,children:e})}function Ul({children:n,...e}){return p.jsx(J_,{dir:"ltr",asChild:!0,onTouchEnd:t=>Ze(t),...e,children:n})}function $l({className:n,side:e="bottom",align:t="start",sideOffset:r=8,alignOffset:i=8,children:s}){const a=bn();return p.jsx(uy,{container:a,children:p.jsx(eC,{className:Oe("tlui-menu",n),side:e,sideOffset:r,align:t,alignOffset:i,collisionPadding:4,children:s})})}function ite({id:n,children:e}){const[t,r]=$o(n);return p.jsx(yJ,{open:t,onOpenChange:r,children:e})}function ste({id:n,label:e,title:t,disabled:r}){return p.jsx(SJ,{dir:"ltr",asChild:!0,disabled:r,children:p.jsxs(Le,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:t,children:[p.jsx(cn,{children:e}),p.jsx(tt,{icon:"chevron-right",small:!0})]})})}function ote({id:n,alignOffset:e=-1,sideOffset:t=-6,size:r="small",children:i}){const s=bn();return p.jsx(uy,{container:s,children:p.jsx(vJ,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":r,children:i})})}function ate({children:n}){return p.jsx(pJ,{dir:"ltr",className:"tlui-menu__group",children:n})}function Oh({noClose:n,children:e}){return p.jsx(gJ,{dir:"ltr",asChild:!0,onClick:n?Ze:void 0,children:e})}function We({id:n,label:e,children:t}){const{type:r,sourceId:i}=Sy(),s=ot(),a=jh(e,r),l=a?s(a):void 0;switch(r){case"panel":return p.jsx("div",{className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"menu":return p.jsx(ate,{"data-testid":`${i}-group.${n}`,children:t});case"context-menu":return p.jsx(Z4,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"keyboard-shortcuts":return p.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${n}`,children:[p.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),p.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function Ur({id:n,disabled:e=!1,label:t,size:r="small",children:i}){const{type:s,sourceId:a}=Sy(),l=bn(),u=ot(),d=t?typeof t=="string"?t:t[s]??t.default:void 0,f=d?u(d):void 0;switch(s){case"menu":return p.jsxs(ite,{id:`${a}-sub.${n}`,children:[p.jsx(ste,{id:`${a}-sub.${n}-button`,disabled:e,label:f,title:f}),p.jsx(ote,{id:`${a}-sub.${n}-content`,size:r,children:i})]});case"context-menu":return e?null:p.jsxs(lte,{id:`${a}-sub.${n}`,children:[p.jsx(t6,{dir:"ltr",disabled:e,asChild:!0,children:p.jsxs(Le,{"data-testid":`${a}-sub.${n}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[p.jsx(cn,{children:f}),p.jsx(tt,{icon:"chevron-right",small:!0})]})}),p.jsx(W_,{container:l,children:p.jsx(n6,{"data-testid":`${a}-sub.${n}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function lte({id:n,children:e}){const[t,r]=$o(n);return p.jsx(e6,{open:t,onOpenChange:r,children:e})}const cte=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function ute(){const n=te(),e=$n(),t=oe("colorScheme",()=>n.user.getUserPreferences().colorScheme??(n.user.getIsDarkMode()?"dark":"light"),[n]);return p.jsx(Ur,{id:"help menu color-scheme",label:"menu.theme",children:p.jsx(We,{id:"theme",children:cte.map(({colorScheme:r,label:i})=>p.jsx(vy,{id:`color-scheme-${r}`,label:i,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}const dte=({id:n,component:e,onClose:t,preventBackgroundClose:r})=>{const{removeDialog:i}=cf(),s=T.useRef(!1),a=bn(),l=T.useCallback(u=>{if(!u){if(t)try{t()}catch(d){console.warn(d)}i(n)}},[n,t,i]);return p.jsx(NJ,{onOpenChange:l,defaultOpen:!0,children:p.jsx(zJ,{container:a,children:p.jsx(FJ,{dir:"ltr",className:"tlui-dialog__overlay",onClick:u=>{s.current||!r&&u.target===u.currentTarget&&l(!1)},children:p.jsx(BJ,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>s.current=!0,onMouseUp:()=>s.current=!1,onInteractOutside:u=>{s.current=!1,r&&u.preventDefault()},children:p.jsx(e,{onClose:()=>{s.current=!1,l(!1)}})})})})})},hte=T.memo(function(){const{dialogs:e}=cf();return oe("dialogs",()=>e.get(),[e]).map(r=>p.jsx(dte,{...r},r.id))}),fte=4e3,pte={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function gte({toast:n}){const{removeToast:e}=Uo(),t=ot(),r=a=>{a||e(n.id)},i=n.actions&&n.actions.length>0,s=n.icon||n.severity&&pte[n.severity];return p.jsxs(See,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:fte,"data-severity":n.severity,children:[s&&p.jsx("div",{className:"tlui-toast__icon",children:p.jsx(Bs,{icon:s})}),p.jsxs("div",{className:"tlui-toast__main","data-title":!!n.title,"data-description":!!n.description,"data-actions":!!n.actions,children:[p.jsxs("div",{className:"tlui-toast__content",children:[n.title&&p.jsx(vee,{className:"tlui-toast__title",children:n.title}),n.description&&p.jsx(bee,{className:"tlui-toast__description",children:n.description})]}),n.actions&&p.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((a,l)=>p.jsx(xee,{altText:a.label,asChild:!0,onClick:a.onClick,children:p.jsx(Le,{type:a.type,children:p.jsx(cn,{children:a.label})})},l)),p.jsx(xk,{asChild:!0,children:p.jsx(Le,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:p.jsx(cn,{children:n.closeLabel??t("toast.close")})})})]})]}),!i&&p.jsx(xk,{asChild:!0,children:p.jsx(Le,{type:"normal",className:"tlui-toast__close",children:p.jsx(cn,{children:n.closeLabel??t("toast.close")})})})]})}const mte=T.memo(function(){const{toasts:e}=Uo(),t=oe("toasts",()=>e.get(),[]);return p.jsxs(p.Fragment,{children:[t.map(r=>p.jsx(gte,{toast:r},r.id)),p.jsx(F6,{className:"tlui-toast__viewport"})]})});function hs({actionId:n="",...e}){const r=Xl()[n];return r?p.jsx(vy,{...r,...e}):null}function Ck(n){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function Pn({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:r,kbd:i,label:s,icon:a,onSelect:l,noClose:u,isSelected:d}){const{type:f,sourceId:g}=Sy(),m=ot(),[S,b]=T.useState(!1);if(ai()&&!t)return null;const w=jh(s,f),_=i?Hw(i):void 0,E=w?m(w):void 0,M=E&&_?`${E} ${_}`:E;switch(f){case"menu":return p.jsx(Oh,{children:p.jsxs(Le,{type:"menu","data-testid":`${g}.${r}`,disabled:n,title:M,onClick:I=>{u&&Ze(I),S?b(!1):l(g)},children:[p.jsx(cn,{children:E}),i&&p.jsx(gh,{children:i})]})});case"context-menu":return n?null:p.jsxs(Q4,{dir:"ltr",title:M,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${g}.${r}`,onSelect:I=>{u&&Ze(I),S?b(!1):l(g)},children:[p.jsx("span",{className:"tlui-button__label",draggable:!1,children:E}),i&&p.jsx(gh,{children:i}),e&&p.jsx(Ck,{})]});case"panel":return p.jsxs(Le,{"data-testid":`${g}.${r}`,type:"menu",title:M,disabled:n,onClick:()=>l(g),children:[p.jsx(cn,{children:E}),e?p.jsx(Ck,{}):a&&p.jsx(tt,{icon:a})]});case"small-icons":case"icons":return p.jsx(Le,{"data-testid":`${g}.${r}`,type:"icon",title:M,disabled:n,onClick:()=>l(g),children:p.jsx(tt,{icon:a,small:f==="small-icons"})});case"keyboard-shortcuts":return i?p.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${g}.${r}`,children:[p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:E}),p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:p.jsx(gh,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return p.jsxs(Le,{type:"low",onClick:()=>l(g),children:[p.jsx(tt,{icon:a}),p.jsx(cn,{children:E})]});case"toolbar":return p.jsx(Le,{type:"tool","data-testid":`tools.${r}`,"aria-label":w,"data-value":r,onClick:()=>l("toolbar"),title:M,disabled:n,onTouchStart:I=>{Ze(I),l("toolbar")},role:"radio","aria-checked":d?"true":"false",children:p.jsx(tt,{icon:a})});case"toolbar-overflow":return p.jsx(Oh,{"aria-label":s,children:p.jsx(Le,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{l("toolbar")},"data-testid":`tools.more.${r}`,title:M,disabled:n,role:"radio","aria-checked":d?"true":"false","data-value":r,children:p.jsx(tt,{icon:a})})});default:throw mn(f)}}function he({actionId:n="",...e}){const r=Xl()[n];return r?p.jsx(Pn,{...r,...e}):null}const rN=T.createContext(null);function yte({overrides:n,children:e}){const t=te(),r=$n(),i=pC(),s=T.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(u){if(t.isIn("select")){const d=t.root.getCurrent();d.exit({},d.id),d.enter({},d.id)}t.setCurrentTool("select"),r("select-tool",{source:u,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(u){t.setCurrentTool("hand"),r("select-tool",{source:u,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(u){t.setCurrentTool("eraser"),r("select-tool",{source:u,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(u){t.setCurrentTool("draw"),r("select-tool",{source:u,id:"draw"})}},...[...rs.values].map(u=>({id:u,label:`tool.${u}`,meta:{geo:u},kbd:u==="rectangle"?"r":u==="ellipse"?"o":void 0,icon:"geo-"+u,onSelect(d){t.run(()=>{t.setStyleForNextShapes(rs,u),t.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${u}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(u){t.setCurrentTool("arrow"),r("select-tool",{source:u,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(u){t.setCurrentTool("line"),r("select-tool",{source:u,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(u){t.setCurrentTool("frame"),r("select-tool",{source:u,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(u){t.setCurrentTool("text"),r("select-tool",{source:u,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(u){i.insertMedia(),r("select-tool",{source:u,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(u){t.setCurrentTool("note"),r("select-tool",{source:u,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(u){t.setCurrentTool("laser"),r("select-tool",{source:u,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(u){i.addDialog({component:D6}),r("select-tool",{source:u,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(u){t.setCurrentTool("highlight"),r("select-tool",{source:u,id:"highlight"})}}];a.push();const l=Object.fromEntries(a.map(u=>[u.id,u]));return n?n(t,l,i):l},[n,t,r,i]);return p.jsx(rN.Provider,{value:s,children:e})}function by(){const n=T.useContext(rN);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Mr({toolId:n="",...e}){const r=by()[n];return r?p.jsx(Pn,{...r,...e}):null}function Ste({children:n}){const e=te();return oe("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:vte}=Math,au=vte+1e-4;function iN(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],s=n[n.length-1],a=s.runningLength,l=Math.pow(t*r,2),u=[],d=[];let f=n[0].vector,g=n[0].point,m=g,S=g,b=m,x=!1,w;for(let _=0;_<n.length;_++){w=n[_];const{point:E,vector:M}=n[_],I=w.vector.dpr(f),A=(_<n.length-1?n[_+1]:n[_]).vector,j=_<n.length-1?A.dpr(w.vector):1,D=I<0&&!x,R=j!==null&&j<.2;if(D||R){if(j>-.62&&a-w.runningLength>w.radius){const L=f.clone().mul(w.radius);f.clone().cpr(A)<0?(S=P.Add(E,L),b=P.Sub(E,L)):(S=P.Sub(E,L),b=P.Add(E,L)),u.push(S),d.push(b)}else{const L=f.clone().mul(w.radius).per(),K=P.Sub(w.input,L);for(let G=1/13,z=0;z<1;z+=G)S=P.RotWith(K,w.input,au*z),u.push(S),b=P.RotWith(K,w.input,au+au*-z),d.push(b)}g=S,m=b,R&&(x=!0);continue}if(x=!1,w===i||w===s){const L=P.Per(M).mul(w.radius);u.push(P.Sub(E,L)),d.push(P.Add(E,L));continue}const q=P.Lrp(A,M,j).per().mul(w.radius);S=P.Sub(E,q),(_<=1||P.Dist2(g,S)>l)&&(u.push(S),g=S),b=P.Add(E,q),(_<=1||P.Dist2(m,b)>l)&&(d.push(b),m=b),f=M}return{left:u,right:d}}function gC(n,e={}){const{size:t=16,start:r={},end:i={},last:s=!1}=e,{cap:a=!0}=r,{cap:l=!0}=i;if(n.length===0||t<=0)return[];const u=n[0],d=n[n.length-1],f=d.runningLength,g=r.taper===!1?0:r.taper===!0?Math.max(t,f):r.taper,m=i.taper===!1?0:i.taper===!0?Math.max(t,f):i.taper,{left:S,right:b}=iN(n,e),x=u.point,w=n.length>1?n[n.length-1].point:P.AddXY(u.point,1,1);if(n.length===1&&(!(g||m)||s)){const I=P.Add(x,P.Sub(x,w).uni().per().mul(-u.radius)),A=[];for(let j=1/13,D=j;D<=1;D+=j)A.push(P.RotWith(I,x,au*2*D));return A}const _=[];if(!(g||m&&n.length===1))if(a)for(let I=1/8,A=I;A<=1;A+=I){const j=P.RotWith(b[0],x,au*A);_.push(j)}else{const I=P.Sub(S[0],b[0]),A=P.Mul(I,.5),j=P.Mul(I,.51);_.push(P.Sub(x,A),P.Sub(x,j),P.Add(x,j),P.Add(x,A))}const E=[],M=d.vector.clone().per().neg();if(m||g&&n.length===1)E.push(w);else if(l){const I=P.Add(w,P.Mul(M,d.radius));for(let A=1/29,j=A;j<1;j+=A)E.push(P.RotWith(I,w,au*3*j))}else E.push(P.Add(w,P.Mul(M,d.radius)),P.Add(w,P.Mul(M,d.radius*.99)),P.Sub(w,P.Mul(M,d.radius*.99)),P.Sub(w,P.Mul(M,d.radius)));return S.concat(E,b.reverse(),_)}const bte=.025,xte=.01;function Us(n,e={}){var w;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const s=.15+(1-t)*.85;let a=n.map(P.From),l=0;if(!i){let _=a[0];for(;_&&!(_.z>=bte);)a.shift(),_=a[0]}if(!i){let _=a[a.length-1];for(;_&&!(_.z>=xte);)a.pop(),_=a[a.length-1]}if(a.length===0)return[{point:P.From(n[0]),input:P.From(n[0]),pressure:i?.5:.15,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let u=a[1];for(;u&&!(P.Dist2(u,a[0])>(r/3)**2);)a[0].z=Math.max(a[0].z,u.z),a.splice(1,1),u=a[1];const d=a.pop();for(u=a[a.length-1];u&&!(P.Dist2(u,d)>(r/3)**2);)a.pop(),u=a[a.length-1],l++;a.push(d);const f=e.last||!e.simulatePressure||a.length>1&&P.Dist2(a[a.length-1],a[a.length-2])<r**2||l>0;if(a.length===2&&e.simulatePressure){const _=a[1];a=a.slice(0,-1);for(let E=1;E<5;E++){const M=P.Lrp(a[0],_,E/4);M.z=(a[0].z+(_.z-a[0].z))*E/4,a.push(M)}}const g=[{point:a[0],input:a[0],pressure:i?.5:a[0].z,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let m=0,S=g[0],b,x;f&&t>0&&a.push(a[a.length-1].clone());for(let _=1,E=a.length;_<E;_++)b=!s||e.last&&_===E-1?a[_].clone():a[_].clone().lrp(S.point,1-s),!S.point.equals(b)&&(x=P.Dist(b,S.point),m+=x,!(_<4&&m<r)&&(S={input:a[_],point:b,pressure:i?.5:a[_].z,vector:P.Sub(S.point,b).uni(),distance:x,runningLength:m,radius:1},g.push(S)));if((w=g[1])!=null&&w.vector&&(g[0].vector=g[1].vector.clone()),m<1){const _=Math.max(.5,...g.map(E=>E.pressure));g.forEach(E=>E.pressure=_)}return g}const{min:va}=Math,wx=.275;function xy(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:s=w=>w,start:a={},end:l={}}=e,{easing:u=Tn.easeOutQuad}=a,{easing:d=Tn.easeOutCubic}=l,f=n[n.length-1].runningLength;let g,m=n[0].pressure,S;if(!i&&f<t){const w=n.reduce((_,E)=>Math.max(_,E.pressure),.5);return n.forEach(_=>{_.pressure=w,_.radius=t*s(.5-r*(.5-_.pressure))}),n}else{let w;for(let _=0,E=n.length;_<E&&(S=n[_],!(S.runningLength>t*5));_++){const M=va(1,S.distance/t);if(i){const I=va(1,1-M);w=va(1,m+(I-m)*(M*wx))}else w=va(1,m+(S.pressure-m)*.5);m=m+(w-m)*.5}for(let _=0;_<n.length;_++){if(S=n[_],r){let{pressure:E}=S;const M=va(1,S.distance/t);if(i){const I=va(1,1-M);E=va(1,m+(I-m)*(M*wx))}else E=va(1,m+(E-m)*(M*wx));S.radius=t*s(.5-r*(.5-E)),m=E}else S.radius=t/2;g===void 0&&(g=S.radius)}}const b=a.taper===!1?0:a.taper===!0?Math.max(t,f):a.taper,x=l.taper===!1?0:l.taper===!0?Math.max(t,f):l.taper;if(b||x)for(let w=0;w<n.length;w++){S=n[w];const{runningLength:_}=S,E=_<b?u(_/b):1,M=f-_<x?d((f-_)/x):1;S.radius=Math.max(.01,S.radius*Math.min(E,M))}return n}function wte(n,e={}){return gC(xy(Us(n,e),e),e)}function Ek({scribble:n,zoom:e,color:t,opacity:r,className:i}){if(!n.points.length)return null;const s=wte(n.points,{size:n.size/e,start:{taper:n.taper,easing:Tn.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let a;if(s.length<4){const l=n.size/e/2,{x:u,y:d}=n.points[n.points.length-1];a=`M ${u-l},${d} a ${l},${l} 0 1,0 ${l*2},0 a ${l},${l} 0 1,0 ${-l*2},0`}else a=a_(s);return p.jsx("svg",{className:i&&Oe("tl-overlays__item",i),children:p.jsx("path",{className:"tl-scribble",d:a,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})}const _te=({bounds:n,rotation:e})=>{const t=te();return oe("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?p.jsx(GD,{bounds:n,rotation:e}):null};function Cte({size:n,width:e,height:t,hideAlternateHandles:r}){const i=ee(n/3),s=i/2;return p.jsxs("svg",{className:"tl-overlays__item",children:[p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(0-s)},${ee(n)} 
						${ee(0-s)},${ee(0-s)} 
						${ee(n)},${ee(0-s)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),p.jsx("line",{className:Oe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-n),y1:ee(0-s),x2:ee(e/2+n),y2:ee(0-s),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),p.jsx("polyline",{className:Oe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(e-n)},${ee(0-s)} 
						${ee(e+s)},${ee(0-s)} 
						${ee(e+s)},${ee(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),p.jsx("line",{className:Oe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e+s),y1:ee(t/2-n),x2:ee(e+s),y2:ee(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(e+s)},${ee(t-n)} 
						${ee(e+s)},${ee(t+s)}
						${ee(e-n)},${ee(t+s)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),p.jsx("line",{className:Oe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-n),y1:ee(t+s),x2:ee(e/2+n),y2:ee(t+s),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),p.jsx("polyline",{className:Oe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(0+n)},${ee(t+s)} 
						${ee(0-s)},${ee(t+s)}
						${ee(0-s)},${ee(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),p.jsx("line",{className:Oe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(0-s),y1:ee(t/2-n),x2:ee(0-s),y2:ee(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const Ete=Bn(function({bounds:e,rotation:t}){const r=te(),i=T.useRef(null),s=ai(),a=Es("top"),l=Es("right"),u=Es("bottom"),d=Es("left"),f=Es("top_left"),g=Es("top_right"),m=Es("bottom_right"),S=Es("bottom_left"),b=r.getInstanceState().cursor.type==="default",x=r.getInstanceState().isCoarsePointer,w=r.getOnlySelectedShape(),_=w&&r.isShapeOrAncestorLocked(w),E=w?r.getShapeUtil(w).expandSelectionOutlinePx(w):0,M=E instanceof be?e.clone().expand(E).zeroFix():e.clone().expandBy(E).zeroFix();if(_u(i,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:M.x-e.x,y:M.y-e.y}),w&&r.isShapeHidden(w))return null;const I=r.getZoomLevel(),A=r.getInstanceState().isChangingStyle,j=M.width,D=M.height,R=8/I,q=j<R*2,L=D<R*2,K=j<R*4,G=D<R*4,z=j<R*5,U=D<R*5,Y=x?1.75:1,H=6/I*Y,X=(K?H/2:H)*(Y*.75),V=(G?H/2:H)*(Y*.75),ie=(w?!r.getShapeUtil(w).hideSelectionBoundsFg(w):!0)&&!A;let B=ie&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||ie&&r.isIn("select.resizing")&&w&&r.isShapeOfType(w,"text");w&&B&&kt.isFirefox&&r.isShapeOfType(w,"embed")&&(B=!1);const re=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!A&&!s,me=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!A&&!s,de=!x&&!(q||L)&&(me||re)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!_,ye=x&&(!K||!G)&&(me||re)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!_,ge=me&&(w?r.getShapeUtil(w).canResize(w)&&!r.getShapeUtil(w).hideResizeHandles(w):!0)&&!re&&!_,Ie=q||L,Ne=q&&L,we=z||U,Te=ge||re,je=!de,He=!me||!ye,Ft=!me||!Te,at=!me||!Te||Ie,Bt=!me||!Te||Ie,_t=!me||!Te||Ne&&!re;let gt=!0,Sr=!0;if(re)gt=we,Sr=we;else if(ge){gt=Ie||Ne||x;const ci=x&&w&&w.type==="text";Sr=gt&&!ci}const Hn=Math.min(24/I,D-V*3),vr=me&&x&&w&&r.isShapeOfType(w,"text")&&Hn*I>=4;return p.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsxs("g",{ref:i,children:[B&&p.jsx("rect",{className:"tl-selection__fg__outline",width:ee(j),height:ee(D)}),p.jsx(Yp,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:H,corner:"top_left_rotate",cursor:b?Xr("nwse-rotate",t):void 0,isHidden:je}),p.jsx(Yp,{"data-testid":"selection.rotate.top-right",cx:j+H*3,cy:0,targetSize:H,corner:"top_right_rotate",cursor:b?Xr("nesw-rotate",t):void 0,isHidden:je}),p.jsx(Yp,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:D+H*3,targetSize:H,corner:"bottom_left_rotate",cursor:b?Xr("swne-rotate",t):void 0,isHidden:je}),p.jsx(Yp,{"data-testid":"selection.rotate.bottom-right",cx:j+H*3,cy:D+H*3,targetSize:H,corner:"bottom_right_rotate",cursor:b?Xr("senw-rotate",t):void 0,isHidden:je}),p.jsx(Tte,{"data-testid":"selection.rotate.mobile",cx:K?-H*1.5:j/2,cy:K?D/2:-H*1.5,size:R,isHidden:He}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":gt}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:ee(0-(G?V*2:V)),width:ee(j),height:ee(Math.max(1,V*2)),style:b?{cursor:Xr("ns-resize",t)}:void 0,...a}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":Sr}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:ee(j-(K?0:X)),y:0,height:ee(D),width:ee(Math.max(1,X*2)),style:b?{cursor:Xr("ew-resize",t)}:void 0,...l}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":gt}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:ee(D-(G?0:V)),width:ee(j),height:ee(Math.max(1,V*2)),style:b?{cursor:Xr("ns-resize",t)}:void 0,...u}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":Sr}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:ee(0-(K?X*2:X)),y:0,height:ee(D),width:ee(Math.max(1,X*2)),style:b?{cursor:Xr("ew-resize",t)}:void 0,...d}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":Ft}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:ee(0-(K?X*2:X*1.5)),y:ee(0-(G?V*2:V*1.5)),width:ee(X*3),height:ee(V*3),style:b?{cursor:Xr("nwse-resize",t)}:void 0,...f}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":at}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:ee(j-(K?0:X*1.5)),y:ee(0-(G?V*2:V*1.5)),width:ee(X*3),height:ee(V*3),style:b?{cursor:Xr("nesw-resize",t)}:void 0,...g}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":_t}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:ee(j-(K?X:X*1.5)),y:ee(D-(G?V:V*1.5)),width:ee(X*3),height:ee(V*3),style:b?{cursor:Xr("nwse-resize",t)}:void 0,...m}),p.jsx("rect",{className:Oe("tl-transparent",{"tl-hidden":Bt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:ee(0-(K?X*3:X*1.5)),y:ee(D-(G?0:V*1.5)),width:ee(X*3),height:ee(V*3),style:b?{cursor:Xr("nesw-resize",t)}:void 0,...S}),ge&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.resize.top-left",className:Oe("tl-corner-handle",{"tl-hidden":Ft}),"aria-label":"top_left handle",x:ee(0-R/2),y:ee(0-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.top-right",className:Oe("tl-corner-handle",{"tl-hidden":at}),"aria-label":"top_right handle",x:ee(j-R/2),y:ee(0-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Oe("tl-corner-handle",{"tl-hidden":_t}),"aria-label":"bottom_right handle",x:ee(j-R/2),y:ee(D-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Oe("tl-corner-handle",{"tl-hidden":Bt}),"aria-label":"bottom_left handle",x:ee(0-R/2),y:ee(D-R/2),width:ee(R),height:ee(R)})]}),vr&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:ee(0-R/4),y:ee(D/2-Hn/2),rx:R/4,width:ee(R/2),height:ee(Hn)}),p.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:R/4,x:ee(j-R/4),y:ee(D/2-Hn/2),width:ee(R/2),height:ee(Hn)})]}),re&&p.jsx(Cte,{size:R,width:j,height:D,hideAlternateHandles:we})]})})}),Yp=function({cx:e,cy:t,targetSize:r,corner:i,cursor:s,isHidden:a,"data-testid":l}){const u=Es(i);return p.jsx("rect",{className:Oe("tl-transparent","tl-rotate-corner",{"tl-hidden":a}),"data-testid":l,"aria-label":`${i} target`,pointerEvents:"all",x:ee(e-r*3),y:ee(t-r*3),width:ee(Math.max(1,r*3)),height:ee(Math.max(1,r*3)),cursor:s,...u})},Pte=Math.sqrt(Math.PI),Tte=function({cx:e,cy:t,size:r,isHidden:i,"data-testid":s}){const a=Es("mobile_rotate"),l=te(),u=oe("zoom level",()=>l.getZoomLevel(),[l]),d=Math.max(14*(1/u),20/Math.max(1,u));return p.jsxs("g",{children:[p.jsx("circle",{"data-testid":s,pointerEvents:"all",className:Oe("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:d,...a}),p.jsx("circle",{className:Oe("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:r/Pte})]})};function Ite(){const n=te();return oe("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?p.jsx(YD,{}):null}function Kw(n,e,t){const{arrowheadStart:r,arrowheadEnd:i}=e.props,s=Jc(n,e,t),a=s.start.clone(),l=s.end.clone(),u=P.Med(a,l);if(P.Equals(a,l))return{bindings:t,isStraight:!0,start:{handle:a,point:a,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:u,isValid:!1,length:0};const d=P.Sub(l,a).uni(),f=mm(n,e,"start"),g=mm(n,e,"end"),m=n.getShapePageTransform(e);Pk(l,s.start,m,g),Pk(a,s.end,m,f);let S=0,b=0,x=0,w=0,_=mh*e.props.scale;const E=f&&g&&f.shape===g.shape,M=f&&g?mC(n,f.shape.id,g.shape.id):"safe";M==="safe"&&f&&g&&!E&&!f.isExact&&!g.isExact&&(g.didIntersect&&!f.didIntersect?f.isClosed&&a.setTo(l.clone().add(d.clone().mul(mh*e.props.scale))):g.didIntersect||g.isClosed&&l.setTo(a.clone().sub(d.clone().mul(mh*e.props.scale))));const I=P.Sub(l,a),A=P.Len(I)?I.uni():P.From(I),j=!P.Equals(A,d);E||(M!=="start-contains-end"&&f&&r!=="none"&&!f.isExact&&(x=ks[e.props.size]/2+("size"in f.shape.props?ks[f.shape.props.size]/2:0),S=(ym+x)*e.props.scale,_+=x*e.props.scale),M!=="end-contains-start"&&g&&i!=="none"&&!g.isExact&&(w=ks[e.props.size]/2+("size"in g.shape.props?ks[g.shape.props.size]/2:0),b=(ym+w)*e.props.scale,_+=w*e.props.scale));const D=a.clone().add(A.clone().mul(S*(j?-1:1))),R=l.clone().sub(A.clone().mul(b*(j?-1:1)));P.DistMin(D,R,_)&&(S!==0&&b!==0?(S*=-1.5,b*=-1.5):S!==0?S*=-1:b!==0&&(b*=-1)),a.add(A.clone().mul(S*(j?-1:1))),l.sub(A.clone().mul(b*(j?-1:1))),j?(f&&g&&l.setTo(P.Add(a,A.clone().mul(-10*e.props.scale))),u.setTo(P.Med(s.start,s.end))):u.setTo(P.Med(a,l));const q=P.Dist(a,l);return{bindings:t,isStraight:!0,start:{handle:s.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:e.props.arrowheadEnd},middle:u,isValid:q>0,length:q}}function Pk(n,e,t,r){if(r===void 0||r.isExact)return;const i=ve.applyToPoint(t,e),s=ve.applyToPoint(t,n),a=ve.applyToPoint(ve.Inverse(r.transform),i),l=ve.applyToPoint(ve.Inverse(r.transform),s),u=r.isClosed,f=(u?h_:Nq)(a,l,r.outline);let g;if(f!==null&&(g=f.sort((b,x)=>P.Dist2(b,a)-P.Dist2(x,a))[0]??(u?void 0:l)),g===void 0)return;const m=ve.applyToPoint(r.transform,g),S=ve.applyToPoint(ve.Inverse(t),m);n.setTo(S),r.didIntersect=!0}function Mte(n,e,t){const{arrowheadEnd:r,arrowheadStart:i}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(Dte*e.props.scale)))return Kw(n,e,t);const a=Jc(n,e,t),l=P.Med(a.start,a.end),u=P.Sub(a.end,a.start),d=P.Len(u)?u.uni():P.From(u),f=P.Add(l,d.per().mul(-s)),g=mm(n,e,"start"),m=mm(n,e,"end"),S=a.start.clone(),b=a.end.clone(),x=f.clone();if(P.Equals(S,b))return{bindings:t,isStraight:!0,start:{handle:S,point:S,arrowhead:e.props.arrowheadStart},end:{handle:b,point:b,arrowhead:e.props.arrowheadEnd},middle:x,isValid:!1,length:0};const w=e.props.bend<0,_=w?Kh:TO,E=Tk(S,b,x),M=P.Angle(E.center,S),I=P.Angle(E.center,b),A=_(M,I);if(E.length===0||E.size===0||!BM(E.length)||!BM(E.size))return Kw(n,e,t);const j=S.clone(),D=b.clone(),R=x.clone(),q=n.getShapePageTransform(e);let L=0,K=0,G=mh*e.props.scale;if(g&&!g.isExact){const B=ve.applyToPoint(q,j),re=ve.applyToPoint(q,E.center),me=ve.applyToPoint(q,D),de=ve.Inverse(g.transform),ye=ve.applyToPoint(de,B),ge=ve.applyToPoint(de,re),Ie=ve.applyToPoint(de,me),{isClosed:Ne}=g,we=Ne?vw:TA;let Te,je=we(ge,E.radius,g.outline);if(je){const He=ge.angle(ye),Ft=ge.angle(Ie),at=_(He,Ft);je=je.filter(_t=>_(He,ge.angle(_t))<=at);const Bt=at*.25;je.sort(Ne?(_t,gt)=>Math.abs(_(He,ge.angle(_t))-Bt)<Math.abs(_(He,ge.angle(gt))-Bt)?-1:1:(_t,gt)=>_(He,ge.angle(_t))<_(He,ge.angle(gt))?-1:1),Te=je[0]??(Ne?void 0:ye)}else Te=Ne?void 0:ye;if(Te&&(j.setTo(n.getPointInShapeSpace(e,ve.applyToPoint(g.transform,Te))),g.didIntersect=!0,i!=="none")){const He=ks[e.props.size]/2+("size"in g.shape.props?ks[g.shape.props.size]/2:0);L=(ym+He)*e.props.scale,G+=He*e.props.scale}}if(m&&!m.isExact){const B=ve.applyToPoint(q,j),re=ve.applyToPoint(q,D),me=ve.applyToPoint(q,E.center),de=ve.Inverse(m.transform),ye=ve.applyToPoint(de,B),ge=ve.applyToPoint(de,me),Ie=ve.applyToPoint(de,re),Ne=m.isClosed,we=Ne?vw:TA;let Te,je=we(ge,E.radius,m.outline);if(je){const He=ge.angle(ye),Ft=ge.angle(Ie),at=_(He,Ft),Bt=at*.75;je=je.filter(_t=>_(He,ge.angle(_t))<=at),je.sort(Ne?(_t,gt)=>Math.abs(_(He,ge.angle(_t))-Bt)<Math.abs(_(He,ge.angle(gt))-Bt)?-1:1:(_t,gt)=>_(He,ge.angle(_t))<_(He,ge.angle(gt))?-1:1),je[0]?Te=je[0]:Te=Ne?void 0:Ie}else Te=Ne?void 0:Ie;if(Te&&(D.setTo(n.getPointInShapeSpace(e,ve.applyToPoint(m.transform,Te))),m.didIntersect=!0,r!=="none")){const He=ks[e.props.size]/2+("size"in m.shape.props?ks[m.shape.props.size]/2:0);K=(ym+He)*e.props.scale,G+=He*e.props.scale}}let z=P.Angle(E.center,j),U=P.Angle(E.center,D),Y=_(z,U),H=Y*E.radius;const X=j.clone(),V=D.clone();if(L!==0&&X.setTo(E.center).add(P.FromAngle(z+Y*(L/H*(w?1:-1))).mul(E.radius)),K!==0&&V.setTo(E.center).add(P.FromAngle(U+Y*(K/H*(w?-1:1))).mul(E.radius)),P.DistMin(X,V,G)&&(L!==0&&K!==0?(L*=-1.5,K*=-1.5):L!==0?L*=-2:K!==0&&(K*=-2)),L!==0&&j.setTo(E.center).add(P.FromAngle(z+Y*(L/H*(w?1:-1))).mul(E.radius)),K!==0&&D.setTo(E.center).add(P.FromAngle(U+Y*(K/H*(w?-1:1))).mul(E.radius)),g&&m&&!g.isExact&&!m.isExact){z=P.Angle(E.center,j),U=P.Angle(E.center,D),Y=_(z,U),H=Y*E.radius;const B=mC(n,g.shape.id,m.shape.id);B==="double-bound"&&H<30?(j.setTo(S),D.setTo(b),R.setTo(x)):B==="safe"&&(g&&!g.didIntersect&&j.setTo(S),(m&&!m.didIntersect||_(M,z)>_(M,U))&&D.setTo(E.center).add(P.FromAngle(z+Y*(Math.min(.9,mh*e.props.scale/H)*(w?1:-1))).mul(E.radius)))}Ate(E.center,E.radius,j,D,R,A,w),j.equals(D)&&(j.setTo(R.clone().addXY(1,1)),D.setTo(R.clone().subXY(1,1))),S.setTo(j),b.setTo(D),x.setTo(R);const ie=Tk(S,b,x);return{bindings:t,isStraight:!1,start:{point:S,handle:a.start,arrowhead:e.props.arrowheadStart},end:{point:b,handle:a.end,arrowhead:e.props.arrowheadEnd},middle:x,handleArc:E,bodyArc:ie,isValid:ie.length!==0&&isFinite(ie.center.x)&&isFinite(ie.center.y)}}function Tk(n,e,t){const r=B1(n,e,t)??P.Med(n,e),i=P.Dist(r,n),s=+P.Clockwise(n,t,e),a=((n.y-e.y)**2+(n.x-e.x)**2)**.5,l=((e.y-t.y)**2+(e.x-t.x)**2)**.5,u=((t.y-n.y)**2+(t.x-n.x)**2)**.5,d=Math.acos((l*l+u*u-a*a)/(2*l*u))*2,f=+(pt>d),g=(wt-d)*(s?1:-1),m=g*i;return{center:r,radius:i,size:g,length:m,largeArcFlag:f,sweepFlag:s}}function Ate(n,e,t,r,i,s,a){const l=P.Angle(n,t),u=P.Angle(n,r);let d=Kh(l,u);if(a||(d=wt-d),i.setTo(n).add(P.FromAngle(l+d*(.5*(a?1:-1))).mul(e)),d>s){i.rotWith(n,pt);const f=r.clone();r.setTo(t),t.setTo(f)}}const kte=8;function jte(n){return Math.abs(n.props.bend)<kte*n.props.scale}function mm(n,e,t){const r=n.getBindingsFromShape(e,"arrow").find(u=>u.props.terminal===t);if(!r)return;const i=n.getShape(r.toId);if(!i)return;const s=n.getShapePageTransform(i),a=n.getShapeGeometry(i),l=a instanceof ki?a.children[0].vertices:a.vertices;return{shape:i,transform:s,isClosed:a.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:l}}function Ik(n,e,t,r){const i=n.getShape(t.toId);if(i){const{point:s,size:a}=n.getShapeGeometry(i).bounds,l=P.Add(s,P.MulV(t.props.isPrecise||r?t.props.normalizedAnchor:{x:.5,y:.5},a)),u=ve.applyToPoint(n.getShapePageTransform(i),l);return ve.applyToPoint(ve.Inverse(e),u)}else return new P(0,0)}function Dr(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(r=>r.props.terminal==="start"),end:t.find(r=>r.props.terminal==="end")}}const Ote=HU("arrow info",(n,e)=>{const t=Dr(n,e);return jte(e)?Kw(n,e,t):Mte(n,e,t)});function As(n,e){const t=typeof e=="string"?e:e.id;return Ote.get(n,t)}function Jc(n,e,t){var l,u;const r=n.getShapePageTransform(e),i=mC(n,(l=t.start)==null?void 0:l.toId,(u=t.end)==null?void 0:u.toId),s=t.start?Ik(n,r,t.start,i==="double-bound"||i==="start-contains-end"):P.From(e.props.start),a=t.end?Ik(n,r,t.end,i==="double-bound"||i==="end-contains-start"):P.From(e.props.end);return{start:s,end:a}}function Yd(n,e,t,r){const i=typeof e=="string"?e:e.id,s=typeof t=="string"?t:t.id,a=n.getBindingsFromShape(i,"arrow").filter(u=>u.props.terminal===r.terminal);a.length>1&&n.deleteBindings(a.slice(1));const l=a[0];l?n.updateBinding({...l,toId:s,props:r}):n.createBinding({type:"arrow",fromId:i,toId:s,props:r})}function gg(n,e,t){const r=n.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===t);n.deleteBindings(r)}const mh=10,ym=10,Dte=10,ks={s:2,m:3.5,l:5,xl:10};function mC(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}class mg extends dg{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&_x(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&_x(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){_x(this.editor,e)}onAfterChangeToShape({binding:e}){sN(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&Sm({editor:this.editor,arrow:t,terminal:e.props.terminal})}}O(mg,"type","arrow"),O(mg,"props",XO),O(mg,"migrations",WO);function sN(n,e){var w;const t=n.getShape(e);if(!t)return;const r=Dr(n,t),{start:i,end:s}=r,a=i?n.getShape(i.toId):void 0,l=s?n.getShape(s.toId):void 0,u=n.getAncestorPageId(t);if(!u)return;let d;if(a&&l)d=n.findCommonAncestor([a,l])??u;else if(a||l){const _=(w=a||l)==null?void 0:w.parentId;_&&_===t.parentId?d=t.parentId:d=u}else return;d&&d!==t.parentId&&n.reparentShapes([e],d);const f=n.getShape(e);if(!f)throw Error("no reparented arrow");const g=n.getShapeNearestSibling(f,a),m=n.getShapeNearestSibling(f,l);let S;if(g&&m)S=g.index>m.index?g:m;else if(g&&!m)S=g;else if(m&&!g)S=m;else return;let b;const x=n.getSortedChildIdsForParent(S.parentId).map(_=>n.getShape(_)).filter(_=>_.index>S.index);if(x.length){const _=x.find(E=>E.type!=="arrow");if(f.index>S.index&&(!_||f.index<_.index))return;b=wh(S.index,x[0].index)}else b=Is(S.index);b!==f.index&&n.updateShapes([{id:e,type:"arrow",index:b}])}function _x(n,e){const t=Dr(n,e);for(const r of["start","end"]){const i=t[r];if(!i)continue;const s=n.getShape(i.toId),a=n.getAncestorPageId(e)===n.getAncestorPageId(s);(!s||!a)&&Sm({editor:n,arrow:e,terminal:r,unbind:!0})}sN(n,e.id)}function Sm({editor:n,arrow:e,terminal:t,unbind:r=!1,useHandle:i=!1}){const s=As(n,e);if(!s)throw new Error("expected arrow info");const a=i?s.start.handle:s.start.point,l=i?s.end.handle:s.end.point,u=t==="start"?a:l,d={id:e.id,type:"arrow",props:{[t]:{x:u.x,y:u.y},bend:e.props.bend}};if(!s.isStraight){const f=t==="start"?a:s.start.handle,g=t==="end"?l:s.end.handle,m=P.Med(f,g),S=P.Sub(f,g).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),b=Xh(s.handleArc.center,P.Add(m,S),s.handleArc.center,s.handleArc.radius);vt((b==null?void 0:b.length)===1);const x=P.Dist(m,b[0])*Math.sign(e.props.bend);Aa(x,d.props.bend)||(d.props.bend=x)}n.updateShape(d),r&&gg(n,e,t)}const oN=[mg],rr={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},nr={s:2,m:3.5,l:5,xl:10},du={s:18,m:24,l:36,xl:44},Do={s:18,m:22,l:26,xl:32},Rte={s:18,m:20,l:24,xl:28},No={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Lte=20,yC=4.25,Ci=16;function Nte(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}async function zte(n,e,t){var _,E,M;const{elements:r,files:i}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},a=new Map,l=new Map,u=n.getCurrentPageId(),d=new Map,f=[],g=new Set;r.forEach(I=>{if(d.set(I.id,Mt()),I.boundElements!==null)for(const A of I.boundElements)A.type==="text"&&g.add(A.id)});let m=zj;for(const I of r){if(g.has(I.id))continue;const A=d.get(I.id),j={id:A,typeName:"shape",parentId:u,index:m,x:I.x,y:I.y,rotation:0,isLocked:I.locked,opacity:Fte(I.opacity),meta:{}};switch(I.angle!==0&&l.set(A,I.angle),I.groupIds&&I.groupIds.length>0?a.has(I.groupIds[0])?(_=a.get(I.groupIds[0]))==null||_.push(A):a.set(I.groupIds[0],[A]):f.push(A),I.type){case"rectangle":case"ellipse":case"diamond":{let D="",R="middle";if(I.boundElements!==null){for(const L of I.boundElements)if(L.type==="text"){const K=r.find(G=>G.id===L.id);K&&(D=K.text,R=Gte[K.textAlign])}}const q=I.backgroundColor==="transparent"?I.strokeColor:I.backgroundColor;s.shapes.push({...j,type:"geo",props:{geo:I.type,url:I.link??"",w:I.width,h:I.height,size:Vp[I.strokeWidth]??"draw",color:Vd[q]??"black",text:D,align:R,dash:Xp(I),fill:Xte(I)}});break}case"freedraw":{s.shapes.push({...j,type:"draw",props:{dash:Xp(I),size:Vp[I.strokeWidth],color:Vd[I.strokeColor]??"black",segments:[{type:"free",points:I.points.map(([D,R,q=.5])=>({x:D,y:R,z:q}))}]}});break}case"line":{if(I.points.slice().length<2)break;const R=_h(I.points.length);s.shapes.push({...j,type:"line",props:{dash:Xp(I),size:Vp[I.strokeWidth],color:Vd[I.strokeColor]??"black",spline:I.roundness?"cubic":"line",points:{...Object.fromEntries(I.points.map(([q,L],K)=>{const G=R[K];return[G,{id:G,index:G,x:q,y:L}]}))}}});break}case"arrow":{let D="";if(I.boundElements!==null){for(const G of I.boundElements)if(G.type==="text"){const z=r.find(U=>U.id===G.id);z&&(D=z.text)}}const R=I.points[0],q=I.points[I.points.length-1],L=d.get((E=I.startBinding)==null?void 0:E.elementId),K=d.get((M=I.endBinding)==null?void 0:M.elementId);s.shapes.push({...j,type:"arrow",props:{text:D,bend:Vte(I,R,q),dash:Xp(I),size:Vp[I.strokeWidth]??"m",color:Vd[I.strokeColor]??"black",start:{x:R[0],y:R[1]},end:{x:q[0],y:q[1]},arrowheadEnd:Mk[I.endArrowhead]??"none",arrowheadStart:Mk[I.startArrowhead]??"none"}}),L&&s.bindings.push({id:Al(),typeName:"binding",type:"arrow",fromId:A,toId:L,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),K&&s.bindings.push({id:Al(),typeName:"binding",type:"arrow",fromId:A,toId:K,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:D,scale:R}=Ute(I.fontSize);s.shapes.push({...j,type:"text",props:{size:D,scale:R,font:$te[I.fontFamily]??"draw",color:Vd[I.strokeColor]??"black",text:I.text,textAlign:Yte[I.textAlign]}});break}case"image":{const D=i[I.fileId];if(!D)break;const R=ja.createId();s.assets.push({id:R,typeName:"asset",type:"image",props:{w:I.width,h:I.height,fileSize:D.size,name:I.id??"Untitled",isAnimated:!1,mimeType:D.mimeType,src:D.dataURL},meta:{}}),s.shapes.push({...j,type:"image",props:{w:I.width,h:I.height,assetId:R}})}}m=Is(m)}const S=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.putContentOntoCurrentPage(s,{point:S,select:!1,preserveIds:!0});for(const I of a.values())if(I.length>1){n.groupShapes(I);const A=n.getShape(I[0]);A!=null&&A.parentId&&kr(A.parentId)&&f.push(A.parentId)}for(const[I,A]of l)n.select(I),n.rotateShapesBy([I],A);const b=Ye(f.map(I=>n.getShape(I))),x=be.Common(b.map(I=>n.getShapePageBounds(I))),w=n.getViewportPageBounds().center;n.updateShapes(b.map(I=>{const A={x:(I.x??0)-(x.x+x.w/2),y:(I.y??0)-(x.y+x.h/2)};return{id:I.id,type:I.type,x:w.x+A.x,y:w.y+A.y}})),n.setSelectedShapes(f)}const Fte=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Vp={1:"s",2:"m",3:"l",4:"xl"},Bte={16:"s",20:"m",28:"l",36:"xl"};function Ute(n){const e=Bte[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const $te={1:"draw",2:"sans",3:"mono"},Hte={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function _s(n,e,t){const r=[0,1,2,3,4].map(i=>Hte[n][i]);return Object.fromEntries(r.map((i,s)=>[i,s<3?e:t]))}const Vd={..._s("gray","grey","black"),..._s("red","light-red","red"),..._s("pink","light-red","red"),..._s("grape","light-violet","violet"),..._s("blue","light-blue","blue"),..._s("cyan","light-blue","blue"),..._s("teal","light-green","green"),..._s("green","light-green","green"),..._s("yellow","yellow","orange"),..._s("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},Kte={solid:"draw",dashed:"dashed",dotted:"dotted"},qte={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Gte={left:"start",center:"middle",right:"end"},Yte={left:"start",center:"middle",right:"end"},Mk={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Vte(n,e,t){let r=0;if(n.points.length>2){const i=new P(e[0],e[1]),s=new P(t[0],t[1]),a=new P(n.points[1][0],n.points[1][1]),l=P.Sub(s,i),u=P.Per(l),d=P.Med(s,i),f=P.Sub(d,u),g=P.Add(d,u),m=P.NearestPointOnLineSegment(f,g,a,!1);r=P.Dist(m,d),P.Clockwise(m,s,d)&&(r*=-1)}return r}const Xp=n=>{let e=Kte[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},Xte=n=>n.backgroundColor==="transparent"?"none":qte[n.fillStyle]??"solid";/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const eu="  ",cr=class cr{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||cr.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),cr.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:s}=e,a=cr.getSelection(e);cr.insert(e,t+a+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(s||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...s)=>{const a=i+s[s.length-2],l=s[0].length;e.selectionStart=a,e.selectionEnd=a+l;const u=typeof r=="string"?r:r(...s);return cr.insert(e,u),e.selectionStart=a,i+=u.length-l,u})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var l;const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.slice(t,r),a=(l=/\n/g.exec(s))==null?void 0:l.length;if(a&&a>0){const u=i.lastIndexOf(`
`,t-1)+1,d=e.value.slice(u,r-1),f=d.replace(/^|\n/g,`$&${eu}`),g=f.length-d.length;e.setSelectionRange(u,r-1),cr.insert(e,f),e.setSelectionRange(t+1,r+g)}else cr.insert(e,eu)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.lastIndexOf(`
`,t-1)+1,a=cr.findLineEnd(i,r),l=e.value.slice(s,a),u=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-u.length;e.setSelectionRange(s,a),cr.insert(e,u);const f=/\t| {1,2}/.exec(i.slice(s,t)),g=f?f[0].length:0,m=t-g;e.setSelectionRange(t-g,Math.max(m,r-d))}static indentCE(e){var u;const t=window.getSelection(),r=e.innerText,i=Wp(e)??0,s=Wp(e)??0,a=r.slice(i,s),l=(u=/\n/g.exec(a))==null?void 0:u.length;if(l&&l>0){const d=r.lastIndexOf(`
`,i-1)+1,f=r.slice(d,s-1),m=f.replace(/^|\n/g,`$&${eu}`).length-f.length;t&&t.setBaseAndExtent(e,i+1,e,s+m)}else{const d=window.getSelection();e.innerText=r.slice(0,i)+eu+r.slice(i),d==null||d.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=Wp(e)??0,s=Wp(e)??0,a=r.lastIndexOf(`
`,i-1)+1,l=cr.findLineEnd(r,s),u=r.slice(a,l),d=u.replace(/(^|\n)(\t| {1,2})/g,"$1"),f=u.length-d.length;if(t){t.setBaseAndExtent(e,a,e,l);const g=/\t| {1,2}/.exec(r.slice(a,i)),m=g?g[0].length:0,S=i-m;t.setBaseAndExtent(e,i-m,e,Math.max(S,s-f))}}static normalizeText(e){return e.replace(cr.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(cr.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};O(cr,"fixNewLines",/\r?\n|\r/g);let hu=cr;function Wp(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const Wte=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function aN(n){return Wte.test(n)}function Zte(n){return n.replace(/\t/g,eu)}function Qte(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}const lN={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"","&#8212;":"","&#8216;":"","&#8217;":"","&#8220;":"","&#8221;":"","&#8230;":""},Jte=new RegExp(Object.keys(lN).join("|"),"g");function ene(n){return n.replace(Jte,e=>lN[e])}function tne(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function nne(n){return tne(Qte(Zte(n)))}const rne=5e3,cN=10*1024*1024;function ine(n,e){n.registerExternalAssetHandler("file",async t=>sne(n,t,e)),n.registerExternalAssetHandler("url",async t=>one(n,t,e)),n.registerExternalContentHandler("svg-text",async t=>ane(n,t)),n.registerExternalContentHandler("embed",t=>lne(n,t)),n.registerExternalContentHandler("files",async t=>cne(n,t,e)),n.registerExternalContentHandler("text",async t=>une(n,t)),n.registerExternalContentHandler("url",async t=>dne(n,t,e)),n.registerExternalContentHandler("tldraw",async t=>hne(n,t)),n.registerExternalContentHandler("excalidraw",async t=>fne(n,t))}async function sne(n,{file:e,assetId:t},{acceptedImageMimeTypes:r=Nh,acceptedVideoMimeTypes:i=_m,maxAssetSize:s=cN,maxImageDimension:a=rne,toasts:l,msg:u}){const d=r.includes(e.type),f=i.includes(e.type);!d&&!f&&l.addToast({title:u("assets.files.type-not-allowed"),severity:"error"}),vt(d||f,`File type not allowed: ${e.type}`),e.size>s&&l.addToast({title:u("assets.files.size-too-big"),severity:"error"}),vt(e.size<=s,`File size too big: ${(e.size/1024).toFixed()}kb > ${(s/1024).toFixed()}kb`);const g=wj(await e.arrayBuffer());t=t??ja.createId(g);const m=await uN(e,t,d,f);if(isFinite(a)){const b={w:m.props.w,h:m.props.h},x=Nte(b,{w:a,h:a});b!==x&&Zr.isStaticImageType(e.type)&&(m.props.w=x.w,m.props.h=x.h)}const S=await n.uploadAsset(m,e);return m.props.src=S.src,S.meta&&(m.meta={...m.meta,...S.meta}),ja.create(m)}async function one(n,{url:e},{toasts:t,msg:r}){var s,a,l,u,d;let i;try{const g=await(await Ls(e,{method:"GET",mode:"no-cors"})).text(),m=new DOMParser().parseFromString(g,"text/html");i={image:((s=m.head.querySelector('meta[property="og:image"]'))==null?void 0:s.getAttribute("content"))??"",favicon:((a=m.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:a.getAttribute("href"))??((l=m.head.querySelector('link[rel="icon"]'))==null?void 0:l.getAttribute("href"))??"",title:((u=m.head.querySelector('meta[property="og:title"]'))==null?void 0:u.getAttribute("content"))??e,description:((d=m.head.querySelector('meta[property="og:description"]'))==null?void 0:d.getAttribute("content"))??""},i.image.startsWith("http")||(i.image=new URL(i.image,e).href),i.favicon.startsWith("http")||(i.favicon=new URL(i.favicon,e).href)}catch(f){console.error(f),t.addToast({title:r("assets.url.failed"),severity:"error"}),i={image:"",favicon:"",title:"",description:""}}return{id:ja.createId(v1(e)),typeName:"asset",type:"bookmark",props:{src:e,description:i.description,image:i.image,favicon:i.favicon,title:i.title},meta:{}}}async function ane(n,{point:e,text:t}){const r=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),i=new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg");if(!i)throw new Error("No <svg/> element present");let s=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0");if(!(s&&a)){document.body.appendChild(i);const u=i.getBoundingClientRect();document.body.removeChild(i),s=u.width,a=u.height}const l=await n.getAssetForExternalContent({type:"file",file:new File([t],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");dN(n,[l],r)}function lne(n,{point:e,url:t,embed:r}){const i=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:s,height:a}=r,l=Mt(),u={id:l,type:"embed",x:i.x-(s||450)/2,y:i.y-(a||450)/2,props:{w:s,h:a,url:t}};n.createShapes([u]).select(l)}async function cne(n,{point:e,files:t},{maxAssetSize:r=cN,acceptedImageMimeTypes:i=Nh,acceptedVideoMimeTypes:s=_m,toasts:a,msg:l}){if(t.length>n.options.maxFilesAtOnce){a.addToast({title:l("assets.files.amount-too-big"),severity:"error"});return}const u=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=new P(u.x,u.y),f=[];for(const m of t){if(m.size>r){a.addToast({title:l("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(m.size/1024).toFixed()}kb > ${(r/1024).toFixed()}kb`);continue}if(!m.type){a.addToast({title:l("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(![...i,...s].includes(m.type)){a.addToast({title:l("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${m.name} not loaded - Mime type not allowed ${m.type}.`);continue}const b=i.includes(m.type),x=s.includes(m.type),w=wj(await m.arrayBuffer()),_=ja.createId(w),E=await uN(m,_,b,x);let M;b&&(M=n.createTemporaryAssetPreview(_,m)),f.push({asset:E,file:m,temporaryAssetPreview:M})}const g=[];await Promise.allSettled(f.map(async m=>{try{const S=await n.getAssetForExternalContent({type:"file",file:m.file});if(!S)throw Error("Could not create an asset");const b={...S,id:m.asset.id};g.push(b),n.updateAssets([b])}catch(S){a.addToast({title:l("assets.files.upload-failed"),severity:"error"}),console.error(S);return}})),dN(n,g,d)}async function une(n,{point:e,text:t}){const r=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),i=n.getShapeUtil("text").getDefaultProps(),s=nne(t),a=n.getOnlySelectedShape();if(a&&"text"in a.props){n.updateShapes([{id:a.id,type:a.type,props:{text:s}}]);return}let l,u,d,f="middle";const g=s.split(`
`).length>1,m=aN(s);g&&(f=g?m?"end":"start":"middle");const S=n.textMeasure.measureText(s,{...rr,fontFamily:No[i.font],fontSize:du[i.size],maxWidth:null}),b=Math.min(g?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(S.w>b){const x=n.textMeasure.measureText(s,{...rr,fontFamily:No[i.font],fontSize:du[i.size],maxWidth:b});l=x.w,u=x.h,d=!1,f=m?"end":"start"}else l=S.w,u=S.h,d=!0;r.y-u/2<n.getViewportPageBounds().minY+40&&(r.y=n.getViewportPageBounds().minY+40+u/2),n.createShapes([{id:Mt(),type:"text",x:r.x-l/2,y:r.y-u/2,props:{text:s,textAlign:f,autoSize:d,w:l}}])}async function dne(n,{point:e,url:t},{toasts:r,msg:i}){const s=n.getShapeUtil("embed"),a=s==null?void 0:s.getEmbedDefinition(t);if(a)return n.putExternalContent({type:"embed",url:a.url,point:e,embed:a.definition});const l=e??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=ja.createId(v1(t)),d=pne(n,t,l);let f=n.getAsset(u),g=!1;if(!f){g=!0;try{const m=await n.getAssetForExternalContent({type:"url",url:t});if(!m)throw Error("Could not create an asset");f=m}catch{r.addToast({title:i("assets.url.failed"),severity:"error"});return}}n.run(()=>{g&&n.createAssets([f]),n.updateShapes([{id:d.id,type:d.type,props:{assetId:f.id}}])})}async function hne(n,{point:e,content:t}){n.run(()=>{const r=n.getSelectionPageBounds();n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(t,{point:e,select:!0});const i=n.getSelectionPageBounds();r&&i&&(r!=null&&r.collides(i))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))})}async function fne(n,{point:e,content:t}){n.run(()=>{zte(n,t,e)})}async function uN(n,e,t,r){let i=n.type;n.type==="video/quicktime"&&(i="video/mp4");const s=t?await Zr.getImageSize(n):await Zr.getVideoSize(n),a=await Zr.isAnimated(n)||r;return{id:e,type:t?"image":"video",typeName:"asset",props:{name:n.name,src:"",w:s.w,h:s.h,fileSize:n.size,mimeType:i,isAnimated:a},meta:{}}}async function dN(n,e,t){if(!e.length)return[];const r=P.From(t),i=[];for(let s=0;s<e.length;s++){const a=e[s];switch(a.type){case"image":{i.push({id:Mt(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:a.id,w:a.props.w,h:a.props.h}}),r.x+=a.props.w;break}case"video":i.push({id:Mt(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:a.id,w:a.props.w,h:a.props.h}}),r.x+=a.props.w}}return n.run(()=>{const s=e.filter(a=>!n.getAsset(a.id));s.length&&n.createAssets(s),n.createShapes(i).select(...i.map(a=>a.id)),hN(n,t)}),i.map(s=>s.id)}function hN(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(s=>{const a=n.getShapeParentTransform(s).decompose().rotation,l=P.Rot(i,-a);return{id:s.id,type:s.type,x:s.x-l.x,y:s.y-l.y}}))}if(r=n.getSelectionPageBounds(),r&&n.getInstanceState().isGridMode){const i=n.getDocumentSettings().gridSize,s=new P(r.minX,r.minY),a=s.clone().snapToGrid(i),l=P.Sub(s,a);n.updateShapes(n.getSelectedShapes().map(u=>{const d={x:u.x-l.x,y:u.y-l.y};return{id:u.id,type:u.type,x:d.x,y:d.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})}function pne(n,e,t){const r={id:Mt(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([r]).select(r.id),hN(n,t)}),n.getShape(r.id)}var Lx;let gne=(Lx=class extends Ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}},O(Lx,"id","idle"),Lx);var Nx;let mne=(Nx=class extends Ae{constructor(){super(...arguments);O(this,"shape");O(this,"markId","");O(this,"preciseTimeout",-1);O(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var g;const{originPagePoint:t}=this.editor.inputs,r=Mt();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`);const i=ss(t,this.editor);this.editor.createShape({id:r,type:"arrow",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(r);if(!s)throw Error("expected shape");const a=this.editor.getShapeHandles(s);if(!a)throw Error("expected handles for arrow");const l=this.editor.getShapeUtil("arrow"),u=this.shape,d=a.find(m=>m.id==="start"),f=(g=l.onHandleDrag)==null?void 0:g.call(l,s,{handle:{...d,x:0,y:0},isPrecise:!0,initial:u});f&&this.editor.updateShapes([f]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var i,s;const t=this.shape;if(!t)throw Error("expected shape");const r=this.editor.getShapeHandles(t);if(!r)throw Error("expected handles for arrow");{const a=this.editor.getShapeUtil("arrow"),l=this.shape,u=r.find(f=>f.id==="start"),d=(i=a.onHandleDrag)==null?void 0:i.call(a,t,{handle:{...u,x:0,y:0},isPrecise:this.didTimeout,initial:l});d&&this.editor.updateShapes([d])}{const a=this.editor.getShapeUtil("arrow"),l=this.shape,u=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),d=r.find(g=>g.id==="end"),f=(s=a.onHandleDrag)==null?void 0:s.call(a,this.editor.getShape(t),{handle:{...d,x:u.x,y:u.y},isPrecise:!1,initial:l});f&&this.editor.updateShapes([f])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},O(Nx,"id","pointing"),Nx);class qw extends Ae{constructor(){super(...arguments);O(this,"shapeType","arrow")}static children(){return[gne,mne]}}O(qw,"id","arrow"),O(qw,"initial","idle");class SC extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"initialShape");O(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");O(this,"util",this.editor.getShapeUtil(this.shapeType));O(this,"isPen",!1);O(this,"isPenOrStylus",!1);O(this,"segmentMode","free");O(this,"didJustShiftClickToExtendPreviousShapeLine",!1);O(this,"pagePointWhereCurrentSegmentChanged",{});O(this,"pagePointWhereNextSegmentChanged",null);O(this,"lastRecordedPoint",{});O(this,"mergeNextPoint",!1);O(this,"currentLineLength",0);O(this,"markId",null)}onEnter(t){this.markId=null,this.info=t,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:t}=this.editor;if(this.isPen&&!t.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?P.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(t){if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(t){if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r,i){if(!this.canClose())return!1;const s=nr[r],a=t[0].points[0],l=t[t.length-1],u=l.points[l.points.length-1];return a!==u&&this.currentLineLength>s*4*i&&P.DistMin(a,u,s*2*i)}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:i=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||i>0&&i<.5||i>.5&&i<1;const s=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const l=this.editor.getShape(this.initialShape.id);if(l&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const u=Rn(l.props.segments);if(!u)throw Error("Expected a previous segment!");const d=Rn(u.points);if(!d)throw Error("Expected a previous point!");const{x:f,y:g}=this.editor.getPointInShapeSpace(l,t).toFixed(),m={type:this.segmentMode,points:[{x:d.x,y:d.y,z:+s.toFixed(2)},{x:f,y:g,z:+s.toFixed(2)}]},S=ve.applyToPoint(this.editor.getShapePageTransform(l.id),d);this.pagePointWhereCurrentSegmentChanged=S,this.pagePointWhereNextSegmentChanged=null;const b=[...l.props.segments,m];this.currentLineLength<nr[l.props.size]*4&&(this.currentLineLength=this.getLineLength(b));const x={id:l.id,type:this.shapeType,props:{segments:b}};this.canClose()&&(x.props.isClosed=this.getIsClosed(b,l.props.size,l.props.scale)),this.editor.updateShapes([x]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const a=Mt();this.editor.createShapes([{id:a,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(a)}updateDrawingShape(){const{initialShape:t}=this,{inputs:r}=this.editor;if(!t)return;const{id:i,props:{size:s,scale:a}}=t,l=this.editor.getShape(i);if(!l)return;const{segments:u}=l.props,{x:d,y:f,z:g}=this.editor.getPointInShapeSpace(l,r.currentPagePoint).toFixed(),m=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,S={x:d,y:f,z:m};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:b}=this;if(b===null)throw Error("We should have a point where the segment changed");if(P.Dist2(b,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const w=Rn(u);if(!w)throw Error("Expected a previous segment!");const _=Rn(w.points);if(!_)throw Error("Expected a previous last point!");let E;const M=this.editor.getPointInShapeSpace(l,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(w.type==="straight"){this.currentLineLength+=P.Dist(_,M),E={type:"straight",points:[{..._},M]};const A=this.editor.getShapePageTransform(l);this.pagePointWhereCurrentSegmentChanged=ve.applyToPoint(A,_)}else E={type:"straight",points:[M,S]};const I={id:i,type:this.shapeType,props:{segments:[...u,E]}};this.canClose()&&(I.props.isClosed=this.getIsClosed(u,s,a)),this.editor.updateShapes([I])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:b}=this;if(b===null)throw Error("We should have a point where the segment changed");if(P.Dist2(b,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const w=u.slice(),_=w[w.length-1],E=Rn(_.points);if(!E)throw Error("No previous point!");const M={type:"free",points:[...P.PointsBetween(E,S,6).map(j=>({x:Po(j.x),y:Po(j.y),z:Po(j.z)}))]},I=[...w,M];this.currentLineLength<nr[l.props.size]*4&&(this.currentLineLength=this.getLineLength(I));const A={id:i,type:this.shapeType,props:{segments:I}};this.canClose()&&(A.props.isClosed=this.getIsClosed(I,s,a)),this.editor.updateShapes([A])}break}case"straight":{const b=u.slice(),x=b[b.length-1],{pagePointWhereCurrentSegmentChanged:w}=this,{ctrlKey:_,currentPagePoint:E}=this.editor.inputs;if(!w)throw Error("We should have a point where the segment changed");let M,I=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(I=!_,this.didJustShiftClickToExtendPreviousShapeLine=!1):I=!_;let A=this.editor.getPointInShapeSpace(l,E).toFixed().toJson(),j=!1,D;if((this.editor.user.getIsSnapMode()?!_:_)&&b.length>2){let L,K=8/this.editor.getZoomLevel();for(let G=0,z=u.length-2;G<z;G++){const U=u[G];if(!U)break;if(U.type==="free")continue;const Y=U.points[0],H=Rn(U.points);if(!(Y&&H))continue;const X=P.NearestPointOnLineSegment(Y,H,A);if(P.DistMin(X,A,K)){L=X.toFixed().toJson(),K=P.Dist(X,A),D=U;break}}L&&(j=!0,A=L)}if(j&&D){const L=this.editor.getShapePageTransform(l),K=D.points[0],G=Rn(D.points);if(!G)throw Error("Expected a last point!");const z=ve.applyToPoint(L,K),U=ve.applyToPoint(L,G),Y=ve.applyToPoint(L,A);this.editor.snaps.setIndicators([{id:Ct(),type:"points",points:[z,Y,U]}])}else{if(this.editor.snaps.clearIndicators(),I){const L=P.Angle(w,E),G=Hg(L,24)-L;M=P.RotWith(E,w,G)}else M=E;A=this.editor.getPointInShapeSpace(l,M).toFixed().toJson()}this.currentLineLength+=P.Dist(x.points[0],A),b[b.length-1]={...x,type:"straight",points:[x.points[0],A]};const q={id:i,type:this.shapeType,props:{segments:b}};this.canClose()&&(q.props.isClosed=this.getIsClosed(u,s,a)),this.editor.updateShapes([q]);break}case"free":{const b=u.slice(),x=b[b.length-1],w=[...x.points];if(w.length&&this.mergeNextPoint){const{z:E}=w[w.length-1];w[w.length-1]={x:S.x,y:S.y,z:E?Math.max(E,S.z):S.z}}else this.currentLineLength+=P.Dist(w[w.length-1],S),w.push(S);b[b.length-1]={...x,points:w},this.currentLineLength<nr[l.props.size]*4&&(this.currentLineLength=this.getLineLength(b));const _={id:i,type:this.shapeType,props:{segments:b}};if(this.canClose()&&(_.props.isClosed=this.getIsClosed(b,s,a)),this.editor.updateShapes([_]),w.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const E=Mt(),M=this.editor.getShape(i).props;this.editor.createShapes([{id:E,type:this.shapeType,x:Po(r.currentPagePoint.x),y:Po(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:M.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(g*1.25).toFixed():.5}]}]}}]),this.initialShape=$t(this.editor.getShape(E)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let s=0;s<i.points.length-1;s++){const a=i.points[s],l=i.points[s+1];r+=P.Dist2(l,a)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}O(SC,"id","drawing");var zx;let fN=(zx=class extends Ae{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},O(zx,"id","idle"),zx);class yg extends Ae{constructor(){super(...arguments);O(this,"shapeType","draw")}static children(){return[fN,SC]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}O(yg,"id","draw"),O(yg,"initial","idle"),O(yg,"isLockable",!1);class Gw extends Tw{constructor(){super(...arguments);O(this,"shapeType","frame")}onCreate(t){if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],s=this.editor.getShapeAncestors(t).map(a=>a.id);this.editor.getSortedChildIdsForParent(t.parentId).map(a=>{const l=this.editor.getShape(a);if(!l||l.id===t.id||l.isLocked)return;const u=this.editor.getShapePageBounds(l);u&&r.contains(u)&&yne(l,s,t)&&i.push(l.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}O(Gw,"id","frame"),O(Gw,"initial","idle");function yne(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var Fx;let Sne=(Fx=class extends Ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},O(Fx,"id","idle"),Fx);var Bx;let vne=(Bx=class extends Ae{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=Mt(),i=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),s=ss(t,this.editor);this.editor.createShapes([{id:r,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(rs),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=Mt();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(rs),s=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(rs),scale:r,...s}}]);const a=this.editor.getShape(t);if(!a)return;const{w:l,h:u}=a.props,d=new P(l/2,u/2).mul(r),f=this.editor.getShapeParentTransform(a);f&&d.rot(-f.rotation());const g=ss(new P(a.x-d.x,a.y-d.y),this.editor);this.editor.select(t),this.editor.updateShape({id:a.id,type:"geo",x:g.x,y:g.y,props:{geo:this.editor.getStyleForNextShape(rs),w:l*r,h:u*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},O(Bx,"id","pointing"),Bx);class Yw extends Ae{constructor(){super(...arguments);O(this,"shapeType","geo")}static children(){return[Sne,vne]}}O(Yw,"id","geo"),O(Yw,"initial","idle");class Sg extends Ae{constructor(){super(...arguments);O(this,"shapeType","highlight")}static children(){return[fN,SC]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}O(Sg,"id","highlight"),O(Sg,"initial","idle"),O(Sg,"isLockable",!1);var Ux;let bne=(Ux=class extends Ae{constructor(){super(...arguments);O(this,"shapeId","")}onEnter(t){this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},O(Ux,"id","idle"),Ux);const Ak=2;var $x;let xne=($x=class extends Ae{constructor(){super(...arguments);O(this,"shape",{});O(this,"markId")}onEnter(t){const{inputs:r}=this.editor,{currentPagePoint:i}=r;this.markId=void 0;const s=t.shapeId&&this.editor.getShape(t.shapeId);if(s&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s.id}`),this.shape=s;const a=this.editor.getShapeHandles(this.shape);if(!a)return;const l=a.filter(b=>b.type==="vertex").sort(Jn),u=l[l.length-1],d=l[l.length-2],f=ve.applyToPoint(this.editor.getShapeParentTransform(this.shape),new P(this.shape.x,this.shape.y)),g=P.Sub(i,f).addXY(.1,.1),m=ss(g,this.editor),S=$t(this.shape.props.points);if(P.DistMin(u,d,Ak)||P.DistMin(m,u,Ak))S[u.id]={id:u.id,index:u.index,x:m.x,y:m.y};else{const b=Is(u.index);S[b]={id:b,index:b,x:m.x,y:m.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:S}}])}else{const a=Mt();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${a}`);const l=ss(i,this.editor);this.editor.createShapes([{id:a,type:"line",x:l.x,y:l.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(a),this.shape=this.editor.getShape(a)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Rn(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},O($x,"id","pointing"),$x);class Vw extends Ae{constructor(){super(...arguments);O(this,"shapeType","line")}static children(){return[bne,xne]}}O(Vw,"id","line"),O(Vw,"initial","idle");var Hx;let wne=(Hx=class extends Ae{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},O(Hx,"id","idle"),Hx);const _ne=0,It=200,wy=new P(It/2,It/2),pN=10,Cne=n=>[[["a1"],new P(It*.5,It*-.5-n.options.adjacentShapeMargin)],[["a2"],new P(It*1.5+n.options.adjacentShapeMargin,It*.5)],[["a3"],new P(It*.5,It*1.5+n.options.adjacentShapeMargin)],[["a4"],new P(It*-.5-n.options.adjacentShapeMargin,It*.5)]];function Ene(n,e){if(e===1)return Cne(n);const t=It*e,r=n.options.adjacentShapeMargin*e;return[[["a1"],new P(t*.5,t*-.5-r)],[["a2"],new P(t*1.5+r,t*.5)],[["a3"],new P(t*.5,t*1.5+r)],[["a4"],new P(t*-.5-r,t*.5)]]}function gN(n,e,t,r,i,s){return Object.fromEntries(Ene(n,s).map(([a,l],u)=>{const d=l.clone();return u===0&&i?d.y-=i:u===2&&r&&(d.y+=r),[a,d.rot(t).add(e)]}))}function mN(n,e,t,r){const i=new Set(n.getSelectedShapeIds()),s=(It+n.options.adjacentShapeMargin+r)**2,a=new Map,l=[];for(const f of n.getCurrentPageShapes()){if(!n.isShapeOfType(f,"note")||t!==f.props.scale||i.has(f.id))continue;const g=n.getShapePageTransform(f.id);e===g.rotation()&&(a.set(f,n.getShapePageBounds(f).center),l.push(...Object.values(gN(n,g.point(),e,f.props.growY,r,t))))}const u=l.length;let d;for(const[f,g]of a)for(let m=0;m<u;m++)d=l[m],d&&(P.Dist2(g,d)>s||n.isPointInShape(f,d)&&(l[m]=void 0));return Ye(l)}function yN(n,e,t,r,i=!1){let s;const a=n.getCurrentPageShapesSorted(),l=(It+n.options.adjacentShapeMargin**2)**e.props.scale;for(let u=a.length-1;u>=0;u--){const d=a[u];if(d.type==="note"&&d.id!==e.id){const f=n.getShapePageBounds(d);if(f&&P.Dist2(f.center,t)<l&&n.isPointInShape(d,t)){s=d;break}}}if(n.complete(),!s||i){n.markHistoryStoppingPoint("creating note shape");const u=Mt();n.createShape({id:u,type:"note",x:t.x,y:t.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const d=n.getShape(u);if(!d)return;const f=n.getPointInParentSpace(d,P.Sub(t,P.Rot(wy.clone().mul(d.props.scale),r)));n.updateShape({id:u,type:"note",x:f.x,y:f.y}),s=n.getShape(u)}return Tne(n),s}const Pne=16;function Tne(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const r=e.clone().expandBy(Pne/n.getZoomLevel()).expand(t),i=t.clone().translate({x:(r.center.x-t.center.x)*2,y:(r.center.y-t.center.y)*2});n.zoomToBounds(i,{animation:{duration:n.options.animationMediumMs},inset:0})}}var Kx;let Ine=(Kx=class extends Ae{constructor(){super(...arguments);O(this,"dragged",!1);O(this,"info",{});O(this,"markId","");O(this,"shape",{})}onEnter(){const{editor:t}=this,r=Mt();this.markId=t.markHistoryStoppingPoint(`creating_note:${r}`);const i=this.editor.inputs.originPagePoint.clone(),s=Mne(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=Ane(this.editor,r,i)}onPointerMove(t){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},O(Kx,"id","pointing"),Kx);function Mne(n,e,t){let r=pN/n.getZoomLevel(),i;for(const s of mN(n,0,t,0)){const a=P.Sub(e,s),l=a.len();l<r&&(r=l,i=a)}return i}function Ane(n,e,t){n.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const r=n.getShape(e),i=n.getShapeGeometry(r).bounds,s=ss(new P(r.x-i.width/2,r.y-i.height/2),n);return n.updateShapes([{id:e,type:"note",x:s.x,y:s.y}]),n.getShape(e)}class Xw extends Ae{constructor(){super(...arguments);O(this,"shapeType","note")}static children(){return[wne,Ine]}}O(Xw,"id","note"),O(Xw,"initial","idle");function kne(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}const Io=Sj(kne,32);var qx;let jne=(qx=class extends Ae{onPointerMove(e){switch(e.target){case"shape":case"canvas":Io(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){Io.cancel()}onKeyDown(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},O(qx,"id","idle"),qx);var Gx;let One=(Gx=class extends Ae{constructor(){super(...arguments);O(this,"shape");O(this,"markId","");O(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(t){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:i}=r.inputs;if(!i)return;const{originPagePoint:s,currentPagePoint:a}=r.inputs,l=Math.abs(s.x-a.x),d=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(l>d){const f=Mt();this.markId=r.markHistoryStoppingPoint(`creating_text:${f}`);const g=this.createTextShape(f,s,!1,l);if(!g){this.cancel();return}this.shape=r.getShape(g),r.select(f),r.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:l,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(g.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const t=Mt(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(t,r,!0,20)&&(this.editor.select(t),this.editor.setEditingShape(t))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,r,i,s){this.editor.createShape({id:t,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:i,w:s,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const a=this.editor.getShape(t);if(!a){this.cancel();return}const l=this.editor.getShapePageBounds(a),u=new P;if(i)switch(a.props.textAlign){case"start":{u.x=0;break}case"middle":{u.x=-l.width/2;break}case"end":{u.x=-l.width;break}}else u.x=0;if(u.y=-l.height/2,kr(a.parentId)){const g=this.editor.getShapeParentTransform(a);u.rot(-g.rotation())}const d=a.x+u.x,f=a.y+u.y;if(this.editor.getInstanceState().isGridMode){const g=new P(d,f),m=ss(g,this.editor),S=P.Sub(g,m);this.editor.updateShape({...a,x:d-S.x,y:f-S.y})}else this.editor.updateShape({...a,x:d,y:f});return a}},O(Gx,"id","pointing"),Gx);class Ww extends Ae{constructor(){super(...arguments);O(this,"shapeType","text")}static children(){return[jne,One]}}O(Ww,"id","text"),O(Ww,"initial","idle");const Dne=[Ww,yg,Yw,Xw,Vw,Gw,qw,Sg];function Ri(){return Bo({isDarkMode:ef()})}function _y(n){return{key:`${Ns.id}:${n}`,async getElement(){const e=Rne(n);if(!e)return null;const{url:t,fontFaceRule:r}=e,i=await(await Ls(t)).blob(),s=await ts.blobToDataUrl(i),a=r.replace(t,s);return p.jsx("style",{children:a})}}}function Rne(n){const e=qO[n];for(const t of document.fonts)if(e.includes(t.family)&&"$$_url"in t&&typeof t.$$_url=="string"&&"$$_fontface"in t&&typeof t.$$_fontface=="string")return{url:t.$$_url,fontFaceRule:t.$$_fontface};return null}function vC(n){return{key:`${Ns.id}:${n}`,async getElement(){return n!=="pattern"?null:p.jsx(Lne,{})}}}function Lne(){const n=xC(),e=wu(),t=Ri(),r=8/12;return p.jsxs(p.Fragment,{children:[p.jsxs("mask",{id:e,children:[p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),p.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[p.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),p.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),p.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),p.jsx("pattern",{id:n(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function bC(){return{key:`${Ns.id}:pattern`,component:Bne}}const oh=8,kk=(n,e,t)=>new Promise((r,i)=>{const s=oh*e*n,a=document.createElement("canvas");a.width=s,a.height=s;const l=a.getContext("2d");if(!l)return;l.fillStyle=t?Wg.darkMode.solid:Wg.lightMode.solid,l.fillRect(0,0,s,s),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*e*n;const u=8/12,d=f=>f*e*n;l.beginPath(),l.moveTo(d(u*1),d(u*3)),l.lineTo(d(u*3),d(u*1)),l.moveTo(d(u*5),d(u*7)),l.lineTo(d(u*7),d(u*5)),l.moveTo(d(u*9),d(u*11)),l.lineTo(d(u*11),d(u*9)),l.stroke(),a.toBlob(f=>{!f||ln.throwToBlob.get()?i():r(f)})}),jk=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""};let Cx=null;function Nne(){return Cx||(Cx={white:jk([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:jk([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),Cx}function SN(n){return Math.ceil(Math.log2(Math.max(1,n)))}function xC(){const n=is("hash_pattern");return T.useCallback((e,t)=>{const r=SN(e);return t_(n,`${t}_${r}`)},[n])}function vN(n){const e=[],r=SN(n);for(let i=0;i<=r;i++)e.push(Math.pow(2,i));return e}function zne(n){const e=Nne();return vN(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function Fne(){const n=te(),e=oe("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=oe("maxZoom",()=>Math.ceil(Rn(n.getCameraOptions().zoomSteps)),[n]),[r,i]=T.useState(!1),[s,a]=T.useState(()=>zne(t)),l=xC();return T.useEffect(()=>{const d=Promise.all(vN(t).flatMap(g=>[kk(e,g,!1).then(m=>({zoom:g,theme:"light",url:URL.createObjectURL(m)})),kk(e,g,!0).then(m=>({zoom:g,theme:"dark",url:URL.createObjectURL(m)}))]));let f=!1;return d.then(g=>{f||(a(g),i(!0))}),()=>{f=!0,i(!1),d.then(g=>{for(const{url:m}of g)URL.revokeObjectURL(m)})}},[e,t]),{defs:p.jsx(p.Fragment,{children:s.map(d=>{const f=l(d.zoom,d.theme);return p.jsx("pattern",{id:f,width:oh,height:oh,patternUnits:"userSpaceOnUse",children:p.jsx("image",{href:d.url,width:oh,height:oh})},f)})}),isReady:r}}function Bne(){const n=te(),e=T.useRef(null),{defs:t,isReady:r}=Fne();return T.useEffect(()=>{if(r&&kt.isSafari){const i=bN(e.current);i&&n.timers.requestAnimationFrame(()=>{i.style.display="none",n.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),p.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:t})}function bN(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?bN(n.parentElement):null}const Wn=ct.memo(function({theme:e,d:t,color:r,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return p.jsx("path",{fill:e[r].semi,d:t});case"semi":return p.jsx("path",{fill:e.solid,d:t});case"fill":return p.jsx("path",{fill:e[r].fill,d:t});case"pattern":return p.jsx(Une,{theme:e,color:r,fill:i,d:t,scale:s})}});function Une({d:n,color:e,theme:t}){const r=te(),i=Wh(),s=oe("zoomLevel",()=>r.getZoomLevel(),[r]),a=xC(),l=r.getZoomLevel()<=.18;return p.jsxs(p.Fragment,{children:[p.jsx("path",{fill:t[e].pattern,d:n}),p.jsx("path",{fill:i?`url(#${a(1,t.id)})`:l?t[e].semi:`url(#${a(s,t.id)})`,d:n})]})}function $ne(n){return n.replace(/\s/g,"")}function Zw(n,e,t){const{padding:r=0}=t;if(e.length===0)return null;const i=be.From(e[0].box);for(const{box:d}of e)i.union(d);const s=r+(t.offsetX??0),a=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-i.height:(Math.ceil(t.height)-i.height)/2);let l=null;const u=[];for(const{text:d,box:f}of e)l!==null&&f.y>l&&u.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:f.y+a,children:`
`},u.length)),u.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:f.x+s,y:f.y+a,unicodeBidi:"plaintext",children:$ne(d)},u.length)),l=f.y;return p.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:u})}function Hne(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=be.From(t[0].box);for(const{box:s}of t)i.union(s);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function Kne(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Cy({fontSize:n,font:e,align:t,verticalAlign:r,text:i,labelColor:s,bounds:a,padding:l=16,stroke:u=!0}){const d=te(),f=Ri(),g={fontSize:n,fontFamily:qO[e],textAlign:t,verticalTextAlign:r,width:Math.ceil(a.width),height:Math.ceil(a.height),padding:l,lineHeight:rr.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},m=d.textMeasure.measureTextSpans(i,g),S=Hne(t,l,m,a.width);S&&(g.offsetX=S),g.offsetX+=a.x,g.offsetY+=a.y;const b=Zw(d,m,g);let x=null;return u&&(g.fill=f.background,g.stroke=f.background,g.strokeWidth=2,x=Zw(d,m,g)),p.jsxs(p.Fragment,{children:[x,b]})}const qne=T.forwardRef(function({isEditing:e,text:t,handleFocus:r,handleChange:i,handleKeyDown:s,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:u},d){return p.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:r,onChange:i,onKeyDown:s,onBlur:a,onTouchEnd:dn,onContextMenu:e?dn:void 0,onPointerDown:l,onDoubleClick:u,onDragStart:Ze})});function Gne(n,e,t){const r=te(),i=T.useRef(null),s=oe("isEditing",()=>r.getEditingShapeId()===n,[r]),a=oe("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);T.useEffect(()=>{function f(g){var m;g.shapeId===n&&((m=i.current)==null||m.select())}return r.on("select-all-text",f),()=>{r.off("select-all-text",f)}},[r,n,s]),T.useEffect(()=>{var f,g,m,S;s&&(document.activeElement!==i.current&&((f=i.current)==null||f.focus()),r.getInstanceState().isCoarsePointer&&((g=i.current)==null||g.select()),kt.isSafari&&((m=i.current)==null||m.blur(),(S=i.current)==null||S.focus()))},[r,s]);const l=T.useCallback(f=>{if(r.getEditingShapeId()===n)switch(f.key){case"Enter":{(f.ctrlKey||f.metaKey)&&r.complete();break}}},[r,n]),u=T.useCallback(f=>{if(r.getEditingShapeId()!==n)return;let g=hu.normalizeText(f.currentTarget.value);const m=g.replace(/\t/g,eu);if(m!==g){const S=f.currentTarget.selectionStart;f.currentTarget.value=m,f.currentTarget.selectionStart=S+(m.length-g.length),f.currentTarget.selectionEnd=S+(m.length-g.length),g=m}r.updateShape({id:n,type:e,props:{text:g}})},[r,n,e]),d=T.useCallback(f=>{r.dispatch({...Qr(f),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),dn(f)},[r,n]);return{rInput:i,handleFocus:bh,handleBlur:bh,handleKeyDown:l,handleChange:u,handleInputPointerDown:d,handleDoubleClick:dn,isEmpty:t.trim().length===0,isEditing:s,isEditingAnything:a}}const Ey=ct.memo(function({shapeId:e,type:t,text:r,labelColor:i,font:s,fontSize:a,lineHeight:l,align:u,verticalAlign:d,wrap:f,isSelected:g,padding:m=0,onKeyDown:S,classNamePrefix:b,style:x,textWidth:w,textHeight:_}){const{rInput:E,isEmpty:M,isEditing:I,isEditingAnything:A,...j}=Gne(e,t,r),[D,R]=T.useState(r);T.useEffect(()=>{I||R(r)},[I,r]);const q=hu.normalizeTextForDom(r),L=q.length>0,K=Kne(u);if(!I&&!L)return null;const G=b||"tl-text";return p.jsx("div",{className:`${G}-label tl-text-wrapper`,"data-font":s,"data-align":u,"data-hastext":!M,"data-isediting":I,"data-iseditinganything":A,"data-textwrap":!!f,"data-isselected":g,style:{justifyContent:u==="middle"||K?"center":u,alignItems:d==="middle"?"center":d,padding:m,...x},children:p.jsxs("div",{className:`${G}-label__inner tl-text-content__wrapper`,style:{fontSize:a,lineHeight:Math.floor(a*l)+"px",minHeight:Math.floor(a*l)+"px",minWidth:Math.ceil(w||0),color:i,width:w?Math.ceil(w):void 0,height:_?Math.ceil(_):void 0},children:[p.jsx("div",{className:`${G} tl-text tl-text-content`,dir:"auto",children:q.split(`
`).map((z,U)=>p.jsx("div",{dir:"auto",children:z},U))}),(A||g)&&p.jsx(qne,{ref:E,text:r,isEditing:I,...j,handleKeyDown:S??j.handleKeyDown},D)]})})}),Yne=new Rs;function Vne(n){return Yne.get(n,()=>n.store.createComputedCache("arrowLabelSize",e=>{const t=As(n,e);let r=0,i=0;const s=t.isStraight?new To({start:P.From(t.start.point),end:P.From(t.end.point)}):new Qc({center:P.Cast(t.handleArc.center),start:P.Cast(t.start.point),end:P.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});if(e.props.text.trim()){const a=s.bounds,l=Qw(e),{w:u,h:d}=n.textMeasure.measureText(e.props.text,{...rr,fontFamily:No[e.props.font],fontSize:l,maxWidth:null});r=u,i=d;let f=!1;if(a.width>a.height?(r=Math.max(Math.min(u,64),Math.min(a.width-64,u)),f=!0):r>16*l&&(r=16*l,f=!0),f){const{w:g,h:m}=n.textMeasure.measureText(e.props.text,{...rr,fontFamily:No[e.props.font],fontSize:l,maxWidth:r});r=g,i=m}}return new P(r,i).addScalar(yC*2*e.props.scale)}))}function wC(n,e){return e.props.text.trim()===""?new P(0,0).addScalar(yC*2*e.props.scale):Vne(n).get(e.id)??new P(0,0)}function xN(n){const e=nr[n.props.size];return(Lte+(e-nr.s)*2+(e===nr.xl?20:0))*n.props.scale}function Xne(n,e,t){const r=wC(n,e),i=xN(e),s=P.Nudge(t.start.point,t.end.point,i),a=P.Nudge(t.end.point,t.start.point,i),l=h_(s,a,be.FromCenter(t.middle,r).corners);if(!l||l.length!==2)return{start:.5,end:.5};let[u,d]=l;P.Dist2(u,s)>P.Dist2(d,s)&&([d,u]=l);const f=s.add(P.Sub(t.middle,u)),g=a.add(P.Sub(t.middle,d)),m=P.Dist(t.start.point,f)/t.length,S=P.Dist(t.start.point,g)/t.length;return{start:m,end:S}}function Wne(n,e,t){const r=wC(n,e),i=xN(e),s=Math.sign(e.props.bend),a=i/t.handleArc.radius*s,l=P.Angle(t.bodyArc.center,t.start.point)-a,u=P.Angle(t.bodyArc.center,t.end.point)+a,d=jl(t.bodyArc.center,t.bodyArc.radius,l),f=jl(t.bodyArc.center,t.bodyArc.radius,u),g=[],m=Dk(t.bodyArc.center,t.bodyArc.radius,l,u,s,be.FromCenter(d,r).corners);g.push(new an({points:be.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const S=Dk(t.bodyArc.center,t.bodyArc.radius,l,u,s,be.FromCenter(f,r).corners);g.push(new an({points:be.FromCenter(f,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const D of[...m??[],...S??[],d,f])g.push(new E_({x:D.x-3,y:D.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const b=(m&&Rk(t.start.point,m))??t.middle,x=(S&&Rk(t.end.point,S))??t.middle,w=P.Angle(t.bodyArc.center,t.start.point),_=P.Angle(t.bodyArc.center,t.end.point),E=P.Angle(t.bodyArc.center,b),M=P.Angle(t.bodyArc.center,x);if(_a(w,E,s)>_a(w,M,s))return{start:.5,end:.5,dbg:g};const I=_a(w,_,s),A=_a(w,E,s)/I,j=_a(w,M,s)/I;return{start:A,end:j,dbg:g}}function vg(n,e){let t;const r=[],i=As(n,e),s={hasStartBinding:!!i.bindings.start,hasEndBinding:!!i.bindings.end,hasStartArrowhead:i.start.arrowhead!=="none",hasEndArrowhead:i.end.arrowhead!=="none"};if(i.isStraight){const l=Xne(n,e,i),u=Ok(n,e,l,s);t=P.Lrp(i.start.point,i.end.point,u)}else{const l=Wne(n,e,i);l.dbg&&r.push(...l.dbg);const u=Ok(n,e,l,s),d=Zne(P.Angle(i.bodyArc.center,i.start.point),P.Angle(i.bodyArc.center,i.end.point),Math.sign(e.props.bend),u);t=jl(i.bodyArc.center,i.bodyArc.radius,d)}const a=wC(n,e);return{box:be.FromCenter(t,a),debugGeom:r}}function Ok(n,e,t,r){const{hasEndArrowhead:i,hasEndBinding:s,hasStartBinding:a,hasStartArrowhead:l}=r,u=EN(n,e);let d=On(e.props.labelPosition,l||a?t.start:0,i||s?t.end:1);const f=Math.min(.02,500/u*.02);return d=d>=.5-f&&d<=.5+f?.5:d,d}function Dk(n,e,t,r,i,s){const a=vw(n,e,s),l=_a(t,r,i);return a==null?void 0:a.filter(u=>{const d=_a(t,P.Angle(n,u),i);return d>=0&&d<=l})}function Rk(n,e){let t=null,r=-1/0;for(const i of e){const s=P.Dist2(n,i);s>r&&(t=i,r=s)}return t}function Zne(n,e,t,r){const i=_a(n,e,t);return n+i*r*t*-1}function Qw(n){return Rte[n.props.size]*n.props.scale}function Qne(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,s=n.isStraight?P.Dist(i,r):Math.abs(n.bodyArc.length),a=Math.max(Math.min(s/5,t*3),t);let l;if(n.isStraight)l=P.Nudge(r,i,a);else{const u=zq(r,a,n.handleArc.center,n.handleArc.radius);l=e==="end"?n.handleArc.sweepFlag?u[0]:u[1]:n.handleArc.sweepFlag?u[1]:u[0]}return P.IsNaN(l)&&(l=n.start.point),{point:r,int:l}}function Jne({point:n,int:e}){const t=P.RotWith(e,n,pt/6),r=P.RotWith(e,n,-pt/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function ere({point:n,int:e}){const t=P.RotWith(e,n,pt/6),r=P.RotWith(e,n,-pt/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function tre({point:n,int:e}){const t=P.Sub(e,n).div(2),r=P.Add(n,P.Rot(t,Nt)),i=P.Sub(n,P.Rot(t,Nt));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function nre({point:n,int:e}){const t=P.Lrp(n,e,.45),r=P.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function rre({point:n,int:e}){const t=P.Lrp(n,e,.75),r=P.RotWith(t,n,pt/4),i=P.RotWith(t,n,-pt/4),s=P.Lrp(r,i,.5);return s.add(P.Sub(s,n)),`M ${s.x} ${s.y} L ${i.x} ${i.y} ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function ire({int:n,point:e}){const t=P.Lrp(e,n,.85),r=P.Sub(t,e).div(2),i=P.Add(e,P.Rot(r,Nt)),s=P.Sub(e,P.Rot(r,Nt)),a=P.Add(t,P.Rot(r,Nt)),l=P.Sub(t,P.Rot(r,Nt));return`M ${i.x} ${i.y} L ${a.x} ${a.y} L ${l.x} ${l.y} L ${s.x} ${s.y} Z`}function sre({int:n,point:e}){const t=P.Sub(n,e).div(2),r=P.Add(e,P.Rot(t,Nt)),i=P.Sub(e,P.Rot(t,Nt));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function vm(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=Qne(n,e,t);if(i){switch(r){case"bar":return sre(i);case"square":return ire(i);case"diamond":return rre(i);case"dot":return nre(i);case"inverted":return tre(i);case"arrow":return Jne(i);case"triangle":return ere(i)}return""}}function ore(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${s} ${t.handle.x},${t.handle.y}`}function wN(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${s} ${t.point.x},${t.point.y}`}function _N(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function are(n){return _N(n.start.handle,n.end.handle)}function CN(n){return _N(n.start.point,n.end.point)}class bg extends Mi{constructor(){super(...arguments);O(this,"_resizeInitialBindings",new Rs)}canEdit(){return!0}canBind({toShapeType:t}){return t!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(t){const r=Dr(this.editor,t);return!r.start&&!r.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const r=As(this.editor,t),i=[],s=r.isStraight?new To({start:P.From(r.start.point),end:P.From(r.end.point)}):new Qc({center:P.Cast(r.handleArc.center),start:P.Cast(r.start.point),end:P.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let a;if(t.props.text.trim()){const l=vg(this.editor,t);i.push(...l.debugGeom),a=new ji({x:l.box.x,y:l.box.y,width:l.box.w,height:l.box.h,isFilled:!0,isLabel:!0})}return new ki({children:[...a?[s,a]:[s],...i]})}getHandles(t){const r=As(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}getText(t){return t.props.text}onHandleDrag(t,{handle:r,isPrecise:i}){const s=r.id,a=Dr(this.editor,t);if(s==="middle"){const{start:j,end:D}=Jc(this.editor,t,a),R=P.Sub(D,j),q=P.Per(R),L=P.Med(D,j),K=P.Sub(L,q),G=P.Add(L,q),z=P.NearestPointOnLineSegment(K,G,r,!1);let U=P.Dist(z,L);return P.Clockwise(z,D,L)&&(U*=-1),{id:t.id,type:t.type,props:{bend:U}}}const l={id:t.id,type:"arrow",props:{}},u=a[s],f=a[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return gg(this.editor,t,s),l.props[s]={x:r.x,y:r.y},l;const g=this.editor.getShapePageTransform(t.id).applyToPoint(r),m=this.editor.getShapeAtPoint(g,{hitInside:!0,hitFrameInside:!0,margin:0,filter:j=>!j.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:j,binding:"arrow"})});if(!m){gg(this.editor,t,s);const j=ss(new P(r.x,r.y),this.editor);return l.props[s]={x:j.x,y:j.y},l}const S=this.editor.getShapeGeometry(m),b=be.ZeroFix(S.bounds),w=this.editor.getShapePageTransform(l.id).applyToPoint(r),_=this.editor.getPointInShapeSpace(m,w);let E=i;E||(!u||u&&m.id!==u.toId)&&(E=this.editor.inputs.pointerVelocity.len()<.5),i||(S.isClosed||(E=!0),f&&m.id===f.toId&&f.props.isPrecise&&(E=!0));const M={x:(_.x-b.minX)/b.width,y:(_.y-b.minY)/b.height};E&&P.Dist(_,b.center)<Math.max(4,Math.min(Math.min(b.width,b.height)*.15,16))/this.editor.getZoomLevel()&&(M.x=.5,M.y=.5);const I={terminal:s,normalizedAnchor:M,isPrecise:E,isExact:this.editor.inputs.altKey};Yd(this.editor,t,m.id,I),this.editor.setHintingShapes([m.id]);const A=Dr(this.editor,t);return A.start&&A.end&&A.start.toId===A.end.toId&&P.Equals(A.start.props.normalizedAnchor,A.end.props.normalizedAnchor)&&Yd(this.editor,t,A.end.toId,{...A.end.props,normalizedAnchor:{x:A.end.props.normalizedAnchor.x+.05,y:A.end.props.normalizedAnchor.y}}),l}onTranslateStart(t){const r=Dr(this.editor,t),i=Jc(this.editor,t,r),s=this.editor.getShapePageTransform(t.id),a=this.editor.getSelectedShapeIds();if(!(r.start&&(a.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(a.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){Nk.set(t,{pagePosition:s.applyToPoint(t),terminalBindings:zh(i,(l,u)=>{const d=r[l];return d?{binding:d,shapePosition:u,pagePosition:s.applyToPoint(u)}:null})}),r.start&&(Sm({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),r.end&&Sm({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const l of["start","end"]){const u=r[l];u&&this.editor.updateBinding({...u,props:{...u.props,isPrecise:!0}})}}}onTranslate(t,r){const i=Nk.get(t);if(!i)return;const s=this.editor.getShapePageTransform(r.id),a=P.Sub(s.applyToPoint(r),i.pagePosition);for(const l of Object.values(i.terminalBindings)){if(!l)continue;const u=P.Add(l.pagePosition,P.Mul(a,.5)),d=this.editor.getShapeAtPoint(u,{hitInside:!0,hitFrameInside:!0,margin:0,filter:f=>!f.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:f,binding:"arrow"})});if((d==null?void 0:d.id)===l.binding.toId){const f=be.ZeroFix(this.editor.getShapeGeometry(d).bounds),g=this.editor.getPointInShapeSpace(d,u),m={x:(g.x-f.minX)/f.width,y:(g.y-f.minY)/f.height};Yd(this.editor,r,d.id,{...l.binding.props,normalizedAnchor:m,isPrecise:!0})}else gg(this.editor,r,l.binding.props.terminal)}}onResize(t,r){const{scaleX:i,scaleY:s}=r,a=this._resizeInitialBindings.get(t,()=>Dr(this.editor,t)),l=Jc(this.editor,t,a),{start:u,end:d}=$t(t.props);let{bend:f}=t.props;a.start||(u.x=l.start.x*i,u.y=l.start.y*s),a.end||(d.x=l.end.x*i,d.y=l.end.y*s);const g=Math.abs(i),m=Math.abs(s),S=a!=null&&a.start?P.From(a.start.props.normalizedAnchor):null,b=a!=null&&a.end?P.From(a.end.props.normalizedAnchor):null;return i<0&&s>=0?(f!==0&&(f*=-1,f*=Math.max(g,m)),S&&(S.x=1-S.x),b&&(b.x=1-b.x)):i>=0&&s<0?(f!==0&&(f*=-1,f*=Math.max(g,m)),S&&(S.y=1-S.y),b&&(b.y=1-b.y)):i>=0&&s>=0?f!==0&&(f*=Math.max(g,m)):i<0&&s<0&&(f!==0&&(f*=Math.max(g,m)),S&&(S.x=1-S.x,S.y=1-S.y),b&&(b.x=1-b.x,b.y=1-b.y)),a.start&&S&&Yd(this.editor,t,a.start.toId,{...a.start.props,normalizedAnchor:S.toJson()}),a.end&&b&&Yd(this.editor,t,a.end.toId,{...a.end.props,normalizedAnchor:b.toJson()}),{props:{start:u,end:d,bend:f}}}onDoubleClickHandle(t,r){switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(t){const r=Ri(),i=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),a=As(this.editor,t);if(!(a!=null&&a.isValid))return null;const l=vg(this.editor,t),u=t.id===this.editor.getOnlySelectedShapeId(),f=this.editor.getEditingShapeId()===t.id||t.props.text;return p.jsxs(p.Fragment,{children:[p.jsx(Oa,{style:{minWidth:50,minHeight:50},children:p.jsx(Lk,{shape:t,shouldDisplayHandles:s&&(i==null?void 0:i.id)===t.id})}),f&&p.jsx(Ey,{shapeId:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:Qw(t),lineHeight:rr.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:r[t.props.labelColor].solid,textWidth:l.box.w-yC*2*t.props.scale,isSelected:u,padding:0,style:{transform:`translate(${l.box.center.x}px, ${l.box.center.y}px)`}})]})}indicator(t){const r=Zm(t.id),i=is(t.id+"_clip"),s=As(this.editor,t);if(!s)return null;const{start:a,end:l}=Jc(this.editor,t,s==null?void 0:s.bindings),u=this.editor.getShapeGeometry(t),d=u.bounds,f=t.props.text.trim()?u.children[1]:null;if(P.Equals(a,l))return null;const g=nr[t.props.size]*t.props.scale,m=s.start.arrowhead&&vm(s,"start",g),S=s.end.arrowhead&&vm(s,"end",g),b=s.isStraight?CN(s):wN(s),x=m&&s.start.arrowhead!=="arrow"||S&&s.end.arrowhead!=="arrow"||!!f;if(r&&f)return p.jsx("rect",{x:ee(f.x),y:ee(f.y),width:f.w,height:f.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale});const w=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),_=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs("g",{children:[x&&p.jsx("defs",{children:p.jsx(PN,{hasText:t.props.text.trim().length>0,bounds:d,labelBounds:f?f.getBounds():new be(0,0,0,0),as:w&&m?m:"",ae:_&&S?S:""})}),p.jsxs("g",{style:{clipPath:x?`url(#${i})`:void 0,WebkitClipPath:x?`url(#${i})`:void 0},children:[x&&p.jsx("rect",{x:d.minX-100,y:d.minY-100,width:d.width+200,height:d.height+200,opacity:0}),p.jsx("path",{d:b})]}),m&&p.jsx("path",{d:m}),S&&p.jsx("path",{d:S}),f&&p.jsx("rect",{x:ee(f.x),y:ee(f.y),width:f.w,height:f.h,rx:3.5,ry:3.5})]})}onEditEnd(t){const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])}toSvg(t,r){r.addExportDef(vC(t.props.fill)),t.props.text&&r.addExportDef(_y(t.props.font));const i=Bo(r),s=1/t.props.scale;return p.jsxs("g",{transform:`scale(${s})`,children:[p.jsx(Lk,{shape:t,shouldDisplayHandles:!1}),p.jsx(Cy,{fontSize:Qw(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:i[t.props.labelColor].solid,bounds:vg(this.editor,t).box.clone().expandBy(-4.25*t.props.scale),padding:0})]})}getCanvasSvgDefs(){return[bC(),{key:"arrow:dot",component:lre},{key:"arrow:cross",component:cre}]}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,scale:st(t.props.scale,r.props.scale,i),start:{x:st(t.props.start.x,r.props.start.x,i),y:st(t.props.start.y,r.props.start.y,i)},end:{x:st(t.props.end.x,r.props.end.x,i),y:st(t.props.end.y,r.props.end.y,i)},bend:st(t.props.bend,r.props.bend,i),labelPosition:st(t.props.labelPosition,r.props.labelPosition,i)}}}O(bg,"type","arrow"),O(bg,"props",YO),O(bg,"migrations",VO);function EN(n,e){const t=As(n,e);return t.isStraight?P.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const Lk=Bn(function({shape:e,shouldDisplayHandles:t}){const r=te(),i=Ri(),s=As(r,e),a=be.ZeroFix(r.getShapeGeometry(e).bounds),l=Dr(r,e),u=oe("force solid",()=>r.getZoomLevel()<.2,[r]),d=is(e.id+"_clip"),f=is("arrowhead-dot"),g=is("arrowhead-cross");if(!(s!=null&&s.isValid))return null;const m=nr[e.props.size]*e.props.scale,S=s.start.arrowhead&&vm(s,"start",m),b=s.end.arrowhead&&vm(s,"end",m),x=s.isStraight?CN(s):wN(s);let w=null;if(t){const j=2/r.getZoomLevel(),{strokeDasharray:D,strokeDashoffset:R}=es(EN(r,e),j,{end:"skip",start:"skip",lengthRatio:2.5});w=l.start||l.end?p.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?are(s):ore(s),strokeDasharray:D,strokeDashoffset:R,strokeWidth:j,markerStart:l.start?l.start.props.isExact?"":l.start.props.isPrecise?`url(#${g})`:`url(#${f})`:"",markerEnd:l.end?l.end.props.isExact?"":l.end.props.isPrecise?`url(#${g})`:`url(#${f})`:"",opacity:.16}):null}const{strokeDasharray:_,strokeDashoffset:E}=es(s.isStraight?s.length:Math.abs(s.bodyArc.length),m,{style:e.props.dash,forceSolid:u}),M=vg(r,e),I=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),A=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:d,children:p.jsx(PN,{hasText:e.props.text.trim().length>0,bounds:a,labelBounds:M.box,as:I&&S?S:"",ae:A&&b?b:""})})}),p.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:m,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[w,p.jsxs("g",{style:{clipPath:`url(#${d})`,WebkitClipPath:`url(#${d})`},children:[p.jsx("rect",{x:ee(a.minX-100),y:ee(a.minY-100),width:ee(a.width+200),height:ee(a.height+200),opacity:0}),p.jsx("path",{d:x,strokeDasharray:_,strokeDashoffset:E})]}),S&&I&&e.props.fill!=="none"&&p.jsx(Wn,{theme:i,d:S,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),b&&A&&e.props.fill!=="none"&&p.jsx(Wn,{theme:i,d:b,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),S&&p.jsx("path",{d:S}),b&&p.jsx("path",{d:b})]})]})});function PN({hasText:n,bounds:e,labelBounds:t,as:r,ae:i}){const s=`M${ee(e.minX-100)},${ee(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,a=`M${ee(t.minX)},${ee(t.minY)} v${t.height} h${t.width} v-${t.height} Z`;return p.jsx("path",{d:`${s}${n?a:""}${r}${i}`})}const Nk=new WeakMap;function lre(){const n=is("arrowhead-dot");return p.jsx("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:p.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function cre(){const n=is("arrowhead-cross");return p.jsxs("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[p.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),p.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const zk="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function fu({url:n}){const e=te(),t=oe("zoomLevel",()=>e.getZoomLevel()<.32,[e]);return p.jsx("a",{className:Oe("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:dn,onPointerUp:dn,title:n,draggable:!1,children:p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${zk}") center 100% / 100% no-repeat`,WebkitMask:`url("${zk}") center 100% / 100% no-repeat`}})})}const Fk="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",ure=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function bm(n){return ure.map(t=>{const{offsetX:r,offsetY:i,blur:s,spread:a,color:l}=t,u=new P(r,i),{x:d,y:f}=u.rot(-n);return`${d}px ${f}px ${s}px ${a}px ${l}`}).join(", ")}const dre=300,TN=320,hre=46,fre=101;class xg extends Mu{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:dre,h:TN,assetId:null}}component(e){return p.jsx(pre,{shape:e,util:this})}indicator(e){return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return Bk(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(ri.isValid(t.props.url))mre(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return Bk(this.editor,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r)}}}O(xg,"type","bookmark"),O(xg,"props",eD),O(xg,"migrations",tD);function pre({shape:n,util:e}){const t=n.props.assetId?e.editor.getAsset(n.props.assetId):null,r=!!Wh()&&kt.isSafari,i=e.editor.getShapePageTransform(n).rotation(),s=gre(n),[a,l]=T.useState(!0),u=()=>l(!1);return p.jsx(jo,{children:p.jsxs("div",{className:Oe("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:bm(i),maxHeight:n.props.h},children:[(!t||t.props.image)&&p.jsxs("div",{className:"tl-bookmark__image_container",children:[t?p.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t==null?void 0:t.props.image,alt:(t==null?void 0:t.props.title)||""}):p.jsx("div",{className:"tl-bookmark__placeholder"}),(t==null?void 0:t.props.image)&&p.jsx(fu,{url:n.props.url})]}),p.jsxs("div",{className:"tl-bookmark__copy_container",children:[t!=null&&t.props.title?p.jsx("h2",{className:"tl-bookmark__heading",children:ene(t.props.title)}):null,t!=null&&t.props.description&&(t!=null&&t.props.image)?p.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,p.jsxs("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:dn,onPointerUp:dn,onClick:dn,children:[a&&(t!=null&&t.props.favicon)?p.jsx("img",{className:"tl-bookmark__favicon",src:t==null?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:u,alt:`favicon of ${s}`}):p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${Fk}") center 100% / 100% no-repeat`,WebkitMask:`url("${Fk}") center 100% / 100% no-repeat`}}),p.jsx("span",{children:s})]})]})]})})}function Bk(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let r=TN;return t&&(t.props.image||(t.props.title?r=fre:r=hre)),{...e,props:{...e.props,h:r}}}const gre=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function mre(n,e){const{url:t}=e.props,r=ja.createId(v1(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),yre(n,e))}const yre=y1(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.run(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Hl(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${ft(r)}L${ft(i)}`;let s="";for(let a=2,l=t-1;a<l;a++)r=n[a].point,i=n[a+1].point,s+=Or(r,i);return e?`M${Or(n[0].point,n[1].point)}Q${ft(n[1].point)}${Or(n[1].point,n[2].point)}T${s}${Or(n[t-1].point,n[0].point)}${Or(n[0].point,n[1].point)}Z`:`M${ft(n[0].point)}Q${ft(n[1].point)}${Or(n[1].point,n[2].point)}${n.length>3?"T":""}${s}L${ft(n[t-1].point)}`}function Sre(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:s=!0}=r;vt(!t.taper&&!r.taper,"cap taper not supported here"),vt(!t.easing&&!r.easing,"cap easing not supported here"),vt(i&&s,"cap must be true");const a=Us(n,e);xy(a,e);const l=vre(a);let u="";for(const d of l)u+=xre(d,e);return u}function vre(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],r=P.Sub(n[1].point,n[0].point).uni(),i,s,a,l,u;for(let d=1,f=n.length;d<f-1;d++){if(a=n[d-1],l=n[d],u=n[d+1],i=P.Sub(u.point,l.point).uni(),s=P.Dpr(r,i),r=i,s<-.8){const g={...l,point:l.input};t.push(g),e.push(Ex(t)),t=[g];continue}if(t.push(l),!(s>.7)&&(P.Dist2(a.point,l.point)+P.Dist2(l.point,u.point))/((a.radius+l.radius+u.radius)/3)**2<1.5){t.push(l),e.push(Ex(t)),t=[l];continue}}return t.push(n[n.length-1]),e.push(Ex(t)),e}function Ex(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],P.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const r=n[n.length-1];let i;for(;n.length>2&&(i=n[n.length-2],P.Dist2(r.point,i.point)<((r.radius+i.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:P.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:P.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function bre(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function xre(n,e={}){if(n.length===0)return"";if(n.length===1)return bre(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=iN(n,e);r.reverse();let i=`M${ft(t[0])}T`;for(let s=1;s<t.length;s++)i+=Or(t[s-1],t[s]);{const s=n[n.length-1],a=s.radius,l=s.vector.clone().per().neg(),u=P.Add(s.point,P.Mul(l,a)),d=P.Add(s.point,P.Mul(l,-a));i+=`${ft(u)}A${ee(a)},${ee(a)} 0 0 1 ${ft(d)}T`}for(let s=1;s<r.length;s++)i+=Or(r[s-1],r[s]);{const s=n[0],a=s.radius,l=s.vector.clone().per(),u=P.Add(s.point,P.Mul(l,a)),d=P.Add(s.point,P.Mul(l,-a));i+=`${ft(u)}A${ee(a)},${ee(a)} 0 0 1 ${ft(d)}Z`}return i}const IN=(n,e,t)=>{const r=[],i=[];n.forEach(d=>r.push(...d.points)),e.forEach(d=>i.push(...d.points));const s=Math.max(r.length,i.length),a=[],l=[];for(let d=0;d<s;d++)a.push(r[d]||r[r.length-1]),l.push(i[d]||i[i.length-1]);return[{type:"free",points:a.map((d,f)=>{let g=.5;return l[f].z!==void 0&&d.z!==void 0&&(g=st(d.z,l[f].z,t)),{x:st(d.x,l[f].x,t),y:st(d.y,l[f].y,t),z:g}})}]},wre=n=>n*.65+gU(n*pt/2)*.35,_re=n=>({size:n,thinning:.5,streamline:lu(n,[9,16],[.64,.74],!0),smoothing:.62,easing:Tn.easeOutSine,simulatePressure:!0}),Cre=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:wre}),Uk=n=>({size:n,thinning:0,streamline:lu(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Tn.linear}),Ere=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Tn.linear});function _C({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Tn.easeOutSine,last:e}}function Jw(n,e,t,r){const i=n.isComplete||t;return r?n.isPen?{...Ere(e),last:i}:{...Uk(e),last:i}:n.dash==="draw"?n.isPen?{...Cre(e),last:i}:{..._re(e),last:i}:{...Uk(e),last:i}}function pu(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(P.Cast));else{const r=Math.max(4,Math.floor(P.Dist(t.points[0],t.points[1])/16));e.push(...P.PointsBetween(t.points[0],t.points[1],r))}return e}function Pre(n,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class wg extends Mi{constructor(){super(...arguments);O(this,"options",{maxPointsPerShape:600})}hideResizeHandles(t){return Px(t)}hideRotateHandle(t){return Px(t)}hideSelectionBoundsFg(t){return Px(t)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(t){const r=pu(t.props.segments),i=(nr[t.props.size]+1)*t.props.scale;if(t.props.segments.length===1){const a=be.FromPoints(r);if(a.width<i*2&&a.height<i*2)return new E_({x:-i,y:-i,radius:i,isFilled:!0})}const s=Us(r,Jw(t.props,i,t.props.isPen,!0)).map(a=>a.point);return t.props.isClosed?new an({points:s,isFilled:t.props.fill!=="none"}):new Eu({points:s})}component(t){return p.jsx(Oa,{children:p.jsx($k,{shape:t})})}indicator(t){var f;const r=pu(t.props.segments);let i=(nr[t.props.size]+1)*t.props.scale;!oe("force solid",()=>{const g=this.editor.getZoomLevel();return g<.5&&g<1.5/i},[this.editor,i])&&!t.props.isPen&&t.props.dash==="draw"&&r.length===1&&(i+=ls(t.id)()*(i/6));const a=t.props.isComplete||((f=Rn(t.props.segments))==null?void 0:f.type)==="straight",l=Jw(t.props,i,a,!0),u=Us(r,l),d=u.length>1?Hl(u,t.props.isClosed):MN(r[0],i);return p.jsx("path",{d})}toSvg(t,r){r.addExportDef(vC(t.props.fill));const i=1/t.props.scale;return p.jsx("g",{transform:`scale(${i})`,children:p.jsx($k,{shape:t,zoomOverride:1})})}getCanvasSvgDefs(){return[bC()]}onResize(t,r){const{scaleX:i,scaleY:s}=r,a=[];for(const l of t.props.segments)a.push({...l,points:l.points.map(({x:u,y:d,z:f})=>({x:Po(i*u),y:Po(s*d),z:f}))});return{props:{segments:a}}}expandSelectionOutlinePx(t){const r=t.props.dash==="draw"?1.6:1;return nr[t.props.size]*r/2*t.props.scale}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,segments:IN(t.props.segments,r.props.segments,i),scale:st(t.props.scale,r.props.scale,i)}}}O(wg,"type","draw"),O(wg,"props",rD),O(wg,"migrations",iD);function MN(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Px(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function $k({shape:n,zoomOverride:e}){var S;const t=Ri(),r=te(),i=pu(n.props.segments),s=n.props.isComplete||((S=Rn(n.props.segments))==null?void 0:S.type)==="straight";let a=(nr[n.props.size]+1)*n.props.scale;const l=oe("force solid",()=>{const b=e??r.getZoomLevel();return b<.5&&b<1.5/a},[r,a,e]),u=oe("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!l&&!n.props.isPen&&n.props.dash==="draw"&&i.length===1&&(a+=ls(n.id)()*(a/6));const d=Jw(n.props,a,s,l);if(!l&&n.props.dash==="draw")return p.jsxs(p.Fragment,{children:[n.props.isClosed&&n.props.fill&&i.length>1?p.jsx(Wn,{d:Hl(Us(i,d),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,p.jsx("path",{d:Sre(i,d),strokeLinecap:"round",fill:t[n.props.color].solid})]});const f=Us(i,d),g=f.length<2,m=g?MN(i[0],0):Hl(f,n.props.isClosed);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{d:m,theme:t,color:n.props.color,fill:g||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),p.jsx("path",{d:m,strokeLinecap:"round",fill:g?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:a,strokeDasharray:g?"none":Pre(n,a,u),strokeDashoffset:"0"})]})}function Tre(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Ire(n,e){const t=Ke(e);if(!t)return;const r=t.host.replace("www.","");for(const i of n)if(AN(i.hostnames,r)){const s=i.fromEmbedUrl(e);if(s)return{definition:i,url:s,embedUrl:e}}}const Mre=n=>n.split("*").map(e=>Tre(e)).join(".+"),AN=(n,e)=>!!n.find(t=>{const r=new RegExp(Mre(t));return e.match(r)});function Are(n,e){const t=Ke(e);if(!t)return;const r=t.host.replace("www.","");for(const i of n)if(AN(i.hostnames,r)){const s=i.toEmbedUrl(e);if(s)return{definition:i,embedUrl:s,url:e}}}function kre(n,e){try{return Are(n,e)??Ire(n,e)}catch{return}}const jre=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" "),Eo=class Eo extends Mu{static setEmbedDefinitions(e){Eo.embedDefinitions=e}getEmbedDefinitions(){return Eo.embedDefinitions}getEmbedDefinition(e){return kre(Eo.embedDefinitions,e)}getText(e){return e.props.url}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){var t,r;return!!((r=(t=this.getEmbedDefinition(e.props.url))==null?void 0:t.definition)!=null&&r.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){const t=this.getEmbedDefinition(e.props.url);return(t==null?void 0:t.definition.isAspectRatioLocked)??!1}onResize(e,t){const r=this.isAspectRatioLocked(e),i=this.getEmbedDefinition(e.props.url);let s=(i==null?void 0:i.definition.minWidth)??200,a=(i==null?void 0:i.definition.minHeight)??200;if(r){const l=e.props.w/e.props.h;l>1?s*=l:a/=l}return tf(e,t,{minWidth:s,minHeight:a})}component(e){const t=Wh(),{w:r,h:i,url:s}=e.props,a=Zm(e.id),l=this.getEmbedDefinition(s),u=oe("is hovering",()=>{const{editingShapeId:S,hoveredShapeId:b}=this.editor.getCurrentPageState();if(S&&b!==S){const x=this.editor.getShape(S);if(x&&this.editor.isShapeOfType(x,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(e).rotation();if(t)return p.jsx(jo,{className:"tl-embed-container",id:e.id,children:p.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:bm(d),borderRadius:(l==null?void 0:l.definition.overrideOutlineRadius)??8,background:(l==null?void 0:l.definition.backgroundColor)??"var(--color-background)",width:r,height:i}})});const f=a||u;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(l==null?void 0:l.definition.type)==="tldraw")return null;if((l==null?void 0:l.definition.type)==="github_gist"){const S=l.url.split("/").pop();if(!S)throw Error("No gist id!");return p.jsx(jo,{className:"tl-embed-container",id:e.id,children:p.jsx(Ore,{id:S,width:ee(r),height:ee(i),isInteractive:f,pageRotation:d})})}const m=jre({...qJ,...(l==null?void 0:l.definition.overridePermissions)??{}});return p.jsx(jo,{className:"tl-embed-container",id:e.id,children:l!=null&&l.definition?p.jsx("iframe",{className:"tl-embed",sandbox:m,src:l.embedUrl,width:ee(r),height:ee(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:f?"auto":"none",zIndex:f?"":"-1",boxShadow:bm(d),borderRadius:(l==null?void 0:l.definition.overrideOutlineRadius)??8,background:l==null?void 0:l.definition.backgroundColor}}):null})}indicator(e){const t=this.getEmbedDefinition(e.props.url);return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:(t==null?void 0:t.definition.overrideOutlineRadius)??8,ry:(t==null?void 0:t.definition.overrideOutlineRadius)??8})}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r)}}};O(Eo,"type","embed"),O(Eo,"props",sD),O(Eo,"migrations",oD),O(Eo,"embedDefinitions",aC);let xm=Eo;function Ore({id:n,isInteractive:e,width:t,height:r,style:i,pageRotation:s}){if(!n.match(/^[0-9a-f]+$/))throw Error("No gist id!");return p.jsx("iframe",{className:"tl-embed",draggable:!1,width:ee(t),height:ee(r),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:bm(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function e1(n,e){const i=((Ml(n.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(i)}const Hk=new WeakMap;function Kk(n,e,t){let r=Hk.get(e.props);if(!r){const i=CC(e.props.name,"Frame")+"",s=n.textMeasure.measureTextSpans(i,t),a=s[0],l=Rn(s);r=l.box.w+l.box.x-a.box.x,Hk.set(e.props,r)}return new be(0,-t.height,r,t.height)}function qk(n,e){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:e,offsetY:-34,offsetX:2}}function kN(n,e,t){const r=t?"":"px",i=t?"":"deg";let s;switch(e){case 0:s="";break;case 3:s=`translate(${ee(n.props.w)}${r}, 0${r}) rotate(90${i})`;break;case 2:s=`translate(${ee(n.props.w)}${r}, ${ee(n.props.h)}${r}) rotate(180${i})`;break;case 1:s=`translate(0${r}, ${ee(n.props.h)}${r}) rotate(270${i})`;break;default:throw Error("labelSide out of bounds")}return s}const Dre=T.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=te(),s=T.useCallback(u=>{u.key==="Enter"&&!u.nativeEvent.isComposing&&(dn(u),u.currentTarget.blur(),i.setEditingShape(null))},[i]),a=T.useCallback(u=>{const d=i.getShape(n);if(!d)return;const f=d.props.name,g=u.currentTarget.value.trim();f!==g&&i.updateShapes([{id:n,type:"frame",props:{name:g}}])},[n,i]),l=T.useCallback(u=>{const d=i.getShape(n);if(!d)return;const f=d.props.name,g=u.currentTarget.value;f!==g&&i.updateShapes([{id:n,type:"frame",props:{name:g}}])},[n,i]);return p.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[p.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:a,onChange:l}),CC(e,"Frame")+""]})}),Rre=T.memo(function({id:e,name:t,width:r,height:i}){const s=te(),{side:a,translation:l}=oe("shape rotation",()=>{const f=s.getShape(e);if(!f)return{side:0,translation:"translate(0, 0)"};const g=e1(s,f);return{side:g,translation:kN(f,g,!1)}},[s,e]),u=T.useRef(null),d=Zm(e);return T.useEffect(()=>{const f=u.current;f&&d&&(f.focus(),f.select())},[u,d]),p.jsx("div",{className:"tl-frame-heading",style:{overflow:d?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(a===0||a===2?r:i)}px + var(--space-5))`,bottom:"100%",transform:`${l} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},children:p.jsx("div",{className:"tl-frame-heading-hit-area",children:p.jsx(Dre,{ref:u,id:e,name:t,isEditing:d})})})});function CC(n,e){return n.match(/^\s*$/)?e:n}class _g extends Mu{canEdit(){return!0}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){const{editor:t}=this,r=t.getZoomLevel(),i=qk(e,"black"),s=Kk(t,e,i),a=e1(t,e);let l,u,d,f;const{w:g,h:m}=s,S=Math.min(g,e.props.w*r),b=Math.min(m,e.props.h*r);switch(a){case 0:{l=-8/r,u=(-m-4)/r,d=(S+16)/r,f=m/r;break}case 1:{l=(-m-4)/r,f=(b+16)/r,u=e.props.h-f+8/r,d=m/r;break}case 2:{l=e.props.w-(S+8)/r,u=e.props.h+4/r,d=(b+16)/r,f=m/r;break}case 3:{l=e.props.w+4/r,f=(b+16)/r,u=-8/r,d=m/r;break}}return new ki({children:[new ji({width:e.props.w,height:e.props.h,isFilled:!1}),new ji({x:l,y:u,width:d,height:f,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=Ri(),r=oe("is creating this shape",()=>{const i=this.editor.getStateDescendant("select.resizing");if(!i||!i.getIsActive())return!1;const s=i==null?void 0:i.info;return s?s.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return p.jsxs(p.Fragment,{children:[p.jsx(Oa,{children:p.jsx("rect",{className:Oe("tl-frame__body",{"tl-frame__creating":r}),width:e.props.w,height:e.props.h,fill:t.solid,stroke:t.text})}),r?null:p.jsx(Rre,{id:e.id,name:e.props.name,width:e.props.w,height:e.props.h})]})}toSvg(e,t){const r=Bo({isDarkMode:t.isDarkMode}),i=e1(this.editor,e),s=kN(e,i,!0),a=qk(e,r.text),l=CC(e.props.name,"Frame")+"",u=Kk(this.editor,e,a),d=this.editor.textMeasure.measureTextSpans(l,a),f=Zw(this.editor,d,a);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),p.jsxs("g",{transform:s,children:[p.jsx("rect",{x:u.x-8,y:u.y-4,width:u.width+20,height:u.height,fill:r.background,rx:4,ry:4}),f]})]})}indicator(e){return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every(r=>r.parentId===e.id)||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(t,r.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return tf(e,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r)}}}O(_g,"type","frame"),O(_g,"props",aD),O(_g,"migrations",lD);function Gk(n,e){return n>e?(pt*(e/2)+(n-e))*2:(pt*(n/2)+(e-n))*2}function jN(n,e){return EC(n,e).map((t,r)=>t.getSvgPathData(r===0)).join(" ")+" Z"}function Lre(n,e,t,r){const i=n/4,s=e/4,a=ls(r),l=t*.75,u=E=>E.addXY(a()*l,a()*l),d=new P(n/2,e),f=new P(0,s*1.2),g=new P(n/2,s*.9),m=new P(n,s*1.2),S=u(new P(n/2,e)),b=u(new P(0,s*1.2)),x=u(new P(n/2,s*.9)),w=u(new P(n,s*1.2));return[new Qn({start:d,cp1:new P(i*1.5,s*3),cp2:new P(0,s*2.5),end:f}),new Qn({start:f,cp1:new P(0,-s*.32),cp2:new P(i*1.85,-s*.32),end:g}),new Qn({start:g,cp1:new P(i*2.15,-s*.32),cp2:new P(n,-s*.32),end:m}),new Qn({start:m,cp1:new P(n,s*2.5),cp2:new P(i*2.5,s*3),end:S}),new Qn({start:S,cp1:new P(i*1.5,s*3),cp2:new P(0,s*2.5),end:b}),new Qn({start:b,cp1:new P(0,-s*.32),cp2:new P(i*1.85,-s*.32),end:x}),new Qn({start:x,cp1:new P(i*2.15,-s*.32),cp2:new P(n,-s*.32),end:w}),new Qn({start:w,cp1:new P(n,s*2.5),cp2:new P(i*2.5,s*3),end:d})].map((E,M)=>E.getSvgPathData(M===0)).join(" ")+" Z"}function EC(n,e){const t=n/4,r=e/4;return[new Qn({start:new P(n/2,e),cp1:new P(t*1.5,r*3),cp2:new P(0,r*2.5),end:new P(0,r*1.2)}),new Qn({start:new P(0,r*1.2),cp1:new P(0,-r*.32),cp2:new P(t*1.85,-r*.32),end:new P(n/2,r*.9)}),new Qn({start:new P(n/2,r*.9),cp1:new P(t*2.15,-r*.32),cp2:new P(n,-r*.32),end:new P(n,r*1.2)}),new Qn({start:new P(n,r*1.2),cp1:new P(n,r*2.5),cp2:new P(t*2.5,r*3),end:new P(n/2,e)})]}function Nre(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function zre(n,e,t,r){const i=ls(n),s=e/2,a=t/2,l=PO(s,a),u=[],d=wt*i(),f=wt+Nt/2+Math.abs(i())*Nt,g=Math.max(16,l/10);for(let m=0;m<g;m++){const S=m/(g-1),b=d+S*f,x=Math.cos(b),w=Math.sin(b);u.push(new P(s*x+e*.5+.05*i(),a*w+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?Tn.easeInOutSine(S):Tn.easeInExpo(S)))/2)))}return Us(u,Nre(r))}function Fre(n,e,t,r){return Hl(zre(n,e,t,r))}function t1(n){let e="M";const t=n.length;let r,i,s;for(let a=0,l=t;a<l;a+=3)r=n[a],i=n[a+1],s=n[a+2],e+=`${ft(r)}L${ft(i)}Q${ft(s)}`;return e+=`${ft(n[0])}`,e}function n1(n,e,t,r,i){const s=[],a=ls(n);let l=e[0],u;const d=e.length;for(let f=0,g=d*i;f<g;f++){u=P.AddXY(e[(f+1)%d],a()*t,a()*t);const m=P.Sub(u,l),S=P.Len(m),b=P.Div(m,S).mul(Math.min(S/4,r));s.push(P.Add(l,b),P.Add(u,b.neg()),u),l=u}return s}function Bre(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,a=(Math.PI*(r*2)+2*i)/t,l=n>e?[{type:"straight",start:new P(r,0),delta:new P(1,0)},{type:"arc",center:new P(n-r,r),startAngle:-pt/2},{type:"straight",start:new P(n-r,e),delta:new P(-1,0)},{type:"arc",center:new P(r,r),startAngle:pt/2}]:[{type:"straight",start:new P(n,r),delta:new P(0,1)},{type:"arc",center:new P(r,e-r),startAngle:0},{type:"straight",start:new P(0,e-r),delta:new P(0,-1)},{type:"arc",center:new P(r,r),startAngle:pt}];let u=0;const d=[];for(let f=0;f<t;f++){const g=l[0];g.type==="straight"?d.push(P.Add(g.start,P.Mul(g.delta,u))):d.push(jl(g.center,r,g.startAngle+u/r)),u+=a;let m=g.type==="straight"?i:pt*r;for(;u>m;)u-=m,l.push(l.shift()),m=l[0].type==="straight"?i:pt*r}return d}const Ure={s:50,m:70,l:100,xl:130},$re=.2;function Py(n,e,t,r,i){const s=ls(t),a=Gk(n,e),l=Math.max(Math.ceil(a/Ure[r]),6,Math.ceil(a/Math.min(n,e))),u=a/l*$re,d=Math.max(n-u*2,1),f=Math.max(e-u*2,1),m=Gk(d,f)/l,S=(n-d)/2,b=(e-f)/2,x=Bre(d,f,l).map(I=>I.addXY(S,b)),w=n<20?0:u*.3,_=e<20?0:u*.3,E=x.slice(0);for(let I=0;I<Math.floor(l/2);I++)E[I]=P.AddXY(E[I],s()*w*i,s()*_*i),E[l-I-1]=P.AddXY(E[l-I-1],s()*w*i,s()*_*i);const M=[];for(let I=0;I<E.length;I++){const A=I===E.length-1?0:I+1,j=E[I],D=E[A],R=x[I],q=x[A],L=P.Dist(R,q),K=m-L,z=P.Dist(j,D)/L,U=(Math.max(S,b)+K)*z,Y=P.Lrp(R,q,.5).add(P.Sub(q,R).uni().per().mul(U));Y.x<0?Y.x=0:Y.x>n&&(Y.x=n),Y.y<0?Y.y=0:Y.y>e&&(Y.y=e);const H=B1(j,D,Y),X=P.Dist(H||P.Average([j,D]),j);M.push({leftPoint:j,rightPoint:D,arcPoint:Y,center:H,radius:X})}return M}function Hre(n,e,t,r,i){const s=[],a=Py(n,e,t,r,i);for(const{center:l,radius:u,leftPoint:d,rightPoint:f}of a)s.push(...vU(d,f,l,u,10));return s}function r1(n,e,t,r,i){const s=Py(n,e,t,r,i);let a=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:l,rightPoint:u,radius:d,center:f}of s){if(f===null){a+=` L${u.toFixed()}`;continue}const g=P.Clockwise(l,u,f)?"0":"1";a+=` A${ee(d)},${ee(d)} 0 ${g},1 ${u.toFixed()}`}return a+=" Z",a}const Kre={s:.5,m:.7,l:.9,xl:1.6};function qre(n,e,t,r,i){const s=ls(t),a=Kre[r]*i,l=Py(n,e,t,r,i),f=l.reduce((b,x)=>b+P.Dist2(x.leftPoint,x.rightPoint),0)/l.length>(a*15)**2?b=>P.AddXY(b,s()*a*2,s()*a*2):b=>b;let g=`M${l[0].leftPoint.toFixed()}`,m=f(l[0].leftPoint),S=`M${m.toFixed()}`;for(const{leftPoint:b,center:x,rightPoint:w,radius:_,arcPoint:E}of l){if(x===null){g+=` L${w.toFixed()}`;const R=f(w);S+=` L${R.toFixed()}`,m=R;continue}const M=P.Clockwise(b,w,x)?"0":"1";g+=` A${ee(_)},${ee(_)} 0 ${M},1 ${w.toFixed()}`;const I=f(w),A=f(E),j=B1(m,I,A);if(!j){S+=` L${I.toFixed()}`,m=I;continue}const D=Math.abs(P.Dist(j,m));S+=` A${ee(D)},${ee(D)} 0 ${M},1 ${I.toFixed()}`,m=I}return g+S+" Z"}function i1(n,e){switch(n.geo){case"x-box":return Gre(n.w,n.h,e,n.dash);case"check-box":return Yre(n.w,n.h);default:return}}function Gre(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new P(0,0),new P(n/2,e/2)],[new P(n,e),new P(n/2,e/2)],[new P(0,e),new P(n/2,e/2)],[new P(n,0),new P(n/2,e/2)]];const s=l=>Math.max(0,Math.min(n,l)),a=l=>Math.max(0,Math.min(e,l));return[[new P(s(t*i),a(t*i)),new P(s(n-t*i),a(e-t*i))],[new P(s(t*i),a(e-t*i)),new P(s(n-t*i),a(t*i))]]}function Yre(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,s=l=>Math.max(0,Math.min(n,l)),a=l=>Math.max(0,Math.min(e,l));return[[new P(s(r+t*.25),a(i+t*.52)),new P(s(r+t*.45),a(i+t*.82))],[new P(s(r+t*.45),a(i+t*.82)),new P(s(r+t*.82),a(i+t*.22))]]}function Yk({shape:n,shouldScale:e,forceSolid:t}){const r=e?n.props.scale:1,i=te(),s=Ri(),{id:a,props:l}=n,{w:u,color:d,fill:f,dash:g,growY:m,size:S,scale:b}=l,x=nr[S]*r,w=l.h+m;switch(l.geo){case"cloud":if(g==="solid"){const _=r1(u,w,a,S,b);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:_,color:d,fill:f,scale:r}),p.jsx("path",{d:_,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}else if(g==="draw"){const _=qre(u,w,a,S,b);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:_,color:d,fill:f,scale:r}),p.jsx("path",{d:_,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}else{const _=r1(u,w,a,S,b),E=Py(u,w,a,S,b);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:_,color:d,fill:f,scale:r}),p.jsx("g",{strokeWidth:x,stroke:s[d].solid,fill:"none",pointerEvents:"all",children:E.map(({leftPoint:M,rightPoint:I,center:A,radius:j},D)=>{const R=A?j*Ml(Ml(P.Angle(A,I))-Ml(P.Angle(A,M))):P.Dist(M,I),{strokeDasharray:q,strokeDashoffset:L}=es(R,x,{style:g,start:"outset",end:"outset",forceSolid:t});return p.jsx("path",{d:A?`M${M.x},${M.y}A${j},${j},0,0,1,${I.x},${I.y}`:`M${M.x},${M.y}L${I.x},${I.y}`,strokeDasharray:q,strokeDashoffset:L},D)})})]})}case"ellipse":{const _=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),E=_.getSvgPathData(!0);if(g==="dashed"||g==="dotted"){const M=_.length,{strokeDasharray:I,strokeDashoffset:A}=es(M<64?M*2:M,x,{style:g,snap:4,closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:E,color:d,fill:f,scale:r}),p.jsx("path",{d:E,strokeWidth:x,fill:"none",stroke:s[d].solid,strokeDasharray:I,strokeDashoffset:A})]})}else{const I=(e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:I,color:d,fill:f,scale:r}),p.jsx("path",{d:I,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}}case"oval":{const _=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),E=_.getSvgPathData(!0);if(g==="dashed"||g==="dotted"){const M=_.getLength(),{strokeDasharray:I,strokeDashoffset:A}=es(M<64?M*2:M,x,{style:g,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:E,color:d,fill:f,scale:r}),p.jsx("path",{d:E,strokeWidth:x,fill:"none",stroke:s[d].solid,strokeDasharray:I,strokeDashoffset:A})]})}else return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:E,color:d,fill:f,scale:r}),p.jsx("path",{d:E,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}case"heart":if(g==="dashed"||g==="dotted"||g==="solid"){const _=jN(u,w),E=EC(u,w);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:_,color:d,fill:f,scale:r}),E.map((M,I)=>{const{strokeDasharray:A,strokeDashoffset:j}=es(M.length,x,{style:g,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsx("path",{d:M.getSvgPathData(),strokeWidth:x,fill:"none",stroke:s[d].solid,strokeDasharray:A,strokeDashoffset:j,pointerEvents:"all"},`curve_${I}`)})]})}else{const _=Lre(u,w,x,n.id);return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:_,color:d,fill:f,scale:r}),p.jsx("path",{d:_,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}default:{const _=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),E=_ instanceof ki?_.children[0].vertices:_.vertices,M=i1(n.props,x);if(g==="solid"){let I="M"+E[0]+"L"+E.slice(1)+"Z";if(M)for(const[A,j]of M)I+=`M${A.x},${A.y}L${j.x},${j.y}`;return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:I,color:d,fill:f,scale:r}),p.jsx("path",{d:I,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}else if(g==="dashed"||g==="dotted"){const I="M"+E[0]+"L"+E.slice(1)+"Z";return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:I,color:d,fill:f,scale:r}),p.jsxs("g",{strokeWidth:x,stroke:s[d].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(E.length)).map((A,j)=>{const D=P.ToFixed(E[j]),R=P.ToFixed(E[(j+1)%E.length]),q=P.Dist(D,R),{strokeDasharray:L,strokeDashoffset:K}=es(q,x,{style:g,start:"outset",end:"outset",forceSolid:t});return p.jsx("line",{x1:D.x,y1:D.y,x2:R.x,y2:R.y,strokeDasharray:L,strokeDashoffset:K},j)}),M&&M.map(([A,j],D)=>{const R=P.Dist(A,j),{strokeDasharray:q,strokeDashoffset:L}=es(R,x,{style:g,start:"skip",end:"skip",snap:g==="dotted"?4:void 0,forceSolid:t});return p.jsx("path",{d:`M${A.x},${A.y}L${j.x},${j.y}`,stroke:s[d].solid,strokeWidth:x,fill:"none",strokeDasharray:q,strokeDashoffset:L},`line_fg_${D}`)})]})]})}else if(g==="draw"){let I=t1(n1(a,E,x/3,x*2,2));if(M)for(const[j,D]of M)I+=`M${j.toFixed()}L${D.toFixed()}`;const A=t1(n1(a,E,0,x*2,1));return p.jsxs(p.Fragment,{children:[p.jsx(Wn,{theme:s,d:A,color:d,fill:f,scale:r}),p.jsx("path",{d:I,stroke:s[d].solid,strokeWidth:x,fill:"none"})]})}}}}const Vk=17*3;class Cg extends Mu{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=t/2,s=r/2,a=e.props.fill!=="none";let l;switch(e.props.geo){case"cloud":{l=new an({points:Hre(t,r,e.id,e.props.size,e.props.scale),isFilled:a});break}case"triangle":{l=new an({points:[new P(i,0),new P(t,r),new P(0,r)],isFilled:a});break}case"diamond":{l=new an({points:[new P(i,0),new P(t,s),new P(i,r),new P(0,s)],isFilled:a});break}case"pentagon":{l=new an({points:Fb(t,r,5),isFilled:a});break}case"hexagon":{l=new an({points:Fb(t,r,6),isFilled:a});break}case"octagon":{l=new an({points:Fb(t,r,8),isFilled:a});break}case"ellipse":{l=new dX({width:t,height:r,isFilled:a});break}case"oval":{l=new hX({width:t,height:r,isFilled:a});break}case"star":{const E=wt/5/2,M=Math.floor(5/4)*2,I=5*2-M,A=0,j=Math.floor(5/2)*2,D=Math.cos(-Nt+M*E)*t/2,R=Math.cos(-Nt+I*E)*t/2,q=Math.sin(-Nt+A*E)*r/2,L=Math.sin(-Nt+j*E)*r/2,K=t-Math.abs(D-R),G=r-Math.abs(L-q),z=t/2+R-(t/2-D),U=r/2+q-(r/2-L),Y=1,H=(t-z)/2,X=(r-U)/2,V=(t+K)/2,ie=(r+G)/2,B=V*Y/2,re=ie*Y/2;l=new an({points:Array.from(Array(5*2)).map((me,de)=>{const ye=-Nt+de*E;return new P(H+(de%2?B:V)*Math.cos(ye),X+(de%2?re:ie)*Math.sin(ye))}),isFilled:a});break}case"rhombus":{const _=Math.min(t*.38,r*.38);l=new an({points:[new P(_,0),new P(t,0),new P(t-_,r),new P(0,r)],isFilled:a});break}case"rhombus-2":{const _=Math.min(t*.38,r*.38);l=new an({points:[new P(0,0),new P(t-_,0),new P(t,r),new P(_,r)],isFilled:a});break}case"trapezoid":{const _=Math.min(t*.38,r*.38);l=new an({points:[new P(_,0),new P(t-_,0),new P(t,r),new P(0,r)],isFilled:a});break}case"arrow-right":{const _=Math.min(t,r)*.38,E=r*.16;l=new an({points:[new P(0,E),new P(t-_,E),new P(t-_,0),new P(t,r/2),new P(t-_,r),new P(t-_,r-E),new P(0,r-E)],isFilled:a});break}case"arrow-left":{const _=Math.min(t,r)*.38,E=r*.16;l=new an({points:[new P(_,0),new P(_,E),new P(t,E),new P(t,r-E),new P(_,r-E),new P(_,r),new P(0,r/2)],isFilled:a});break}case"arrow-up":{const _=t*.16,E=Math.min(t,r)*.38;l=new an({points:[new P(t/2,0),new P(t,E),new P(t-_,E),new P(t-_,r),new P(_,r),new P(_,E),new P(0,E)],isFilled:a});break}case"arrow-down":{const _=t*.16,E=Math.min(t,r)*.38;l=new an({points:[new P(_,0),new P(t-_,0),new P(t-_,r-E),new P(t,r-E),new P(t/2,r),new P(0,r-E),new P(_,r-E)],isFilled:a});break}case"check-box":case"x-box":case"rectangle":{l=new ji({width:t,height:r,isFilled:a});break}case"heart":{const E=EC(t,r).reduce((M,I)=>(M.push(...I.vertices),M),[]);l=new an({points:E,isFilled:a});break}default:mn(e.props.geo)}const u=Zp(this.editor,e),d=t/e.props.scale,f=r/e.props.scale,g=Math.min(100,d/2),m=Math.min(Do[e.props.size]*rr.lineHeight+Ci*2,f/2),S=Math.min(d,Math.max(u.w,Math.min(g,Math.max(1,d-8)))),b=Math.min(f,Math.max(u.h,Math.min(m,Math.max(1,f-8)))),x=i1(e.props,nr[e.props.size]*e.props.scale),w=x?x.map(_=>new Eu({points:_})):[];return new ki({children:[l,new ji({x:e.props.align==="start"?0:e.props.align==="end"?(d-S)*e.props.scale:(d-S)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(f-b)*e.props.scale:(f-b)/2*e.props.scale,width:S*e.props.scale,height:b*e.props.scale,isFilled:!0,isLabel:!0}),...w]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),r=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[t.bounds.center]};default:mn(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:i.trimEnd()}}])}component(e){const{id:t,type:r,props:i}=e,{fill:s,font:a,align:l,verticalAlign:u,size:d,text:f}=i,g=Ri(),{editor:m}=this,S=oe("isGeoOnlySelected",()=>e.id===m.getOnlySelectedShapeId(),[]),x=m.getEditingShapeId()!==null||e.props.text,w=oe("force solid",()=>m.getZoomLevel()<.2,[m]);return p.jsxs(p.Fragment,{children:[p.jsx(Oa,{children:p.jsx(Yk,{shape:e,shouldScale:!0,forceSolid:w})}),x&&p.jsx(jo,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:p.jsx(Ey,{shapeId:t,type:r,font:a,fontSize:Do[d]*e.props.scale,lineHeight:rr.lineHeight,padding:Ci*e.props.scale,fill:s,align:l,verticalAlign:u,text:f,isSelected:S,labelColor:g[i.labelColor].solid,wrap:!0})}),e.props.url&&p.jsx(fu,{url:e.props.url})]})}indicator(e){const{id:t,props:r}=e,{w:i,size:s}=r,a=r.h+r.growY,l=nr[s],u=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?p.jsx("path",{d:Fre(t,i,a,l)}):p.jsx("path",{d:u.getSvgPathData(!0)});case"heart":return p.jsx("path",{d:jN(i,a)});case"oval":return p.jsx("path",{d:u.getSvgPathData(!0)});case"cloud":return p.jsx("path",{d:r1(i,a,t,s,e.props.scale)});default:{const d=this.editor.getShapeGeometry(e),f=d instanceof ki?d.children[0].vertices:d.vertices;let g;if(r.dash==="draw"){const S=n1(t,f,0,l*2*e.props.scale,1);g=t1(S)}else g="M"+f[0]+"L"+f.slice(1)+"Z";const m=i1(e.props,l);if(m)for(const[S,b]of m)g+=`M${S.x},${S.y}L${b.x},${b.y}`;return p.jsx("path",{d:g})}}}toSvg(e,t){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},i=r.props;t.addExportDef(vC(i.fill));let s;if(i.text){t.addExportDef(_y(i.font));const a=Bo(t),l=new be(0,0,i.w,i.h+i.growY);s=p.jsx(Cy,{fontSize:Do[i.size],font:i.font,align:i.align,verticalAlign:i.verticalAlign,text:i.text,labelColor:a[i.labelColor].solid,bounds:l,padding:16})}return p.jsxs(p.Fragment,{children:[p.jsx(Yk,{shouldScale:!1,shape:r,forceSolid:!1}),s]})}getCanvasSvgDefs(){return[bC()]}onResize(e,{handle:t,newPoint:r,scaleX:i,scaleY:s,initialShape:a}){const l=a.props.w/a.props.scale,u=a.props.h/a.props.scale,d=a.props.growY/a.props.scale;let f=l*i,g=(u+d)*s,m=0,S=0;const b=Vk;if(e.props.text.trim()){let I=Math.max(Math.abs(f),b),A=Math.max(Math.abs(g),b);I<b&&A===b&&(I=b),I===b&&A<b&&(A=b);const j=Zp(this.editor,{...e,props:{...e.props,w:I*e.props.scale,h:A*e.props.scale}}),D=Math.max(Math.abs(f),j.w)*Math.sign(f),R=Math.max(Math.abs(g),j.h)*Math.sign(g);m=Math.abs(D)-Math.abs(f),S=Math.abs(R)-Math.abs(g),f=D,g=R}const x=f*e.props.scale,w=g*e.props.scale,_=new P(0,0);i<0&&(_.x+=x),(t==="left"||t==="top_left"||t==="bottom_left")&&(_.x+=i<0?m:-m),s<0&&(_.y+=w),(t==="top"||t==="top_left"||t==="top_right")&&(_.y+=s<0?S:-S);const{x:E,y:M}=_.rot(e.rotation).add(r);return{x:E,y:M,props:{w:Math.max(Math.abs(x),1),h:Math.max(Math.abs(w),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,r=Zp(this.editor,e).h;let i=null;if(r>t?i=r-t:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i*e.props.scale}}}onBeforeUpdate(e,t){const r=e.props.text,i=t.props.text;if(r===i&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(r&&!i)return{...t,props:{...t.props,growY:0}};const s=e.props.w/e.props.scale,a=e.props.h/e.props.scale,l=e.props.growY/e.props.scale,u=Zp(this.editor,t);if(!r&&i&&i.length===1){let f=Math.max(s,u.w),g=Math.max(a,u.h);const m=Vk;return s<m&&a<m&&(f=Math.max(f,m),g=Math.max(g,m),f=Math.max(f,g),g=Math.max(f,g)),{...t,props:{...t.props,w:f*t.props.scale,h:g*t.props.scale,growY:0}}}let d=null;if(u.h>a?d=u.h-a:l&&(d=0),d!==null){const f=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:d*t.props.scale,w:Math.max(f,u.w)*t.props.scale}}}if(u.w>s)return{...t,props:{...t.props,w:u.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r),scale:st(e.props.scale,t.props.scale,r)}}}O(Cg,"type","geo"),O(Cg,"props",cD),O(Cg,"migrations",uD);function Zp(n,e){const{text:t,font:r,size:i,w:s}=e.props;if(!t)return{w:0,h:0};const a=n.textMeasure.measureText("w",{...rr,fontFamily:No[r],fontSize:Do[i],maxWidth:100}),l={s:2,m:3.5,l:5,xl:10},u=n.textMeasure.measureText(t,{...rr,fontFamily:No[r],fontSize:Do[i],minWidth:a.w,maxWidth:Math.max(0,Math.ceil(a.w+l[i]),Math.ceil(s/e.props.scale-Ci*2))});return{w:u.w+Ci*2,h:u.h+Ci*2}}function Vre(){const[n,e]=T.useState(!1);return T.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(r&&i.matches);const s=()=>e(r&&i.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),oe(ln.forceSrgb)||!n?"srgb":"p3"}class Eg extends Mi{constructor(){super(...arguments);O(this,"options",{maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35})}hideResizeHandles(t){return Qp(t)}hideRotateHandle(t){return Qp(t)}hideSelectionBoundsFg(t){return Qp(t)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(t){const r=Pl(t);if(Qp(t))return new E_({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:s}=Xk(t,r,!0),a=_C({strokeWidth:s,showAsComplete:!0});return xy(i,a),new an({points:gC(i,a),isFilled:!0})}component(t){const r=Tx(this.editor,t),i=Pl(t);return p.jsx(Oa,{children:p.jsx(Jp,{shape:t,forceSolid:r,strokeWidth:i,opacity:this.options.overlayOpacity})})}backgroundComponent(t){const r=Tx(this.editor,t),i=Pl(t);return p.jsx(Oa,{children:p.jsx(Jp,{shape:t,forceSolid:r,strokeWidth:i,opacity:this.options.underlayOpacity})})}indicator(t){const r=Tx(this.editor,t),i=Pl(t),{strokePoints:s,sw:a}=Xk(t,i,r),l=pu(t.props.segments);let u;return s.length<2?u=Wre(l[0],a):u=Hl(s,!1),p.jsx("path",{d:u})}toSvg(t){const r=Pl(t),i=r<1.5,s=1/t.props.scale;return p.jsx("g",{transform:`scale(${s})`,children:p.jsx(Jp,{forceSolid:i,strokeWidth:r,shape:t,opacity:this.options.overlayOpacity})})}toBackgroundSvg(t){const r=Pl(t),i=r<1.5,s=1/t.props.scale;return p.jsx("g",{transform:`scale(${s})`,children:p.jsx(Jp,{forceSolid:i,strokeWidth:r,shape:t,opacity:this.options.underlayOpacity})})}onResize(t,r){const{scaleX:i,scaleY:s}=r,a=[];for(const l of t.props.segments)a.push({...l,points:l.points.map(({x:u,y:d,z:f})=>({x:i*u,y:s*d,z:f}))});return{props:{segments:a}}}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,...r.props,segments:IN(t.props.segments,r.props.segments,i),scale:st(t.props.scale,r.props.scale,i)}}}O(Eg,"type","highlight"),O(Eg,"props",fD),O(Eg,"migrations",pD);function Xre(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function Wre(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Xk(n,e,t){var u;const r=pu(n.props.segments),i=n.props.isComplete||((u=Rn(n.props.segments))==null?void 0:u.type)==="straight";let s=e;!t&&!n.props.isPen&&r.length===1&&(s+=ls(n.id)()*(e/6));const a=_C({strokeWidth:s,showAsComplete:i});return{strokePoints:Us(r,a),sw:s}}function Pl(n){return du[n.props.size]*1.12*n.props.scale}function Qp(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function Jp({strokeWidth:n,forceSolid:e,shape:t,opacity:r}){var m;const i=Ri(),s=pu(t.props.segments);let a=n;!e&&!t.props.isPen&&s.length===1&&(a+=ls(t.id)()*(a/6));const l=_C({strokeWidth:a,showAsComplete:t.props.isComplete||((m=Rn(t.props.segments))==null?void 0:m.type)==="straight"}),u=Us(s,l),d=u.length>1?Hl(u,!1):Xre(t.props.segments[0].points[0]),f=Vre(),g=i[t.props.color].highlight[f];return p.jsx("path",{d,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:g,strokeWidth:a,opacity:r})}function Tx(n,e){return oe("forceSolid",()=>{const t=Pl(e),r=n.getZoomLevel();return t/r<1.5},[n])}function ON(){return p.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),p.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),p.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}const Wk=8;function Zre(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}function Dh(n,e){if(!e)return{w:n.w,h:n.h};const t=n.w/(e.bottomRight.x-e.topLeft.x),r=n.h/(e.bottomRight.y-e.topLeft.y);return{w:t,h:r}}function Qre(n,e,t={}){const{handle:r,change:i,crop:s}=e,{w:a,h:l}=e.uncroppedSize,{minWidth:u=Wk,minHeight:d=Wk}=t,f=$t(s),g=new P(n.x,n.y),m=new P(0,0);let S=!1;switch(r){case"top":case"top_left":case"top_right":{if(l<d)break;S=!0,f.topLeft.y=f.topLeft.y+i.y/l,l*(f.bottomRight.y-f.topLeft.y)<d?(f.topLeft.y=f.bottomRight.y-d/l,m.y=(f.topLeft.y-s.topLeft.y)*l):f.topLeft.y<=0?(f.topLeft.y=0,m.y=(f.topLeft.y-s.topLeft.y)*l):m.y=i.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(l<d)break;S=!0,f.bottomRight.y=Math.min(1,f.bottomRight.y+i.y/l),l*(f.bottomRight.y-f.topLeft.y)<d&&(f.bottomRight.y=f.topLeft.y+d/l);break}}switch(r){case"left":case"top_left":case"bottom_left":{if(a<u)break;S=!0,f.topLeft.x=f.topLeft.x+i.x/a,a*(f.bottomRight.x-f.topLeft.x)<u?(f.topLeft.x=f.bottomRight.x-u/a,m.x=(f.topLeft.x-s.topLeft.x)*a):f.topLeft.x<=0?(f.topLeft.x=0,m.x=(f.topLeft.x-s.topLeft.x)*a):m.x=i.x;break}case"right":case"top_right":case"bottom_right":{if(a<u)break;S=!0,f.bottomRight.x=Math.min(1,f.bottomRight.x+i.x/a),a*(f.bottomRight.x-f.topLeft.x)<u&&(f.bottomRight.x=f.topLeft.x+u/a);break}}if(S)return g.add(m.rot(n.rotation)),{id:n.id,type:n.type,x:g.x,y:g.y,props:{w:(f.bottomRight.x-f.topLeft.x)*a,h:(f.bottomRight.y-f.topLeft.y)*l,crop:f}}}function DN({shapeId:n,assetId:e,width:t}){const r=te(),i=Wh(),s=bG(),[a,l]=T.useState(()=>({asset:e?r.getAsset(e)??null:null,url:null})),u=T.useRef(!1),d=T.useRef(null);return T.useEffect(()=>{if(!e)return;let f=!1,g;const m=js("update state",()=>{if(!i&&n&&r.getCulledShapes().has(n))return;const S=r.getAsset(e);if(!S)return;if(!S.props.src){const w=r.getTemporaryAssetPreview(S.id);if(w){d.current!==w&&(d.current=w,l(_=>({..._,isPlaceholder:!0,url:w})),s());return}}const b=i?i.scale*(t/S.props.w):r.getZoomLevel()*(t/S.props.w);function x(w,_){f||d.current!==_&&(u.current=!0,d.current=_,l({asset:w,url:_}),s())}if(u.current){let w=0;const _=()=>{w++,w>500/16&&(Zk(r,e,b,i,E=>x(S,E)),g==null||g())};g==null||g(),r.on("tick",_),g=()=>r.off("tick",_)}else Zk(r,e,b,i,w=>x(S,w))});return()=>{m(),g==null||g(),f=!0}},[r,e,i,s,n,t]),a}function Zk(n,e,t,r,i){n.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:r?r.pixelRatio===null:!1,dpr:(r==null?void 0:r.pixelRatio)??void 0}).then(s=>{i(s)})}async function Jre(n){const t=await(await Ls(n)).blob();return ts.blobToDataUrl(t)}class Pg extends Mu{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let r=tf(e,t);const{flipX:i,flipY:s}=t.initialShape.props,{scaleX:a,scaleY:l,mode:u}=t;if(r={...r,props:{...r.props,flipX:a<0!==i,flipY:l<0!==s}},!e.props.crop)return r;const d=u==="scale_shape"&&a===-1||u==="resize_bounds"&&i!==r.props.flipX,f=u==="scale_shape"&&l===-1||u==="resize_bounds"&&s!==r.props.flipY,{topLeft:g,bottomRight:m}=e.props.crop;return r.props.crop={topLeft:{x:d?1-m.x:g.x,y:f?1-m.y:g.y},bottomRight:{x:d?1-g.x:m.x,y:f?1-g.y:m.y}},r}component(e){return p.jsx(eie,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e,t){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;const{w:i}=Dh(e.props,e.props.crop);let s=await t.resolveAssetUrl(e.props.assetId,i);return s?((s.startsWith("blob:")||s.startsWith("http")||s.startsWith("/")||s.startsWith("./"))&&(s=await Jre(s)||""),p.jsx(nie,{shape:e,src:s})):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const r=$t(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:i,h:s}=Dh(e.props,r),a=new P(r.topLeft.x*i,r.topLeft.y*s).rot(e.rotation),l={id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:s}};this.editor.updateShapes([l])}getInterpolatedProps(e,t,r){function i(s,a){var g,m,S,b;if(s.props.crop===null&&a.props.crop===null)return null;const l=((g=s.props.crop)==null?void 0:g.topLeft)||{x:0,y:0},u=((m=s.props.crop)==null?void 0:m.bottomRight)||{x:1,y:1},d=((S=a.props.crop)==null?void 0:S.topLeft)||{x:0,y:0},f=((b=a.props.crop)==null?void 0:b.bottomRight)||{x:1,y:1};return{topLeft:{x:st(l.x,d.x,r),y:st(l.y,d.y,r)},bottomRight:{x:st(u.x,f.x,r),y:st(u.y,f.y,r)}}}return{...r>.5?t.props:e.props,w:st(e.props.w,t.props.w,r),h:st(e.props.h,t.props.h,r),crop:i(e,t)}}}O(Pg,"type","image"),O(Pg,"props",gD),O(Pg,"migrations",mD);const eie=T.memo(function({shape:e}){var E;const t=te(),{w:r}=Dh(e.props,e.props.crop),{asset:i,url:s}=DN({shapeId:e.id,assetId:e.props.assetId,width:r}),a=gL(),[l,u]=T.useState(""),[d,f]=T.useState(null),g=tie(t,e);T.useEffect(()=>{if(s&&g){let M=!1;const I=xh();return I.onload=()=>{if(M)return;const A=document.createElement("canvas");A.width=I.width,A.height=I.height;const j=A.getContext("2d");j&&(j.drawImage(I,0,0),u(A.toDataURL()),f(s))},I.crossOrigin="anonymous",I.src=s,()=>{M=!0}}},[t,g,a,s]);const m=oe("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),S=a&&(((E=i==null?void 0:i.props.mimeType)==null?void 0:E.includes("video"))||g),b=RN(e),x=s===d?null:s,w=S?l:d;if(!s&&!(i!=null&&i.props.src))return p.jsxs(jo,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[p.jsx("div",{className:Oe("tl-image-container",i&&"tl-image-container-loading"),style:b,children:i?null:p.jsx(ON,{})}),"url"in e.props&&e.props.url&&p.jsx(fu,{url:e.props.url})]});const _=g?"anonymous":void 0;return p.jsxs(p.Fragment,{children:[m&&w&&p.jsx("div",{style:b,children:p.jsx("img",{className:"tl-image",style:{...yh(e),opacity:.1},crossOrigin:_,src:w,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),p.jsxs(jo,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[p.jsxs("div",{className:Oe("tl-image-container"),style:b,children:[w&&p.jsx("img",{className:"tl-image",style:yh(e),crossOrigin:_,src:w,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},w),x&&p.jsx("img",{className:"tl-image",style:yh(e),crossOrigin:_,src:x,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>f(x)},x)]}),e.props.url&&p.jsx(fu,{url:e.props.url})]})]})});function tie(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):void 0;return t?"mimeType"in t.props&&Zr.isAnimatedImageType(t==null?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function RN(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const{w:r,h:i}=Dh(n.props,e),s=-t.x*r,a=-t.y*i;return{transform:`translate(${s}px, ${a}px)`,width:r,height:i}}function yh(n,e){const{flipX:t,flipY:r}=n.props;if(!t&&!r)return;const i=`scale(${t?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${t?e.width:0}px, ${r?e.height:0}px)`:""} ${i}`,transformOrigin:e?"0 0":"center center"}}function nie({shape:n,src:e}){const t=wu(),r=RN(n),i=n.props.crop;if(r.transform&&i){const{transform:s,width:a,height:l}=r,u=(i.bottomRight.x-i.topLeft.x)*a,d=(i.bottomRight.y-i.topLeft.y)*l,f=[new P(0,0),new P(u,0),new P(u,d),new P(0,d)],g=yh(n,{width:a,height:l});return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:t,children:p.jsx("polygon",{points:f.map(m=>`${m.x},${m.y}`).join(" ")})})}),p.jsx("g",{clipPath:`url(#${t})`,children:p.jsx("image",{href:e,width:a,height:l,style:g?{...g,transform:`${s} ${g.transform}`}:{transform:s}})})]})}else return p.jsx("image",{href:e,width:n.props.w,height:n.props.h,style:yh(n,{width:n.props.w,height:n.props.h})})}function LN(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function NN(n,e,t){const r=e.vertices,i=LN(t);return Us(r,i)}function rie(n,e,t){const r=LN(t);return gC(xy(NN(n,e,t),r),r)}function iie(n,e,t){const r=rie(n,e,t);return a_(r)}function sie(n,e,t){if(n.props.dash==="draw"){const r=NN(n,e,t);return Hl(r)}return e.getSvgPathData()}function zN(n,e,t){let r=`M ${ft(e[0])}L`,i=`M ${ft(e[0])}L`;const s=t/3,a=t*2,l=ls(n);let u=e[0],d,f=e[0],g;const m=e.length;for(let S=0,b=m-1;S<b;S++){d=e[S+1],g=P.AddXY(e[S+1],l()*s,l()*s);const x=P.Sub(d,u),w=P.Len(x),_=P.Div(x,w).mul(Math.min(w/4,a)),E=P.Add(u,_),M=P.Add(d,_.neg()),I=P.Sub(g,f),A=P.Len(I),j=P.Div(I,A).mul(Math.min(A/4,a)),D=P.Add(f,j),R=P.Add(g,j.neg());S===b-1?(r+=`${ft(E)}L ${ft(d)}`,i+=`${ft(D)}L ${ft(g)}`):(r+=`${ft(E)}L ${ft(M)}Q ${ft(d)}`,i+=`${ft(D)}L ${ft(R)}Q ${ft(g)}`,u=d,f=g)}return[r,r+i]}const oie=new Rs;class Tg extends Mi{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=_h(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return lh(e)}getHandles(e){return oie.get(e.props,()=>{const t=lh(e),r=ah(e),i=r.map(s=>({...s,id:s.index,type:"vertex",canSnap:!0}));for(let s=0;s<r.length-1;s++){const a=wh(r[s].index,r[s+1].index),u=t.segments[s].midPoint();i.push({id:a,type:"create",index:a,x:u.x,y:u.y,canSnap:!0})}return i.sort(Jn)})}onResize(e,t){const{scaleX:r,scaleY:i}=t;return{props:{points:zh(e.props.points,(s,{id:a,index:l,x:u,y:d})=>({id:a,index:l,x:u*r,y:d*i}))}}}onBeforeCreate(e){const{props:{points:t}}=e,r=Object.keys(t);if(r.length<2)return;const i=t[r[0]];if(r.every(a=>{const l=t[a];return l.x===i.x&&l.y===i.y})){const a=r[r.length-1];return t[a]={...t[a],x:t[a].x+.1,y:t[a].y+.1},e}}onHandleDrag(e,{handle:t}){if(t.type!=="vertex")return;const r=ss(new P(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:r.x,y:r.y}}}}}component(e){return p.jsx(Oa,{style:{minWidth:50,minHeight:50},children:p.jsx(Qk,{shape:e})})}indicator(e){const t=ks[e.props.size]*e.props.scale,r=lh(e),{dash:i}=e.props;let s;if(e.props.spline==="line"){const a=r.points;if(i==="solid"||i==="dotted"||i==="dashed")s="M"+a[0]+"L"+a.slice(1);else{const[l]=zN(e.id,a,t);s=l}}else s=sie(e,r,t);return p.jsx("path",{d:s})}toSvg(e){return p.jsx(Qk,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=ah(e);return{points:t,getSelfSnapPoints:r=>{const i=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id);return t.filter((s,a)=>Math.abs(a-i)>1).map(P.From)},getSelfSnapOutline:r=>{const i=this.getHandles(e).filter(a=>a.type==="vertex").findIndex(a=>a.id===r.id),s=lh(e).segments.filter((a,l)=>l!==i-1&&l!==i);return s.length?new ki({children:s}):null}}}getInterpolatedProps(e,t,r){const i=ah(e),s=ah(t),a=[],l=[];let u=zj;if(i.length>s.length)for(let d=0;d<i.length;d++)a[d]={...i[d]},s[d]===void 0?l[d]={...s[s.length-1],id:u}:l[d]={...s[d],id:u},u=Is(u);else if(s.length>i.length)for(let d=0;d<s.length;d++)l[d]={...s[d]},i[d]===void 0?a[d]={...i[i.length-1],id:u}:a[d]={...i[d],id:u},u=Is(u);else for(let d=0;d<s.length;d++)a[d]=i[d],l[d]=s[d];return{...r>.5?t.props:e.props,points:Object.fromEntries(a.map((d,f)=>{const g=l[f];return[d.id,{...d,x:st(d.x,g.x,r),y:st(d.y,g.y,r)}]})),scale:st(e.props.scale,t.props.scale,r)}}}O(Tg,"type","line"),O(Tg,"props",yD),O(Tg,"migrations",SD);function ah(n){return Object.values(n.props.points).sort(Jn)}function lh(n){const e=ah(n).map(P.From);switch(n.props.spline){case"cubic":return new uX({points:e});case"line":return new Eu({points:e})}}function Qk({shape:n,shouldScale:e=!1,forceSolid:t=!1}){const r=Ri(),i=lh(n),{dash:s,color:a,size:l}=n.props,u=1/n.props.scale,d=e?u:1,f=ks[l]*n.props.scale;if(n.props.spline==="line"){if(s==="solid"){const g=i.points,m="M"+g[0]+"L"+g.slice(1);return p.jsx("path",{d:m,stroke:r[a].solid,strokeWidth:f,fill:"none",transform:`scale(${d})`})}if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[a].solid,strokeWidth:f,transform:`scale(${d})`,children:i.segments.map((g,m)=>{const{strokeDasharray:S,strokeDashoffset:b}=t?{strokeDasharray:"none",strokeDashoffset:"none"}:es(g.length,f,{style:s,start:m>0?"outset":"none",end:m<i.segments.length-1?"outset":"none"});return p.jsx("path",{strokeDasharray:S,strokeDashoffset:b,d:g.getSvgPathData(!0),fill:"none"},m)})});if(s==="draw"){const g=i.points,[m,S]=zN(n.id,g,f);return p.jsx("path",{d:S,stroke:r[a].solid,strokeWidth:f,fill:"none",transform:`scale(${d})`})}}if(n.props.spline==="cubic"){const g=i.getSvgPathData();if(s==="solid")return p.jsx("path",{strokeWidth:f,stroke:r[a].solid,fill:"none",d:g,transform:`scale(${d})`});if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[a].solid,strokeWidth:f,transform:`scale(${d})`,children:i.segments.map((m,S)=>{const{strokeDasharray:b,strokeDashoffset:x}=es(m.length,f,{style:s,start:S>0?"outset":"none",end:S<i.segments.length-1?"outset":"none",forceSolid:t});return p.jsx("path",{strokeDasharray:b,strokeDashoffset:x,d:m.getSvgPathData(),fill:"none"},S)})});if(s==="draw")return p.jsx("path",{d:iie(n,i,f),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid,transform:`scale(${d})`})}}class Ig extends Mi{constructor(){super(...arguments);O(this,"options",{resizeMode:"none"})}canEdit(){return!0}hideResizeHandles(){const{resizeMode:t}=this.options;switch(t){case"none":return!0;case"scale":return!1;default:throw mn(t)}}isAspectRatioLocked(){return this.options.resizeMode==="scale"}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(t){const{labelHeight:r,labelWidth:i}=FN(this.editor,t),{scale:s}=t.props,a=r*s,l=i*s,u=It*s,d=eg(t);return new ki({children:[new ji({width:u,height:d,isFilled:!0}),new ji({x:t.props.align==="start"?0:t.props.align==="end"?u-l:(u-l)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?d-a:(d-a)/2,width:l,height:a,isFilled:!0,isLabel:!0})]})}getHandles(t){const{scale:r}=t.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*r<.25)return[];const a=eg(t),l=It*r,u=_ne/s*r;return s*r<.5?[{id:"bottom",index:"a3",type:"clone",x:l/2,y:a+u}]:[{id:"top",index:"a1",type:"clone",x:l/2,y:-u},{id:"right",index:"a2",type:"clone",x:l+u,y:a/2},{id:"bottom",index:"a3",type:"clone",x:l/2,y:a+u},{id:"left",index:"a4",type:"clone",x:-u,y:a/2}]}onResize(t,r){const{resizeMode:i}=this.options;switch(i){case"none":return;case"scale":return MO(t,r);default:throw mn(i)}}getText(t){return t.props.text}component(t){const{id:r,type:i,props:{labelColor:s,scale:a,color:l,font:u,size:d,align:f,text:g,verticalAlign:m,fontSizeAdjustment:S}}=t,b=cie(r),x=Ri(),w=It*a,_=eg(t),E=oe("shape rotation",()=>{var j;return((j=this.editor.getShapePageTransform(r))==null?void 0:j.rotation())??0},[this.editor]),M=oe("zoom",()=>this.editor.getZoomLevel()<.35/a,[a,this.editor]),I=oe("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),A=t.id===this.editor.getOnlySelectedShapeId();return p.jsxs(p.Fragment,{children:[p.jsx("div",{id:r,className:"tl-note__container",style:{width:w,height:_,backgroundColor:x[l].note.fill,borderBottom:M?I?`${2*a}px solid rgb(20, 20, 20)`:`${2*a}px solid rgb(144, 144, 144)`:"none",boxShadow:M?"none":uie(t.id,E,a)},children:p.jsx(Ey,{shapeId:r,type:i,font:u,fontSize:(S||Do[d])*a,lineHeight:rr.lineHeight,align:f,verticalAlign:m,text:g,isNote:!0,isSelected:A,labelColor:s==="black"?x[l].note.text:x[s].fill,wrap:!0,padding:16*a,onKeyDown:b})}),"url"in t.props&&t.props.url&&p.jsx(fu,{url:t.props.url})]})}indicator(t){const{scale:r}=t.props;return p.jsx("rect",{rx:r,width:ee(It*r),height:ee(eg(t))})}toSvg(t,r){t.props.text&&r.addExportDef(_y(t.props.font));const i=Bo({isDarkMode:r.isDarkMode}),s=die(t);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{x:5,y:5,rx:1,width:It-10,height:s.h,fill:"rgba(0,0,0,.1)"}),p.jsx("rect",{rx:1,width:It,height:s.h,fill:i[t.props.color].note.fill}),p.jsx(Cy,{fontSize:t.props.fontSizeAdjustment||Do[t.props.size],font:t.props.font,align:t.props.align,verticalAlign:t.props.verticalAlign,text:t.props.text,labelColor:i[t.props.color].note.text,bounds:s,stroke:!1})]})}onBeforeCreate(t){return Jk(this.editor,t)}onBeforeUpdate(t,r){if(!(t.props.text===r.props.text&&t.props.font===r.props.font&&t.props.size===r.props.size))return Jk(this.editor,r)}onEditEnd(t){const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,scale:st(t.props.scale,r.props.scale,i)}}}O(Ig,"type","note"),O(Ig,"props",vD),O(Ig,"migrations",bD);function Jk(n,e){const{labelHeight:t,fontSizeAdjustment:r}=FN(n,e),i=Math.max(0,t-It);if(i!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:r}}}function aie(n,e){const{text:t}=e.props;if(!t)return{labelHeight:Do[e.props.size]*rr.lineHeight+Ci*2,labelWidth:100,fontSizeAdjustment:0};const r=Do[e.props.size];let i=0,s=0,a=It,l=It;const u=1;do{i=Math.min(r,r-s);const d=n.textMeasure.measureText(t,{...rr,fontFamily:No[e.props.font],fontSize:i,maxWidth:It-Ci*2-u,disableOverflowWrapBreaking:!0});if(a=d.h+Ci*2,l=d.w+Ci*2,i<=14){const f=n.textMeasure.measureText(t,{...rr,fontFamily:No[e.props.font],fontSize:i,maxWidth:It-Ci*2-u});a=f.h+Ci*2,l=f.w+Ci*2;break}if(d.scrollWidth.toFixed(0)===d.w.toFixed(0))break}while(s++<50);return{labelHeight:a,labelWidth:l,fontSizeAdjustment:i}}const lie=new Rs;function FN(n,e){return lie.get(e,()=>aie(n,e))}function cie(n){const e=te(),t=S6();return T.useCallback(r=>{const i=e.getShape(n);if(!i)return;const s=r.key==="Tab",a=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(s||a){r.preventDefault();const l=e.getShapePageTransform(n),u=l.rotation(),d=!!(t.dir==="rtl"||aN(i.props.text)),f=(It+e.options.adjacentShapeMargin+(a&&!r.shiftKey?i.props.growY:0))*i.props.scale,g=new P(s?r.shiftKey!=d?-1:1:0,a?r.shiftKey?-1:1:0).mul(f).add(wy.clone().mul(i.props.scale)).rot(u).add(l.point()),m=yN(e,i,g,u);m&&(e.markHistoryStoppingPoint("editing adjacent shape"),fm(e,m,!0))}},[n,e,t.dir])}function eg(n){return(It+n.props.growY)*n.props.scale}function uie(n,e,t){const r=ls(n),i=Math.abs(r())+.5,s=Math.cos(e),a=5*t,l=4*t,u=6*t,d=7*t;return`0px ${a-i}px ${a}px -${a}px rgba(15, 23, 31, .6),
	0px ${(l+i*d)*Math.max(0,s)}px ${u+i*d}px -${l+i*u}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+s)/2)).toFixed(2)})`}function die(n){return new be(0,0,It,It+n.props.growY)}const hie=new Rs;class Mg extends Mi{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return hie.get(e.props,t=>ej(this.editor,t))}getGeometry(e){const{scale:t}=e.props,{width:r,height:i}=this.getMinDimensions(e);return new ji({width:r*t,height:i*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:r,size:i,text:s,color:a,scale:l,textAlign:u}}=e,{width:d,height:f}=this.getMinDimensions(e),g=e.id===this.editor.getOnlySelectedShapeId(),m=Ri(),S=fie(t);return p.jsx(Ey,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:du[i],lineHeight:rr.lineHeight,align:u,verticalAlign:"middle",text:s,labelColor:m[a].solid,isSelected:g,textWidth:d,textHeight:f,style:{transform:`scale(${l})`,transformOrigin:"top left"},wrap:!0,onKeyDown:S})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,r=te();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:p.jsx("rect",{width:ee(t.width),height:ee(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(_y(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,i=r.width/(e.props.scale??1),s=r.height/(e.props.scale??1),a=Bo(t);return p.jsx(Cy,{fontSize:du[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:a[e.props.color].solid,bounds:new be(0,0,i,s),padding:0})}onResize(e,t){const{newPoint:r,initialBounds:i,initialShape:s,scaleX:a,handle:l}=t;if(t.mode==="scale_shape"||l!=="right"&&l!=="left")return{id:e.id,type:e.type,...MO(e,t)};{const u=Math.max(1,Math.abs(i.width*a)),{x:d,y:f}=a<0?P.Sub(r,P.FromAngle(e.rotation).mul(u)):r;return{id:e.id,type:e.type,x:d,y:f,props:{w:u/s.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:r,props:{text:i}}=e,s=e.props.text.trimEnd();s.length===0?this.editor.deleteShapes([e.id]):s!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:i.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,i=e.props.text!==t.props.text;if(!r&&!i)return;const s=this.getMinDimensions(e),a=ej(this.editor,t.props),l=s.width*e.props.scale,u=s.height*e.props.scale,d=a.width*t.props.scale,f=a.height*t.props.scale;let g;switch(t.props.textAlign){case"middle":{g=new P((d-l)/2,i?0:(f-u)/2);break}case"end":{g=new P(d-l,i?0:(f-u)/2);break}default:{if(i)break;g=new P(0,(f-u)/2);break}}if(g){g.rot(t.rotation);const{x:m,y:S}=t;return{...t,x:m-g.x,y:S-g.y,props:{...t.props,w:d}}}else return{...t,props:{...t.props,w:d}}}}O(Mg,"type","text"),O(Mg,"props",xD),O(Mg,"migrations",wD);function ej(n,e){const{font:t,text:r,autoSize:i,size:s,w:a}=e,l=i?16:Math.max(16,a),u=du[s],d=i?null:Math.floor(Math.max(l,a)),f=n.textMeasure.measureText(r,{...rr,fontFamily:No[t],fontSize:u,maxWidth:d});return i&&(f.w+=1),{width:Math.max(l,f.w),height:Math.max(u,f.h)}}function fie(n){const e=te();return T.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{Ze(t),t.shiftKey?hu.unindent(t.currentTarget):hu.indent(t.currentTarget);break}}},[e,n])}class Ag extends Mu{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return p.jsx(pie,{shape:e})}indicator(e){return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e,t){if(!e.props.assetId)return null;const r=await t.resolveAssetUrl(e.props.assetId,e.props.w);if(!r)return null;const i=await Zr.loadVideo(r),s=await Zr.getVideoFrameAsDataUrl(i,0);return s?p.jsx("image",{href:s,width:e.props.w,height:e.props.h}):null}}O(Ag,"type","video"),O(Ag,"props",_D),O(Ag,"migrations",CD);const pie=T.memo(function({shape:e}){const t=te(),r=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,i=Zm(e.id),s=gL(),{Spinner:a}=Ht(),{asset:l,url:u}=DN({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),d=T.useRef(null),[f,g]=T.useState(!1),[m,S]=T.useState(!1);T.useEffect(()=>{const x=()=>S(document.fullscreenElement===d.current);return document.addEventListener("fullscreenchange",x),()=>document.removeEventListener("fullscreenchange",x)});const b=T.useCallback(x=>{x.currentTarget&&g(!0)},[]);return T.useEffect(()=>{const x=d.current;x&&i&&document.activeElement!==x&&x.focus()},[i,f]),T.useEffect(()=>{if(s){const x=d.current;if(!x)return;x.pause(),x.currentTime=0}},[d,s]),p.jsxs(p.Fragment,{children:[p.jsx(jo,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:l?"transparent":"var(--color-low)",border:l?"none":"1px solid var(--color-low-border)"},children:p.jsx("div",{className:"tl-counter-scaled",children:p.jsx("div",{className:"tl-video-container",children:l?a&&!l.props.src?p.jsx(a,{}):u?p.jsxs(p.Fragment,{children:[p.jsx("video",{ref:d,style:i?{pointerEvents:"all"}:f?void 0:{display:"none"},className:Oe("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":m}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:i&&r,onLoadedData:b,hidden:!f,children:p.jsx("source",{src:u})}),!f&&a&&p.jsx(a,{})]}):null:p.jsx(ON,{})})})}),"url"in e.props&&e.props.url&&p.jsx(fu,{url:e.props.url})]})}),BN=[Mg,xg,wg,Cg,Ig,Tg,_g,bg,Eg,xm,Pg,Ag];function gie(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!n.isIn("select.editing_shape")){const r=n.getEditingShape();r&&r.type==="text"&&n.isInAny("text.pointing","select.resizing")&&n.getInstanceState().isToolLocked?n.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):n.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle")}}})}class UN extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"scribbleId","id");O(this,"markId","");O(this,"excludedShapeIds",new Set)}onEnter(t){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const a=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(a)}return!1}).map(s=>s.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:t,excludedShapeIds:r}=this,i=t.getErasingShapeIds(),s=t.getZoomLevel(),a=t.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:l,previousPagePoint:u}}=t;this.pushPointToScribble();const d=new Set(i),f=this.editor.options.hitTestMargin/s;for(const g of a){if(t.isShapeOfType(g,"group"))continue;const m=t.getShapeMask(g.id);if(m&&!ei(l,m))continue;const S=t.getShapeGeometry(g),b=t.getShapePageTransform(g);if(!S||!b)continue;const x=b.clone().invert(),w=x.applyToPoint(u),_=x.applyToPoint(l),{bounds:E}=S;E.minX-f>Math.max(w.x,_.x)||E.minY-f>Math.max(w.y,_.y)||E.maxX+f<Math.min(w.x,_.x)||E.maxY+f<Math.min(w.y,_.y)||S.hitTestLineSegment(w,_,f)&&d.add(t.getOutermostSelectableShape(g).id)}this.editor.setErasingShapes([...d].filter(g=>!r.has(g)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}O(UN,"id","erasing");var Yx;let mie=(Yx=class extends Ae{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},O(Yx,"id","idle"),Yx);var Vx;let yie=(Vx=class extends Ae{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,s=i.size;for(let a=t.length,l=a-1;l>=0;l--){const u=t[l];if(!(this.editor.isShapeOrAncestorLocked(u)||this.editor.isShapeOfType(u,"group"))&&this.editor.isPointInShape(u,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const d=this.editor.getOutermostSelectableShape(u);if(this.editor.isShapeOfType(d,"frame")&&i.size>s)break;i.add(d.id)}}this.editor.setErasingShapes([...i])}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},O(Vx,"id","pointing"),Vx);class kg extends Ae{static children(){return[mie,yie,UN]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}O(kg,"id","eraser"),O(kg,"initial","idle"),O(kg,"isLockable",!1);class $N extends Ae{constructor(){super(...arguments);O(this,"initialCamera",new P)}onEnter(){this.initialCamera=P.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:t,editor:r}=this,{currentScreenPoint:i,originScreenPoint:s}=r.inputs,a=P.Sub(i,s).div(r.getZoomLevel());a.len2()!==0&&r.setCamera(t.clone().add(a))}complete(){const{editor:t}=this,{pointerVelocity:r}=t.inputs,i=Math.min(r.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:r}),this.parent.transition("idle")}}O($N,"id","dragging");var Xx;let Sie=(Xx=class extends Ae{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},O(Xx,"id","idle"),Xx);var Wx;let vie=(Wx=class extends Ae{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},O(Wx,"id","pointing"),Wx);class jg extends Ae{static children(){return[Sie,vie,$N]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:Tn.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:Tn.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:Tn.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Tn.easeOutQuint}})}}}O(jg,"id","hand"),O(jg,"initial","idle"),O(jg,"isLockable",!1);var Zx;let bie=(Zx=class extends Ae{onPointerDown(e){this.parent.transition("lasering",e)}},O(Zx,"id","idle"),Zx);class HN extends Ae{constructor(){super(...arguments);O(this,"scribbleId","id")}onEnter(){const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}O(HN,"id","lasering");class Og extends Ae{static children(){return[bie,HN]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}O(Og,"id","laser"),O(Og,"initial","idle"),O(Og,"isLockable",!1);class KN extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"initialSelectedShapeIds",[]);O(this,"excludedShapeIds",new Set);O(this,"isWrapMode",!1);O(this,"initialStartShape",null)}onEnter(t){const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(t){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)}onKeyDown(t){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:r,isWrapMode:i}=this,{inputs:{originPagePoint:s,currentPagePoint:a,shiftKey:l,ctrlKey:u}}=t,d=new Set(l?this.initialSelectedShapeIds:[]),f=i?!u:u,g=be.FromPoints([s,a]),{corners:m}=g;let S,b,x,w,_,E;const M=t.getCurrentPageRenderingShapesSorted(),I=t.getCurrentPageId();e:for(let D=0,R=M.length;D<R;D++){if(x=M[D],r.has(x.id)||d.has(x.id)||(w=t.getShapePageBounds(x),!w))continue e;if(g.contains(w)){this.handleHit(x,a,I,d,m);continue e}if(f||t.isShapeOfType(x,"frame"))continue e;if(g.collides(w)){if(_=t.getShapePageTransform(x),!_)continue e;E=_.clone().invert().applyToPoints(m);const q=t.getShapeGeometry(x);t:for(let L=0;L<4;L++)if(S=E[L],b=E[(L+1)%4],q.hitTestLineSegment(S,b,0)){this.handleHit(x,a,I,d,m);break t}}}const A=t.getInstanceState().brush;(!A||!g.equals(A))&&t.updateInstanceState({brush:{...g.toJson()}});const j=t.getSelectedShapeIds();(j.length!==d.size||j.some(D=>!d.has(D)))&&t.setSelectedShapes(Array.from(d))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(t,r,i,s,a){if(t.parentId===i){s.add(t.id);return}const l=this.editor.getOutermostSelectableShape(t),u=this.editor.getShapeMask(l.id);u&&!p_(u,a)&&!ei(r,u)||s.add(l.id)}}O(KN,"id","brushing");const gu={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class qN extends Ae{constructor(){super(...arguments);O(this,"info",{})}updateCursor(){const t=this.editor.getSelectedShapes(),r=gu[this.info.handle];this.editor.setCursor({type:r,rotation:t.length===1?this.editor.getSelectionRotation():0})}onEnter(t){this.info=t,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}O(qN,"id","pointing_resize_handle");class PC extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"markId","");O(this,"snapshot",{})}onEnter(t){this.info=t,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=gu[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}updateShapes(){var m;const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t)return;const i=this.editor.getShapeUtil(t.type);if(!i)return;const s=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),l=s.clone().sub(a).rot(-t.rotation),u=t.props.crop??Zre(),d={w:1/(u.bottomRight.x-u.topLeft.x)*t.props.w,h:1/(u.bottomRight.y-u.topLeft.y)*t.props.h},g=(((m=i.onCrop)==null?void 0:m.bind(i))??Qre)(t,{handle:this.info.handle,change:l,crop:u,uncroppedSize:d,initialShape:this.snapshot.shape});g&&(this.editor.updateShapes([{id:t.id,type:t.type,...g}]),this.updateCursor())}complete(){this.updateShapes(),Lt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),a=P.RotWith(s.getHandlePoint(this.info.handle),s.point,t),l=P.Sub(r,a);return{shape:i,cursorHandleOffset:l}}}O(PC,"id","cropping");function GN(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:r}}=n;return n.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(r)}function YN(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const{w:s,h:a}=Dh(e.props,r),l=r.bottomRight.y-r.topLeft.y,u=r.bottomRight.x-r.topLeft.x,d=$t(r);return d.topLeft.x=Math.min(1-u,Math.max(0,d.topLeft.x-t.x/s)),d.topLeft.y=Math.min(1-l,Math.max(0,d.topLeft.y-t.y/a)),d.bottomRight.x=d.topLeft.x+u,d.bottomRight.y=d.topLeft.y+l,{id:e.id,type:e.type,props:{crop:d}}}var Qx;let xie=(Qx=class extends Ae{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var t;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=GN(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var s;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);if(i){if(e.target==="selection"){(s=i.onDoubleClickEdge)==null||s.call(i,r);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new P(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new P(0,0)))return;r&&i.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const a=YN(this.editor,s,i);a&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([a]))}},O(Qx,"id","idle"),Qx);class VN extends Ae{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}O(VN,"id","pointing_crop");class TC extends Ae{constructor(){super(...arguments);O(this,"info",{})}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const i=gu[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}O(TC,"id","pointing_crop_handle");class XN extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"markId","");O(this,"snapshot",{})}onEnter(t){this.info=t,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(t){switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(t){switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,s=i.clone().sub(r),a=YN(this.editor,t,s);a&&this.editor.updateShapes([a])}}O(XN,"id","translating_crop");class s1 extends Ae{constructor(){super(...arguments);O(this,"markId","");O(this,"didExit",!1)}static children(){return[xie,XN,VN,TC,PC]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}O(s1,"id","crop"),O(s1,"initial","idle");class WN extends Ae{constructor(){super(...arguments);O(this,"shapeId","");O(this,"initialHandle",{});O(this,"initialAdjacentHandle",null);O(this,"initialPagePoint",{});O(this,"markId","");O(this,"initialPageTransform");O(this,"initialPageRotation");O(this,"info",{});O(this,"isPrecise",!1);O(this,"isPreciseId",null);O(this,"pointingId",null);O(this,"exactTimeout",-1)}onEnter(t){const{shape:r,isCreating:i,creatingMarkId:s,handle:a}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId="",i)if(s)this.markId=s;else{const d=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);d&&(this.markId=d)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=$t(a),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[a.index]:{id:a.index,index:a.index,x:a.x,y:a.y}}}});const f=this.editor.getShapeHandles(r).find(g=>g.index===a.index);this.initialHandle=$t(f)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const l=this.editor.getShapeHandles(r).sort(Jn),u=l.findIndex(d=>d.id===t.handle.id);this.initialAdjacentHandle=null;for(let d=u+1;d<l.length;d++){const f=l[d];if(f.type==="vertex"&&f.id!=="middle"&&f.id!==t.handle.id){this.initialAdjacentHandle=f;break}}if(!this.initialAdjacentHandle)for(let d=l.length-1;d>=0;d--){const f=l[d];if(f.type==="vertex"&&f.id!=="middle"&&f.id!==t.handle.id){this.initialAdjacentHandle=f;break}}if(this.editor.isShapeOfType(r,"arrow")){const d=Dr(this.editor,r)[t.handle.id];this.isPrecise=!1,d?(this.editor.setHintingShapes([d.toId]),this.isPrecise=d.props.isPrecise,this.isPrecise?this.isPreciseId=d.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),Lt(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var D;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:a,initialAdjacentHandle:l}=this,u=this.editor.getHintingShapeIds(),d=this.editor.user.getIsSnapMode(),{snaps:f,inputs:{currentPagePoint:g,shiftKey:m,ctrlKey:S,altKey:b,pointerVelocity:x}}=t,w=this.info.shape,_=t.getShape(r);if(!_)return;const E=t.getShapeUtil(_);let M=g.clone().sub(i).rot(-a).add(s);if(m&&l&&s.id!=="middle"){const R=P.Angle(l,M),L=Hg(R,24)-R;M=P.RotWith(M,l,L)}t.snaps.clearIndicators();let I={...s,x:M.x,y:M.y};if(s.canSnap&&(d?!S:S)){if(!t.getShapePageTransform(_.id))throw Error("Expected a page transform");const q=f.handles.snapHandle({currentShapeId:r,handle:I});q&&(q.nudge.rot(-t.getShapeParentTransform(_).rotation()),M.add(q.nudge),I={...s,x:M.x,y:M.y})}const A=(D=E.onHandleDrag)==null?void 0:D.call(E,_,{handle:I,isPrecise:this.isPrecise||b,initial:w}),j={id:_.id,type:_.type,...A};if(s.type==="vertex"&&this.editor.isShapeOfType(_,"arrow")){const R=Dr(t,_)[s.id];R?u[0]!==R.toId&&(t.setHintingShapes([R.toId]),this.pointingId=R.toId,this.isPrecise=x.len()<.5||b,this.isPreciseId=this.isPrecise?R.toId:null,this.resetExactTimeout()):u.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}A&&t.updateShapes([j])}}O(WN,"id","dragging_handle");function ZN(n){return n.isLabel?[n]:n instanceof ki?n.children.filter(e=>e.isLabel):[]}class QN extends Ae{constructor(){super(...arguments);O(this,"hitShapeForPointerUp",null);O(this,"info",{})}onEnter(t){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=t,t.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),Io(this.editor),this.editor.select(r)}onExit(){var s;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),Io.cancel();const r=this.editor.getShape(t),i=this.editor.getShapeUtil(r);(s=i.onEditEnd)==null||s.call(i,r),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(t){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{Io(this.editor);return}}}onPointerDown(t){switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),a=ZN(s),l=a.length===1?a[0]:void 0,u=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(l&&!u){const d=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(l.bounds.containsPoint(d,0)&&l.hitTestPoint(d)){if(r.id===i.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)}onPointerUp(t){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getIsReadonly()&&!i.canEditInReadOnly(r)){this.parent.transition("pointing_shape",t);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),Io(this.editor)}}onComplete(t){this.parent.transition("idle",t)}onCancel(t){this.parent.transition("idle",t)}}O(QN,"id","editing_shape");function tj(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function wm(n,e){const t=n.getSelectedShapeIds(),{currentPagePoint:r}=n.inputs,{shiftKey:i,altKey:s,accelKey:a}=e,l=i||a,u=n.getShapeAtPoint(r,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:d=>!d.isLocked});if(u){const d=n.getOutermostSelectableShape(u);if(l&&!s)n.cancelDoubleClick(),t.includes(d.id)?(n.markHistoryStoppingPoint("deselecting shape"),n.deselect(d)):(n.markHistoryStoppingPoint("shift selecting shape"),n.setSelectedShapes([...t,d.id]));else{let f;d===u||d.id===n.getFocusedGroupId()||t.includes(d.id)?f=u:f=d,f&&!t.includes(f.id)&&(n.markHistoryStoppingPoint("selecting shape"),n.select(f.id))}}else{if(l)return;{t.length>0&&(n.markHistoryStoppingPoint("selecting none"),n.selectNone());const d=n.getFocusedGroupId();if(kr(d)){const f=n.getShape(d);n.isPointInShape(f,r,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const wie=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var Jx;let _ie=(Jx=class extends Ae{onEnter(){this.parent.setCurrentToolIdMask(void 0),Io(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){Io.cancel()}onPointerMove(){Io(this.editor)}onPointerDown(e){const t=e.ctrlKey&&tj(this.editor);switch(e.target){case"canvas":{const r=GN(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&nj(this.editor,a)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var t,r,i,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),u=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){wm(this.editor,e);return}else{const d=this.editor.getShape(l.parentId);if(d&&this.editor.isShapeOfType(d,"group")&&!(u&&d.id===u)){wm(this.editor,e);return}}this.onDoubleClick({...e,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const u=(t=l.onDoubleClickEdge)==null?void 0:t.call(l,a);if(u){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([u]),Lt(this.editor,[a.id]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,e,!0)}break}case"shape":{const{shape:a}=e,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getIsReadonly())break;if(l.onDoubleClick){const u=(r=l.onDoubleClick)==null?void 0:r.call(l,a);if(u){this.editor.updateShapes([u]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)?this.startEditingShape(a,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:a,handle:l}=e,u=this.editor.getShapeUtil(a),d=(s=u.onDoubleClickHandle)==null?void 0:s.call(u,a,l);d?this.editor.updateShapes([d]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:a}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&nj(this.editor,a)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,s=>!t.includes(s.id));!t.includes(i.id)&&!this.editor.findShapeAncestor(i,s=>t.includes(s.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(ln.editOnType.get()&&!wie.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}tj(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),fm(this.editor,e,r),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&ei(t,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=Mt(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const s=this.editor.getShape(t);if(!s)return;const a=this.editor.getShapeUtil(s);this.editor.getIsReadonly()&&!a.canEditInReadOnly(s)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new P(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new P(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:s}=this.editor.getDocumentSettings(),a=this.editor.getInstanceState().isGridMode?r?s*Pie:s:r?Cie:Eie,l=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(l,i.mul(a)),Lt(this.editor,l)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},O(Jx,"id","idle"),Jx);const Cie=10,Eie=1,Pie=5;function nj(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?ei(e,t.corners.map(i=>P.RotWith(i,t.point,r))):t.containsPoint(e)}class JN extends Ae{constructor(){super(...arguments);O(this,"shapeId","");O(this,"markId","");O(this,"wasAlreadySelected",!1);O(this,"didDrag",!1);O(this,"didCtrlOnEnter",!1);O(this,"info",{});O(this,"_labelDragOffset",new P(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(t){const{shape:r}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=t.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:a}=this.editor.inputs,l=this.editor.getPointInShapeSpace(r,a);if(this._labelDragOffset=P.Sub(s.center,l),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),t.shiftKey||t.accelKey){const d=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...d,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:t}=this.editor.inputs;if(!t)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const i=As(this.editor,r),s=this.editor.getShapeGeometry(r),a=s.children[0],l=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),u=a.nearestPoint(P.Add(l,this._labelDragOffset));let d;if(i.isStraight){const f=P.Dist(i.start.point,i.end.point);d=1-P.Dist(i.end.point,u)/f}else{const{_center:f,measure:g,angleEnd:m,angleStart:S}=s.children[0];d=aw(g,S,m,f.angle(u))}isNaN(d)&&(d=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:d}})}onPointerUp(){const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}O(JN,"id","pointing_arrow_label");class ez extends Ae{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){wm(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}O(ez,"id","pointing_canvas");class tz extends Ae{constructor(){super(...arguments);O(this,"didCtrlOnEnter",!1);O(this,"info",{})}onEnter(t){this.info=t,this.didCtrlOnEnter=t.accelKey;const{shape:r}=t;if(this.editor.isShapeOfType(r,"arrow")){const i=Dr(this.editor,r)[t.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:t,handle:r}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:i}=this,s=rj(i,t,r,!1);if(s){fm(i,s,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(t){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:t}=this;if(t.getIsReadonly())return;const{shape:r,handle:i}=this.info;if(t.isShapeOfType(r,"note")){const s=rj(t,r,i,!0);if(s){const a=t.getPointInParentSpace(s,t.inputs.originPagePoint).sub(P.Rot(wy.clone().mul(r.props.scale),s.rotation));t.updateShape({...s,x:a.x,y:a.y}),t.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{fm(t,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}O(tz,"id","pointing_handle");function rj(n,e,t,r){const i=n.getShapePageTransform(e.id),s=i.point(),a=i.rotation(),u=gN(n,s,a,e.props.growY*e.props.scale,0,e.props.scale)[t.index];if(u)return yN(n,e,u,a,r)}class nz extends Ae{constructor(){super(...arguments);O(this,"info",{})}updateCursor(){this.editor.setCursor({type:gu[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(t){this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}O(nz,"id","pointing_rotate_handle");class rz extends Ae{constructor(){super(...arguments);O(this,"info",{})}onEnter(t){this.info=t}onPointerUp(t){wm(this.editor,t),this.parent.transition("idle",t)}onPointerMove(t){this.editor.inputs.isDragging&&this.startTranslating(t)}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||this.parent.transition("translating",t)}onDoubleClick(t){var s,a;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(a=(s=this.parent).onDoubleClick)==null||a.call(s,{...t,target:"shape",shape:this.editor.getShape(i)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}O(rz,"id","pointing_selection");class iz extends Ae{constructor(){super(...arguments);O(this,"hitShape",{});O(this,"hitShapeForPointerUp",{});O(this,"isDoubleClick",!1);O(this,"didCtrlOnEnter",!1);O(this,"didSelectOnEnter",!1)}onEnter(t){const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:a}}=this.editor,{shiftKey:l,altKey:u,accelKey:d}=t;this.hitShape=t.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=d;const f=this.editor.getOutermostSelectableShape(t.shape),g=this.editor.findShapeAncestor(f,m=>r.includes(m.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(t.shape).onClick||f.id===s||r.includes(f.id)||g||r.length>1&&(i!=null&&i.containsPoint(a))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=f;return}this.didSelectOnEnter=!0,l&&!u?(this.editor.cancelDoubleClick(),r.includes(f.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,f.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([f.id]))}onPointerUp(t){var f;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:a}}=this.editor,l=t.shiftKey||t.accelKey,u=this.editor.getShapeAtPoint(a,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,d=u?this.editor.getOutermostSelectableShape(u):this.hitShapeForPointerUp;if(d){const g=this.editor.getShapeUtil(d);if(g.onClick){const m=(f=g.onClick)==null?void 0:f.call(g,d);if(m){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([m]),this.parent.transition("idle",t);return}}if(d.id===i){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const g=this.editor.getOutermostSelectableShape(u,m=>!r.includes(m.id));if(r.includes(g.id))if(l)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(d);else if(r.includes(d.id)){if(r.length===1){const m=this.editor.getShapeUtil(d).getGeometry(d),S=ZN(m),b=S.length===1?S[0]:void 0;if(b){const x=this.editor.getPointInShapeSpace(d,a);if(b.bounds.containsPoint(x,0)&&b.hitTestPoint(x)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(d.id);const w=this.editor.getShapeUtil(d);this.editor.getIsReadonly()&&!w.canEditInReadOnly(d)||(this.editor.setEditingShape(d.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:d.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(d.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(d);else if(l){const m=this.editor.getShapeAncestors(g);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(S=>!m.find(b=>b.id===S)),g.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([g.id])}this.parent.transition("idle",t)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(t){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startTranslating(t))}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",t))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}O(iz,"id","pointing_shape");class sz extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"markId","");O(this,"didHoldCommand",!1);O(this,"creationCursorOffset",{x:0,y:0});O(this,"snapshot",{})}onEnter(t){const{isCreating:r=!1,creatingMarkId:i,creationCursorOffset:s={x:0,y:0}}=t;if(this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=s,this.snapshot=this._createSnapshot(),this.markId="",r)if(i)this.markId=i;else{const a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(Lt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var l;const s=this.editor.getShapeUtil(i),a=(l=s.onResizeStart)==null?void 0:l.call(s,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var u;const s=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i),l=(u=a.onResizeEnd)==null?void 0:u.call(a,i,s);l&&r.push(l)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:s,selectionBounds:a,cursorHandleOffset:l,selectedShapeIds:u,selectionRotation:d,canShapesDeform:f}=this.snapshot;let g=r||!f;if(s.size===1){const R=[...s.values()][0];this.editor.isShapeOfType(R.shape,"text")&&(g=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:m}=this.editor.inputs,S=this.editor.inputs.currentPagePoint.clone().sub(l).sub(this.creationCursorOffset),b=this.editor.inputs.originPagePoint.clone().sub(l);if(this.editor.getInstanceState().isGridMode&&!m){const{gridSize:R}=this.editor.getDocumentSettings();S.snapToGrid(R)}const x=this.info.handle,w=ij(x,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!m:m)&&d%Nt===0){const{nudge:R}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:P.Sub(S,b),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:ij(x,d),isAspectRatioLocked:g,isResizingFromCenter:t});S.add(R)}const E=P.RotWith(t?a.center:a.getHandlePoint(w),a.point,d),M=P.Sub(S,E).rot(-d),I=P.Sub(b,E).rot(-d),A=P.DivV(M,I);Number.isFinite(A.x)||(A.x=1),Number.isFinite(A.y)||(A.y=1);const j=x==="top"||x==="bottom",D=x==="left"||x==="right";g?D?A.y=Math.abs(A.x):j?A.x=Math.abs(A.y):Math.abs(A.x)>Math.abs(A.y)?A.y=Math.abs(A.x)*(A.y<0?-1:1):A.x=Math.abs(A.y)*(A.x<0?-1:1):(j&&(A.x=1),D&&(A.y=1)),this.info.isCreating||this.updateCursor({dragHandle:x,isFlippedX:A.x<0,isFlippedY:A.y<0,rotation:d});for(const R of s.keys()){const q=s.get(R);this.editor.resizeShape(R,A,{initialShape:q.shape,initialBounds:q.bounds,initialPageTransform:q.pageTransform,dragHandle:x,mode:u.length===1&&R===u[0]?"resize_bounds":"scale_shape",scaleOrigin:E,isAspectRatioLocked:g,scaleAxisRotation:d,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:R,children:q}of i){if(!q.length)continue;const L=s.get(R).shape,K=this.editor.getShape(R);if(!(L&&K))continue;const G=K.x-L.x,z=K.y-L.y,U=new P(G,z).rot(-L.rotation);if(U.x!==0||U.y!==0)for(const Y of q)this.editor.updateShape({id:Y.id,type:Y.type,x:Y.x-U.x,y:Y.y-U.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:R}of i)if(R.length)for(const q of R)this.editor.updateShape({id:q.id,type:q.type,x:q.x,y:q.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:s}){const a={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{a.type="nwse-resize",r!==i&&(a.type="nesw-resize");break}case"top_right":case"bottom_left":{a.type="nesw-resize",r!==i&&(a.type="nwse-resize");break}}a.rotation=s,this.editor.setCursor(a)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),a=P.RotWith(s.getHandlePoint(this.info.handle),s.point,r),l=P.Sub(i,a),u=new Map,d=[];t.forEach(g=>{const m=this.editor.getShape(g);if(m){if(m.type==="frame"&&d.push({id:g,children:Ye(this.editor.getSortedChildIdsForParent(m).map(S=>this.editor.getShape(S)))}),u.set(m.id,this._createShapeSnapshot(m)),this.editor.isShapeOfType(m,"frame")&&t.length===1)return;this.editor.visitDescendants(m.id,S=>{const b=this.editor.getShape(S);if(b&&(u.set(b.id,this._createShapeSnapshot(b)),this.editor.isShapeOfType(b,"frame")))return!1})}});const f=![...u.values()].some(g=>!IO(g.pageRotation,r)||g.isAspectRatioLocked);return{shapeSnapshots:u,selectionBounds:s,cursorHandleOffset:l,selectionRotation:r,selectedShapeIds:t,canShapesDeform:f,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:d}}_createShapeSnapshot(t){const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:ve.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}}}O(sz,"id","resizing");const Ix=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function ij(n,e){e=e%wt;const t=Math.round(e/(pt/4)),r=Ix.indexOf(n);return Ix[(r+t)%Ix.length]}const sj=Math.PI/180;class oz extends Ae{constructor(){super(...arguments);O(this,"snapshot",{});O(this,"info",{});O(this,"markId","")}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=RR({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ug({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:gu[this.info.handle],rotation:i+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});ug({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:gu[this.info.handle],rotation:t+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){ug({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),Lt(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:a}}=this.editor,{initialCursorAngle:l,initialShapesRotation:u}=this.snapshot;if(!i)return u;const f=i.center.clone().rotWith(i.point,r).angle(a)-l;let g=u+f;if(s)g=Hg(g,24);else if(t&&(g=Math.round(g/sj)*sj,this.editor.getInstanceState().isCoarsePointer)){const m=Hg(g,4),S=sg(g,m);Math.abs(S)<mU(5)&&(g=m)}return g-u}}O(oz,"id","rotating");class az extends Ae{constructor(){super(...arguments);O(this,"hits",new Set);O(this,"size",0);O(this,"scribbleId","id");O(this,"initialSelectedShapeIds",new Set);O(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}updateScribbleSelection(t){const{editor:r}=this,i=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:s,originPagePoint:a,previousPagePoint:l,currentPagePoint:u}}=this.editor,{newlySelectedShapeIds:d,initialSelectedShapeIds:f}=this;t&&this.pushPointToScribble();const g=i;let m,S,b,x;const w=0;for(let M=0,I=g.length;M<I;M++){if(m=g[M],r.isShapeOfType(m,"group")||d.has(m.id)||r.isShapeOrAncestorLocked(m)||(S=r.getShapeGeometry(m),r.isShapeOfType(m,"frame")&&S.bounds.containsPoint(r.getPointInShapeSpace(m,a))))continue;const A=r.getShapePageTransform(m);if(!S||!A)continue;const j=A.clone().invert();b=j.applyToPoint(l),x=j.applyToPoint(u);const{bounds:D}=S;if(!(D.minX-w>Math.max(b.x,x.x)||D.minY-w>Math.max(b.y,x.y)||D.maxX+w<Math.min(b.x,x.x)||D.maxY+w<Math.min(b.y,x.y))&&S.hitTestLineSegment(b,x,w)){const R=this.editor.getOutermostSelectableShape(m),q=this.editor.getShapeMask(R.id);if(q&&h_(l,u,q)!==null&&!ei(u,q))continue;d.add(R.id)}}const _=r.getSelectedShapeIds(),E=new Set(s?[...d,...f]:[...d]);(_.length!==E.size||_.some(M=>!E.has(M)))&&this.editor.setSelectedShapes(Array.from(E))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}O(az,"id","scribble_brushing");var Tie=Object.create,lz=Object.defineProperty,Iie=Object.getOwnPropertyDescriptor,Mie=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),cz=n=>{throw TypeError(n)},uz=(n,e,t)=>e in n?lz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Aie=n=>[,,,Tie(null)],dz=["class","method","getter","setter","accessor","field","value","get","set"],hz=n=>n!==void 0&&typeof n!="function"?cz("Function expected"):n,kie=(n,e,t,r,i)=>({kind:dz[n],name:e,metadata:r,addInitializer:s=>t._?cz("Already initialized"):i.push(hz(s||null))}),jie=(n,e)=>uz(e,Mie("metadata"),n[3]),Oie=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Die=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=dz[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,Iie(i,t)),_=r.length-1;_>=0;_--)u=kie(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,hz(a)&&(w[b]=a);return w&&lz(i,t,w),i},Mx=(n,e,t)=>uz(n,typeof e!="symbol"?e+"":e,t),fz,Ty;const Rie=20,Lie=100;fz=[Lr];class IC{constructor(e){this.editor=e,Oie(Ty,5,this),Mx(this,"prevDroppingShapeId",null),Mx(this,"droppingNodeTimer",null),Mx(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,s=>s.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,Rie,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,Lie,t))}setDragTimer(e,t,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var u,d,f,g,m;t=Ye(t.map(S=>this.editor.getShape(S.id)));const i=((u=this.editor.getDroppingOverShape(e,t))==null?void 0:u.id)??null;if(i===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:s}=this,a=s&&this.editor.getShape(s),l=i&&this.editor.getShape(i);a&&((f=(d=this.editor.getShapeUtil(a)).onDragShapesOut)==null||f.call(d,a,t)),l&&((m=(g=this.editor.getShapeUtil(l)).onDragShapesOver)==null||m.call(g,l,t)),this.hintParents(t),r==null||r(),this.prevDroppingShapeId=i}hintParents(e){const t=new Map;for(const i of e){const s=this.editor.findShapeAncestor(i,a=>a.type!=="group");s&&(t.has(s.id)||t.set(s.id,[]),t.get(s.id).push(i.id))}const r=[];for(const[i,s]of t){const a=this.editor.getShape(i);a&&g6(this.editor,a).length<s.length&&r.push(a.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const s=this.editor.getShape(t);if(!s)return;(i=(r=this.editor.getShapeUtil(s)).onDropShapesOver)==null||i.call(r,s,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}Ty=Aie();Die(Ty,1,"dispose",fz,IC);jie(Ty,IC);var Nie=Object.create,pz=Object.defineProperty,zie=Object.getOwnPropertyDescriptor,gz=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),mz=n=>{throw TypeError(n)},yz=(n,e,t)=>e in n?pz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Fie=n=>[,,,Nie((n==null?void 0:n[gz("metadata")])??null)],Sz=["class","method","getter","setter","accessor","field","value","get","set"],vz=n=>n!==void 0&&typeof n!="function"?mz("Function expected"):n,Bie=(n,e,t,r,i)=>({kind:Sz[n],name:e,metadata:r,addInitializer:s=>t._?mz("Already initialized"):i.push(vz(s||null))}),Uie=(n,e)=>yz(e,gz("metadata"),n[3]),$ie=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Hie=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=Sz[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,zie(i,t)),_=r.length-1;_>=0;_--)u=Bie(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,vz(a)&&(w[b]=a);return w&&pz(i,t,w),i},wa=(n,e,t)=>yz(n,typeof e!="symbol"?e+"":e,t),bz,o1,Iy;class My extends(o1=Ae,bz=[Lr],o1){constructor(){super(...arguments),$ie(Iy,5,this),wa(this,"info",{}),wa(this,"selectionSnapshot",{}),wa(this,"snapshot",{}),wa(this,"markId",""),wa(this,"isCloning",!1),wa(this,"isCreating",!1),wa(this,"dragAndDropManager",new IC(this.editor))}onCreate(e){}onEnter(e){var s;const{isCreating:t=!1,creatingMarkId:r,onCreate:i=()=>{}}=e;if(!((s=this.editor.getSelectedShapeIds())!=null&&s.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(r)this.markId=r;else{const a=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);a&&(this.markId=a)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=i,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=oj(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=oj(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),Lt(this.editor,this.snapshot.movingShapes.map(t=>t.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(r=>{var a;const i=this.editor.getShapeUtil(r),s=(a=i.onTranslateStart)==null?void 0:a.call(i,r);s&&t.push(s)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=P.Average(e.map(s=>this.editor.getShapePageTransform(s.id).point())),i=P.Sub(r,this.selectionSnapshot.averagePagePoint);P.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(s=>s.id),offset:{x:i.x,y:i.y}}})}const t=[];e.forEach(r=>{var l;const i=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r),a=(l=s.onTranslateEnd)==null?void 0:l.call(s,r,i);a&&t.push(a)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),Kie({editor:this.editor,snapshot:e});const{movingShapes:t}=e,r=[];t.forEach(i=>{var u;const s=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i),l=(u=a.onTranslate)==null?void 0:u.call(a,i,s);l&&r.push(l)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(r=>{const i=e.getShape(r.shape.id);if(!i)return null;const s=Ir(i.parentId)?null:ve.Inverse(e.getShapePageTransform(i.parentId));r.parentTransform=s})}}Iy=Fie(o1);Hie(Iy,1,"updateParentTransforms",bz,My);Uie(Iy,My);wa(My,"id","translating");function oj(n){var g;const e=[],t=[],r=n.getSelectedShapeIds(),i=Ye(r.map(m=>{const S=n.getShape(m);if(!S)return null;e.push(S);const b=n.getShapePageTransform(m),x=b.point(),w=b.rotation();t.push(x);const _=si.isId(S.parentId)?null:ve.Inverse(n.getShapePageTransform(S.parentId));return{shape:S,pagePoint:x,pageRotation:w,parentTransform:_}})),s=n.getOnlySelectedShape();let a=[];if(s)a=n.snaps.shapeBounds.getSnapPoints(s.id);else{const m=n.getSelectionPageBounds();m&&(a=m.cornersAndCenter.map((S,b)=>({id:"selection:"+b,x:S.x,y:S.y})))}let l,u;const{originPagePoint:d}=n.inputs,f=i.filter(m=>n.isShapeOfType(m.shape,"note")&&n.isPointInShape(m.shape,d));if(f.length!==0)if(f.length===1)u=f[0];else{const m=n.getCurrentPageShapesSorted();u=(g=f.map(S=>({snapshot:S,index:m.findIndex(b=>b.id===S.shape.id)})).sort((S,b)=>b.index-S.index)[0])==null?void 0:g.snapshot}return u&&(l=mN(n,u.pageRotation,u.shape.props.scale,u.shape.props.growY??0)),{averagePagePoint:P.Average(t),movingShapes:e,shapeSnapshots:i,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:a,noteAdjacentPositions:l,noteSnapshot:u}}function Kie({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:a,shapeSnapshots:l,averagePagePoint:u}=e,d=n.getInstanceState().isGridMode,f=n.getDocumentSettings().gridSize,g=P.Sub(t.currentPagePoint,t.originPagePoint),m=n.inputs.shiftKey?Math.abs(g.x)<Math.abs(g.y)?"x":"y":null;m==="x"?g.x=0:m==="y"&&(g.y=0),n.snaps.clearIndicators();const S=n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let b=!1;if(S&&n.inputs.pointerVelocity.len()<.5){const{nudge:E}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:g,initialSelectionPageBounds:s,lockedAxis:m,initialSelectionSnapPoints:a});g.add(E)}else if(r&&i){const{scale:E}=r.shape.props,M=r.pagePoint.clone().add(g).add(wy.clone().mul(E).rot(r.pageRotation));let I=pN/n.getZoomLevel(),A=new P(0,0);for(const j of i){const D=P.Sub(M,j),R=D.len();R<I&&(b=!0,I=R,A=D)}g.sub(A)}const x=P.Add(u,g),w=n.snaps.getIndicators();d&&!t.ctrlKey&&!b&&w.length===0&&x.snapToGrid(f);const _=P.Sub(x,u);n.updateShapes(Ye(l.map(({shape:E,pagePoint:M,parentTransform:I})=>{const A=P.Add(M,_),j=I?ve.applyToPoint(I,A):A;return{id:E.id,type:E.type,x:j.x,y:j.y}})))}class Dg extends Ae{constructor(){super(...arguments);O(this,"reactor")}static children(){return[s1,PC,_ie,ez,iz,My,KN,az,TC,rz,qN,QN,sz,oz,nz,JN,tz,WN]}cleanUpDuplicateProps(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const i=new Set(r.duplicateProps.shapeIds);t.length===i.size&&t.every(s=>i.has(s))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=js("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){console.error(t)}})}onExit(){var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}O(Dg,"id","select"),O(Dg,"initial","idle"),O(Dg,"isLockable",!1);class xz extends Ae{constructor(){super(...arguments);O(this,"info",{})}onEnter(t){this.info=t}onPointerDown(){this.parent.transition("pointing",this.info)}}O(xz,"id","idle");class wz extends Ae{constructor(){super(...arguments);O(this,"info",{})}onEnter(t){this.info=t}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}O(wz,"id","pointing");class _z extends Ae{constructor(){super(...arguments);O(this,"info",{});O(this,"zoomBrush",new be)}onEnter(t){this.info=t,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(be.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}O(_z,"id","zoom_brushing");class Rg extends Ae{constructor(){super(...arguments);O(this,"info",{})}static children(){return[xz,_z,wz]}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(t){this.updateCursor(),t.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}O(Rg,"id","zoom"),O(Rg,"initial","idle"),O(Rg,"isLockable",!1);const qie=[kg,jg,Og,Rg,Dg];function Gie(){const n=te(),e=oe("follow",()=>n.getInstanceState().followingUserId,[n]);return e?p.jsx(Yie,{userId:e}):null}function Yie({userId:n}){const e=Nm(n);return e?p.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let a1={fonts:{draw:`${Ta()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${Ta()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${Ta()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${Ta()}/fonts/IBMPlexMono-Medium.woff2`}};function Cz(n){return T.useMemo(()=>n?{fonts:{...a1.fonts,...n==null?void 0:n.fonts}}:a1,[n])}const Vie=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Xd={...a1,icons:Object.fromEntries(Vie.map(n=>[n,`${Ta()}/icons/icon/0_merged.svg#${n}`])),translations:Object.fromEntries(Eh.map(n=>[n.locale,`${Ta()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(aC.map(n=>[n.type,`${Ta()}/embed-icons/${n.type}.png`]))};function Xie(n){return n?{fonts:Object.assign({...Xd.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Xd.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Xd.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Xd.translations},{...n==null?void 0:n.translations})}:Xd}var MC="Popover",[Ez,Pce]=qs(MC,[iy]),uf=iy(),[Wie,Va]=Ez(MC),Pz=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:a=!1}=n,l=uf(e),u=T.useRef(null),[d,f]=T.useState(!1),[g=!1,m]=Ga({prop:r,defaultProp:i,onChange:s});return p.jsx(z_,{...l,children:p.jsx(Wie,{scope:e,contentId:Oo(),triggerRef:u,open:g,onOpenChange:m,onOpenToggle:T.useCallback(()=>m(S=>!S),[m]),hasCustomAnchor:d,onCustomAnchorAdd:T.useCallback(()=>f(!0),[]),onCustomAnchorRemove:T.useCallback(()=>f(!1),[]),modal:a,children:t})})};Pz.displayName=MC;var Tz="PopoverAnchor",Zie=T.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Va(Tz,t),s=uf(t),{onCustomAnchorAdd:a,onCustomAnchorRemove:l}=i;return T.useEffect(()=>(a(),()=>l()),[a,l]),p.jsx(F_,{...s,...r,ref:e})});Zie.displayName=Tz;var Iz="PopoverTrigger",Mz=T.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Va(Iz,t),s=uf(t),a=zt(e,i.triggerRef),l=p.jsx(ht.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Dz(i.open),...r,ref:a,onClick:Me(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:p.jsx(F_,{asChild:!0,...s,children:l})});Mz.displayName=Iz;var AC="PopoverPortal",[Qie,Jie]=Ez(AC,{forceMount:void 0}),Az=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,s=Va(AC,e);return p.jsx(Qie,{scope:e,forceMount:t,children:p.jsx(us,{present:t||s.open,children:p.jsx(sf,{asChild:!0,container:i,children:r})})})};Az.displayName=AC;var mu="PopoverContent",kz=T.forwardRef((n,e)=>{const t=Jie(mu,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,s=Va(mu,n.__scopePopover);return p.jsx(us,{present:r||s.open,children:s.modal?p.jsx(ese,{...i,ref:e}):p.jsx(tse,{...i,ref:e})})});kz.displayName=mu;var ese=T.forwardRef((n,e)=>{const t=Va(mu,n.__scopePopover),r=T.useRef(null),i=zt(e,r),s=T.useRef(!1);return T.useEffect(()=>{const a=r.current;if(a)return B_(a)},[]),p.jsx(ay,{as:Nl,allowPinchZoom:!0,children:p.jsx(jz,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Me(n.onCloseAutoFocus,a=>{var l;a.preventDefault(),s.current||(l=t.triggerRef.current)==null||l.focus()}),onPointerDownOutside:Me(n.onPointerDownOutside,a=>{const l=a.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Me(n.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),tse=T.forwardRef((n,e)=>{const t=Va(mu,n.__scopePopover),r=T.useRef(!1),i=T.useRef(!1);return p.jsx(jz,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var a,l;(a=n.onCloseAutoFocus)==null||a.call(n,s),s.defaultPrevented||(r.current||(l=t.triggerRef.current)==null||l.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var u,d;(u=n.onInteractOutside)==null||u.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const a=s.target;((d=t.triggerRef.current)==null?void 0:d.contains(a))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),jz=T.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,...g}=n,m=Va(mu,t),S=uf(t);return I_(),p.jsx(ey,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:p.jsx(nf,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:f,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:p.jsx(HL,{"data-state":Dz(m.open),role:"dialog",id:m.contentId,...S,...g,ref:e,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Oz="PopoverClose",nse=T.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Va(Oz,t);return p.jsx(ht.button,{type:"button",...r,ref:e,onClick:Me(n.onClick,()=>i.onOpenChange(!1))})});nse.displayName=Oz;var rse="PopoverArrow",ise=T.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=uf(t);return p.jsx(KL,{...i,...r,ref:e})});ise.displayName=rse;function Dz(n){return n?"open":"closed"}var kC=Pz,jC=Mz,OC=Az,DC=kz;function RC({id:n,children:e,onOpenChange:t,open:r}){const[i,s]=$o(n,t);return p.jsx(kC,{onOpenChange:s,open:r||i,children:p.jsx("div",{className:"tlui-popover",children:e})})}function LC({children:n}){return p.jsx(jC,{asChild:!0,dir:"ltr",children:n})}function NC({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:s=!1}){const a=bn();return p.jsx(OC,{container:a,children:p.jsx(DC,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",onEscapeKeyDown:l=>s&&l.preventDefault(),children:e})})}function sse(n){return n.getSelectedShapeIds().map(r=>n.getShape(r)).filter(r=>{if(!r)return!1;if(n.isShapeOfType(r,"arrow")){const i=Dr(n,r);if(i.start||i.end)return!1}return!0})}const Rz=()=>{const n=te();return oe("threeStackableItems",()=>sse(n).length>2,[n])},Ho=()=>{const n=te();return oe("isInSelectState",()=>n.isIn("select"),[n])},Lz=()=>{const n=te();return oe("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const r=Dr(n,t);if(r.start&&!e.some(i=>i.id===r.start.toId)||r.end&&!e.some(i=>i.id===r.end.toId))return!1}return!0},[n])},Nz=()=>{const n=te();return oe("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},ose=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function zz(n,e){const t=te();return oe("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function yr(n,e){const t=te();return oe("selectedShapes",()=>{const r=t.getSelectedShapes().filter(i=>!t.isShapeOrAncestorLocked(i)).length;return n===void 0?r:r>=n},[t])}function ase(){const n=te();return oe("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function Fz(){const n=te();return oe("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function lse(){const n=te();return oe("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function Bz(){const n=te();return oe("useCanRedo",()=>n.getCanRedo(),[n])}function Uz(){const n=te();return oe("useCanUndo",()=>n.getCanUndo(),[n])}function cse(){return p.jsxs(p.Fragment,{children:[p.jsx(use,{}),p.jsx(dse,{}),p.jsx(hse,{}),p.jsx(fse,{}),p.jsx(pse,{}),p.jsx(yse,{}),p.jsx(Sse,{}),p.jsx(vse,{})]})}function use(){const n=yr(2),e=Ho(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"align-left",disabled:!t}),p.jsx(he,{actionId:"align-center-horizontal",disabled:!t}),p.jsx(he,{actionId:"align-right",disabled:!t}),p.jsx(he,{actionId:"stretch-horizontal",disabled:!t}),p.jsx(he,{actionId:"align-top",disabled:!t}),p.jsx(he,{actionId:"align-center-vertical",disabled:!t}),p.jsx(he,{actionId:"align-bottom",disabled:!t}),p.jsx(he,{actionId:"stretch-vertical",disabled:!t})]})}function dse(){const n=yr(3),e=Ho(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"distribute-horizontal",disabled:!t}),p.jsx(he,{actionId:"distribute-vertical",disabled:!t})]})}function hse(){const n=Rz(),e=Ho(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"stack-horizontal",disabled:!t}),p.jsx(he,{actionId:"stack-vertical",disabled:!t})]})}function fse(){const n=yr(1),e=Ho(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"send-to-back",disabled:!t}),p.jsx(he,{actionId:"send-backward",disabled:!t}),p.jsx(he,{actionId:"bring-forward",disabled:!t}),p.jsx(he,{actionId:"bring-to-front",disabled:!t})]})}function pse(){return mr()<sn.TABLET_SM?p.jsx(gse,{}):p.jsx(mse,{})}function gse(){const n=te(),e=oe("zoom is 1",()=>n.getZoomLevel()===1,[n]);return p.jsx(he,{actionId:"zoom-to-100",disabled:e})}function mse(){const n=yr(1),e=Ho(),t=n&&e;return p.jsx(he,{actionId:"rotate-ccw",disabled:!t})}function yse(){const n=yr(1),e=Ho(),t=n&&e;return p.jsx(he,{actionId:"rotate-cw",disabled:!t})}function Sse(){const n=Fz(),e=Ho(),t=n&&e;return p.jsx(he,{actionId:"edit-link",disabled:!t})}function vse(){const n=Lz(),e=Nz();return n?p.jsx(aj,{}):e?p.jsx(bse,{}):p.jsx(aj,{})}function aj(){const n=yr(2),e=Ho(),t=n&&e;return p.jsx(he,{actionId:"group",disabled:!t})}function bse(){return p.jsx(he,{actionId:"ungroup"})}const xse=T.memo(function({children:e}){const t=ot(),r=mr(),i=ai(),s=T.useRef(null);qa(s);const a=te(),l=oe("should display quick actions when in readonly",()=>a.isInAny("hand","zoom"),[a]),u=e??p.jsx(cse,{});if(!(i&&!l))return p.jsxs(RC,{id:"actions-menu",children:[p.jsx(LC,{children:p.jsx(Le,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:p.jsx(tt,{icon:"dots-vertical",small:!0})})}),p.jsx(NC,{side:r>=sn.TABLET?"bottom":"top",sideOffset:6,children:p.jsx("div",{ref:s,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:p.jsx(Oi,{type:"icons",sourceId:"actions-menu",children:u})})})]})});function $z(){return ase()?p.jsx(he,{actionId:"toggle-auto-size"}):null}function Hz(){return Fz()?p.jsx(he,{actionId:"edit-link"}):null}function wse(){return yr(1)?p.jsx(he,{actionId:"duplicate"}):null}function Kz(){const n=te();return oe("should display flatten option",()=>{if(n.getSelectedShapeIds().length===0)return!1;const r=n.getOnlySelectedShape();return!(r&&n.isShapeOfType(r,"image"))},[n])?p.jsx(he,{actionId:"flatten-to-image"}):null}function qz(){return Lz()?p.jsx(he,{actionId:"group"}):null}function Gz(){return Nz()?p.jsx(he,{actionId:"ungroup"}):null}function Yz(){const n=te();return oe("allow unframe",()=>{const t=n.getSelectedShapes();return t.length===0?!1:t.every(r=>n.isShapeOfType(r,"frame"))},[n])?p.jsx(he,{actionId:"remove-frame"}):null}function Vz(){const n=te();return oe("allow fit frame to content",()=>{const t=n.getOnlySelectedShape();return t?n.isShapeOfType(t,"frame")&&n.getSortedChildIdsForParent(t).length>0:!1},[n])?p.jsx(he,{actionId:"fit-frame-to-content"}):null}function Xz(){const n=te();return oe("selected shapes",()=>n.getSelectedShapes().length>0,[n])?p.jsx(he,{actionId:"toggle-lock"}):null}function zC(){const n=te(),e=oe("isTransparentBg",()=>!n.getInstanceState().exportBackground,[n]);return p.jsx(hs,{actionId:"toggle-transparent",checked:e,toggle:!0})}function _se(){const n=te(),e=oe("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(he,{actionId:"unlock-all",disabled:!e})}function Wz(){const n=te(),e=oe("zoomed to 100",()=>n.getZoomLevel()===1,[n]);return p.jsx(he,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function Zz(){const n=te(),e=oe("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(he,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function Qz(){const n=te(),e=oe("has shapes",()=>n.getSelectedShapeIds().length>0,[n]);return p.jsx(he,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function Jz(){return p.jsxs(We,{id:"clipboard",children:[p.jsx(Ese,{}),p.jsx(Pse,{}),p.jsx(Tse,{}),p.jsx(wse,{}),p.jsx(Ise,{})]})}function Cse(){var t;const n=te(),e=oe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsxs(Ur,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[p.jsxs(We,{id:"copy-as-group",children:[p.jsx(he,{actionId:"copy-as-svg"}),!!((t=window.navigator.clipboard)!=null&&t.write)&&p.jsx(he,{actionId:"copy-as-png"})]}),p.jsx(We,{id:"copy-as-bg",children:p.jsx(zC,{})})]})}function Ese(){const n=yr(1);return p.jsx(he,{actionId:"cut",disabled:!n})}function Pse(){const n=zz(1);return p.jsx(he,{actionId:"copy",disabled:!n})}function Tse(){const n=ose;return p.jsx(he,{actionId:"paste",disabled:!n})}function e8(){const n=te();return oe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?p.jsxs(We,{id:"conversions",children:[p.jsx(Cse,{}),p.jsxs(Ur,{id:"export-as",label:"context-menu.export-as",size:"small",children:[p.jsxs(We,{id:"export-as-group",children:[p.jsx(he,{actionId:"export-as-svg"}),p.jsx(he,{actionId:"export-as-png"})]}),p.jsx(We,{id:"export-as-bg",children:p.jsx(zC,{})})]})]}):null}function t8(){const n=te(),e=oe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(he,{actionId:"select-all",disabled:!e})}function Ise(){const n=yr(1);return p.jsx(he,{actionId:"delete",disabled:!n})}function Mse(){const n=ai();return!zz(1)||n?null:p.jsxs(Ur,{id:"edit",label:"context-menu.edit",size:"small",children:[p.jsx(qz,{}),p.jsx(Gz,{}),p.jsx(Kz,{}),p.jsx(Hz,{}),p.jsx(Vz,{}),p.jsx(Yz,{}),p.jsx(r8,{}),p.jsx(n8,{}),p.jsx($z,{}),p.jsx(Xz,{})]})}function Ase(){const n=yr(2),e=lse();return ai()||!(n||e)?null:p.jsxs(Ur,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&p.jsxs(We,{id:"align",children:[p.jsx(he,{actionId:"align-left"}),p.jsx(he,{actionId:"align-center-horizontal"}),p.jsx(he,{actionId:"align-right"}),p.jsx(he,{actionId:"align-top"}),p.jsx(he,{actionId:"align-center-vertical"}),p.jsx(he,{actionId:"align-bottom"})]}),p.jsx(kse,{}),n&&p.jsxs(We,{id:"stretch",children:[p.jsx(he,{actionId:"stretch-horizontal"}),p.jsx(he,{actionId:"stretch-vertical"})]}),(n||e)&&p.jsxs(We,{id:"flip",children:[p.jsx(he,{actionId:"flip-horizontal"}),p.jsx(he,{actionId:"flip-vertical"})]}),p.jsx(jse,{})]})}function kse(){return yr(3)?p.jsxs(We,{id:"distribute",children:[p.jsx(he,{actionId:"distribute-horizontal"}),p.jsx(he,{actionId:"distribute-vertical"})]}):null}function jse(){const n=yr(2),e=Rz();return n?p.jsxs(We,{id:"order",children:[p.jsx(he,{actionId:"pack"}),e&&p.jsx(he,{actionId:"stack-horizontal"}),e&&p.jsx(he,{actionId:"stack-vertical"})]}):null}function Ose(){const n=ai(),e=yr(1);return n||!e?null:p.jsx(Ur,{id:"reorder",label:"context-menu.reorder",size:"small",children:p.jsxs(We,{id:"reorder",children:[p.jsx(he,{actionId:"bring-to-front"}),p.jsx(he,{actionId:"bring-forward"}),p.jsx(he,{actionId:"send-backward"}),p.jsx(he,{actionId:"send-to-back"})]})})}function Dse(){const n=te(),e=oe("pages",()=>n.getPages(),[n]),t=oe("current page id",()=>n.getCurrentPageId(),[n]),{addToast:r}=Uo(),i=$n(),s=ai();return!yr(1)||s?null:p.jsxs(Ur,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[p.jsx(We,{id:"pages",children:e.map(l=>p.jsx(Pn,{id:l.id,disabled:t===l.id,label:l.name.length>30?`${l.name.slice(0,30)}`:l.name,onSelect:()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),l.id);const u=n.getPage(l.id);u&&r({title:"Changed Page",description:`Moved to ${u.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.markHistoryStoppingPoint("change-page"),n.setCurrentPage(t)}}]}),i("move-to-page",{source:"context-menu"})}},l.id))}),p.jsx(We,{id:"new-page",children:p.jsx(he,{actionId:"move-to-new-page"})})]})}function n8(){const n=te();return oe("oneEmbedSelected",()=>{const t=n.getOnlySelectedShape();return t?!!(n.isShapeOfType(t,"embed")&&t.props.url&&!n.isShapeOrAncestorLocked(t)):!1},[n])?p.jsx(he,{actionId:"convert-to-bookmark"}):null}function r8(){const n=te(),e=lC();return oe("oneEmbeddableBookmarkSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!n.isShapeOrAncestorLocked(r)):!1},[n])?p.jsx(he,{actionId:"convert-to-embed"}):null}function Rse(){const n=te(),e=oe("isSnapMode",()=>n.user.getIsSnapMode(),[n]);return p.jsx(hs,{actionId:"toggle-snap-mode",checked:e})}function Lse(){const n=te(),e=oe("isToolLock",()=>n.getInstanceState().isToolLocked,[n]);return p.jsx(hs,{actionId:"toggle-tool-lock",checked:e})}function Nse(){const n=te(),e=oe("isGridMode",()=>n.getInstanceState().isGridMode,[n]);return p.jsx(hs,{actionId:"toggle-grid",checked:e})}function zse(){const n=te(),e=oe("isWrapMode",()=>n.user.getIsWrapMode(),[n]);return p.jsx(hs,{actionId:"toggle-wrap-mode",checked:e})}function Fse(){const n=te(),e=oe("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]);return p.jsx(hs,{actionId:"toggle-focus-mode",checked:e})}function Bse(){const n=te(),e=oe("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]);return p.jsx(hs,{actionId:"toggle-edge-scrolling",checked:e===1})}function Use(){const n=te(),e=oe("animationSpeed",()=>n.user.getAnimationSpeed(),[n]);return p.jsx(hs,{actionId:"toggle-reduce-motion",checked:e===0})}function $se(){const n=te(),e=oe("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]);return p.jsx(hs,{actionId:"toggle-debug-mode",checked:e})}function Hse(){const n=te(),e=oe("dynamic resize",()=>n.user.getIsDynamicResizeMode(),[n]);return p.jsx(hs,{actionId:"toggle-dynamic-size-mode",checked:e})}function Kse(){const n=te(),e=oe("paste at cursor",()=>n.user.getIsPasteAtCursorMode(),[n]);return p.jsx(hs,{actionId:"toggle-paste-at-cursor",checked:e})}function qse(){const n=te();return oe("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?p.jsx(he,{actionId:"open-cursor-chat"}):null}function Gse(){const n=te(),e=gy(),t=oe("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]),r=oe("isSinglePageMode",()=>n.options.maxPages<=1,[n]);return t?p.jsxs(p.Fragment,{children:[e&&p.jsx(qse,{}),p.jsxs(We,{id:"modify",children:[p.jsx(Mse,{}),p.jsx(Ase,{}),p.jsx(Ose,{}),!r&&p.jsx(Dse,{})]}),p.jsx(Jz,{}),p.jsx(e8,{}),p.jsx(We,{id:"select-all",children:p.jsx(t8,{})})]}):null}const Yse=T.memo(function({children:e,disabled:t=!1}){const r=te(),{Canvas:i}=Ht(),s=T.useCallback(f=>{if(f){if(r.getInstanceState().isCoarsePointer){const g=r.getSelectedShapes(),{inputs:{currentPagePoint:m}}=r,S=r.getShapesAtPoint(m);if(!r.getSelectedShapes().length||!S.some(b=>g.includes(b))){const b=S.filter(x=>r.isShapeOrAncestorLocked(x));b.length&&r.select(...b.map(x=>x.id))}}}else{const g=r.getOnlySelectedShape();g&&r.isShapeOrAncestorLocked(g)&&r.setSelectedShapes([])}},[r]),a=bn(),[l,u]=$o("context menu",s),d=e??p.jsx(Gse,{});return p.jsxs($Q,{dir:"ltr",onOpenChange:u,modal:!1,children:[p.jsx(HQ,{onContextMenu:void 0,dir:"ltr",disabled:t,children:i?p.jsx(i,{}):null}),l&&p.jsx(KQ,{container:a,children:p.jsx(qQ,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Ze,children:p.jsx(Oi,{type:"context-menu",sourceId:"context-menu",children:d})})})]})}),Vse=2e3,Xse=5e3,Wse=Bn(function(){const e=te(),{isChatting:t,chatMessage:r}=e.getInstanceState(),i=T.useRef(-1),[s,a]=T.useState("");return T.useEffect(()=>{if(!t&&r||t){const u=t?Xse:Vse;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),a(""),e.focus()},u)}return()=>{clearTimeout(i.current)}},[e,r,t]),t?p.jsx(Qse,{value:s,setValue:a,chatMessage:r}):r.trim()?p.jsx(Zse,{chatMessage:r}):null});function i8(n){const e=te();T.useLayoutEffect(()=>{var a;if(!n.current)return;const{x:r,y:i}=e.inputs.currentScreenPoint;(a=n.current)==null||a.style.setProperty("transform",`translate(${r}px, ${i}px)`);function s(l){var f;const{minX:u,minY:d}=e.getViewportScreenBounds();(f=n.current)==null||f.style.setProperty("transform",`translate(${l.clientX-u}px, ${l.clientY-d}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[n,e])}const Zse=({chatMessage:n})=>{const e=te(),t=T.useRef(null);return i8(t),p.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},Qse=Bn(function({chatMessage:e,value:t,setValue:r}){const i=te(),s=ot(),a=T.useRef(null),l=e||s("cursor-chat.type-to-chat");i8(a),T.useLayoutEffect(()=>{const m=a.current;if(!m)return;const S=i.textMeasure.measureText(t||l,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});m.style.setProperty("width",S.w+"px")},[i,t,l]),T.useLayoutEffect(()=>{const m=i.timers.requestAnimationFrame(()=>{var S;(S=a.current)==null||S.focus()});return()=>{cancelAnimationFrame(m)}},[i]);const u=T.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),d=T.useCallback(m=>{const{value:S}=m.target;r(S.slice(0,64)),i.updateInstanceState({chatMessage:S})},[i,r]),f=T.useCallback(m=>{const S=a.current;if(!S)return;const{value:b}=S;switch(m.key){case"Enter":{if(Ze(m),m.stopPropagation(),!b){u();return}r("");break}case"Escape":{Ze(m),m.stopPropagation(),u();break}}},[u,r]),g=T.useCallback(m=>{m.stopPropagation()},[]);return p.jsx("input",{ref:a,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:u,onChange:d,onKeyDown:f,onPaste:g,value:t,placeholder:l,spellCheck:!1})});function l1({checked:n}){return p.jsx(Bs,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function Jse(){const n=te(),{addToast:e}=Uo(),{addDialog:t}=cf(),[r,i]=ct.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(We,{id:"items",children:[p.jsx(Pn,{id:"add-toast",onSelect:()=>{e({id:Ct(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Ct(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Ct(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Ct(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),p.jsx(Pn,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:s})=>p.jsx(noe,{displayDontShowAgain:!0,onCancel:()=>s(),onContinue:()=>s()}),onClose:()=>{}})}}),p.jsx(Pn,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>roe(n,100)}),p.jsx(Pn,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var l;const s=n.getSelectedShapes(),a=s.length===0?n.getRenderingShapes():s;window.alert(`Shapes ${a.length}, DOM nodes:${(l=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:l.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),p.jsx(Pn,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),p.jsx(Pn,{id:"hard-reset",onSelect:WD,label:"Hard reset"})]}),p.jsxs(We,{id:"flags",children:[p.jsx(eoe,{}),p.jsx(toe,{})]})]})}function eoe(){const n=Object.values(ln);return n.length?p.jsx(Ur,{id:"debug flags",label:"Debug Flags",children:p.jsx(We,{id:"debug flags",children:n.map(e=>p.jsx(s8,{flag:e},e.name))})}):null}function toe(){const n=Object.values(hH);return n.length?p.jsx(Ur,{id:"feature flags",label:"Feature Flags",children:p.jsx(We,{id:"feature flags",children:n.map(e=>p.jsx(s8,{flag:e},e.name))})}):null}function noe({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:s,onContinue:a}){const[l,u]=ct.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(dy,{children:[p.jsx(hy,{children:n}),p.jsx(fy,{})]}),p.jsx(kh,{style:{maxWidth:350},children:e}),p.jsxs(oC,{className:"tlui-dialog__footer__actions",children:[i&&p.jsxs(Le,{type:"normal",onClick:()=>u(!l),style:{marginRight:"auto"},children:[p.jsx(l1,{checked:l}),p.jsx(cn,{children:"Dont show again"})]}),p.jsx(Le,{type:"normal",onClick:s,children:p.jsx(cn,{children:t})}),p.jsx(Le,{type:"primary",onClick:async()=>a(),children:p.jsx(cn,{children:r})})]})]})}const s8=Bn(function({flag:e,onChange:t}){const r=e.get();return p.jsx(vy,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),t==null||t(!r)}})});let lj=0;function roe(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)lj++,t[i]={id:Mt("box"+lj),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}function ioe({children:n}){const e=n??p.jsx(Jse,{});return p.jsxs(Bl,{id:"debug",children:[p.jsx(Ul,{children:p.jsx(Le,{type:"icon",title:"Debug menu",children:p.jsx(tt,{icon:"dots-horizontal"})})}),p.jsx($l,{side:"top",align:"end",alignOffset:0,children:p.jsx(Oi,{type:"menu",sourceId:"debug-panel",children:e})})]})}const soe=T.memo(function(){const{DebugMenu:e}=Xa(),t=T.useRef(null);return qa(t),p.jsxs("div",{ref:t,className:"tlui-debug-panel",children:[p.jsx(aoe,{}),p.jsx(loe,{}),e&&p.jsx(e,{})]})});function ooe(n=!0){const[e,t]=T.useState(0),r=te();T.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const aoe=Bn(function(){ooe();const e=te(),t=e.getPath(),r=e.getHoveredShape(),i=e.getOnlySelectedShape(),s=t==="select.idle"||!t.includes("select.")?r:i,a=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${P.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",l=t.startsWith("select.")&&!t.includes(".idle")?` / [${P.ToInt(e.inputs.originPagePoint)}]  [${P.ToInt(e.inputs.currentPagePoint)}] = ${P.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return p.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${a}${l}`})});function loe(){const n=te(),e=oe("show_fps",()=>ln.showFps.get(),[ln]),t=T.useRef(null);return T.useEffect(()=>{if(!e)return;const r=250;let i=0,s=-1,a=performance.now(),l=0,u=0,d=!1;function f(){if(u++,l=performance.now()-a,l>r){const g=Math.round(u*(r/l)*(1e3/r));g>i&&(i=g);const m=i*.75;(g<m&&!d||g>=m&&d)&&(d=!d),t.current.innerHTML=`FPS ${g.toString()}`,t.current.className="tlui-debug-panel__fps"+(d?" tlui-debug-panel__fps__slow":""),l-=r,u=0,a=performance.now()}s=n.timers.requestAnimationFrame(f)}return f(),()=>{cancelAnimationFrame(s)}},[e,n]),e?p.jsx("div",{ref:t}):null}const coe=T.memo(function(){const e=mr(),t=T.useRef(null);qa(t);const{MainMenu:r,QuickActions:i,ActionsMenu:s,PageMenu:a}=Xa(),l=te(),u=oe("isSinglePageMode",()=>l.options.maxPages<=1,[l]),d=l.options.actionShortcutsLocation==="menu"?!0:l.options.actionShortcutsLocation==="toolbar"?!1:e>=sn.TABLET;return!r&&!a&&!d?null:p.jsx("div",{ref:t,className:"tlui-menu-zone",children:p.jsxs("div",{className:"tlui-buttons__horizontal",children:[r&&p.jsx(r,{}),a&&!u&&p.jsx(a,{}),d?p.jsxs(p.Fragment,{children:[i&&p.jsx(i,{}),s&&p.jsx(s,{})]}):null]})})});function uoe(){const n=te(),e=Xl(),[t,r]=T.useState(!1),i=T.useRef(!1);return Ma("toggle showback to content",()=>{const s=i.current,a=n.getCurrentPageShapeIds();let l=!1;a.size&&(l=a.size===n.getCulledShapes().size),s!==l&&(r(l),i.current=l)},[n]),t?p.jsx(he,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function doe(){const n=te();return oe("is pen mode",()=>n.getInstanceState().isPenMode,[n])?p.jsx(he,{actionId:"exit-pen-mode"}):null}function hoe(){const n=te(),e=Xl();return oe("is following user",()=>!!n.getInstanceState().followingUserId,[n])?p.jsx(Pn,{...e["stop-following"]}):null}function foe(){return p.jsxs(p.Fragment,{children:[p.jsx(doe,{}),p.jsx(uoe,{}),p.jsx(hoe,{})]})}function poe({children:n}){const e=n??p.jsx(foe,{});return p.jsx("div",{className:"tlui-helper-buttons",children:p.jsx(Oi,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function goe(){const n=gy();return p.jsxs(p.Fragment,{children:[p.jsxs(We,{label:"shortcuts-dialog.tools",id:"tools",children:[p.jsx(he,{actionId:"toggle-tool-lock"}),p.jsx(he,{actionId:"insert-media"}),p.jsx(Mr,{toolId:"select"}),p.jsx(Mr,{toolId:"draw"}),p.jsx(Mr,{toolId:"eraser"}),p.jsx(Mr,{toolId:"hand"}),p.jsx(Mr,{toolId:"rectangle"}),p.jsx(Mr,{toolId:"ellipse"}),p.jsx(Mr,{toolId:"arrow"}),p.jsx(Mr,{toolId:"line"}),p.jsx(Mr,{toolId:"text"}),p.jsx(Mr,{toolId:"frame"}),p.jsx(Mr,{toolId:"note"}),p.jsx(Mr,{toolId:"laser"}),p.jsx(Pn,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),p.jsxs(We,{label:"shortcuts-dialog.preferences",id:"preferences",children:[p.jsx(he,{actionId:"toggle-dark-mode"}),p.jsx(he,{actionId:"toggle-focus-mode"}),p.jsx(he,{actionId:"toggle-grid"})]}),p.jsxs(We,{label:"shortcuts-dialog.edit",id:"edit",children:[p.jsx(he,{actionId:"undo"}),p.jsx(he,{actionId:"redo"}),p.jsx(he,{actionId:"cut"}),p.jsx(he,{actionId:"copy"}),p.jsx(he,{actionId:"paste"}),p.jsx(he,{actionId:"select-all"}),p.jsx(he,{actionId:"delete"}),p.jsx(he,{actionId:"duplicate"})]}),p.jsxs(We,{label:"shortcuts-dialog.view",id:"view",children:[p.jsx(he,{actionId:"zoom-in"}),p.jsx(he,{actionId:"zoom-out"}),p.jsx(he,{actionId:"zoom-to-100"}),p.jsx(he,{actionId:"zoom-to-fit"}),p.jsx(he,{actionId:"zoom-to-selection"})]}),p.jsxs(We,{label:"shortcuts-dialog.transform",id:"transform",children:[p.jsx(he,{actionId:"bring-to-front"}),p.jsx(he,{actionId:"bring-forward"}),p.jsx(he,{actionId:"send-backward"}),p.jsx(he,{actionId:"send-to-back"}),p.jsx(he,{actionId:"group"}),p.jsx(he,{actionId:"ungroup"}),p.jsx(he,{actionId:"flip-horizontal"}),p.jsx(he,{actionId:"flip-vertical"}),p.jsx(he,{actionId:"align-top"}),p.jsx(he,{actionId:"align-center-vertical"}),p.jsx(he,{actionId:"align-bottom"}),p.jsx(he,{actionId:"align-left"}),p.jsx(he,{actionId:"align-center-horizontal"}),p.jsx(he,{actionId:"align-right"})]}),n&&p.jsx(We,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:p.jsx(he,{actionId:"open-cursor-chat"})})]})}const moe=T.memo(function({children:e}){const t=ot(),r=mr(),i=e??p.jsx(goe,{});return p.jsxs(p.Fragment,{children:[p.jsxs(dy,{className:"tlui-shortcuts-dialog__header",children:[p.jsx(hy,{children:t("shortcuts-dialog.title")}),p.jsx(fy,{})]}),p.jsx(kh,{className:Oe("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=sn.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=sn.TABLET}),children:p.jsx(Oi,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),p.jsx("div",{className:"tlui-dialog__scrim"})]})});function o8(){const n=Ha(),e=$n(),t=oe("locale",()=>n==null?void 0:n.user.getLocale(),[n]);return n?p.jsx(Ur,{id:"help menu language",label:"menu.language",children:p.jsx(We,{id:"languages",children:Eh.map(({locale:r,label:i})=>p.jsx(vy,{id:`language-${r}`,title:r,label:i,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function yoe(){return p.jsxs(p.Fragment,{children:[p.jsx(o8,{}),p.jsx(a8,{})]})}function a8(){const{KeyboardShortcutsDialog:n}=Xa(),{addDialog:e}=cf(),t=T.useCallback(()=>{n&&e({component:n})},[e,n]);return n?p.jsx(Pn,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}function Soe(){return p.jsxs(p.Fragment,{children:[p.jsxs(We,{id:"basic",children:[p.jsx(boe,{}),p.jsx(Coe,{}),p.jsx(voe,{}),p.jsx(Eoe,{})]}),p.jsx(Poe,{})]})}function voe(){return p.jsxs(Ur,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[p.jsxs(We,{id:"export-all-as-group",children:[p.jsx(he,{actionId:"export-all-as-svg"}),p.jsx(he,{actionId:"export-all-as-png"})]}),p.jsx(We,{id:"export-all-as-bg",children:p.jsx(zC,{})})]})}function boe(){return p.jsxs(Ur,{id:"edit",label:"menu.edit",children:[p.jsx(_oe,{}),p.jsx(Jz,{}),p.jsx(e8,{}),p.jsx(xoe,{}),p.jsx(woe,{}),p.jsx(We,{id:"select-all",children:p.jsx(t8,{})})]})}function xoe(){return p.jsxs(We,{id:"misc",children:[p.jsx(qz,{}),p.jsx(Gz,{}),p.jsx(Hz,{}),p.jsx($z,{}),p.jsx(Yz,{}),p.jsx(Vz,{}),p.jsx(r8,{}),p.jsx(n8,{}),p.jsx(Kz,{})]})}function woe(){return p.jsxs(We,{id:"lock",children:[p.jsx(Xz,{}),p.jsx(_se,{})]})}function _oe(){const n=Uz(),e=Bz();return p.jsxs(We,{id:"undo-redo",children:[p.jsx(he,{actionId:"undo",disabled:!n}),p.jsx(he,{actionId:"redo",disabled:!e})]})}function Coe(){return p.jsx(Ur,{id:"view",label:"menu.view",children:p.jsxs(We,{id:"view-actions",children:[p.jsx(he,{actionId:"zoom-in"}),p.jsx(he,{actionId:"zoom-out"}),p.jsx(Wz,{}),p.jsx(Zz,{}),p.jsx(Qz,{})]})})}function Eoe(){return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"insert-embed"}),p.jsx(he,{actionId:"insert-media"})]})}function Poe(){return p.jsxs(We,{id:"preferences",children:[p.jsxs(Ur,{id:"preferences",label:"menu.preferences",children:[p.jsxs(We,{id:"preferences-actions",children:[p.jsx(Rse,{}),p.jsx(Lse,{}),p.jsx(Nse,{}),p.jsx(zse,{}),p.jsx(Fse,{}),p.jsx(Bse,{}),p.jsx(Use,{}),p.jsx(Hse,{}),p.jsx(Kse,{}),p.jsx($se,{})]}),p.jsx(We,{id:"color-scheme",children:p.jsx(ute,{})})]}),p.jsx(o8,{}),p.jsx(a8,{})]})}const Toe=T.memo(function({children:e}){const t=bn(),[r,i]=$o("main menu"),s=ot(),a=e??p.jsx(Soe,{});return p.jsxs(Q_,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[p.jsx(J_,{asChild:!0,dir:"ltr",children:p.jsx(Le,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:p.jsx(tt,{icon:"menu",small:!0})})}),p.jsx(uy,{container:t,children:p.jsx(eC,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:p.jsx(Oi,{type:"menu",sourceId:"main-menu",children:a})})})]})}),Ax={};function Wd(n){if(Ax[n])return Ax[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[r,i,s,a]=t.getImageData(0,0,1,1).data,l=new Float32Array([r/255,i/255,s/255,a/255]);return Ax[n]=l,l}const Lg=10,l8=4*6*Lg+12+4*12;function Gc(n,{center:e,radius:t,numArcSegments:r=20,startAngle:i=0,endAngle:s=wt,offset:a=0}){const l=(s-i)/r;let u=a;for(let d=i;d<s;d+=l)n[u++]=e.x,n[u++]=e.y,n[u++]=e.x+Math.cos(d)*t,n[u++]=e.y+Math.sin(d)*t,n[u++]=e.x+Math.cos(d+l)*t,n[u++]=e.y+Math.sin(d+l)*t;return n}function Yc(n,e,t,r,i,s){n[e++]=t,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r,n[e++]=t+i,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r+s}function Ioe(n,e,t){const r=Lg;t=Math.min(t,Math.min(e.w,e.h)/2);const i=be.ExpandBy(e,-t);if(i.w<=0||i.h<=0)return Gc(n,{center:e.center,radius:t,numArcSegments:Lg*4}),Lg*4*6;let s=0;return Yc(n,s,i.minX,i.minY,i.w,i.h),s+=12,Yc(n,s,i.minX,e.minY,i.w,t),s+=12,Yc(n,s,i.maxX,i.minY,t,i.h),s+=12,Yc(n,s,i.minX,i.maxY,i.w,t),s+=12,Yc(n,s,e.minX,i.minY,t,i.h),s+=12,Gc(n,{numArcSegments:r,offset:s,center:i.point,radius:t,startAngle:pt,endAngle:pt*1.5}),s+=r*6,Gc(n,{numArcSegments:r,offset:s,center:P.Add(i.point,new P(i.w,0)),radius:t,startAngle:pt*1.5,endAngle:wt}),s+=r*6,Gc(n,{numArcSegments:r,offset:s,center:P.Add(i.point,i.size),radius:t,startAngle:0,endAngle:Nt}),s+=r*6,Gc(n,{numArcSegments:r,offset:s,center:P.Add(i.point,new P(0,i.h)),radius:t,startAngle:Nt,endAngle:pt}),l8}function Moe(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const a=e.createProgram();if(!a)throw new Error("Failed to create program");if(e.attachShader(a,r),e.attachShader(a,s),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(a);const l=e.getAttribLocation(a,"shapeVertexPosition");if(l<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(l);const u=e.getUniformLocation(a,"canvasPageBounds"),d=e.getUniformLocation(a,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:tg(e,1024),unselectedShapes:tg(e,4096),viewport:tg(e,l8),collaborators:tg(e,1024),prepareTriangles(m,S){e.bindBuffer(e.ARRAY_BUFFER,m.buffer),e.bufferData(e.ARRAY_BUFFER,m.vertices,e.STATIC_DRAW,0,S),e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(m){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,m/2),e.disable(e.BLEND)},drawTriangles(m){e.drawArrays(e.TRIANGLES,0,m/2)},setFillColor(m){e.uniform4fv(d,m)},setCanvasPageBounds(m){e.uniform4fv(u,m)}}}function tg(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function cj(n,e,t){let r=n.vertices.length;for(;r<e+t.length;)r*=2;if(r!=n.vertices.length){const i=new Float32Array(r);i.set(n.vertices),n.vertices=i}n.vertices.set(t,e)}var Aoe=Object.create,c8=Object.defineProperty,koe=Object.getOwnPropertyDescriptor,joe=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),u8=n=>{throw TypeError(n)},d8=(n,e,t)=>e in n?c8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ooe=n=>[,,,Aoe(null)],h8=["class","method","getter","setter","accessor","field","value","get","set"],f8=n=>n!==void 0&&typeof n!="function"?u8("Function expected"):n,Doe=(n,e,t,r,i)=>({kind:h8[n],name:e,metadata:r,addInitializer:s=>t._?u8("Already initialized"):i.push(f8(s||null))}),Roe=(n,e)=>d8(e,joe("metadata"),n[3]),Loe=(n,e,t,r)=>{for(var i=0,s=n[e>>1],a=s&&s.length;i<a;i++)s[i].call(t);return r},Ys=(n,e,t,r,i,s)=>{for(var a,l,u,d,f=e&7,g=!1,m=!1,S=2,b=h8[f+5],x=n[S]||(n[S]=[]),w=(i=i.prototype,koe(i,t)),_=r.length-1;_>=0;_--)u=Doe(f,t,l={},n[3],x),u.static=g,u.private=m,d=u.access={has:E=>t in E},d.get=E=>E[t],a=(0,r[_])(w[b],u),l._=1,f8(a)&&(w[b]=a);return w&&c8(i,t,w),i},xo=(n,e,t)=>d8(n,typeof e!="symbol"?e+"":e,t),p8,g8,m8,y8,S8,v8,b8,x8,w8,_8,li;_8=[Lr],w8=[ue],x8=[ue],b8=[ue],v8=[ue],S8=[ue],y8=[ue],m8=[ue],g8=[ue],p8=[Lr];class Li{constructor(e,t,r){this.editor=e,this.elem=t,this.container=r,Loe(li,5,this),xo(this,"disposables",[]),xo(this,"gl"),xo(this,"shapeGeometryCache"),xo(this,"colors"),xo(this,"id",Ct()),xo(this,"canvasBoundingClientRect",yn("canvasBoundingClientRect",new be)),xo(this,"originPagePoint",new P),xo(this,"originPageCenter",new P),xo(this,"isInViewport",!1),this.gl=Moe(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const s=e.getShapeMaskedPageBounds(i.id);if(!s)return null;const a=new Float32Array(12);return Yc(a,0,s.x,s.y,s.w,s.h),a}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),js("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Wd(e.getPropertyValue("--color-text-3").trim()),selectFill:Wd(e.getPropertyValue("--color-selected").trim()),viewportFill:Wd(e.getPropertyValue("--color-muted-1").trim()),background:Wd(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?be.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new P(e.maxX,e.maxY));return new be(t.x,t.y,r.x-t.x,r.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:r,height:i}=this.elem.getBoundingClientRect();return new be(e,t,r,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new P(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),r=e.width/e.height;let i=t.width,s=i/r;s<t.height&&(s=t.height,i=s*r);const a=new be(0,0,i,s);return a.center=t.center,a}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:r,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,r,i])}getMinimapPagePoint(e,t){const r=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,a=t-i.y;return s*=r.width/i.width,a*=r.height/i.height,s+=r.minX,a+=r.minY,new P(s,a,1)}minimapScreenPointToPagePoint(e,t,r=!1,i=!1){const{editor:s}=this,a=s.getViewportPageBounds();let{x:l,y:u}=this.getMinimapPagePoint(e,t);if(i){const d=this.editor.getCurrentPageBounds()??new be,f=d.minX-a.width/2,g=d.maxX+a.width/2,m=d.minY-a.height/2,S=d.maxY+a.height/2,b=Math.max(0,f+a.width-l),x=Math.max(0,-(g-a.width-l)),w=Math.max(0,m+a.height-u),_=Math.max(0,-(S-a.height-u));l+=(b-x)/2,u+=(w-_)/2,l=On(l,f,g),u=On(u,m,S)}if(r){const{originPagePoint:d}=this,f=Math.abs(l-d.x),g=Math.abs(u-d.y);f>g?u=d.y:l=d.x}return new P(l,u)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,a=0;const l=this.editor.getCurrentPageShapeIdsSorted();for(let u=0,d=l.length;u<d;u++){const f=l[u],g=this.shapeGeometryCache.get(f);if(!g)continue;const m=g.length;r.has(f)?(cj(this.gl.selectedShapes,s,g),s+=m):(cj(this.gl.unselectedShapes,a,g),a+=m)}this.drawShapes(this.gl.unselectedShapes,a,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,r){this.gl.prepareTriangles(e,t),this.gl.setFillColor(r),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=Ioe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),kt.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,r=t*6,i=r*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const s=this.gl.collaborators.vertices;let a=0;const l=this.getZoom();for(const{cursor:u}of e)u&&(Gc(s,{center:P.From(u),radius:3*l,offset:a,numArcSegments:t}),a+=r);this.gl.prepareTriangles(this.gl.collaborators,i),a=0;for(const{color:u}of e)this.gl.setFillColor(Wd(u)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,a/2,r/2),a+=r}}li=Ooe();Ys(li,1,"close",_8,Li);Ys(li,1,"getDpr",w8,Li);Ys(li,1,"getContentPageBounds",x8,Li);Ys(li,1,"getContentScreenBounds",b8,Li);Ys(li,1,"getCanvasSize",v8,Li);Ys(li,1,"getCanvasClientPosition",S8,Li);Ys(li,1,"getCanvasPageBounds",y8,Li);Ys(li,1,"getZoom",m8,Li);Ys(li,1,"getCanvasPageBoundsArray",g8,Li);Ys(li,1,"render",p8,Li);Roe(li,Li);function Noe(){const n=te(),e=bn(),t=T.useRef(null),r=T.useRef(!1),i=T.useRef();T.useEffect(()=>{try{const f=new Li(n,t.current,e);return i.current=f,i.current.close}catch(f){n.annotateError(f,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw f})}},[n,e]);const s=T.useCallback(f=>{if(!n.getCurrentPageShapeIds().size||!i.current)return;const g=i.current.minimapScreenPointToPagePoint(f.clientX,f.clientY,!1,!1),m=i.current.minimapScreenPointToPagePoint(f.clientX,f.clientY,!1,!0);i.current.originPagePoint.setTo(m),i.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(g,{animation:{duration:n.options.animationMediumMs}})},[n]),a=T.useCallback(f=>{if(!i.current)return;const g=f.currentTarget;if(qh(g,f),!n.getCurrentPageShapeIds().size)return;r.current=!0,i.current.isInViewport=!1;const m=i.current.minimapScreenPointToPagePoint(f.clientX,f.clientY,!1,!1),S=n.getViewportPageBounds(),b=i.current.getContentPageBounds();if(new be(b.x-S.width/2,b.y-S.height/2,b.width+S.width,b.height+S.height).containsPoint(m)&&!S.containsPoint(m)){i.current.isInViewport=S.containsPoint(m);const _=P.Sub(S.center,S.point),E=P.Add(m,_);i.current.originPagePoint.setTo(E),i.current.originPageCenter.setTo(m),n.centerOnPoint(m,{animation:{duration:n.options.animationMediumMs}})}else{const _=i.current.minimapScreenPointToPagePoint(f.clientX,f.clientY,!1,!0);i.current.isInViewport=S.containsPoint(_),i.current.originPagePoint.setTo(_),i.current.originPageCenter.setTo(S.center)}function w(_){g&&Gh(g,_),r.current=!1,document.body.removeEventListener("pointerup",w)}document.body.addEventListener("pointerup",w)},[n]),l=T.useCallback(f=>{if(!i.current)return;const g=i.current.minimapScreenPointToPagePoint(f.clientX,f.clientY,f.shiftKey,!0);if(r.current){if(i.current.isInViewport){const x=i.current.originPagePoint.clone().sub(i.current.originPageCenter);n.centerOnPoint(P.Sub(g,x));return}n.centerOnPoint(g)}const m=i.current.getMinimapPagePoint(f.clientX,f.clientY),S=n.pageToScreen(m),b={type:"pointer",target:"canvas",name:"pointer_move",...Qr(f),point:S,isPen:n.getInstanceState().isPenMode};n.dispatch(b)},[n]),u=T.useCallback(f=>{const g=FD(f);n.dispatch({type:"wheel",name:"wheel",delta:g,point:new P(f.clientX,f.clientY),shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey,metaKey:f.metaKey,accelKey:er(f)})},[n]),d=ef();return T.useEffect(()=>{n.timers.setTimeout(()=>{var f,g;(f=i.current)==null||f.updateColors(),(g=i.current)==null||g.render()})},[d,n]),p.jsx("div",{className:"tlui-minimap",children:p.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:l,onPointerDown:a,onWheelCapture:u})})}function zoe(n,e){const[t,r]=ct.useState(e);ct.useLayoutEffect(()=>{const s=C1(n);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=ct.useCallback(s=>{r(a=>{const l=typeof s=="function"?s(a):s;return E1(n,JSON.stringify(l)),l})},[n]);return[t,i]}const Foe=T.memo(function(){const e=Xl(),t=ot(),r=mr(),i=T.useRef(null);qa(i);const[s,a]=zoe("minimap",!0),l=T.useCallback(()=>{a(f=>!f)},[a]),{ZoomMenu:u,Minimap:d}=Xa();return r<sn.MOBILE?null:p.jsxs("div",{ref:i,className:"tlui-navigation-panel",children:[p.jsx("div",{className:"tlui-buttons__horizontal",children:u&&r<sn.TABLET?p.jsx(u,{}):s?p.jsxs(p.Fragment,{children:[u&&p.jsx(u,{}),d&&p.jsx(Le,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:l,children:p.jsx(tt,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):p.jsxs(p.Fragment,{children:[p.jsx(Le,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(jh(e["zoom-out"].label))} ${Hw(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:p.jsx(tt,{icon:"minus"})}),u&&p.jsx(u,{}),p.jsx(Le,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(jh(e["zoom-in"].label))} ${Hw(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:p.jsx(tt,{icon:"plus"})}),d&&p.jsx(Le,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:l,children:p.jsx(tt,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),d&&r>=sn.TABLET&&!s&&p.jsx(d,{})]})}),Boe=function({name:e,id:t,isCurrentPage:r,onCancel:i}){const s=te(),a=$n(),l=T.useRef(null),u=T.useRef(null),d=T.useCallback(()=>{u.current=s.markHistoryStoppingPoint("rename page")},[s]),f=T.useCallback(m=>{s.renamePage(t,m||"New Page"),a("rename-page",{source:"page-menu"})},[s,t,a]),g=T.useCallback(()=>{u.current&&s.bailToMark(u.current),i()},[s,i]);return p.jsx(py,{className:"tlui-page-menu__item__input",ref:m=>l.current=m,defaultValue:e,onValueChange:f,onCancel:g,onFocus:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},c1=(n,e,t,r,i)=>{let s;const a=n.getPages(),l=t>r?a[r-1]:a[r],u=t>r?a[r]:a[r+1];l&&!u?s=Is(l.index):!l&&u?s=zF(a[0].index):s=wh(l.index,u.index),s!==a[t].index&&(n.markHistoryStoppingPoint("moving page"),n.updatePage({id:e,index:s}),i("move-page",{source:"page-menu"}))},uj=Bn(function({index:e,listSize:t,item:r,onRename:i}){const s=te(),a=ot(),l=s.getPages(),u=$n(),d=T.useCallback(()=>{s.markHistoryStoppingPoint("creating page");const S=si.createId();s.duplicatePage(r.id,S),u("duplicate-page",{source:"page-menu"})},[s,r,u]),f=T.useCallback(()=>{c1(s,r.id,e,e-1,u)},[s,r,e,u]),g=T.useCallback(()=>{c1(s,r.id,e,e+1,u)},[s,r,e,u]),m=T.useCallback(()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(r.id),u("delete-page",{source:"page-menu"})},[s,r,u]);return p.jsxs(Bl,{id:`page item submenu ${e}`,children:[p.jsx(Ul,{children:p.jsx(Le,{type:"icon",title:a("page-menu.submenu.title"),children:p.jsx(tt,{icon:"dots-vertical",small:!0})})}),p.jsx($l,{alignOffset:0,side:"right",sideOffset:-4,children:p.jsxs(Oi,{type:"menu",sourceId:"page-menu",children:[p.jsxs(We,{id:"modify",children:[i&&p.jsx(Pn,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),p.jsx(Pn,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:l.length>=s.options.maxPages}),e>0&&p.jsx(Pn,{id:"move-up",onSelect:f,label:"page-menu.submenu.move-up"}),e<t-1&&p.jsx(Pn,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:g})]}),t>1&&p.jsx(We,{id:"delete",children:p.jsx(Pn,{id:"delete",onSelect:m,label:"page-menu.submenu.delete"})})]})})]})}),Uoe=T.memo(function(){const e=te(),t=$n(),r=ot(),i=mr(),s=T.useCallback(()=>_(!1),[]),[a,l]=$o("page-menu",s),u=36,d=T.useRef(null),f=oe("pages",()=>e.getPages(),[e]),g=oe("currentPage",()=>e.getCurrentPage(),[e]),m=oe("currentPageId",()=>e.getCurrentPageId(),[e]),S=ai(),b=oe("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),x=oe("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[w,_]=T.useState(!1),E=T.useCallback(()=>{S||_(z=>!z)},[S]),M=T.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[I,A]=T.useState(Object.fromEntries(f.map((z,U)=>[z.id,{y:U*u,offsetY:0,isSelected:!1}])));T.useLayoutEffect(()=>{A(Object.fromEntries(f.map((z,U)=>[z.id,{y:U*u,offsetY:0,isSelected:!1}])))},[u,f]),T.useEffect(()=>{a&&e.timers.requestAnimationFrame(()=>{const z=document.querySelector(`[data-testid="page-menu-item-${m}"]`);if(z){const U=d.current;if(!U)return;const Y=z.offsetTop,H=U.scrollTop;Y<H&&U.scrollTo({top:Y});const X=Y+u,V=U.scrollTop+U.offsetHeight;X>V&&U.scrollTo({top:X-U.offsetHeight})}})},[u,m,a,e]);const j=T.useCallback(z=>{const{clientY:U,currentTarget:Y}=z,{dataset:{id:H,index:X}}=Y;if(!H||!X)return;const V=M.current;qh(z.currentTarget,z),V.status="pointing",V.pointing={id:H,index:+X};const B=I[H].y;V.startY=U,V.startIndex=Math.max(0,Math.min(Math.round(B/u),f.length-1))},[u,f.length,I]),D=T.useCallback(z=>{const U=M.current;if(U.status==="pointing"){const{clientY:Y}=z,H=Y-U.startY;Math.abs(H)>5&&(U.status="dragging")}if(U.status==="dragging"){const{clientY:Y}=z,H=Y-U.startY,X=I[U.pointing.id],{startIndex:V,pointing:ie}=U,B=X.y+H,re=Math.max(0,Math.min(Math.round(B/u),f.length-1)),me={...I};if(me[ie.id]={y:X.y,offsetY:H,isSelected:!0},re!==U.dragIndex){U.dragIndex=re;for(let de=0;de<f.length;de++){const ye=f[de];if(ye.id===U.pointing.id)continue;let{y:ge}=me[ye.id];re===V?ge=de*u:re<V?re<=de&&de<V?ge=(de+1)*u:ge=de*u:re>V&&(re>=de&&de>V?ge=(de-1)*u:ge=de*u),ge!==me[ye.id].y&&(me[ye.id]={y:ge,offsetY:0,isSelected:!0})}}A(me)}},[u,f,I]),R=T.useCallback(z=>{const U=M.current;if(U.status==="dragging"){const{id:Y,index:H}=U.pointing;c1(e,Y,H,U.dragIndex,t)}Gh(z.currentTarget,z),U.status="idle"},[e,t]),q=T.useCallback(z=>{const U=M.current;z.key==="Escape"&&(U.status==="dragging"&&A(Object.fromEntries(f.map((Y,H)=>[Y.id,{y:H*u,offsetY:0,isSelected:!1}]))),U.status="idle")},[u,f]),L=T.useCallback(()=>{S||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const z=si.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:z}),e.setCurrentPage(z),_(!0)}),t("new-page",{source:"page-menu"}))},[e,r,S,t]),K=T.useCallback(z=>{e.setCurrentPage(z),t("change-page",{source:"page-menu"})},[e,t]),G=T.useCallback((z,U)=>{e.renamePage(z,U),t("rename-page",{source:"page-menu"})},[e,t]);return p.jsxs(RC,{id:"pages",onOpenChange:l,open:a,children:[p.jsx(LC,{"data-testid":"main.page-menu",children:p.jsxs(Le,{type:"menu",title:g.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[p.jsx("div",{className:"tlui-page-menu__name",children:g.name}),p.jsx(tt,{icon:"chevron-down",small:!0})]})}),p.jsx(NC,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:w,children:p.jsxs("div",{className:"tlui-page-menu__wrapper",children:[p.jsxs("div",{className:"tlui-page-menu__header",children:[p.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!S&&p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsx(Le,{type:"icon","data-testid":"page-menu.edit",title:r(w?"page-menu.edit-done":"page-menu.edit-start"),onClick:E,children:p.jsx(tt,{icon:w?"check":"edit"})}),p.jsx(Le,{type:"icon","data-testid":"page-menu.create",title:r(b?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:b,onClick:L,children:p.jsx(tt,{icon:"plus"})})]})]}),p.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:u*f.length+4},ref:d,children:f.map((z,U)=>{const Y=I[z.id]??{offsetY:0};return w?p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:z.id===g.id?888:U,transform:`translate(0px, ${Y.y+Y.offsetY}px)`},children:[p.jsx(Le,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:j,onPointerUp:R,onPointerMove:D,onKeyDown:q,"data-id":z.id,"data-index":U,children:p.jsx(tt,{icon:"drag-handle-dots"})}),i<sn.TABLET_SM&&x?p.jsxs(Le,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const H=window.prompt("Rename page",z.name);H&&H!==z.name&&G(z.id,H)},onDoubleClick:E,children:[p.jsx(l1,{checked:z.id===g.id}),p.jsx(cn,{children:z.name})]}):p.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:u},children:p.jsx(Boe,{id:z.id,name:z.name,isCurrentPage:z.id===g.id,onCancel:()=>{_(!1),e.menus.clearOpenMenus()}})}),!S&&p.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":w,children:p.jsx(uj,{index:U,item:z,listSize:f.length})})]},z.id+"_editing"):p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[p.jsxs(Le,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>K(z.id),onDoubleClick:E,title:r("page-menu.go-to-page"),children:[p.jsx(l1,{checked:z.id===g.id}),p.jsx(cn,{children:z.name})]}),!S&&p.jsx("div",{className:"tlui-page_menu__item__submenu",children:p.jsx(uj,{index:U,item:z,listSize:f.length,onRename:()=>{if(kt.isIos){const H=window.prompt("Rename page",z.name);H&&H!==z.name&&G(z.id,H)}else _(!0),m!==z.id&&K(z.id)}})})]},z.id)})})]})})]})});function $oe(){const n=te(),e=ai(),t=oe("should display quick actions",()=>n.isInAny("select","hand","zoom"),[n]);if(!(e&&!t))return p.jsxs(p.Fragment,{children:[p.jsx(Koe,{}),p.jsx(Hoe,{})]})}function Hoe(){const n=yr(1),e=Ho(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"delete",disabled:!t}),p.jsx(he,{actionId:"duplicate",disabled:!t})]})}function Koe(){const n=Uz(),e=Bz();return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"undo",disabled:!n}),p.jsx(he,{actionId:"redo",disabled:!e})]})}const qoe=T.memo(function({children:e}){const t=e??p.jsx($oe,{});return p.jsx(Oi,{type:"small-icons",sourceId:"quick-actions",children:t})});function Goe({userId:n}){const e=Nm(n);return e?p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const Yoe=Bn(function({userId:e}){const t=te(),r=ot(),i=$n(),s=Nm(e),a=T.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[t,e,i]),l=(s==null?void 0:s.followingUserId)===t.user.getId(),u=t.getInstanceState().followingUserId===e;return s?p.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[p.jsxs(Le,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:a,children:[p.jsx(Bs,{icon:"color",color:s.color}),p.jsx("div",{className:"tlui-people-menu__name",children:s.userName??"New User"})]}),p.jsx(Le,{type:"icon",className:"tlui-people-menu__item__follow",title:r(l?"people-menu.leading":u?"people-menu.following":"people-menu.follow"),onClick:a,disabled:l,"data-active":u||l,children:p.jsx(tt,{icon:l?"leading":u?"following":"follow"})})]}):null});function Voe({count:n}){return p.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const Xoe=Bn(function(){const e=te(),t=bn(),r=ot(),i=$n(),s=T.useRef(!1),[a,l]=T.useState(!1),u=T.useCallback(x=>{l(x)},[]),d=e.user.getColor(),f=T.useCallback(x=>{e.user.updateUserPreferences({color:x}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:g,handleButtonPointerDown:m,handleButtonPointerEnter:S,handleButtonPointerUp:b}=ct.useMemo(()=>{const x=()=>{s.current=!1,window.removeEventListener("pointerup",x)};return{handleButtonClick:I=>{const{id:A}=I.currentTarget.dataset;A&&d!==A&&f(A)},handleButtonPointerDown:I=>{const{id:A}=I.currentTarget.dataset;A&&(f(A),s.current=!0,window.addEventListener("pointerup",x))},handleButtonPointerEnter:I=>{if(!s.current)return;const{id:A}=I.currentTarget.dataset;A&&f(A)},handleButtonPointerUp:I=>{const{id:A}=I.currentTarget.dataset;A&&f(A)}}},[d,f]);return p.jsxs(kC,{onOpenChange:u,open:a,children:[p.jsx(jC,{dir:"ltr",asChild:!0,children:p.jsx(Le,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:p.jsx(tt,{icon:"color"})})}),p.jsx(OC,{container:t,children:p.jsx(DC,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:p.jsx("div",{className:"tlui-buttons__grid",children:yw.map(x=>p.jsx(Le,{type:"icon","data-id":x,"data-testid":x,"aria-label":x,"data-state":d===x?"hinted":void 0,title:x,className:"tlui-button-grid__button",style:{color:x},onPointerEnter:S,onPointerDown:m,onPointerUp:b,onClick:g,children:p.jsx(tt,{icon:"color"})},x))})})})]})});function Woe(){const n=te(),e=$n(),t=oe("userName",()=>n.user.getName(),[]),r=ot(),i=T.useRef(t),s=T.useRef(t),[a,l]=T.useState(!1),u=T.useCallback(()=>{l(m=>!m)},[]),d=T.useCallback(m=>{s.current=m,n.user.updateUserPreferences({name:m})},[n]),f=T.useCallback(()=>{i.current!==s.current&&(e("change-user-name",{source:"people-menu"}),i.current=s.current)},[e]),g=T.useCallback(()=>{l(!1),n.user.updateUserPreferences({name:i.current}),n.menus.clearOpenMenus()},[n]);return p.jsxs("div",{className:"tlui-people-menu__user",children:[p.jsx(Xoe,{}),a?p.jsx(py,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:d,onComplete:u,onCancel:g,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{a||l(!0)},children:t}),t==="New User"?p.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),p.jsx(Le,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:u,children:p.jsx(tt,{icon:a?"check":"edit"})})]})}function Zoe({displayUserWhenAlone:n,children:e}){const t=ot(),r=bn(),i=te(),s=$D(),a=oe("user",()=>i.user.getColor(),[i]),l=oe("user",()=>i.user.getName(),[i]),[u,d]=$o("people menu");return p.jsxs(kC,{onOpenChange:d,open:u,children:[p.jsx(jC,{dir:"ltr",asChild:!0,children:p.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[s.length>5&&p.jsx(Voe,{count:s.length-5}),p.jsxs("div",{className:"tlui-people-menu__avatars",children:[s.slice(-5).map(f=>p.jsx(Goe,{userId:f},f)),(n||s.length>0)&&p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:a},children:l==="New User"?"":l[0]??""})]})]})}),p.jsx(OC,{container:r,children:p.jsx(DC,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,onEscapeKeyDown:Ze,children:p.jsxs("div",{className:"tlui-people-menu__wrapper",children:[p.jsx("div",{className:"tlui-people-menu__section",children:p.jsx(Woe,{})}),s.length>0&&p.jsx("div",{className:"tlui-people-menu__section",children:s.map(f=>p.jsx(Yoe,{userId:f},f+"_presence"))}),e]})})})]})}function Qoe(){return p.jsx("div",{className:"tlui-share-zone",draggable:!1,children:p.jsx(Zoe,{displayUserWhenAlone:!0})})}const Joe=Object.freeze([ii,Rl,Ll,zs]);function C8(n=Joe){const e=te();return oe("getRelevantStyles",()=>{var s;const t=new _w(e.getSharedStyles()),r=!!((s=e.root.getCurrent())!=null&&s.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const a of n)t.applyValue(a,e.getStyleForNextShape(a));return r||i||t.size>0?t:null},[e])}const Pi={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Tl=T.memo(function(e){const{uiType:t,items:r,title:i,style:s,value:a,onValueChange:l,onHistoryMark:u,theme:d}=e,f=ot(),g=T.useRef(!1),m=T.useRef(null),{handleButtonClick:S,handleButtonPointerDown:b,handleButtonPointerEnter:x,handleButtonPointerUp:w}=T.useMemo(()=>{const _=()=>{g.current=!1,window.removeEventListener("pointerup",_);const j=m.current;j&&["TEXTAREA","INPUT"].includes(j.nodeName)&&j.focus(),m.current=null};return{handleButtonClick:j=>{const{id:D}=j.currentTarget.dataset;a.type==="shared"&&a.value===D||(u==null||u("point picker item"),l(s,D))},handleButtonPointerDown:j=>{const{id:D}=j.currentTarget.dataset;u==null||u("point picker item"),l(s,D),g.current=!0,m.current=document.activeElement,window.addEventListener("pointerup",_)},handleButtonPointerEnter:j=>{if(!g.current)return;const{id:D}=j.currentTarget.dataset;l(s,D)},handleButtonPointerUp:j=>{const{id:D}=j.currentTarget.dataset;a.type==="shared"&&a.value===D||l(s,D)}}},[a,u,l,s]);return p.jsx("div",{"data-testid":`style.${t}`,className:Oe("tlui-buttons__grid"),children:r.map(_=>p.jsx(Le,{type:"icon","data-id":_.value,"data-testid":`style.${t}.${_.value}`,"aria-label":_.value,"data-state":a.type==="shared"&&a.value===_.value?"hinted":void 0,title:i+"  "+f(`${t}-style.${_.value}`),className:Oe("tlui-button-grid__button"),style:s===ii?{color:d[_.value].solid}:void 0,onPointerEnter:x,onPointerDown:b,onPointerUp:w,onClick:S,children:p.jsx(tt,{icon:_.icon})},_.value))})});function E8(n,[e,t]){return Math.min(t,Math.max(e,n))}function eae(n){const e=T.useRef({value:n,previous:n});return T.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var P8=["PageUp","PageDown"],T8=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],I8={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ju="Slider",[u1,tae,nae]=Jm(ju),[M8,Tce]=qs(ju,[nae]),[rae,Ay]=M8(ju),A8=T.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:s=1,orientation:a="horizontal",disabled:l=!1,minStepsBetweenThumbs:u=0,defaultValue:d=[r],value:f,onValueChange:g=()=>{},onValueCommit:m=()=>{},inverted:S=!1,form:b,...x}=n,w=T.useRef(new Set),_=T.useRef(0),M=a==="horizontal"?iae:sae,[I=[],A]=Ga({prop:f,defaultProp:d,onChange:K=>{var z;(z=[...w.current][_.current])==null||z.focus(),g(K)}}),j=T.useRef(I);function D(K){const G=uae(I,K);L(K,G)}function R(K){L(K,_.current)}function q(){const K=j.current[_.current];I[_.current]!==K&&m(I)}function L(K,G,{commit:z}={commit:!1}){const U=pae(s),Y=gae(Math.round((K-r)/s)*s+r,U),H=E8(Y,[r,i]);A((X=[])=>{const V=lae(X,H,G);if(fae(V,u*s)){_.current=V.indexOf(H);const ie=String(V)!==String(X);return ie&&z&&m(V),ie?V:X}else return X})}return p.jsx(rae,{scope:n.__scopeSlider,name:t,disabled:l,min:r,max:i,valueIndexToChangeRef:_,thumbs:w.current,values:I,orientation:a,form:b,children:p.jsx(u1.Provider,{scope:n.__scopeSlider,children:p.jsx(u1.Slot,{scope:n.__scopeSlider,children:p.jsx(M,{"aria-disabled":l,"data-disabled":l?"":void 0,...x,ref:e,onPointerDown:Me(x.onPointerDown,()=>{l||(j.current=I)}),min:r,max:i,inverted:S,onSlideStart:l?void 0:D,onSlideMove:l?void 0:R,onSlideEnd:l?void 0:q,onHomeKeyDown:()=>!l&&L(r,0,{commit:!0}),onEndKeyDown:()=>!l&&L(i,I.length-1,{commit:!0}),onStepKeyDown:({event:K,direction:G})=>{if(!l){const Y=P8.includes(K.key)||K.shiftKey&&T8.includes(K.key)?10:1,H=_.current,X=I[H],V=s*Y*G;L(X+V,H,{commit:!0})}}})})})})});A8.displayName=ju;var[k8,j8]=M8(ju,{startEdge:"left",endEdge:"right",size:"width",direction:1}),iae=T.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:s,onSlideStart:a,onSlideMove:l,onSlideEnd:u,onStepKeyDown:d,...f}=n,[g,m]=T.useState(null),S=zt(e,M=>m(M)),b=T.useRef(void 0),x=T_(i),w=x==="ltr",_=w&&!s||!w&&s;function E(M){const I=b.current||g.getBoundingClientRect(),A=[0,I.width],D=FC(A,_?[t,r]:[r,t]);return b.current=I,D(M-I.left)}return p.jsx(k8,{scope:n.__scopeSlider,startEdge:_?"left":"right",endEdge:_?"right":"left",direction:_?1:-1,size:"width",children:p.jsx(O8,{dir:x,"data-orientation":"horizontal",...f,ref:S,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:M=>{const I=E(M.clientX);a==null||a(I)},onSlideMove:M=>{const I=E(M.clientX);l==null||l(I)},onSlideEnd:()=>{b.current=void 0,u==null||u()},onStepKeyDown:M=>{const A=I8[_?"from-left":"from-right"].includes(M.key);d==null||d({event:M,direction:A?-1:1})}})})}),sae=T.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:u,...d}=n,f=T.useRef(null),g=zt(e,f),m=T.useRef(void 0),S=!i;function b(x){const w=m.current||f.current.getBoundingClientRect(),_=[0,w.height],M=FC(_,S?[r,t]:[t,r]);return m.current=w,M(x-w.top)}return p.jsx(k8,{scope:n.__scopeSlider,startEdge:S?"bottom":"top",endEdge:S?"top":"bottom",size:"height",direction:S?1:-1,children:p.jsx(O8,{"data-orientation":"vertical",...d,ref:g,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const w=b(x.clientY);s==null||s(w)},onSlideMove:x=>{const w=b(x.clientY);a==null||a(w)},onSlideEnd:()=>{m.current=void 0,l==null||l()},onStepKeyDown:x=>{const _=I8[S?"from-bottom":"from-top"].includes(x.key);u==null||u({event:x,direction:_?-1:1})}})})}),O8=T.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:a,onEndKeyDown:l,onStepKeyDown:u,...d}=n,f=Ay(ju,t);return p.jsx(ht.span,{...d,ref:e,onKeyDown:Me(n.onKeyDown,g=>{g.key==="Home"?(a(g),g.preventDefault()):g.key==="End"?(l(g),g.preventDefault()):P8.concat(T8).includes(g.key)&&(u(g),g.preventDefault())}),onPointerDown:Me(n.onPointerDown,g=>{const m=g.target;m.setPointerCapture(g.pointerId),g.preventDefault(),f.thumbs.has(m)?m.focus():r(g)}),onPointerMove:Me(n.onPointerMove,g=>{g.target.hasPointerCapture(g.pointerId)&&i(g)}),onPointerUp:Me(n.onPointerUp,g=>{const m=g.target;m.hasPointerCapture(g.pointerId)&&(m.releasePointerCapture(g.pointerId),s(g))})})}),D8="SliderTrack",R8=T.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Ay(D8,t);return p.jsx(ht.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});R8.displayName=D8;var d1="SliderRange",L8=T.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Ay(d1,t),s=j8(d1,t),a=T.useRef(null),l=zt(e,a),u=i.values.length,d=i.values.map(m=>z8(m,i.min,i.max)),f=u>1?Math.min(...d):0,g=100-Math.max(...d);return p.jsx(ht.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:l,style:{...n.style,[s.startEdge]:f+"%",[s.endEdge]:g+"%"}})});L8.displayName=d1;var h1="SliderThumb",N8=T.forwardRef((n,e)=>{const t=tae(n.__scopeSlider),[r,i]=T.useState(null),s=zt(e,l=>i(l)),a=T.useMemo(()=>r?t().findIndex(l=>l.ref.current===r):-1,[t,r]);return p.jsx(oae,{...n,ref:s,index:a})}),oae=T.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,name:i,...s}=n,a=Ay(h1,t),l=j8(h1,t),[u,d]=T.useState(null),f=zt(e,E=>d(E)),g=u?a.form||!!u.closest("form"):!0,m=OL(u),S=a.values[r],b=S===void 0?0:z8(S,a.min,a.max),x=cae(r,a.values.length),w=m==null?void 0:m[l.size],_=w?dae(w,b,l.direction):0;return T.useEffect(()=>{if(u)return a.thumbs.add(u),()=>{a.thumbs.delete(u)}},[u,a.thumbs]),p.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${b}% + ${_}px)`},children:[p.jsx(u1.ItemSlot,{scope:n.__scopeSlider,children:p.jsx(ht.span,{role:"slider","aria-label":n["aria-label"]||x,"aria-valuemin":a.min,"aria-valuenow":S,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...s,ref:f,style:S===void 0?{display:"none"}:n.style,onFocus:Me(n.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),g&&p.jsx(aae,{name:i??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:S},r)]})});N8.displayName=h1;var aae=n=>{const{value:e,...t}=n,r=T.useRef(null),i=eae(e);return T.useEffect(()=>{const s=r.current,a=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(a,"value").set;if(i!==e&&u){const d=new Event("input",{bubbles:!0});u.call(s,e),s.dispatchEvent(d)}},[i,e]),p.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:e})};function lae(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,s)=>i-s)}function z8(n,e,t){const s=100/(t-e)*(n-e);return E8(s,[0,100])}function cae(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function uae(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function dae(n,e,t){const r=n/2,s=FC([0,50],[0,r]);return(r-s(e)*t)*t}function hae(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function fae(n,e){if(e>0){const t=hae(n);return Math.min(...t)>=e}return!0}function FC(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function pae(n){return(String(n).split(".")[1]||"").length}function gae(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var mae=A8,yae=R8,Sae=L8,vae=N8;const bae=T.memo(function({onHistoryMark:e,title:t,steps:r,value:i,label:s,onValueChange:a,["data-testid"]:l}){const u=ot(),d=T.useCallback(m=>{a(m[0])},[a]),f=T.useCallback(()=>{e("click slider")},[e]),g=T.useCallback(()=>{i&&a(i)},[i,a]);return p.jsx("div",{className:"tlui-slider__container",children:p.jsxs(mae,{"data-testid":l,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:i?[i]:void 0,onPointerDown:f,onValueChange:d,onPointerUp:g,title:t+"  "+u(s),children:[p.jsx(yae,{className:"tlui-slider__track",dir:"ltr",children:i!==null&&p.jsx(Sae,{className:"tlui-slider__range",dir:"ltr"})}),i!==null&&p.jsx(vae,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function xae({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:s,itemsB:a,styleA:l,styleB:u,valueA:d,valueB:f,onValueChange:g}){const m=ot(),S=T.useMemo(()=>{var x;return((x=s.find(w=>d.type==="shared"&&d.value===w.value))==null?void 0:x.icon)??"mixed"},[s,d]),b=T.useMemo(()=>{var x;return((x=a.find(w=>f.type==="shared"&&f.value===w.value))==null?void 0:x.icon)??"mixed"},[a,f]);return d===void 0&&f===void 0?null:p.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[p.jsx("div",{title:m(n),className:"tlui-style-panel__double-select-picker-label",children:m(n)}),p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsxs(Bl,{id:`style panel ${e} A`,children:[p.jsx(Ul,{children:p.jsx(Le,{type:"icon","data-testid":`style.${e}`,title:m(r)+"  "+(d===null||d.type==="mixed"?m("style-panel.mixed"):m(`${e}-style.${d.value}`)),children:p.jsx(tt,{icon:S,small:!0,invertIcon:!0})})}),p.jsx($l,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map((x,w)=>p.jsx(Oh,{"data-testid":`style.${e}.${x.value}`,children:p.jsx(Le,{type:"icon",onClick:()=>g(l,x.value),title:`${m(r)}  ${m(`${e}-style.${x.value}`)}`,children:p.jsx(tt,{icon:x.icon,invertIcon:!0})},x.value)},w))})})]}),p.jsxs(Bl,{id:`style panel ${t}`,children:[p.jsx(Ul,{children:p.jsx(Le,{type:"icon","data-testid":`style.${t}`,title:m(i)+"  "+(f===null||f.type==="mixed"?m("style-panel.mixed"):m(`${t}-style.${f.value}`)),children:p.jsx(tt,{icon:b,small:!0})})}),p.jsx($l,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:a.map(x=>p.jsx(Oh,{children:p.jsx(Le,{type:"icon",title:`${m(i)}  ${m(`${t}-style.${x.value}`)}`,"data-testid":`style.${t}.${x.value}`,onClick:()=>g(u,x.value),children:p.jsx(tt,{icon:x.icon})})},x.value))})})]})]})]})}const wae=T.memo(xae);function _ae({id:n,label:e,uiType:t,stylePanelType:r,style:i,items:s,type:a,value:l,onValueChange:u}){const d=ot(),f=te(),g=T.useMemo(()=>{var x;return(x=s.find(w=>l.type==="shared"&&w.value===l.value))==null?void 0:x.icon},[s,l]),m=d(`style-panel.${r}`),S=l.type==="mixed"?d("style-panel.mixed"):m+"  "+d(`${t}-style.${l.value}`),b=e?d(e):"";return p.jsxs(Bl,{id:`style panel ${n}`,children:[p.jsx(Ul,{children:p.jsxs(Le,{type:a,"data-testid":`style.${t}`,title:S,children:[b&&p.jsx(cn,{children:b}),p.jsx(tt,{icon:g??"mixed"})]})}),p.jsx($l,{side:"left",align:"center",alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map(x=>p.jsx(Oh,{children:p.jsx(Le,{type:"icon","data-testid":`style.${t}.${x.value}`,title:m+"  "+d(`${t}-style.${x.value}`),onClick:()=>{f.markHistoryStoppingPoint("select style dropdown item"),u(i,x.value)},children:p.jsx(tt,{icon:x.icon})})},x.value))})})]})}const BC=T.memo(_ae);function Cae({styles:n}){const e=ef();if(!n)return null;const t=n.get(rs),r=n.get(Qg),i=n.get(Zg),s=n.get(nm),a=n.get(Ns),l=t===void 0,u=r===void 0&&i===void 0,d=s===void 0,f=a===void 0,g=Bo({isDarkMode:e});return p.jsxs(p.Fragment,{children:[p.jsx(Eae,{theme:g,styles:n}),!f&&p.jsx(Pae,{theme:g,styles:n}),!(l&&u&&d)&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[p.jsx(Tae,{styles:n}),p.jsx(Mae,{styles:n}),p.jsx(Iae,{styles:n})]})]})}function df(){const n=te(),e=$n();return ct.useMemo(()=>function(r,i){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(r,i),n.setStyleForNextShapes(r,i),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:i})},[n,e])}function Eae({styles:n,theme:e}){const t=ot(),r=te(),i=T.useCallback(g=>r.markHistoryStoppingPoint(g),[r]),s=df(),a=n.get(ii),l=n.get(Ll),u=n.get(Rl),d=n.get(zs),f=l!==void 0||u!==void 0||d!==void 0;return p.jsxs(p.Fragment,{children:[p.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[a===void 0?null:p.jsx(Tl,{title:t("style-panel.color"),uiType:"color",style:ii,items:Pi.color,value:a,onValueChange:s,theme:e,onHistoryMark:i}),p.jsx(Aae,{})]}),f&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[l===void 0?null:p.jsx(Tl,{title:t("style-panel.fill"),uiType:"fill",style:Ll,items:Pi.fill,value:l,onValueChange:s,theme:e,onHistoryMark:i}),u===void 0?null:p.jsx(Tl,{title:t("style-panel.dash"),uiType:"dash",style:Rl,items:Pi.dash,value:u,onValueChange:s,theme:e,onHistoryMark:i}),d===void 0?null:p.jsx(Tl,{title:t("style-panel.size"),uiType:"size",style:zs,items:Pi.size,value:d,onValueChange:(g,m)=>{s(g,m);const S=r.getSelectedShapeIds();S.length>0&&Lt(r,S)},theme:e,onHistoryMark:i})]})]})}function Pae({theme:n,styles:e}){const t=ot(),r=df(),i=te(),s=T.useCallback(f=>i.markHistoryStoppingPoint(f),[i]),a=e.get(Ns),l=e.get(pw),u=e.get(em),d=e.get(tm);return a===void 0&&u===void 0?null:p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[a===void 0?null:p.jsx(Tl,{title:t("style-panel.font"),uiType:"font",style:Ns,items:Pi.font,value:a,onValueChange:r,theme:n,onHistoryMark:s}),l===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(Tl,{title:t("style-panel.align"),uiType:"align",style:pw,items:Pi.textAlign,value:l,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:p.jsx(Le,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(tt,{icon:"vertical-align-middle"})})})]}),u===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(Tl,{title:t("style-panel.label-align"),uiType:"align",style:em,items:Pi.horizontalAlign,value:u,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:d===void 0?p.jsx(Le,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(tt,{icon:"vertical-align-middle"})}):p.jsx(BC,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:tm,items:Pi.verticalAlign,value:d,onValueChange:r})})]})]})}function Tae({styles:n}){const e=df(),t=n.get(rs);return t===void 0?null:p.jsx(BC,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:rs,items:Pi.geo,value:t,onValueChange:e})}function Iae({styles:n}){const e=df(),t=n.get(nm);return t===void 0?null:p.jsx(BC,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:nm,items:Pi.spline,value:t,onValueChange:e})}function Mae({styles:n}){const e=df(),t=n.get(Qg),r=n.get(Zg);return!t||!r?null:p.jsx(wae,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Zg,itemsA:Pi.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Qg,itemsB:Pi.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Zd=[.1,.25,.5,.75,1];function Aae(){const n=te(),e=T.useCallback(l=>n.markHistoryStoppingPoint(l),[n]),t=oe("opacity",()=>n.getSharedOpacity(),[n]),r=$n(),i=ot(),s=ct.useCallback(l=>{const u=Zd[l];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(u),n.setOpacityForNextShapes(u),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:l})},[n,r]);if(t===void 0)return null;const a=t.type==="mixed"?-1:Zd.indexOf(aF(Zd,l=>Math.abs(l-t.value)));return p.jsx(bae,{"data-testid":"style.opacity",value:a>=0?a:Zd.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:s,steps:Zd.length-1,title:i("style-panel.opacity"),onHistoryMark:e})}const kae=T.memo(function({isMobile:e,children:t}){const r=te(),i=T.useRef(null);qa(i);const s=C8(),a=T.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),l=t??p.jsx(Cae,{styles:s});return p.jsx("div",{ref:i,className:Oe("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:a,children:l})});function jae(){const n=te(),e=ot(),t=C8(),r=t==null?void 0:t.get(ii),i=Bo({isDarkMode:n.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?i[r.value]:i.black).solid,a=oe("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),l=T.useCallback(d=>{d||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:u}=Xa();return u?p.jsxs(RC,{id:"mobile style menu",onOpenChange:l,children:[p.jsx(LC,{children:p.jsx(Le,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":s},title:e("style-panel.title"),disabled:a,children:p.jsx(tt,{icon:a?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),p.jsx(NC,{side:"top",align:"end",children:u&&p.jsx(u,{isMobile:!0})})]}):null}function F8(){return p.jsxs(p.Fragment,{children:[p.jsx(Oae,{}),p.jsx(Dae,{}),p.jsx(Rae,{}),p.jsx(Lae,{}),p.jsx(Nae,{}),p.jsx(zae,{}),p.jsx(Fae,{}),p.jsx(Bae,{}),p.jsx(Uae,{}),p.jsx($ae,{}),p.jsx(Kae,{}),p.jsx(Hae,{}),p.jsx(Yae,{}),p.jsx(Wae,{}),p.jsx(qae,{}),p.jsx(Xae,{}),p.jsx(Vae,{}),p.jsx(Gae,{}),p.jsx(Zae,{}),p.jsx(Qae,{}),p.jsx(Jae,{}),p.jsx(ele,{}),p.jsx(tle,{}),p.jsx(nle,{}),p.jsx(rle,{}),p.jsx(ile,{}),p.jsx(ole,{}),p.jsx(sle,{})]})}function B8(n){var r;const e=te(),t=(r=n.meta)==null?void 0:r.geo;return oe("is tool selected",()=>{const i=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(rs);return t?i==="geo"&&s===t:i===n.id},[e,n.id,t])}function jt({tool:n}){const e=by(),t=B8(e[n]);return p.jsx(Mr,{toolId:n,isSelected:t})}function Oae(){return p.jsx(jt,{tool:"select"})}function Dae(){return p.jsx(jt,{tool:"hand"})}function Rae(){return p.jsx(jt,{tool:"draw"})}function Lae(){return p.jsx(jt,{tool:"eraser"})}function Nae(){return p.jsx(jt,{tool:"arrow"})}function zae(){return p.jsx(jt,{tool:"text"})}function Fae(){return p.jsx(jt,{tool:"note"})}function Bae(){return p.jsx(Mr,{toolId:"asset"})}function Uae(){return p.jsx(jt,{tool:"rectangle"})}function $ae(){return p.jsx(jt,{tool:"ellipse"})}function Hae(){return p.jsx(jt,{tool:"diamond"})}function Kae(){return p.jsx(jt,{tool:"triangle"})}function qae(){return p.jsx(jt,{tool:"rhombus"})}function Gae(){return p.jsx(jt,{tool:"heart"})}function Yae(){return p.jsx(jt,{tool:"hexagon"})}function Vae(){return p.jsx(jt,{tool:"cloud"})}function Xae(){return p.jsx(jt,{tool:"star"})}function Wae(){return p.jsx(jt,{tool:"oval"})}function Zae(){return p.jsx(jt,{tool:"x-box"})}function Qae(){return p.jsx(jt,{tool:"check-box"})}function Jae(){return p.jsx(jt,{tool:"arrow-left"})}function ele(){return p.jsx(jt,{tool:"arrow-up"})}function tle(){return p.jsx(jt,{tool:"arrow-down"})}function nle(){return p.jsx(jt,{tool:"arrow-right"})}function rle(){return p.jsx(jt,{tool:"line"})}function ile(){return p.jsx(jt,{tool:"highlight"})}function sle(){return p.jsx(jt,{tool:"frame"})}function ole(){return p.jsx(jt,{tool:"laser"})}const kx=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function jx(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function Qd(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function U8(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function $8(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function ale(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let i=!0;for(let s=0;s<t.length;s++)r.indexOf(t[s])===-1&&(i=!1);return i}const Rh={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":kx?173:189,"=":kx?61:187,";":kx?59:186,"'":222,"[":219,"]":221,"\\":220},$s={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},Ng={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Dn={16:!1,18:!1,17:!1,91:!1},Jt={};for(let n=1;n<20;n++)Rh["f".concat(n)]=111+n;let qt=[],Sh=null,H8="all";const Co=new Map,hf=n=>Rh[n.toLowerCase()]||$s[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),lle=n=>Object.keys(Rh).find(e=>Rh[e]===n),cle=n=>Object.keys($s).find(e=>$s[e]===n);function K8(n){H8=n||"all"}function Lh(){return H8||"all"}function ule(){return qt.slice(0)}function dle(){return qt.map(n=>lle(n)||cle(n)||String.fromCharCode(n))}function hle(){const n=[];return Object.keys(Jt).forEach(e=>{Jt[e].forEach(t=>{let{key:r,scope:i,mods:s,shortcut:a}=t;n.push({scope:i,shortcut:a,mods:s,keys:r.split("+").map(l=>hf(l))})})}),n}function fle(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function ple(n){return typeof n=="string"&&(n=hf(n)),qt.indexOf(n)!==-1}function gle(n,e){let t,r;n||(n=Lh());for(const i in Jt)if(Object.prototype.hasOwnProperty.call(Jt,i))for(t=Jt[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(a=>{let{element:l}=a;return UC(l)}):r++;Lh()===n&&K8(e||"all")}function mle(n){let e=n.keyCode||n.which||n.charCode;const t=qt.indexOf(e);if(t>=0&&qt.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&qt.splice(0,qt.length),(e===93||e===224)&&(e=91),e in Dn){Dn[e]=!1;for(const r in $s)$s[r]===e&&(Ti[r]=!1)}}function q8(n){if(typeof n>"u")Object.keys(Jt).forEach(i=>{Array.isArray(Jt[i])&&Jt[i].forEach(s=>ng(s)),delete Jt[i]}),UC(null);else if(Array.isArray(n))n.forEach(i=>{i.key&&ng(i)});else if(typeof n=="object")n.key&&ng(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[i,s]=t;typeof i=="function"&&(s=i,i=""),ng({key:n,scope:i,method:s,splitKey:"+"})}}const ng=n=>{let{key:e,scope:t,method:r,splitKey:i="+"}=n;$8(e).forEach(a=>{const l=a.split(i),u=l.length,d=l[u-1],f=d==="*"?"*":hf(d);if(!Jt[f])return;t||(t=Lh());const g=u>1?U8($s,l):[],m=[];Jt[f]=Jt[f].filter(S=>{const x=(r?S.method===r:!0)&&S.scope===t&&ale(S.mods,g);return x&&m.push(S.element),!x}),m.forEach(S=>UC(S))})};function dj(n,e,t,r){if(e.element!==r)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const s in Dn)Object.prototype.hasOwnProperty.call(Dn,s)&&(!Dn[s]&&e.mods.indexOf(+s)>-1||Dn[s]&&e.mods.indexOf(+s)===-1)&&(i=!1);(e.mods.length===0&&!Dn[16]&&!Dn[18]&&!Dn[17]&&!Dn[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(qt),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function hj(n,e){const t=Jt["*"];let r=n.keyCode||n.which||n.charCode;if(!Ti.filter.call(this,n))return;if((r===93||r===224)&&(r=91),qt.indexOf(r)===-1&&r!==229&&qt.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const u=Ng[l];n[l]&&qt.indexOf(u)===-1?qt.push(u):!n[l]&&qt.indexOf(u)>-1?qt.splice(qt.indexOf(u),1):l==="metaKey"&&n[l]&&(qt=qt.filter(d=>d in Ng||d===r))}),r in Dn){Dn[r]=!0;for(const l in $s)$s[l]===r&&(Ti[l]=!0);if(!t)return}for(const l in Dn)Object.prototype.hasOwnProperty.call(Dn,l)&&(Dn[l]=n[Ng[l]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(qt.indexOf(17)===-1&&qt.push(17),qt.indexOf(18)===-1&&qt.push(18),Dn[17]=!0,Dn[18]=!0);const i=Lh();if(t)for(let l=0;l<t.length;l++)t[l].scope===i&&(n.type==="keydown"&&t[l].keydown||n.type==="keyup"&&t[l].keyup)&&dj(n,t[l],i,e);if(!(r in Jt))return;const s=Jt[r],a=s.length;for(let l=0;l<a;l++)if((n.type==="keydown"&&s[l].keydown||n.type==="keyup"&&s[l].keyup)&&s[l].key){const u=s[l],{splitKey:d}=u,f=u.key.split(d),g=[];for(let m=0;m<f.length;m++)g.push(hf(f[m]));g.sort().join("")===qt.sort().join("")&&dj(n,u,i,e)}}function Ti(n,e,t){qt=[];const r=$8(n);let i=[],s="all",a=document,l=0,u=!1,d=!0,f="+",g=!1,m=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(a=e.element),e.keyup&&(u=e.keyup),e.keydown!==void 0&&(d=e.keydown),e.capture!==void 0&&(g=e.capture),typeof e.splitKey=="string"&&(f=e.splitKey),e.single===!0&&(m=!0)),typeof e=="string"&&(s=e),m&&q8(n,s);l<r.length;l++)n=r[l].split(f),i=[],n.length>1&&(i=U8($s,n)),n=n[n.length-1],n=n==="*"?"*":hf(n),n in Jt||(Jt[n]=[]),Jt[n].push({keyup:u,keydown:d,scope:s,mods:i,shortcut:r[l],method:t,key:r[l],splitKey:f,element:a});if(typeof a<"u"&&window){if(!Co.has(a)){const S=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return hj(x,a)},b=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;hj(x,a),mle(x)};Co.set(a,{keydownListener:S,keyupListenr:b,capture:g}),jx(a,"keydown",S,g),jx(a,"keyup",b,g)}if(!Sh){const S=()=>{qt=[]};Sh={listener:S,capture:g},jx(window,"focus",S,g)}}}function yle(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Jt).forEach(t=>{Jt[t].filter(i=>i.scope===e&&i.shortcut===n).forEach(i=>{i&&i.method&&i.method()})})}function UC(n){const e=Object.values(Jt).flat();if(e.findIndex(r=>{let{element:i}=r;return i===n})<0){const{keydownListener:r,keyupListenr:i,capture:s}=Co.get(n)||{};r&&i&&(Qd(n,"keyup",i,s),Qd(n,"keydown",r,s),Co.delete(n))}if((e.length<=0||Co.size<=0)&&(Object.keys(Co).forEach(i=>{const{keydownListener:s,keyupListenr:a,capture:l}=Co.get(i)||{};s&&a&&(Qd(i,"keyup",a,l),Qd(i,"keydown",s,l),Co.delete(i))}),Co.clear(),Object.keys(Jt).forEach(i=>delete Jt[i]),Sh)){const{listener:i,capture:s}=Sh;Qd(window,"focus",i,s),Sh=null}}const Ox={getPressedKeyString:dle,setScope:K8,getScope:Lh,deleteScope:gle,getPressedKeyCodes:ule,getAllKeyCodes:hle,isPressed:ple,filter:fle,trigger:yle,unbind:q8,keyMap:Rh,modifier:$s,modifierMap:Ng};for(const n in Ox)Object.prototype.hasOwnProperty.call(Ox,n)&&(Ti[n]=Ox[n]);if(typeof window<"u"){const n=window.hotkeys;Ti.noConflict=e=>(e&&window.hotkeys===Ti&&(window.hotkeys=n),Ti),window.hotkeys=Ti}const fj=["copy","cut","paste","asset"];function Sle(){const n=te(),e=ai(),t=Xl(),r=by(),i=oe("is focused",()=>n.getInstanceState().isFocused,[n]);T.useEffect(()=>{if(!i)return;const s=new Array,a=(u,d)=>{Ti(u,{element:document.body},d),s.push(()=>{Ti.unbind(u,d)})},l=(u,d)=>{Ti(u,{element:document.body,keyup:!0,keydown:!1},d),s.push(()=>{Ti.unbind(u,d)})};for(const u of Object.values(t))u.kbd&&(e&&!u.readonlyOk||fj.includes(u.id)||a(pj(u.kbd),d=>{ch(n)||(Ze(d),u.onSelect("kbd"))}));for(const u of Object.values(r))!u.kbd||!u.readonlyOk&&n.getIsReadonly()||fj.includes(u.id)||a(pj(u.kbd),d=>{ch(n)||(Ze(d),u.onSelect("kbd"))});return a(",",u=>{if(ch(n)||n.inputs.keys.has("Comma"))return;Ze(u),n.focus(),n.inputs.keys.add("Comma");const{x:d,y:f,z:g}=n.inputs.currentPagePoint,m=n.pageToScreen({x:d,y:f}),S={type:"pointer",name:"pointer_down",point:{x:m.x,y:m.y,z:g},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:er(u),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(S)}),l(",",u=>{if(ch(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:d,y:f,z:g}=n.inputs.currentScreenPoint,m={type:"pointer",name:"pointer_up",point:{x:d,y:f,z:g},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:er(u),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(m)}),()=>{s.forEach(u=>u())}},[t,r,e,n,i])}function pj(n){return vle(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd++${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function vle(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function ch(n){return n.menus.hasAnyOpenMenus()||n.getEditingShapeId()!==null||n.getCrashingError()}const ble=T.createContext(!1),xle={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function wle({children:n}){const e=te(),t=wu(),r=mr(),i=ot(),s=T.useRef([]),a=Math.min(8,5+r),[l,u]=T.useState(0),d=T.useRef(null),[f,g]=T.useState(null),m=T.useMemo(()=>{const b=f?`:not([data-value="${f}"])`:"";return`
			#${t}_main > *:nth-child(n + ${a+(f?1:2)})${b} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${a}) {
				display: none;
			}
        `},[f,t,a]),S=Km(()=>{var _;if(!d.current)return;const b=Array.from(d.current.children);u(b.length),b.findIndex(E=>E.getAttribute("data-value")===f)<=a&&g(null);const w=Array.from(d.current.children).findIndex(E=>E.getAttribute("aria-checked")==="true");w!==-1&&(w>=a&&g(b[w].getAttribute("data-value")),s.current=Array.from(((_=d.current)==null?void 0:_.children)??[]).filter(E=>!(E instanceof HTMLElement)||E.tagName.toLowerCase()!=="button"?!1:!!(E.offsetWidth||E.offsetHeight)))});return T.useLayoutEffect(()=>{S()}),T.useLayoutEffect(()=>{if(!d.current)return;const b=new MutationObserver(S);return b.observe(d.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{b.disconnect()}},[S]),T.useEffect(()=>{if(!e.options.enableToolbarKeyboardShortcuts)return;function b(x){var _;if(ch(e)||ID()||x.ctrlKey||x.metaKey||x.altKey||x.shiftKey)return;const w=xle[x.key];typeof w=="number"&&(Ze(x),(_=s.current[w])==null||_.click())}return document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b)}},[e]),p.jsxs(p.Fragment,{children:[p.jsx("style",{children:m}),p.jsxs("div",{className:Oe("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<sn.TABLET_SM}),role:"radiogroup",children:[p.jsx("div",{id:`${t}_main`,ref:d,className:"tlui-toolbar__tools__list",children:p.jsx(Oi,{type:"toolbar",sourceId:"toolbar",children:n})}),l>a+1&&p.jsx(ble.Provider,{value:!0,children:p.jsxs(Bl,{id:"toolbar overflow",modal:!1,children:[p.jsx(Ul,{children:p.jsx(Le,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:p.jsx(tt,{icon:"chevron-up"})})}),p.jsx($l,{side:"top",align:"center",children:p.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:p.jsx(Oi,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function _le({activeToolId:n}){const e=te(),t=mr(),r=ot(),i=oe("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=oe("current tool",()=>e.getCurrentTool(),[e]);return!n||!s.isLockable?null:p.jsx(Le,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Oe("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<sn.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:p.jsx(tt,{icon:i?"lock":"unlock",small:!0})})}const G8=T.memo(function({children:e}){const t=te(),r=mr(),i=ai(),s=oe("current tool id",()=>t.getCurrentToolId(),[t]),a=T.useRef(null);qa(a);const{ActionsMenu:l,QuickActions:u}=Xa(),d=t.options.actionShortcutsLocation==="menu"?!1:t.options.actionShortcutsLocation==="toolbar"?!0:r<sn.TABLET;return p.jsx("div",{ref:a,className:"tlui-toolbar",children:p.jsxs("div",{className:"tlui-toolbar__inner",children:[p.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&p.jsxs("div",{className:"tlui-toolbar__extras",children:[d&&p.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[u&&p.jsx(u,{}),l&&p.jsx(l,{})]}),p.jsx(_le,{activeToolId:s})]}),p.jsx(wle,{children:e??p.jsx(F8,{})})]}),r<sn.TABLET_SM&&!i&&p.jsx("div",{className:"tlui-toolbar__tools",children:p.jsx(jae,{})})]})})});function Cle(){const n=ot();return p.jsxs("div",{className:Oe("tlui-offline-indicator"),children:[n("status.offline"),p.jsx(Bs,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function Ele({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:s}){const a=T.useRef(null),l=mr(),u=T.useCallback(()=>{const d=a.current;if(!d)return;const f=d.parentElement.parentElement,g=f.querySelector(".tlui-layout__top__left"),m=f.querySelector(".tlui-layout__top__right"),S=f.offsetWidth,b=g.offsetWidth,x=m.offsetWidth,w=d.offsetWidth-e;let _=(S-w)/2;S%2!==0&&(_-=.5);const E=b+r,M=d.offsetLeft,I=Math.min(S-x-b-2*r,n),A=Math.max(_,E)-M;m.offsetWidth>t&&l<=6?d.style.setProperty("max-width",I-i+"px"):d.style.setProperty("max-width",I+"px"),d.style.setProperty("transform",`translate(${A}px, 0px)`)},[l,e,r,n,i,t]);return T.useLayoutEffect(()=>{const d=a.current;if(!d)return;const f=d.parentElement.parentElement,g=f.querySelector(".tlui-layout__top__left"),m=f.querySelector(".tlui-layout__top__right"),S=new ResizeObserver(u);return S.observe(g),S.observe(m),S.observe(f),S.observe(d),u(),()=>{S.disconnect()}},[u]),T.useLayoutEffect(()=>{u()}),p.jsx("div",{ref:a,className:"tlui-top-panel__container",children:s})}function Ple(){const n=ZJ()==="offline";return p.jsx(Ele,{children:n&&p.jsx(Cle,{})})}function Tle(){return p.jsxs(p.Fragment,{children:[p.jsx(he,{actionId:"zoom-in",noClose:!0}),p.jsx(he,{actionId:"zoom-out",noClose:!0}),p.jsx(Wz,{}),p.jsx(Zz,{}),p.jsx(Qz,{})]})}const Ile=T.memo(function({children:e}){const t=bn(),[r,i]=$o("zoom menu"),s=e??p.jsx(Tle,{});return p.jsxs(Q_,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[p.jsx(J_,{asChild:!0,dir:"ltr",children:p.jsx(Mle,{})}),p.jsx(uy,{container:t,children:p.jsx(eC,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:p.jsx(Oi,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),Mle=T.forwardRef(function(e,t){const r=te(),i=mr(),s=oe("zoom",()=>r.getZoomLevel(),[r]),a=ot(),l=T.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return p.jsx(Le,{ref:t,...e,type:"icon",title:`${a("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<sn.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,children:i<sn.MOBILE?null:p.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(s*100),"%"]})})}),Y8=T.createContext(null);function Ale({overrides:n={},children:e}){const t=Cu(n),r=gy();return p.jsx(Y8.Provider,{value:T.useMemo(()=>({ContextMenu:Yse,ActionsMenu:xse,HelpMenu:null,ZoomMenu:Ile,MainMenu:Toe,Minimap:Noe,StylePanel:kae,PageMenu:Uoe,NavigationPanel:Foe,Toolbar:G8,KeyboardShortcutsDialog:moe,QuickActions:qoe,HelperButtons:poe,DebugPanel:soe,DebugMenu:ioe,MenuPanel:coe,SharePanel:r?Qoe:null,CursorChatBubble:r?Wse:null,TopPanel:r?Ple:null,Dialogs:hte,Toasts:mte,...t}),[t,r]),children:e})}function Xa(){const n=T.useContext(Y8);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}const kle=Bn(function({overrides:e,components:t,assetUrls:r,onUiEvent:i,forceMobile:s,mediaMimeTypes:a,children:l}){const u=Ha();return p.jsx(Q6.Provider,{value:a,children:p.jsx(_J,{assetUrls:Xie(r),children:p.jsx(PJ,{overrides:Qee(e),locale:(u==null?void 0:u.user.getLocale())??Cs.locale,children:p.jsx(gX,{onEvent:i,children:p.jsx(wee,{children:p.jsx(JJ,{context:"tla",children:p.jsx(QJ,{forceMobile:s,children:p.jsx(Ale,{overrides:t,children:u?p.jsx(jle,{overrides:e,children:l}):l})})})})})})})})});function jle({overrides:n,children:e}){const t=Jee(n);return p.jsx(tte,{overrides:t.actions,children:p.jsx(yte,{overrides:t.tools,children:e})})}function Ole(){const n=te(),{addToast:e}=Uo();T.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const Dle=ct.memo(function({renderDebugMenuItems:e,children:t,hideUi:r,components:i,...s}){return p.jsx(kle,{...s,components:i,children:p.jsx(Rle,{hideUi:r,renderDebugMenuItems:e,children:t})})}),Rle=ct.memo(function({children:e,hideUi:t,...r}){return p.jsxs(p.Fragment,{children:[e,t?null:p.jsx(Lle,{...r})]})}),Lle=ct.memo(function(){const e=te(),t=ot(),r=mr(),i=ai(),s=oe("focus",()=>e.getInstanceState().isFocusMode,[e]),a=oe("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:l,TopPanel:u,MenuPanel:d,StylePanel:f,Toolbar:g,HelpMenu:m,NavigationPanel:S,HelperButtons:b,DebugPanel:x,CursorChatBubble:w,Toasts:_,Dialogs:E}=Xa();Sle(),Bee(),Ole();const{"toggle-focus-mode":M}=Xl();return p.jsxs("div",{className:Oe("tlui-layout",{"tlui-layout__mobile":r<sn.TABLET_SM}),"data-breakpoint":r,children:[s?p.jsx("div",{className:"tlui-layout__top",children:p.jsx(Le,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>M.onSelect("menu"),children:p.jsx(tt,{icon:"dot"})})}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"tlui-layout__top",children:[p.jsxs("div",{className:"tlui-layout__top__left",children:[d&&p.jsx(d,{}),b&&p.jsx(b,{})]}),p.jsx("div",{className:"tlui-layout__top__center",children:u&&p.jsx(u,{})}),p.jsxs("div",{className:"tlui-layout__top__right",children:[l&&p.jsx(l,{}),f&&r>=sn.TABLET_SM&&!i&&p.jsx(f,{})]})]}),p.jsxs("div",{className:"tlui-layout__bottom",children:[p.jsxs("div",{className:"tlui-layout__bottom__main",children:[S&&p.jsx(S,{}),g&&p.jsx(g,{}),m&&p.jsx(m,{})]}),a&&x&&p.jsx(x,{})]})]}),_&&p.jsx(_,{}),E&&p.jsx(E,{}),p.jsx(Gie,{}),w&&p.jsx(w,{})]})});async function Nle(n,e){const{url:t,style:r="normal",weight:i="500",display:s,featureSettings:a,stretch:l,unicodeRange:u,variant:d,format:f}=e,g={style:r,weight:i,display:s,featureSettings:a,stretch:l,unicodeRange:u,variant:d},m=new FontFace(n,`url(${t})`,g);return await m.load(),document.fonts.add(m),m.$$_url=t,m.$$_fontface=`
@font-face {
	font-family: ${m.family};
	font-stretch: ${m.stretch};
	font-weight: ${m.weight};
	font-style: ${m.style};
	src: url("${t}") format("${f}")
}`,m}const rg=(n,e)=>{const[t,r]=T.useState(2);return T.useEffect(()=>{let i=!1;return r(2),Nle(n,e).then(()=>{i||r(0)}).catch(s=>{i||(console.error(s),r(1))}),()=>{i=!0}},[n,e]),t};function zle(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function V8(n){const e=T.useMemo(()=>zle(n),[n]),t=[rg("tldraw_draw",e.draw),rg("tldraw_serif",e.serif),rg("tldraw_sans",e.sansSerif),rg("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}const Fle=[...qie,...Dne];function Ble(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:a,components:l={},shapeUtils:u=[],bindingUtils:d=[],tools:f=[],embeds:g,...m}=n,S=Cu(l),b=T.useMemo(()=>({Scribble:Ek,ShapeIndicators:Ite,CollaboratorScribble:Ek,SelectionForeground:Ete,SelectionBackground:_te,Handles:Ste,...S}),[S]),x=Ca(u),w=T.useMemo(()=>Fv("type",x,BN),[x]),_=Ca(d),E=T.useMemo(()=>Fv("type",_,oN),[_]),M=Ca(f),I=T.useMemo(()=>Fv("id",Fle,M),[M]),A=Ca(i??Nh),j=Ca(s??_m),D=T.useMemo(()=>[...A,...j],[A,j]),R=Cz(m.assetUrls),{done:q,error:L}=V8(R);return L?p.jsx(fL,{children:"Could not load assets. Please refresh the page."}):q?(w.find(G=>G.type==="embed")&&g&&xm.setEmbedDefinitions(g),p.jsx(eX,{initialState:"select",...m,components:b,shapeUtils:w,bindingUtils:E,tools:I,children:p.jsxs(Dle,{...m,components:b,mediaMimeTypes:D,children:[p.jsx(Ule,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:A,acceptedVideoMimeTypes:j,onMount:a}),e]})})):p.jsx(__,{children:p.jsx(l_,{})})}function Ule({maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r,onMount:i}){const s=te(),a=Uo(),l=ot();pL(()=>{const f=[];return f.push(gie(s)),ine(s,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r,toasts:a,msg:l}),f.push(s.store.props.onMount(s)),f.push(i==null?void 0:i(s)),()=>{f.forEach(g=>g==null?void 0:g())}});const{Canvas:u}=Ht(),{ContextMenu:d}=Xa();return d?p.jsx(d,{}):u?p.jsx(u,{}):null}T.memo(function(e){const[t,r]=T.useState(null),[i,s]=T.useState(null),a=Ca(e.shapeUtils??[]),l=T.useMemo(()=>[...BN,...a],[a]),u=Ca(e.bindingUtils??[]),d=T.useMemo(()=>[...oN,...u],[u]),f=aX({snapshot:e.snapshot,shapeUtils:l}),g=Cz(e.assetUrls),{done:m,error:S}=V8(g),{pageId:b,bounds:x,scale:w,pixelRatio:_,background:E,padding:M,darkMode:I,preserveAspectRatio:A,format:j="svg",licenseKey:D}=e;return T.useLayoutEffect(()=>{if(!i||!f||!m)return;let R=!1;const q=document.createElement("div");i.appendChild(q),i.classList.add("tl-container","tl-theme__light");const L=new _e({store:f,shapeUtils:l,bindingUtils:d,tools:[],getContainer:()=>q,licenseKey:D});b&&L.setCurrentPage(b);const K=L.getCurrentPageShapeIds();async function G(){const z=await L.toImage([...K],{bounds:x,scale:w,background:E,padding:M,darkMode:I,preserveAspectRatio:A,format:j});if(!z||R)return;const U=URL.createObjectURL(z.blob);r(U),L.dispose()}return G(),()=>{R=!0}},[j,i,f,l,d,b,x,w,E,M,I,A,m,S,D,_]),T.useEffect(()=>()=>{t&&URL.revokeObjectURL(t)},[t]),S?p.jsx(fL,{children:"Could not load assets."}):m?p.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&p.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):p.jsx(__,{children:p.jsx(l_,{})})});T.memo(function({children:e}){const t=ot(),r=mr(),i=T.useRef(null);qa(i);const s=e??p.jsx(yoe,{});return r<sn.MOBILE?null:p.jsx("div",{ref:i,className:"tlui-help-menu",children:p.jsxs(Bl,{id:"help menu",children:[p.jsx(Ul,{children:p.jsx(Le,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:p.jsx(tt,{icon:"question-mark",small:!0})})}),p.jsx($l,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:p.jsx(Oi,{type:"menu",sourceId:"help-menu",children:s})})]})})});const $le=nt({schemaVersion:ir(1),storeVersion:ag,recordVersions:Xg(qe,nt({version:ag,subTypeVersions:Xg(qe,ag).optional(),subTypeKey:qe.optional()}))}),Hle=nt({schemaVersion:ir(2),sequences:Xg(qe,ag)});nt({tldrawFileFormatVersion:ZU,schema:QU("schemaVersion",{1:$le,2:Hle}),records:Ln(nt({id:qe,typeName:qe}).allowUnknownProperties())});Fa("tldraw","3.8.1","esm");class f1 extends Mi{getDefaultProps(){return{w:200,h:200,text:"I'm a card!"}}getBoundsSnapGeometry(e){return new ji({width:e.props.h/2,height:e.props.w/2,isFilled:!0})}canEdit(){return!1}canResize(){return!0}isAspectRatioLocked(){return!1}getGeometry(e){return new ji({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return tf(e,t)}component(e){return p.jsx(jo,{style:{backgroundColor:"#efefef"},children:p.jsx("span",{style:{position:"absolute",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",height:e.props.h/2,width:e.props.w/2},children:e.props.text})})}indicator(e){return p.jsx("rect",{width:e.props.w,height:e.props.h})}}O(f1,"type","card-shape"),O(f1,"props",{w:Fe,h:Fe,text:qe});function Kle(n){const e=Math.floor(Math.random()*n.length);return n[e]}const qle=["Lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","Sed","placerat","auctor","eros","vitae","suscipit","Quisque","tempor","sodales","ipsum","sed","dictum","urna","luctus","ut","Vestibulum","vel","convallis","urna","Donec","eu","pellentesque","lacus","mattis","ultrices","nulla","Proin","tellus","odio","facilisis","quis","efficitur","at","tincidunt","et","urna","Sed","euismod","eros","vel","nulla","lobortis"],gj=12;class X8 extends Ae{onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){const{currentPagePoint:e}=this.editor.inputs;this.editor.createShape({type:"card-shape",x:e.x-gj,y:e.y-gj,props:{text:Kle(qle)}})}}O(X8,"id","card");const Gle=[f1],Yle=[X8],Vle={tools:(n,e)=>({...e,card:{id:"card",label:"Card",icon:"",kbd:"",onSelect(){n.setCurrentTool("card")}}})},Xle=n=>{n.user.updateUserPreferences({isSnapMode:!0})};function Wle(){const n=by(),e=B8(n.card);return p.jsxs(G8,{children:[p.jsx(Pn,{...n.card,isSelected:e}),p.jsx(F8,{})]})}const Zle={Toolbar:Wle};function Qle(){return p.jsx("div",{style:{position:"fixed",inset:0},children:p.jsx(Ble,{shapeUtils:Gle,tools:Yle,overrides:Vle,components:Zle,initialState:"card",onMount:Xle})})}yj.createRoot(document.getElementById("root")).render(p.jsx(T.StrictMode,{children:p.jsx(Qle,{})}));
